{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Agentica","text":"<p>\u8f7b\u91cf\u7ea7\u3001\u529f\u80fd\u5f3a\u5927\u7684 Python \u6846\u67b6\uff0c\u7528\u4e8e\u6784\u5efa\u81ea\u4e3b AI \u667a\u80fd\u4f53\u3002</p> <p> </p>"},{"location":"#agentica_1","title":"\u4e3a\u4ec0\u4e48\u9009\u62e9 Agentica\uff1f","text":"<ul> <li>Async-First \u67b6\u6784 \u2014 \u6240\u6709\u6838\u5fc3\u65b9\u6cd5\u539f\u751f async\uff0c\u540c\u6b65\u9002\u914d\u5668\u65e0\u7f1d\u517c\u5bb9\u3002</li> <li>\u5f00\u53d1\u8005\u53cb\u597d \u2014 \u7b80\u6d01\u76f4\u89c2\u7684\u9762\u5411\u5bf9\u8c61 API\uff0c\u6781\u4f4e\u5b66\u4e60\u66f2\u7ebf\u3002</li> <li>\u6a21\u5757\u5316\u53ef\u6269\u5c55 \u2014 \u6a21\u578b\u3001\u8bb0\u5fc6\u540e\u7aef\u3001\u5411\u91cf\u5b58\u50a8\u5747\u53ef\u81ea\u7531\u66ff\u6362\u3002</li> <li>\u529f\u80fd\u5b8c\u5907 \u2014 \u5185\u7f6e 40+ \u5de5\u5177\u3001RAG\u3001\u591a\u667a\u80fd\u4f53\u56e2\u961f\u3001\u5de5\u4f5c\u6d41\u7f16\u6392\u3001\u5b89\u5168\u5b88\u536b\u3002</li> <li>\u751f\u4ea7\u5c31\u7eea \u2014 CLI / Web UI / API \u670d\u52a1\u591a\u79cd\u90e8\u7f72\u65b9\u5f0f\uff0c\u652f\u6301 MCP \u4e0e ACP \u534f\u8bae\u3002</li> </ul>"},{"location":"#_1","title":"\u7cfb\u7edf\u67b6\u6784","text":""},{"location":"#_2","title":"\u5feb\u901f\u5bfc\u822a","text":"\u6587\u6863 \u5185\u5bb9 \u5feb\u901f\u5165\u95e8 \u5b89\u88c5\u3001\u73af\u5883\u914d\u7f6e\u3001\u7b2c\u4e00\u4e2a Agent \u6838\u5fc3\u6982\u5ff5 Agent Agent \u6838\u5fc3\u6982\u5ff5\u3001Model\u3001Memory\u3001Tools Team &amp; Workflow \u591a\u667a\u80fd\u4f53\u56e2\u961f\u534f\u4f5c\u4e0e\u5de5\u4f5c\u6d41\u7f16\u6392 \u4f7f\u7528\u6307\u5357 CLI \u7ec8\u7aef \u547d\u4ee4\u884c\u4ea4\u4e92\u6a21\u5f0f \u5de5\u5177\u7cfb\u7edf \u5185\u7f6e\u5de5\u5177\u3001\u81ea\u5b9a\u4e49\u5de5\u5177 RAG \u77e5\u8bc6\u5e93\u3001\u5411\u91cf\u68c0\u7d22\u3001\u6df7\u5408\u641c\u7d22 MCP Model Context Protocol \u96c6\u6210 \u6a21\u578b\u63d0\u4f9b\u5546 20+ \u6a21\u578b\u63d0\u4f9b\u5546\u914d\u7f6e\u6307\u5357 \u5b89\u5168\u5b88\u536b \u8f93\u5165\u8f93\u51fa\u9a8c\u8bc1\u3001\u5de5\u5177\u7ea7\u5b88\u536b \u6700\u4f73\u5b9e\u8df5 \u8bbe\u8ba1\u539f\u5219\u3001\u63d0\u793a\u8bcd\u5de5\u7a0b\u3001\u751f\u4ea7\u90e8\u7f72 Benchmark \u6027\u80fd\u8bc4\u6d4b\u7ed3\u679c API \u53c2\u8003 Agent API Agent \u7c7b\u5b8c\u6574 API"},{"location":"#30","title":"30 \u79d2\u4e0a\u624b","text":"<pre><code>pip install -U agentica\nexport ZHIPUAI_API_KEY=\"your-api-key\"\n</code></pre> <pre><code>import asyncio\nfrom agentica import Agent, ZhipuAI\n\nasync def main():\n    agent = Agent(model=ZhipuAI())\n    result = await agent.run(\"\u4e00\u53e5\u8bdd\u4ecb\u7ecd\u5317\u4eac\")\n    print(result.content)\n\nasyncio.run(main())\n</code></pre> <pre><code>\u5317\u4eac\u662f\u4e2d\u56fd\u7684\u9996\u90fd\uff0c\u662f\u4e00\u5ea7\u62e5\u6709\u4e09\u5343\u591a\u5e74\u5386\u53f2\u7684\u6587\u5316\u540d\u57ce\uff0c\u4e5f\u662f\u5168\u56fd\u7684\u653f\u6cbb\u3001\u6587\u5316\u548c\u56fd\u9645\u4ea4\u6d41\u4e2d\u5fc3\u3002\n</code></pre> <p>\u67e5\u770b\u5b8c\u6574\u5feb\u901f\u5165\u95e8 \u2192</p>"},{"location":"#_3","title":"\u793e\u533a\u4e0e\u652f\u6301","text":"<ul> <li>GitHub Issues \u2014 \u63d0\u4ea4 issue</li> <li>\u5fae\u4fe1\u4ea4\u6d41\u7fa4 \u2014 \u6dfb\u52a0\u5fae\u4fe1\u53f7 <code>xuming624</code>\uff0c\u5907\u6ce8 \"llm\"</li> </ul>"},{"location":"#_4","title":"\u8bb8\u53ef\u8bc1","text":"<p>Apache License 2.0</p>"},{"location":"API_REFERENCE/","title":"Agentica API \u53c2\u8003\u6587\u6863","text":"<p>\u5b8c\u6574\u7684 API \u53c2\u8003\uff0c\u5305\u542b\u6240\u6709\u516c\u5f00\u7c7b\u548c\u65b9\u6cd5</p>"},{"location":"API_REFERENCE/#_1","title":"\u76ee\u5f55","text":"<ul> <li>Agent</li> <li>Model</li> <li>Memory</li> <li>Tools</li> <li>Knowledge</li> <li>VectorDB</li> <li>Database</li> <li>Workflow</li> <li>RunResponse</li> </ul>"},{"location":"API_REFERENCE/#agent","title":"Agent","text":""},{"location":"API_REFERENCE/#class-agent","title":"<code>class Agent</code>","text":"<p>\u6838\u5fc3 Agent \u7c7b\uff0c\u5b9e\u73b0 AI \u4ee3\u7406\u7684\u5b8c\u6574\u529f\u80fd\u3002</p> <pre><code>from agentica import Agent\n</code></pre>"},{"location":"API_REFERENCE/#_2","title":"\u6784\u9020\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>model</code> <code>Model</code> <code>None</code> LLM \u6a21\u578b\u5b9e\u4f8b <code>name</code> <code>str</code> <code>None</code> Agent \u540d\u79f0 <code>agent_id</code> <code>str</code> <code>None</code> Agent \u552f\u4e00\u6807\u8bc6\uff08\u81ea\u52a8\u751f\u6210 UUID\uff09 <code>user_id</code> <code>str</code> <code>None</code> \u7528\u6237 ID <code>session_id</code> <code>str</code> <code>None</code> \u4f1a\u8bdd ID <code>description</code> <code>str</code> <code>None</code> Agent \u63cf\u8ff0 <code>instructions</code> <code>str \\| List[str] \\| Callable</code> <code>None</code> \u6307\u4ee4/\u63d0\u793a\u8bcd <code>system_prompt</code> <code>str \\| Callable</code> <code>None</code> \u7cfb\u7edf\u63d0\u793a\u8bcd <code>tools</code> <code>List[Tool \\| Callable]</code> <code>None</code> \u5de5\u5177\u5217\u8868 <code>knowledge</code> <code>Knowledge</code> <code>None</code> \u77e5\u8bc6\u5e93 <code>memory</code> <code>AgentMemory</code> <code>AgentMemory()</code> \u5185\u5b58\u7ba1\u7406\u5668 <code>db</code> <code>BaseDb</code> <code>None</code> \u6301\u4e45\u5316\u6570\u636e\u5e93 <code>team</code> <code>List[Agent]</code> <code>None</code> Agent \u56e2\u961f <code>role</code> <code>str</code> <code>None</code> \u56e2\u961f\u4e2d\u7684\u89d2\u8272 <code>enable_multi_round</code> <code>bool</code> <code>False</code> \u542f\u7528\u591a\u8f6e\u5bf9\u8bdd\u7b56\u7565 <code>max_rounds</code> <code>int</code> <code>100</code> \u6700\u5927\u5bf9\u8bdd\u8f6e\u6570 <code>max_tokens</code> <code>int</code> <code>128000</code> \u6700\u5927 token \u6570 <code>response_model</code> <code>Type[BaseModel]</code> <code>None</code> \u7ed3\u6784\u5316\u8f93\u51fa\u6a21\u578b <code>structured_outputs</code> <code>bool</code> <code>False</code> \u4f7f\u7528\u7ed3\u6784\u5316\u8f93\u51fa <code>add_history_to_messages</code> <code>bool</code> <code>False</code> \u6dfb\u52a0\u5386\u53f2\u5230\u6d88\u606f <code>num_history_responses</code> <code>int</code> <code>3</code> \u5386\u53f2\u54cd\u5e94\u6570\u91cf <code>add_references</code> <code>bool</code> <code>False</code> \u6dfb\u52a0\u77e5\u8bc6\u5e93\u5f15\u7528 <code>markdown</code> <code>bool</code> <code>False</code> Markdown \u683c\u5f0f\u8f93\u51fa <code>debug</code> <code>bool</code> <code>False</code> \u8c03\u8bd5\u6a21\u5f0f"},{"location":"API_REFERENCE/#_3","title":"\u65b9\u6cd5","text":""},{"location":"API_REFERENCE/#async-runmessage-kwargs-runresponse","title":"<code>async run(message, **kwargs) -&gt; RunResponse</code>","text":"<p>\u5f02\u6b65\u8fd0\u884c Agent\uff08\u975e\u6d41\u5f0f\uff09\u3002</p> <pre><code># \u5f02\u6b65\u975e\u6d41\u5f0f\nresponse = await agent.run(\"\u4f60\u597d\")\nprint(response.content)\n</code></pre> <p>\u53c2\u6570: - <code>message</code>: <code>str | List | Dict | Message</code> - \u8f93\u5165\u6d88\u606f - <code>**kwargs</code>: \u5176\u4ed6\u53c2\u6570\u4f20\u9012\u7ed9\u6a21\u578b</p> <p>\u8fd4\u56de: <code>RunResponse</code></p>"},{"location":"API_REFERENCE/#async-run_streammessage-kwargs-asynciteratorrunresponse","title":"<code>async run_stream(message, **kwargs) -&gt; AsyncIterator[RunResponse]</code>","text":"<p>\u5f02\u6b65\u6d41\u5f0f\u8fd0\u884c Agent\u3002</p> <pre><code># \u5f02\u6b65\u6d41\u5f0f\nasync for chunk in agent.run_stream(\"\u4f60\u597d\"):\n    print(chunk.content, end=\"\")\n</code></pre> <p>\u53c2\u6570: - <code>message</code>: <code>str | List | Dict | Message</code> - \u8f93\u5165\u6d88\u606f - <code>**kwargs</code>: \u5176\u4ed6\u53c2\u6570\u4f20\u9012\u7ed9\u6a21\u578b</p> <p>\u8fd4\u56de: <code>AsyncIterator[RunResponse]</code></p>"},{"location":"API_REFERENCE/#run_syncmessage-kwargs-runresponse","title":"<code>run_sync(message, **kwargs) -&gt; RunResponse</code>","text":"<p>\u540c\u6b65\u8fd0\u884c Agent\uff08\u975e\u6d41\u5f0f\uff09\u3002\u5185\u90e8\u8c03\u7528 <code>run()</code> \u7684\u540c\u6b65\u9002\u914d\u5668\u3002</p> <pre><code># \u540c\u6b65\u975e\u6d41\u5f0f\nresponse = agent.run_sync(\"\u4f60\u597d\")\nprint(response.content)\n</code></pre> <p>\u53c2\u6570: - <code>message</code>: <code>str | List | Dict | Message</code> - \u8f93\u5165\u6d88\u606f - <code>**kwargs</code>: \u5176\u4ed6\u53c2\u6570\u4f20\u9012\u7ed9\u6a21\u578b</p> <p>\u8fd4\u56de: <code>RunResponse</code></p>"},{"location":"API_REFERENCE/#run_stream_syncmessage-kwargs-iteratorrunresponse","title":"<code>run_stream_sync(message, **kwargs) -&gt; Iterator[RunResponse]</code>","text":"<p>\u540c\u6b65\u6d41\u5f0f\u8fd0\u884c Agent\u3002\u5185\u90e8\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u9a71\u52a8\u5f02\u6b65\u8fed\u4ee3\u5668\u3002</p> <pre><code># \u540c\u6b65\u6d41\u5f0f\nfor chunk in agent.run_stream_sync(\"\u4f60\u597d\"):\n    print(chunk.content, end=\"\")\n</code></pre> <p>\u53c2\u6570: - <code>message</code>: <code>str | List | Dict | Message</code> - \u8f93\u5165\u6d88\u606f - <code>**kwargs</code>: \u5176\u4ed6\u53c2\u6570\u4f20\u9012\u7ed9\u6a21\u578b</p> <p>\u8fd4\u56de: <code>Iterator[RunResponse]</code></p>"},{"location":"API_REFERENCE/#async-print_responsemessage-kwargs-async-print_response_streammessage-kwargs","title":"<code>async print_response(message, **kwargs)</code> / <code>async print_response_stream(message, **kwargs)</code>","text":"<p>\u5f02\u6b65\u6253\u5370\u683c\u5f0f\u5316\u7684\u54cd\u5e94\uff08\u975e\u6d41\u5f0f / \u6d41\u5f0f\uff09\u3002</p> <pre><code># \u975e\u6d41\u5f0f\nawait agent.print_response(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n\n# \u6d41\u5f0f\nawait agent.print_response_stream(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"API_REFERENCE/#print_response_syncmessage-kwargs-print_response_stream_syncmessage-kwargs","title":"<code>print_response_sync(message, **kwargs)</code> / <code>print_response_stream_sync(message, **kwargs)</code>","text":"<p>\u540c\u6b65\u6253\u5370\u683c\u5f0f\u5316\u7684\u54cd\u5e94\uff08\u975e\u6d41\u5f0f / \u6d41\u5f0f\uff09\u3002</p> <pre><code># \u975e\u6d41\u5f0f\nagent.print_response_sync(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n\n# \u6d41\u5f0f\nagent.print_response_stream_sync(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"API_REFERENCE/#cli_appuseruser-streamfalse","title":"<code>cli_app(user=\"User\", stream=False)</code>","text":"<p>\u542f\u52a8\u547d\u4ee4\u884c\u4ea4\u4e92\u754c\u9762\u3002</p> <pre><code>agent.cli_app()\n</code></pre>"},{"location":"API_REFERENCE/#get_chat_history-listmessage","title":"<code>get_chat_history() -&gt; List[Message]</code>","text":"<p>\u83b7\u53d6\u804a\u5929\u5386\u53f2\u3002</p> <pre><code>history = agent.get_chat_history()\n</code></pre>"},{"location":"API_REFERENCE/#search_knowledge_basequery-num_documentsnone-str","title":"<code>search_knowledge_base(query, num_documents=None) -&gt; str</code>","text":"<p>\u641c\u7d22\u77e5\u8bc6\u5e93\uff08Agentic RAG\uff09\u3002</p> <pre><code>results = agent.search_knowledge_base(\"\u4ec0\u4e48\u662f\u673a\u5668\u5b66\u4e60\uff1f\")\n</code></pre>"},{"location":"API_REFERENCE/#as_tooltool_namenone-tool_descriptionnone-function","title":"<code>as_tool(tool_name=None, tool_description=None) -&gt; Function</code>","text":"<p>\u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\u4f9b\u5176\u4ed6 Agent \u4f7f\u7528\u3002</p> <pre><code>researcher_tool = researcher_agent.as_tool(\n    tool_name=\"research\",\n    tool_description=\"\u8fdb\u884c\u6df1\u5ea6\u7814\u7a76\"\n)\n</code></pre>"},{"location":"API_REFERENCE/#model","title":"Model","text":""},{"location":"API_REFERENCE/#model_1","title":"\u57fa\u7c7b <code>Model</code>","text":"<p>\u6240\u6709\u6a21\u578b\u7684\u57fa\u7c7b\u3002</p> <pre><code>from agentica import Model\n</code></pre>"},{"location":"API_REFERENCE/#_4","title":"\u901a\u7528\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u63cf\u8ff0 <code>model</code> <code>str</code> \u6a21\u578b ID <code>api_key</code> <code>str</code> API \u5bc6\u94a5 <code>base_url</code> <code>str</code> API \u57fa\u7840 URL <code>temperature</code> <code>float</code> \u6e29\u5ea6\u53c2\u6570 <code>max_tokens</code> <code>int</code> \u6700\u5927\u8f93\u51fa token <code>timeout</code> <code>int</code> \u8bf7\u6c42\u8d85\u65f6\uff08\u79d2\uff09"},{"location":"API_REFERENCE/#openai","title":"OpenAI \u6a21\u578b","text":"<pre><code>from agentica import OpenAIChat\n\nmodel = OpenAIChat(\n    model=\"gpt-4o\",\n    api_key=\"sk-xxx\",  # \u6216\u8bbe\u7f6e OPENAI_API_KEY \u73af\u5883\u53d8\u91cf\n    temperature=0.7,\n)\n</code></pre>"},{"location":"API_REFERENCE/#azure-openai","title":"Azure OpenAI","text":"<pre><code>from agentica import AzureOpenAIChat\n\nmodel = AzureOpenAIChat(\n    model=\"gpt-4o\",\n    azure_endpoint=\"https://xxx.openai.azure.com/\",\n    api_key=\"xxx\",\n    api_version=\"2024-02-15-preview\",\n)\n</code></pre>"},{"location":"API_REFERENCE/#deepseek","title":"DeepSeek","text":"<pre><code>from agentica import DeepSeek\n\nmodel = DeepSeek(model=\"deepseek-chat\")\n</code></pre>"},{"location":"API_REFERENCE/#claude","title":"Claude","text":"<pre><code>from agentica import Claude\n\nmodel = Claude(model=\"claude-3-5-sonnet-20241022\")\n</code></pre>"},{"location":"API_REFERENCE/#_5","title":"\u5176\u4ed6\u6a21\u578b","text":"<pre><code>from agentica import (\n    Moonshot,      # \u6708\u4e4b\u6697\u9762\n    Qwen,          # \u901a\u4e49\u5343\u95ee\n    ZhipuAI,       # \u667a\u8c31 AI\n    Doubao,        # \u8c46\u5305\n    Yi,            # \u96f6\u4e00\u4e07\u7269\n    Gemini,        # Google Gemini\n    Grok,          # xAI Grok\n    Ollama,        # \u672c\u5730\u6a21\u578b\n    Together,      # Together AI\n    Groq,          # Groq\n)\n</code></pre>"},{"location":"API_REFERENCE/#memory","title":"Memory","text":""},{"location":"API_REFERENCE/#class-agentmemory","title":"<code>class AgentMemory</code>","text":"<p>Agent \u5185\u5b58\u7ba1\u7406\u3002</p> <pre><code>from agentica import AgentMemory\n</code></pre>"},{"location":"API_REFERENCE/#_6","title":"\u6784\u9020\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>db</code> <code>BaseDb</code> <code>None</code> \u6301\u4e45\u5316\u6570\u636e\u5e93 <code>create_user_memories</code> <code>bool</code> <code>False</code> \u521b\u5efa\u7528\u6237\u957f\u671f\u8bb0\u5fc6 <code>create_session_summary</code> <code>bool</code> <code>False</code> \u521b\u5efa\u4f1a\u8bdd\u6458\u8981"},{"location":"API_REFERENCE/#_7","title":"\u5de5\u5382\u65b9\u6cd5","text":""},{"location":"API_REFERENCE/#agentmemorywith_dbdb-user_idnone-create_user_memoriesfalse","title":"<code>AgentMemory.with_db(db, user_id=None, create_user_memories=False)</code>","text":"<p>\u4f7f\u7528\u6570\u636e\u5e93\u521b\u5efa\u5185\u5b58\u5b9e\u4f8b\u3002</p> <pre><code>from agentica import AgentMemory, SqliteDb\n\nmemory = AgentMemory.with_db(\n    db=SqliteDb(table_name=\"agent_sessions\", db_file=\"agent.db\"),\n    user_id=\"user-1\",\n    create_user_memories=True,\n)\n</code></pre>"},{"location":"API_REFERENCE/#class-memory","title":"<code>class Memory</code>","text":"<p>\u5355\u6761\u8bb0\u5fc6\u6570\u636e\u6a21\u578b\u3002</p> <pre><code>from agentica import Memory\n\nmemory = Memory(\n    memory=\"\u7528\u6237\u559c\u6b22 Python \u7f16\u7a0b\",\n    id=\"mem-1\",\n)\n</code></pre>"},{"location":"API_REFERENCE/#class-memorymanager","title":"<code>class MemoryManager</code>","text":"<p>\u8bb0\u5fc6\u7ba1\u7406\u5668\uff0c\u7528\u4e8e CRUD \u64cd\u4f5c\u3002</p> <pre><code>from agentica import MemoryManager\n\nmanager = MemoryManager(db=db, user_id=\"user-1\")\nmanager.add_memory(\"\u7528\u6237\u662f\u9ad8\u7ea7\u5de5\u7a0b\u5e08\")\nmanager.delete_memory(\"mem-1\")\n</code></pre>"},{"location":"API_REFERENCE/#tools","title":"Tools","text":""},{"location":"API_REFERENCE/#class-tool","title":"<code>class Tool</code>","text":"<p>\u5de5\u5177\u57fa\u7c7b\u3002</p> <pre><code>from agentica import Tool\n</code></pre>"},{"location":"API_REFERENCE/#_8","title":"\u521b\u5efa\u81ea\u5b9a\u4e49\u5de5\u5177","text":"<p>\u65b9\u5f0f 1: \u4f7f\u7528\u51fd\u6570</p> <pre><code>def get_weather(city: str) -&gt; str:\n    \"\"\"\u83b7\u53d6\u57ce\u5e02\u5929\u6c14\n\n    Args:\n        city: \u57ce\u5e02\u540d\u79f0\n    \"\"\"\n    return f\"{city}\u5929\u6c14\u6674\u6717\uff0c25\u00b0C\"\n\nagent = Agent(tools=[get_weather])\n</code></pre> <p>\u65b9\u5f0f 2: \u7ee7\u627f Tool \u7c7b</p> <pre><code>from agentica import Tool\n\nclass WeatherTool(Tool):\n    def __init__(self):\n        super().__init__(name=\"weather\")\n        self.register(self.get_weather)\n\n    def get_weather(self, city: str) -&gt; str:\n        \"\"\"\u83b7\u53d6\u57ce\u5e02\u5929\u6c14\"\"\"\n        return f\"{city}\u5929\u6c14\u6674\u6717\"\n</code></pre>"},{"location":"API_REFERENCE/#class-function","title":"<code>class Function</code>","text":"<p>\u51fd\u6570\u5b9a\u4e49\u6a21\u578b\u3002</p> <pre><code>from agentica import Function\n\nfunc = Function.from_callable(my_function, strict=True)\n</code></pre>"},{"location":"API_REFERENCE/#_9","title":"\u5c5e\u6027","text":"\u5c5e\u6027 \u7c7b\u578b \u63cf\u8ff0 <code>name</code> <code>str</code> \u51fd\u6570\u540d <code>description</code> <code>str</code> \u51fd\u6570\u63cf\u8ff0 <code>parameters</code> <code>Dict</code> JSON Schema \u53c2\u6570 <code>entrypoint</code> <code>Callable</code> \u5b9e\u9645\u51fd\u6570 <code>strict</code> <code>bool</code> \u4e25\u683c\u6a21\u5f0f <code>show_result</code> <code>bool</code> \u663e\u793a\u7ed3\u679c\u7ed9\u7528\u6237 <code>stop_after_tool_call</code> <code>bool</code> \u8c03\u7528\u540e\u505c\u6b62"},{"location":"API_REFERENCE/#_10","title":"\u5185\u7f6e\u5de5\u5177","text":"<pre><code>from agentica.tools import (\n    # \u641c\u7d22\n    DuckDuckGoTool,\n    BaiduSearchTool,\n    SerperTool,\n    ExaTool,\n\n    # \u4ee3\u7801\u6267\u884c\n    RunPythonCodeTool,\n    ShellTool,\n\n    # \u6587\u4ef6\u64cd\u4f5c\n    FileTool,\n    EditTool,\n\n    # \u7f51\u9875\n    UrlCrawlerTool,\n    JinaTool,\n    BrowserTool,\n\n    # \u77e5\u8bc6\n    ArxivTool,\n    WikipediaTool,\n\n    # \u591a\u5a92\u4f53\n    DalleTool,\n    CogViewTool,\n    CogVideoTool,\n\n    # \u5176\u4ed6\n    CalculatorTool,\n    WeatherTool,\n    YFinanceTool,\n)\n</code></pre>"},{"location":"API_REFERENCE/#knowledge","title":"Knowledge","text":""},{"location":"API_REFERENCE/#class-knowledge","title":"<code>class Knowledge</code>","text":"<p>\u77e5\u8bc6\u5e93\u7ba1\u7406\u3002</p> <pre><code>from agentica import Knowledge\n</code></pre>"},{"location":"API_REFERENCE/#_11","title":"\u6784\u9020\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u63cf\u8ff0 <code>data_path</code> <code>str \\| List[str]</code> <code>None</code> \u6570\u636e\u6587\u4ef6/\u76ee\u5f55\u8def\u5f84 <code>vector_db</code> <code>VectorDb</code> <code>None</code> \u5411\u91cf\u6570\u636e\u5e93 <code>embedder</code> <code>Embedder</code> <code>None</code> \u5d4c\u5165\u6a21\u578b <code>num_documents</code> <code>int</code> <code>3</code> \u68c0\u7d22\u6587\u6863\u6570 <code>chunk_size</code> <code>int</code> <code>2000</code> \u5206\u5757\u5927\u5c0f <code>chunk</code> <code>bool</code> <code>True</code> \u662f\u5426\u5206\u5757"},{"location":"API_REFERENCE/#_12","title":"\u65b9\u6cd5","text":""},{"location":"API_REFERENCE/#loadrecreatefalse-upsertfalse","title":"<code>load(recreate=False, upsert=False)</code>","text":"<p>\u52a0\u8f7d\u77e5\u8bc6\u5e93\u3002</p> <pre><code>knowledge = Knowledge(\n    data_path=\"./docs\",\n    vector_db=LanceDb(table_name=\"docs\", uri=\"./lancedb\"),\n)\nknowledge.load(recreate=True)\n</code></pre>"},{"location":"API_REFERENCE/#searchquery-num_documentsnone-listdocument","title":"<code>search(query, num_documents=None) -&gt; List[Document]</code>","text":"<p>\u641c\u7d22\u77e5\u8bc6\u5e93\u3002</p> <pre><code>docs = knowledge.search(\"\u4ec0\u4e48\u662f RAG\uff1f\", num_documents=5)\n</code></pre>"},{"location":"API_REFERENCE/#vectordb","title":"VectorDB","text":""},{"location":"API_REFERENCE/#vectordb_1","title":"\u57fa\u7c7b <code>VectorDb</code>","text":"<p>\u5411\u91cf\u6570\u636e\u5e93\u62bd\u8c61\u57fa\u7c7b\u3002</p> <pre><code>from agentica import VectorDb\n</code></pre>"},{"location":"API_REFERENCE/#lancedb","title":"LanceDB","text":"<pre><code>from agentica.vectordb import LanceDb\n\ndb = LanceDb(\n    table_name=\"documents\",\n    uri=\"./lancedb\",\n    embedder=OpenAIEmbedder(),\n)\n</code></pre>"},{"location":"API_REFERENCE/#chromadb","title":"ChromaDB","text":"<pre><code>from agentica.vectordb import ChromaDb\n\ndb = ChromaDb(\n    collection=\"documents\",\n    path=\"./chromadb\",\n)\n</code></pre>"},{"location":"API_REFERENCE/#_13","title":"\u5176\u4ed6\u5411\u91cf\u6570\u636e\u5e93","text":"<pre><code>from agentica.vectordb import (\n    InMemoryVectorDb,  # \u5185\u5b58\n    PgVectorDb,        # PostgreSQL\n    PineconeDb,        # Pinecone\n    QdrantDb,          # Qdrant\n)\n</code></pre>"},{"location":"API_REFERENCE/#_14","title":"\u901a\u7528\u65b9\u6cd5","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>create()</code> \u521b\u5efa\u6570\u636e\u5e93/\u8868 <code>insert(documents)</code> \u63d2\u5165\u6587\u6863 <code>upsert(documents)</code> \u66f4\u65b0\u6216\u63d2\u5165\u6587\u6863 <code>search(query, limit=5)</code> \u641c\u7d22\u6587\u6863 <code>delete()</code> \u5220\u9664\u6570\u636e\u5e93 <code>exists()</code> \u68c0\u67e5\u662f\u5426\u5b58\u5728"},{"location":"API_REFERENCE/#database","title":"Database","text":""},{"location":"API_REFERENCE/#basedb","title":"\u57fa\u7c7b <code>BaseDb</code>","text":"<p>\u6570\u636e\u5e93\u62bd\u8c61\u57fa\u7c7b\uff0c\u7528\u4e8e\u4f1a\u8bdd\u548c\u8bb0\u5fc6\u6301\u4e45\u5316\u3002</p> <pre><code>from agentica import BaseDb\n</code></pre>"},{"location":"API_REFERENCE/#sqlite","title":"SQLite","text":"<pre><code>from agentica import SqliteDb\n\ndb = SqliteDb(\n    table_name=\"agent_sessions\",\n    db_file=\"agent.db\",\n)\n</code></pre>"},{"location":"API_REFERENCE/#postgresql","title":"PostgreSQL","text":"<pre><code>from agentica import PostgresDb\n\ndb = PostgresDb(\n    table_name=\"agent_sessions\",\n    db_url=\"postgresql://user:pass@localhost/db\",\n)\n</code></pre>"},{"location":"API_REFERENCE/#_15","title":"\u5176\u4ed6\u6570\u636e\u5e93","text":"<pre><code>from agentica import InMemoryDb, JsonDb\n</code></pre>"},{"location":"API_REFERENCE/#workflow","title":"Workflow","text":""},{"location":"API_REFERENCE/#class-workflow","title":"<code>class Workflow</code>","text":"<p>\u5de5\u4f5c\u6d41\u5f15\u64ce\u3002</p> <pre><code>from agentica import Workflow\n</code></pre>"},{"location":"API_REFERENCE/#_16","title":"\u521b\u5efa\u5de5\u4f5c\u6d41","text":"<pre><code>from agentica import Workflow, Agent, RunResponse\nfrom pydantic import Field\n\nclass MyWorkflow(Workflow):\n    researcher: Agent = Field(...)\n    writer: Agent = Field(...)\n\n    async def run(self, topic: str) -&gt; RunResponse:\n        # \u7814\u7a76\u9636\u6bb5\n        research = await self.researcher.run(f\"\u7814\u7a76: {topic}\")\n\n        # \u5199\u4f5c\u9636\u6bb5\n        article = await self.writer.run(f\"\u57fa\u4e8e\u4ee5\u4e0b\u7814\u7a76\u5199\u6587\u7ae0:\\n{research.content}\")\n\n        return RunResponse(content=article.content)\n\n# \u4f7f\u7528\nworkflow = MyWorkflow(\n    researcher=Agent(name=\"Researcher\", ...),\n    writer=Agent(name=\"Writer\", ...),\n)\n\n# \u5f02\u6b65\u8fd0\u884c\nresult = await workflow.run(\"\u4eba\u5de5\u667a\u80fd\u7684\u672a\u6765\")\n\n# \u540c\u6b65\u8fd0\u884c\uff08\u4f7f\u7528\u9002\u914d\u5668\uff09\nresult = workflow.run_sync(\"\u4eba\u5de5\u667a\u80fd\u7684\u672a\u6765\")\n</code></pre>"},{"location":"API_REFERENCE/#runresponse","title":"RunResponse","text":""},{"location":"API_REFERENCE/#class-runresponse","title":"<code>class RunResponse</code>","text":"<p>Agent \u8fd0\u884c\u54cd\u5e94\u3002</p> <pre><code>from agentica import RunResponse\n</code></pre>"},{"location":"API_REFERENCE/#_17","title":"\u5c5e\u6027","text":"\u5c5e\u6027 \u7c7b\u578b \u63cf\u8ff0 <code>content</code> <code>Any</code> \u54cd\u5e94\u5185\u5bb9 <code>content_type</code> <code>str</code> \u5185\u5bb9\u7c7b\u578b <code>event</code> <code>str</code> \u4e8b\u4ef6\u7c7b\u578b <code>messages</code> <code>List[Message]</code> \u6d88\u606f\u5217\u8868 <code>metrics</code> <code>Dict</code> \u6307\u6807\u6570\u636e <code>model</code> <code>str</code> \u6a21\u578b\u540d\u79f0 <code>run_id</code> <code>str</code> \u8fd0\u884c ID <code>session_id</code> <code>str</code> \u4f1a\u8bdd ID <code>tools</code> <code>List[Dict]</code> \u5de5\u5177\u8c03\u7528 <code>images</code> <code>List[Image]</code> \u56fe\u7247 <code>reasoning_content</code> <code>str</code> \u63a8\u7406\u5185\u5bb9"},{"location":"API_REFERENCE/#_18","title":"\u65b9\u6cd5","text":""},{"location":"API_REFERENCE/#to_json-str","title":"<code>to_json() -&gt; str</code>","text":"<p>\u8f6c\u6362\u4e3a JSON \u5b57\u7b26\u4e32\u3002</p>"},{"location":"API_REFERENCE/#to_dict-dict","title":"<code>to_dict() -&gt; Dict</code>","text":"<p>\u8f6c\u6362\u4e3a\u5b57\u5178\u3002</p>"},{"location":"API_REFERENCE/#class-runevent","title":"<code>class RunEvent</code>","text":"<p>\u8fd0\u884c\u4e8b\u4ef6\u679a\u4e3e\u3002</p> <pre><code>from agentica import RunEvent\n\nRunEvent.run_started\nRunEvent.run_response\nRunEvent.run_completed\nRunEvent.tool_call_started\nRunEvent.tool_call_completed\nRunEvent.multi_round_turn\nRunEvent.multi_round_completed\n</code></pre>"},{"location":"API_REFERENCE/#pprint_run_responseresponse-markdowntrue","title":"<code>pprint_run_response(response, markdown=True)</code>","text":"<p>\u683c\u5f0f\u5316\u6253\u5370\u54cd\u5e94\u3002</p> <pre><code>from agentica import pprint_run_response\n\npprint_run_response(response, markdown=True)\n</code></pre>"},{"location":"API_REFERENCE/#mcp-model-context-protocol","title":"MCP (Model Context Protocol)","text":""},{"location":"API_REFERENCE/#class-mcpconfig","title":"<code>class MCPConfig</code>","text":"<p>MCP \u670d\u52a1\u5668\u914d\u7f6e\u3002</p> <pre><code>from agentica import MCPConfig\n\nconfig = MCPConfig(\n    servers=[\n        {\n            \"name\": \"filesystem\",\n            \"command\": \"npx\",\n            \"args\": [\"-y\", \"@anthropic/mcp-filesystem\", \"/path/to/dir\"],\n        }\n    ]\n)\n\nagent = Agent(mcp_config=config)\n</code></pre>"},{"location":"API_REFERENCE/#_19","title":"\u5b9e\u7528\u5de5\u5177","text":""},{"location":"API_REFERENCE/#token","title":"Token \u8ba1\u6570","text":"<pre><code>from agentica import count_tokens, count_text_tokens\n\n# \u8ba1\u7b97\u6587\u672c token\ntokens = count_text_tokens(\"Hello, world!\", model_id=\"gpt-4o\")\n\n# \u8ba1\u7b97\u6d88\u606f token\ntokens = count_tokens(messages, tools=tools, model_id=\"gpt-4o\")\n</code></pre>"},{"location":"API_REFERENCE/#_20","title":"\u538b\u7f29\u7ba1\u7406","text":"<pre><code>from agentica import CompressionManager\n\nmanager = CompressionManager(\n    compress_tool_results=True,\n    compress_token_limit=50000,\n)\n\nagent = Agent(\n    compression_manager=manager,\n    compress_tool_results=True,\n)\n</code></pre> <p>\u6587\u6863\u6700\u540e\u66f4\u65b0: 2026-02-11</p>"},{"location":"BEST_PRACTICES/","title":"Agentica \u6700\u4f73\u5b9e\u8df5","text":"<p>Agent \u5f00\u53d1\u7684\u63a8\u8350\u6a21\u5f0f\u3001\u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898\u89e3\u51b3\u65b9\u6848</p>"},{"location":"BEST_PRACTICES/#_1","title":"\u76ee\u5f55","text":"<ul> <li>Agent \u8bbe\u8ba1\u539f\u5219</li> <li>\u63d0\u793a\u8bcd\u5de5\u7a0b</li> <li>\u5de5\u5177\u4f7f\u7528</li> <li>\u5185\u5b58\u7ba1\u7406</li> <li>RAG \u6700\u4f73\u5b9e\u8df5</li> <li>\u591a\u8f6e\u5bf9\u8bdd</li> <li>\u56e2\u961f\u534f\u4f5c</li> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u9519\u8bef\u5904\u7406</li> <li>\u751f\u4ea7\u90e8\u7f72</li> </ul>"},{"location":"BEST_PRACTICES/#agent","title":"Agent \u8bbe\u8ba1\u539f\u5219","text":""},{"location":"BEST_PRACTICES/#1","title":"1. \u5355\u4e00\u804c\u8d23","text":"<p>\u6bcf\u4e2a Agent \u5e94\u8be5\u4e13\u6ce8\u4e8e\u4e00\u4e2a\u7279\u5b9a\u4efb\u52a1\u3002</p> <pre><code># \u2705 \u597d\u7684\u8bbe\u8ba1\uff1a\u4e13\u6ce8\u7684 Agent\nresearcher = Agent(\n    name=\"Researcher\",\n    instructions=[\"\u4e13\u6ce8\u4e8e\u4fe1\u606f\u641c\u7d22\u548c\u6574\u7406\"],\n    tools=[DuckDuckGoTool(), ArxivTool()],\n)\n\nwriter = Agent(\n    name=\"Writer\",\n    instructions=[\"\u4e13\u6ce8\u4e8e\u5185\u5bb9\u5199\u4f5c\"],\n)\n\n# \u274c \u907f\u514d\uff1a\u529f\u80fd\u8fc7\u591a\u7684 Agent\ndo_everything_agent = Agent(\n    name=\"DoEverything\",\n    instructions=[\"\u641c\u7d22\u3001\u5199\u4f5c\u3001\u7f16\u7a0b\u3001\u5206\u6790...\"],\n    tools=[...20\u4e2a\u5de5\u5177...],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#2","title":"2. \u6e05\u6670\u7684\u6307\u4ee4","text":"<p>\u63d0\u4f9b\u660e\u786e\u3001\u5177\u4f53\u7684\u6307\u4ee4\u3002</p> <pre><code># \u2705 \u597d\u7684\u6307\u4ee4\nagent = Agent(\n    instructions=[\n        \"\u4f60\u662f\u4e00\u4e2a Python \u4ee3\u7801\u5ba1\u67e5\u4e13\u5bb6\",\n        \"\u68c0\u67e5\u4ee3\u7801\u65f6\u5173\u6ce8\uff1a\u5b89\u5168\u6027\u3001\u6027\u80fd\u3001\u53ef\u8bfb\u6027\",\n        \"\u4f7f\u7528\u4e2d\u6587\u56de\u590d\",\n        \"\u53d1\u73b0\u95ee\u9898\u65f6\u63d0\u4f9b\u4fee\u590d\u5efa\u8bae\",\n    ],\n)\n\n# \u274c \u6a21\u7cca\u7684\u6307\u4ee4\nagent = Agent(\n    instructions=[\"\u4f60\u662f\u4e00\u4e2a\u52a9\u624b\"],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#3","title":"3. \u9002\u5f53\u7684\u5de5\u5177\u6570\u91cf","text":"<p>\u5de5\u5177\u8fc7\u591a\u4f1a\u964d\u4f4e\u51c6\u786e\u6027\u3002</p> <pre><code># \u2705 \u63a8\u8350\uff1a3-7 \u4e2a\u76f8\u5173\u5de5\u5177\nagent = Agent(\n    tools=[\n        DuckDuckGoTool(),\n        UrlCrawlerTool(),\n        FileTool(),\n    ],\n)\n\n# \u274c \u907f\u514d\uff1a\u8fc7\u591a\u5de5\u5177\nagent = Agent(\n    tools=[...15\u4e2a\u5de5\u5177...],  # \u6a21\u578b\u53ef\u80fd\u6df7\u6dc6\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#_2","title":"\u63d0\u793a\u8bcd\u5de5\u7a0b","text":""},{"location":"BEST_PRACTICES/#1_1","title":"1. \u7ed3\u6784\u5316\u6307\u4ee4","text":"<pre><code>agent = Agent(\n    instructions=[\n        # \u89d2\u8272\u5b9a\u4e49\n        \"\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u6570\u636e\u5206\u6790\u5e08\",\n\n        # \u80fd\u529b\u63cf\u8ff0\n        \"\u4f60\u53ef\u4ee5\uff1a\u5206\u6790\u6570\u636e\u3001\u751f\u6210\u56fe\u8868\u3001\u64b0\u5199\u62a5\u544a\",\n\n        # \u884c\u4e3a\u7ea6\u675f\n        \"\u5206\u6790\u65f6\u59cb\u7ec8\u9a8c\u8bc1\u6570\u636e\u8d28\u91cf\",\n        \"\u4f7f\u7528 Python \u8fdb\u884c\u6570\u636e\u5904\u7406\",\n\n        # \u8f93\u51fa\u683c\u5f0f\n        \"\u62a5\u544a\u683c\u5f0f\uff1a\u6458\u8981 -&gt; \u8be6\u7ec6\u5206\u6790 -&gt; \u7ed3\u8bba\",\n    ],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_1","title":"2. \u4f7f\u7528\u7cfb\u7edf\u63d0\u793a\u8bcd","text":"<pre><code># \u9759\u6001\u7cfb\u7edf\u63d0\u793a\u8bcd\nagent = Agent(\n    system_prompt=\"\u4f60\u662f\u4e00\u4e2a\u53cb\u597d\u7684\u52a9\u624b\uff0c\u4f7f\u7528\u7b80\u6d01\u7684\u8bed\u8a00\u56de\u7b54\u95ee\u9898\u3002\",\n)\n\n# \u52a8\u6001\u7cfb\u7edf\u63d0\u793a\u8bcd\ndef get_system_prompt(agent):\n    return f\"\"\"\n    \u5f53\u524d\u65f6\u95f4: {datetime.now()}\n    \u7528\u6237ID: {agent.user_id}\n    \u4f1a\u8bddID: {agent.session_id}\n\n    \u4f60\u662f\u4e00\u4e2a\u667a\u80fd\u52a9\u624b\u3002\n    \"\"\"\n\nagent = Agent(system_prompt=get_system_prompt)\n</code></pre>"},{"location":"BEST_PRACTICES/#3_1","title":"3. \u52a8\u6001\u6307\u4ee4","text":"<pre><code>def get_instructions(agent):\n    base = [\"\u4f60\u662f\u4e00\u4e2a\u52a9\u624b\"]\n\n    # \u6839\u636e\u4e0a\u4e0b\u6587\u6dfb\u52a0\u6307\u4ee4\n    if agent.session_state.get(\"mode\") == \"expert\":\n        base.append(\"\u4f7f\u7528\u4e13\u4e1a\u672f\u8bed\u56de\u7b54\")\n    else:\n        base.append(\"\u4f7f\u7528\u7b80\u5355\u6613\u61c2\u7684\u8bed\u8a00\")\n\n    return base\n\nagent = Agent(instructions=get_instructions)\n</code></pre>"},{"location":"BEST_PRACTICES/#4-few-shot","title":"4. Few-shot \u793a\u4f8b","text":"<pre><code>agent = Agent(\n    instructions=[\n        \"\u5c06\u7528\u6237\u8f93\u5165\u8f6c\u6362\u4e3a SQL \u67e5\u8be2\",\n        \"\",\n        \"\u793a\u4f8b\uff1a\",\n        \"\u8f93\u5165\uff1a\u67e5\u627e\u6240\u6709\u5e74\u9f84\u5927\u4e8e 30 \u7684\u7528\u6237\",\n        \"\u8f93\u51fa\uff1aSELECT * FROM users WHERE age &gt; 30\",\n        \"\",\n        \"\u8f93\u5165\uff1a\u7edf\u8ba1\u6bcf\u4e2a\u57ce\u5e02\u7684\u7528\u6237\u6570\",\n        \"\u8f93\u51fa\uff1aSELECT city, COUNT(*) FROM users GROUP BY city\",\n    ],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#_3","title":"\u5de5\u5177\u4f7f\u7528","text":""},{"location":"BEST_PRACTICES/#1_2","title":"1. \u5de5\u5177\u63cf\u8ff0\u8981\u6e05\u6670","text":"<pre><code>def search_products(\n    query: str,\n    category: str = None,\n    max_price: float = None,\n) -&gt; str:\n    \"\"\"\u641c\u7d22\u4ea7\u54c1\u76ee\u5f55\n\n    \u5728\u4ea7\u54c1\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u5339\u914d\u7684\u5546\u54c1\u3002\n\n    Args:\n        query: \u641c\u7d22\u5173\u952e\u8bcd\uff0c\u5982 \"iPhone\" \u6216 \"\u7b14\u8bb0\u672c\u7535\u8111\"\n        category: \u4ea7\u54c1\u7c7b\u522b\uff0c\u53ef\u9009\u503c\uff1aelectronics, clothing, books\n        max_price: \u6700\u9ad8\u4ef7\u683c\u9650\u5236\uff08\u4eba\u6c11\u5e01\uff09\n\n    Returns:\n        JSON \u683c\u5f0f\u7684\u4ea7\u54c1\u5217\u8868\uff0c\u5305\u542b\u540d\u79f0\u3001\u4ef7\u683c\u3001\u63cf\u8ff0\n\n    Example:\n        search_products(\"\u624b\u673a\", category=\"electronics\", max_price=5000)\n    \"\"\"\n    ...\n</code></pre>"},{"location":"BEST_PRACTICES/#2_2","title":"2. \u5de5\u5177\u8fd4\u56de\u683c\u5f0f","text":"<pre><code># \u2705 \u7ed3\u6784\u5316\u8fd4\u56de\ndef get_weather(city: str) -&gt; str:\n    data = fetch_weather(city)\n    return json.dumps({\n        \"city\": city,\n        \"temperature\": data[\"temp\"],\n        \"condition\": data[\"condition\"],\n        \"humidity\": data[\"humidity\"],\n    }, ensure_ascii=False)\n\n# \u274c \u907f\u514d\uff1a\u975e\u7ed3\u6784\u5316\u8fd4\u56de\ndef get_weather(city: str) -&gt; str:\n    return f\"\u5929\u6c14\u5f88\u597d\uff0c\u6e29\u5ea625\u5ea6\"  # \u96be\u4ee5\u89e3\u6790\n</code></pre>"},{"location":"BEST_PRACTICES/#3_2","title":"3. \u9519\u8bef\u5904\u7406","text":"<pre><code>def safe_api_call(url: str) -&gt; str:\n    \"\"\"\u5b89\u5168\u7684 API \u8c03\u7528\"\"\"\n    try:\n        response = requests.get(url, timeout=10)\n        response.raise_for_status()\n        return response.text\n    except requests.Timeout:\n        return \"\u9519\u8bef\uff1a\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\"\n    except requests.HTTPError as e:\n        return f\"\u9519\u8bef\uff1aHTTP {e.response.status_code}\"\n    except Exception as e:\n        return f\"\u9519\u8bef\uff1a{str(e)}\"\n</code></pre>"},{"location":"BEST_PRACTICES/#4","title":"4. \u5de5\u5177\u9650\u5236","text":"<pre><code>agent = Agent(\n    tools=[...],\n    tool_call_limit=10,  # \u9650\u5236\u5de5\u5177\u8c03\u7528\u6b21\u6570\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#_4","title":"\u5185\u5b58\u7ba1\u7406","text":""},{"location":"BEST_PRACTICES/#1_3","title":"1. \u4f1a\u8bdd\u6301\u4e45\u5316","text":"<pre><code>from agentica import Agent, SqliteDb, AgentMemory\n\n# \u4f7f\u7528\u6570\u636e\u5e93\u6301\u4e45\u5316\u4f1a\u8bdd\ndb = SqliteDb(table_name=\"sessions\", db_file=\"agent.db\")\n\nagent = Agent(\n    session_id=\"user-123-session\",\n    memory=AgentMemory.with_db(db=db),\n)\n\n# \u4f1a\u8bdd\u4f1a\u81ea\u52a8\u4fdd\u5b58\u548c\u6062\u590d\n</code></pre>"},{"location":"BEST_PRACTICES/#2_3","title":"2. \u957f\u671f\u8bb0\u5fc6","text":"<pre><code>agent = Agent(\n    user_id=\"user-123\",\n    memory=AgentMemory.with_db(\n        db=db,\n        create_user_memories=True,  # \u542f\u7528\u957f\u671f\u8bb0\u5fc6\n    ),\n)\n\n# Agent \u4f1a\u81ea\u52a8\u8bb0\u4f4f\u7528\u6237\u504f\u597d\n# \"\u8bb0\u4f4f\u6211\u559c\u6b22 Python\" -&gt; \u4fdd\u5b58\u5230\u957f\u671f\u8bb0\u5fc6\n</code></pre>"},{"location":"BEST_PRACTICES/#3_3","title":"3. \u5386\u53f2\u6d88\u606f\u7ba1\u7406","text":"<pre><code>agent = Agent(\n    add_history_to_messages=True,  # \u6dfb\u52a0\u5386\u53f2\u5230\u4e0a\u4e0b\u6587\n    num_history_responses=5,       # \u6700\u8fd1 5 \u8f6e\u5bf9\u8bdd\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#4_1","title":"4. \u4f1a\u8bdd\u6458\u8981","text":"<pre><code>agent = Agent(\n    memory=AgentMemory(\n        create_session_summary=True,  # \u751f\u6210\u4f1a\u8bdd\u6458\u8981\n    ),\n)\n\n# \u957f\u5bf9\u8bdd\u4f1a\u81ea\u52a8\u751f\u6210\u6458\u8981\uff0c\u51cf\u5c11 token \u4f7f\u7528\n</code></pre>"},{"location":"BEST_PRACTICES/#rag","title":"RAG \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"BEST_PRACTICES/#1_4","title":"1. \u77e5\u8bc6\u5e93\u914d\u7f6e","text":"<pre><code>from agentica import Knowledge\nfrom agentica.vectordb import LanceDb\nfrom agentica.emb import OpenAIEmbedder\n\nknowledge = Knowledge(\n    data_path=\"./documents\",\n    vector_db=LanceDb(\n        table_name=\"docs\",\n        uri=\"./lancedb\",\n        embedder=OpenAIEmbedder(),\n    ),\n    chunk_size=1000,      # \u9002\u5f53\u7684\u5206\u5757\u5927\u5c0f\n    num_documents=5,      # \u68c0\u7d22\u6587\u6863\u6570\n)\n\n# \u52a0\u8f7d\u77e5\u8bc6\u5e93\nknowledge.load(recreate=False, upsert=True)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_4","title":"2. \u68c0\u7d22\u589e\u5f3a","text":"<pre><code>agent = Agent(\n    knowledge=knowledge,\n    add_references=True,  # \u6dfb\u52a0\u5f15\u7528\u5230\u54cd\u5e94\n    instructions=[\n        \"\u57fa\u4e8e\u77e5\u8bc6\u5e93\u56de\u7b54\u95ee\u9898\",\n        \"\u5982\u679c\u77e5\u8bc6\u5e93\u4e2d\u6ca1\u6709\u76f8\u5173\u4fe1\u606f\uff0c\u660e\u786e\u544a\u77e5\u7528\u6237\",\n        \"\u5f15\u7528\u6765\u6e90\u65f6\u6ce8\u660e\u6587\u6863\u540d\u79f0\",\n    ],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#3-agentic-rag","title":"3. Agentic RAG","text":"<p>\u8ba9 Agent \u4e3b\u52a8\u641c\u7d22\u77e5\u8bc6\u5e93\u3002</p> <pre><code>agent = Agent(\n    knowledge=knowledge,\n    search_knowledge=True,  # Agent \u53ef\u4ee5\u4e3b\u52a8\u641c\u7d22\n    instructions=[\n        \"\u9047\u5230\u4e13\u4e1a\u95ee\u9898\u65f6\uff0c\u5148\u641c\u7d22\u77e5\u8bc6\u5e93\",\n        \"\u7efc\u5408\u591a\u4e2a\u6765\u6e90\u7684\u4fe1\u606f\u56de\u7b54\",\n    ],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#4_2","title":"4. \u6df7\u5408\u68c0\u7d22","text":"<pre><code>from agentica.vectordb import LanceDb\n\ndb = LanceDb(\n    search_type=\"hybrid\",  # \u6df7\u5408\u68c0\u7d22\uff1a\u5411\u91cf + \u5173\u952e\u8bcd\n    reranker=CohereReranker(),  # \u91cd\u6392\u5e8f\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#_5","title":"\u591a\u8f6e\u5bf9\u8bdd","text":""},{"location":"BEST_PRACTICES/#1_5","title":"1. \u542f\u7528\u591a\u8f6e\u7b56\u7565","text":"<pre><code>agent = Agent(\n    enable_multi_round=True,\n    max_rounds=50,        # \u6700\u5927\u8f6e\u6570\n    max_tokens=100000,    # token \u9650\u5236\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_5","title":"2. \u76d1\u63a7\u591a\u8f6e\u8fdb\u5ea6","text":"<pre><code>async for response in agent.run_stream(\"\u590d\u6742\u4efb\u52a1\"):\n    if response.event == \"MultiRoundTurn\":\n        print(f\"\u8f6e\u6b21 {response.extra_data.round}\")\n    elif response.event == \"MultiRoundToolCall\":\n        print(f\"\u8c03\u7528\u5de5\u5177: {response.content}\")\n    elif response.event == \"MultiRoundCompleted\":\n        print(\"\u4efb\u52a1\u5b8c\u6210\")\n</code></pre>"},{"location":"BEST_PRACTICES/#3_4","title":"3. \u4e0a\u4e0b\u6587\u538b\u7f29","text":"<pre><code>from agentica import CompressionManager\n\nagent = Agent(\n    compression_manager=CompressionManager(\n        compress_tool_results=True,\n        compress_token_limit=50000,\n    ),\n    compress_tool_results=True,\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#_6","title":"\u56e2\u961f\u534f\u4f5c","text":""},{"location":"BEST_PRACTICES/#1-agent","title":"1. Agent \u56e2\u961f","text":"<pre><code>researcher = Agent(\n    name=\"Researcher\",\n    role=\"\u7814\u7a76\u5458\",\n    instructions=[\"\u8d1f\u8d23\u4fe1\u606f\u641c\u7d22\"],\n    tools=[DuckDuckGoTool()],\n)\n\nwriter = Agent(\n    name=\"Writer\",\n    role=\"\u5199\u624b\",\n    instructions=[\"\u8d1f\u8d23\u5185\u5bb9\u521b\u4f5c\"],\n)\n\n# \u4e3b Agent \u534f\u8c03\u56e2\u961f\nleader = Agent(\n    name=\"Leader\",\n    team=[researcher, writer],\n    instructions=[\n        \"\u534f\u8c03\u56e2\u961f\u5b8c\u6210\u4efb\u52a1\",\n        \"\u7814\u7a76\u4efb\u52a1\u4ea4\u7ed9 Researcher\",\n        \"\u5199\u4f5c\u4efb\u52a1\u4ea4\u7ed9 Writer\",\n    ],\n)\n\nleader.print_response(\"\u5199\u4e00\u7bc7\u5173\u4e8e AI \u7684\u6587\u7ae0\")\n</code></pre>"},{"location":"BEST_PRACTICES/#2-agent","title":"2. Agent \u4f5c\u4e3a\u5de5\u5177","text":"<pre><code># \u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\nresearch_tool = researcher.as_tool(\n    tool_name=\"research\",\n    tool_description=\"\u8fdb\u884c\u6df1\u5ea6\u7814\u7a76\",\n)\n\nmain_agent = Agent(\n    tools=[research_tool, other_tools...],\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#3-workflow","title":"3. Workflow \u7f16\u6392","text":"<pre><code>from agentica import Workflow, RunResponse\n\nclass ArticleWorkflow(Workflow):\n    researcher: Agent\n    writer: Agent\n    reviewer: Agent\n\n    def run(self, topic: str) -&gt; RunResponse:\n        # 1. \u7814\u7a76\n        research = self.researcher.run(f\"\u7814\u7a76: {topic}\")\n\n        # 2. \u5199\u4f5c\n        draft = self.writer.run(f\"\u57fa\u4e8e\u7814\u7a76\u5199\u6587\u7ae0:\\n{research.content}\")\n\n        # 3. \u5ba1\u6838\n        final = self.reviewer.run(f\"\u5ba1\u6838\u5e76\u6539\u8fdb:\\n{draft.content}\")\n\n        return RunResponse(content=final.content)\n</code></pre>"},{"location":"BEST_PRACTICES/#_7","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"BEST_PRACTICES/#1_6","title":"1. \u6d41\u5f0f\u8f93\u51fa","text":"<pre><code># \u540c\u6b65\u6d41\u5f0f\u8f93\u51fa\u63d0\u5347\u7528\u6237\u4f53\u9a8c\nfor chunk in agent.run_stream_sync(\"\u95ee\u9898\"):\n    print(chunk.content, end=\"\", flush=True)\n\n# \u5f02\u6b65\u6d41\u5f0f\u8f93\u51fa\nasync for chunk in agent.run_stream(\"\u95ee\u9898\"):\n    print(chunk.content, end=\"\", flush=True)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_6","title":"2. \u5f02\u6b65\u6267\u884c","text":"<pre><code>import asyncio\n\nasync def process_queries(queries):\n    tasks = [agent.run(q) for q in queries]\n    return await asyncio.gather(*tasks)\n\nresults = asyncio.run(process_queries([\"\u95ee\u98981\", \"\u95ee\u98982\", \"\u95ee\u98983\"]))\n</code></pre>"},{"location":"BEST_PRACTICES/#3_5","title":"3. \u6a21\u578b\u9009\u62e9","text":"<pre><code># \u7b80\u5355\u4efb\u52a1\u7528\u5c0f\u6a21\u578b\nsimple_agent = Agent(\n    model=OpenAIChat(model=\"gpt-4o-mini\"),\n)\n\n# \u590d\u6742\u4efb\u52a1\u7528\u5927\u6a21\u578b\ncomplex_agent = Agent(\n    model=OpenAIChat(model=\"gpt-4o\"),\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#4_3","title":"4. \u7f13\u5b58","text":"<pre><code>from functools import lru_cache\n\n@lru_cache(maxsize=100)\ndef cached_search(query: str) -&gt; str:\n    \"\"\"\u7f13\u5b58\u641c\u7d22\u7ed3\u679c\"\"\"\n    return do_search(query)\n</code></pre>"},{"location":"BEST_PRACTICES/#5-token","title":"5. Token \u7ba1\u7406","text":"<pre><code>from agentica import count_tokens\n\n# \u68c0\u67e5 token \u4f7f\u7528\ntokens = count_tokens(messages, model_id=\"gpt-4o\")\nif tokens &gt; 100000:\n    # \u538b\u7f29\u6216\u622a\u65ad\n    ...\n</code></pre>"},{"location":"BEST_PRACTICES/#_8","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"BEST_PRACTICES/#1_7","title":"1. \u91cd\u8bd5\u673a\u5236","text":"<pre><code>from tenacity import retry, stop_after_attempt, wait_exponential\n\n@retry(\n    stop=stop_after_attempt(3),\n    wait=wait_exponential(min=1, max=10),\n)\ndef robust_agent_call(agent, message):\n    return agent.run(message)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_7","title":"2. \u8d85\u65f6\u5904\u7406","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(\n        timeout=60,  # \u8bf7\u6c42\u8d85\u65f6\n        max_retries=3,\n    ),\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#3_6","title":"3. \u4f18\u96c5\u964d\u7ea7","text":"<pre><code>try:\n    response = agent.run(\"\u95ee\u9898\")\nexcept Exception as e:\n    logger.error(f\"Agent \u9519\u8bef: {e}\")\n    response = RunResponse(content=\"\u62b1\u6b49\uff0c\u6211\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002\")\n</code></pre>"},{"location":"BEST_PRACTICES/#4_4","title":"4. \u5de5\u5177\u9519\u8bef\u5904\u7406","text":"<pre><code>from agentica.tools import ToolCallException\n\ndef risky_tool(data: str) -&gt; str:\n    try:\n        return process(data)\n    except ValueError as e:\n        raise ToolCallException(\n            user_message=f\"\u5904\u7406\u5931\u8d25: {e}\",\n            stop_execution=False,  # \u7ee7\u7eed\u6267\u884c\n        )\n</code></pre>"},{"location":"BEST_PRACTICES/#_9","title":"\u751f\u4ea7\u90e8\u7f72","text":""},{"location":"BEST_PRACTICES/#1_8","title":"1. \u73af\u5883\u914d\u7f6e","text":"<pre><code>import os\n\n# \u4f7f\u7528\u73af\u5883\u53d8\u91cf\nagent = Agent(\n    model=OpenAIChat(\n        api_key=os.getenv(\"OPENAI_API_KEY\"),\n        base_url=os.getenv(\"OPENAI_BASE_URL\"),\n    ),\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#2_8","title":"2. \u65e5\u5fd7\u8bb0\u5f55","text":"<pre><code>from agentica.utils.log import logger, set_log_level_to_debug\n\n# \u5f00\u53d1\u73af\u5883\nset_log_level_to_debug()\n\n# \u751f\u4ea7\u73af\u5883\nimport logging\nlogger.setLevel(logging.WARNING)\n</code></pre>"},{"location":"BEST_PRACTICES/#3_7","title":"3. \u76d1\u63a7\u6307\u6807","text":"<pre><code># \u54cd\u5e94\u4e2d\u5305\u542b\u6307\u6807\nresponse = agent.run(\"\u95ee\u9898\")\nprint(response.metrics)\n# {\n#     \"input_tokens\": 100,\n#     \"output_tokens\": 200,\n#     \"time_to_first_token\": 0.5,\n#     \"total_time\": 2.3,\n# }\n</code></pre>"},{"location":"BEST_PRACTICES/#4-api","title":"4. API \u670d\u52a1","text":"<pre><code>from fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\nagent = Agent(...)\n\nclass Query(BaseModel):\n    message: str\n    session_id: str = None\n\n@app.post(\"/chat\")\nasync def chat(query: Query):\n    agent.session_id = query.session_id\n    response = await agent.run(query.message)\n    return {\"content\": response.content}\n</code></pre>"},{"location":"BEST_PRACTICES/#5","title":"5. \u5b89\u5168\u8003\u8651","text":"<pre><code># \u9650\u5236\u5de5\u5177\u6743\u9650\nagent = Agent(\n    tools=[\n        ShellTool(allowed_commands=[\"ls\", \"cat\"]),  # \u767d\u540d\u5355\n        FileTool(base_dir=\"./safe_dir\"),  # \u9650\u5236\u76ee\u5f55\n    ],\n)\n\n# \u8f93\u5165\u9a8c\u8bc1\ndef validate_input(message: str) -&gt; str:\n    if len(message) &gt; 10000:\n        raise ValueError(\"\u8f93\u5165\u8fc7\u957f\")\n    # \u5176\u4ed6\u9a8c\u8bc1...\n    return message\n</code></pre>"},{"location":"BEST_PRACTICES/#_10","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"BEST_PRACTICES/#q-agent","title":"Q: Agent \u4e0d\u8c03\u7528\u5de5\u5177\uff1f","text":"<p>A: \u68c0\u67e5\u4ee5\u4e0b\u51e0\u70b9\uff1a 1. \u5de5\u5177\u63cf\u8ff0\u662f\u5426\u6e05\u6670 2. \u6307\u4ee4\u4e2d\u662f\u5426\u63d0\u5230\u4f7f\u7528\u5de5\u5177 3. \u6a21\u578b\u662f\u5426\u652f\u6301\u5de5\u5177\u8c03\u7528</p> <pre><code>agent = Agent(\n    tools=[my_tool],\n    instructions=[\"\u4f7f\u7528 my_tool \u5de5\u5177\u5b8c\u6210\u4efb\u52a1\"],\n    support_tool_calls=True,\n)\n</code></pre>"},{"location":"BEST_PRACTICES/#q","title":"Q: \u54cd\u5e94\u592a\u6162\uff1f","text":"<p>A: \u4f18\u5316\u5efa\u8bae\uff1a 1. \u4f7f\u7528\u6d41\u5f0f\u8f93\u51fa 2. \u51cf\u5c11\u5de5\u5177\u6570\u91cf 3. \u4f7f\u7528\u66f4\u5feb\u7684\u6a21\u578b 4. \u542f\u7528\u538b\u7f29</p>"},{"location":"BEST_PRACTICES/#q-token","title":"Q: Token \u8d85\u9650\uff1f","text":"<p>A: \u89e3\u51b3\u65b9\u6848\uff1a 1. \u542f\u7528\u538b\u7f29 2. \u51cf\u5c11\u5386\u53f2\u6d88\u606f 3. \u4f7f\u7528\u4f1a\u8bdd\u6458\u8981 4. \u5206\u5757\u5904\u7406\u957f\u6587\u672c</p>"},{"location":"BEST_PRACTICES/#q_1","title":"Q: \u7ed3\u679c\u4e0d\u51c6\u786e\uff1f","text":"<p>A: \u6539\u8fdb\u65b9\u6cd5\uff1a 1. \u4f18\u5316\u63d0\u793a\u8bcd 2. \u6dfb\u52a0 Few-shot \u793a\u4f8b 3. \u4f7f\u7528\u66f4\u5f3a\u7684\u6a21\u578b 4. \u6dfb\u52a0\u77e5\u8bc6\u5e93</p> <p>\u6587\u6863\u6700\u540e\u66f4\u65b0: 2025-12-20</p>"},{"location":"MCP_README/","title":"Model Context Protocol (MCP) Tools","text":"<p>This module provides a client implementation for the Model Context Protocol (MCP), allowing you to easily integrate MCP servers with your Agentica agents.</p>"},{"location":"MCP_README/#features","title":"Features","text":"<ul> <li>Support for both stdio and SSE transport modes</li> <li>Explicit parameter names for each transport type</li> <li>Async context manager-based API for easy resource management</li> <li>Tool caching for improved performance</li> <li>Automatic tool registration with your agents</li> </ul>"},{"location":"MCP_README/#installation","title":"Installation","text":"<p>Make sure you have the <code>mcp</code> package installed:</p> <pre><code>pip install mcp\n</code></pre>"},{"location":"MCP_README/#basic-usage","title":"Basic Usage","text":""},{"location":"MCP_README/#using-the-mcptool-class","title":"Using the McpTool Class","text":"<p>The <code>McpTool</code> class is the primary way to integrate MCP services with your Agentica agents:</p> <pre><code>from agentica import Agent, OpenAIChat\nfrom agentica.tools.mcp_tool import McpTool\nfrom agentica import ShellTool\n\n# For SSE transport (direct connection to running server)\nmcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    sse_timeout=5.0,\n    sse_read_timeout=300.0\n)\n\n# For stdio transport (launches a subprocess)\nmcp_tool = McpTool(\n    command=\"python path/to/your/mcp_server.py\"\n)\n\n# Use with an agent\nasync with mcp_tool:\n    agent = Agent(\n        model=OpenAIChat(model=\"gpt-4o-mini\"),\n        tools=[ShellTool(), mcp_tool]\n    )\n\n    await agent.print_response(\"Use the weather tool to check the forecast for Beijing\")\n</code></pre>"},{"location":"MCP_README/#using-low-level-mcpclient-and-server-classes","title":"Using Low-Level MCPClient and Server Classes","text":"<p>For more control, you can directly use the <code>MCPClient</code> and server classes:</p> <pre><code>import asyncio\nfrom agentica.mcp.client import MCPClient\nfrom agentica.mcp.server import MCPServerStdio, MCPServerSse\n\nasync def stdio_example():\n    \"\"\"Example using stdio transport\"\"\"\n    server = MCPServerStdio(\n        name=\"MathTools\",\n        params={\n            \"command\": \"python\",\n            \"args\": [\"path/to/your/mcp_server.py\"],\n            \"env\": {\"VAR\": \"value\"}\n        }\n    )\n\n    async with MCPClient(server=server) as client:\n        # List available tools\n        tools = await client.list_tools()\n        print(f\"Available tools: {[tool.name for tool in tools]}\")\n\n        # Call a tool\n        result = await client.call_tool(\"add\", {\"a\": 5, \"b\": 7})\n        text_result = client.extract_result_text(result)\n        print(f\"5 + 7 = {text_result}\")\n\nasync def sse_example():\n    \"\"\"Example using SSE transport\"\"\"\n    server = MCPServerSse(\n        name=\"WeatherService\",\n        params={\n            \"url\": \"http://localhost:8081/sse\",\n            \"headers\": {\"Authorization\": \"Bearer your-token\"},  # Optional\n            \"timeout\": 5.0,  # HTTP request timeout\n            \"sse_read_timeout\": 300.0  # SSE connection timeout\n        }\n    )\n\n    async with MCPClient(server=server) as client:\n        # Use client as in stdio example\n        tools = await client.list_tools()\n        result = await client.call_tool(\"get_weather\", {\"city\": \"Beijing\"})\n        print(client.extract_result_text(result))\n\nif __name__ == \"__main__\":\n    asyncio.run(stdio_example())\n    asyncio.run(sse_example())\n</code></pre>"},{"location":"MCP_README/#mcptool-configuration-options","title":"McpTool Configuration Options","text":"<p>The <code>McpTool</code> class supports several configuration options:</p>"},{"location":"MCP_README/#transport-options","title":"Transport Options","text":"<p>You must provide one of these to specify the transport method:</p> <ul> <li><code>stdio_command</code>: Command string to run the MCP server via stdio transport</li> <li><code>sse_server_url</code>: URL of the SSE endpoint for SSE transport</li> <li><code>server_params</code>: Directly provide <code>StdioServerParameters</code> for stdio transport</li> <li><code>session</code>: Directly provide an initialized <code>ClientSession</code></li> </ul>"},{"location":"MCP_README/#sse-configuration","title":"SSE Configuration","text":"<p>For SSE transport, you can configure:</p> <ul> <li><code>sse_headers</code>: HTTP headers for the SSE connection</li> <li><code>sse_timeout</code>: HTTP request timeout in seconds (default: 5.0)</li> <li><code>sse_read_timeout</code>: SSE connection timeout in seconds (default: 300.0)</li> </ul>"},{"location":"MCP_README/#tool-filtering","title":"Tool Filtering","text":"<p>You can filter which tools are exposed to your agent:</p> <ul> <li><code>include_tools</code>: List of tool names to include (if None, includes all)</li> <li><code>exclude_tools</code>: List of tool names to exclude</li> </ul>"},{"location":"MCP_README/#other-options","title":"Other Options","text":"<ul> <li><code>env</code>: Environment variables to pass to the server process (for stdio transport)</li> </ul>"},{"location":"MCP_README/#example","title":"Example","text":"<pre><code># Create an McpTool with SSE transport\nfrom agentica.tools.mcp_tool import McpTool\n\nmcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    sse_headers={\"Authorization\": \"Bearer token123\"},\n    include_tools=[\"get_weather\", \"get_forecast\"],\n    exclude_tools=[\"admin_tool\"]\n)\n\n# Create an McpTool with stdio transport\nmcp_tool = McpTool(\n    command=\"python weather_server.py --port 8081\",\n    env={\"API_KEY\": \"your_api_key\"},\n    include_tools=[\"get_weather\"]\n)\n</code></pre>"},{"location":"MCP_README/#backward-compatibility","title":"Backward Compatibility","text":"<p>The <code>McpTool</code> class still supports environment variables for backward compatibility:</p> <pre><code>from agentica.tools.mcp_tool import McpTool\n# Using environment variables for SSE configuration\nenv = {\n    \"MCP_SERVER_URL\": \"http://localhost:8081/sse\",\n    \"MCP_SERVER_HEADERS\": '{\"Authorization\": \"Bearer token123\"}',\n    \"MCP_SERVER_TIMEOUT\": \"5\",\n    \"MCP_SERVER_READ_TIMEOUT\": \"300\"\n}\n\nmcp_tool = McpTool(env=env)\n</code></pre> <p>However, using the direct parameters is recommended for clarity and type safety.</p>"},{"location":"MCP_README/#mcp-server-implementation","title":"MCP Server Implementation","text":"<p>If you're implementing your own MCP server, you can use the <code>FastMCP</code> class from the <code>mcp</code> package:</p> <pre><code>from mcp.server.fastmcp import FastMCP\nfrom fastapi import FastAPI\n\n# Create server\nmcp = FastMCP(\"My MCP Server\", host=\"0.0.0.0\", port=8081)\n\n# Define a tool\n@mcp.tool()\ndef get_weather(city: str) -&gt; str:\n    \"\"\"Get weather for a city\"\"\"\n    # Implementation here\n    return f\"Weather for {city}: Sunny, 25\u00b0C\"\n\n# Run the server\nif __name__ == \"__main__\":\n    # Use 'stdio' or 'sse' transport\n    mcp.run(transport=\"sse\")\n</code></pre>"},{"location":"MCP_README/#examples","title":"Examples","text":"<p>Check out the examples directory for more complete examples:</p> <ul> <li><code>examples/41_mcp_stdio_demo.py</code>: Demonstrates how to use MCP with stdio transport</li> <li><code>examples/42_mcp_sse_server.py</code>: A simple MCP server with SSE transport</li> <li><code>examples/42_mcp_sse_client.py</code>: Demonstrates how to connect to an MCP SSE server</li> </ul>"},{"location":"acp/","title":"Agentica ACP (Agent Client Protocol)","text":"<p>Agentica ACP \u5b9e\u73b0\u8ba9 Agentica \u53ef\u4ee5\u4f5c\u4e3a ACP \u517c\u5bb9\u7684 Agent \u4e0e IDE \u96c6\u6210\uff0c\u63d0\u4f9b\u7c7b\u4f3c Claude Code / Roo Code / Kimi Code \u7684 AI \u7f16\u7a0b\u52a9\u624b\u4f53\u9a8c\u3002</p>"},{"location":"acp/#acp","title":"\u4ec0\u4e48\u662f ACP\uff1f","text":"<p>ACP (Agent Client Protocol) \u662f\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u534f\u8bae\uff0c\u7c7b\u4f3c\u4e8e LSP (Language Server Protocol)\uff0c\u7528\u4e8e IDE \u4e0e AI Agent \u4e4b\u95f4\u7684\u901a\u4fe1\u3002</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      JSON-RPC over stdio      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   IDE       \u2502  \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba   \u2502  Agentica   \u2502\n\u2502  (Client)   \u2502                               \u2502   ACP       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                               \u2502   Server    \u2502\n      \u2502                                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                                               \u2502\n      \u2502                                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502   Agent     \u2502\n                                               \u2502   Engine    \u2502\n                                               \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u6838\u5fc3\u7279\u6027: - \u901a\u4fe1\u65b9\u5f0f: JSON-RPC 2.0 over stdio - Session \u7ba1\u7406: \u591a\u4f1a\u8bdd\u652f\u6301\uff0c\u72ec\u7acb\u7684\u4e0a\u4e0b\u6587\u548c\u6d88\u606f\u5386\u53f2 - \u6d41\u5f0f\u8f93\u51fa: \u652f\u6301\u5b9e\u65f6\u8fdb\u5ea6\u901a\u77e5 - \u5de5\u5177\u7cfb\u7edf: \u6587\u4ef6\u64cd\u4f5c\u3001\u547d\u4ee4\u6267\u884c\u3001\u4ee3\u7801\u641c\u7d22\u7b49 - \u4f18\u52bf: \u4e00\u6b21\u5b9e\u73b0\uff0c\u591a\u5904\u4f7f\u7528\uff08\u652f\u6301 Zed\u3001JetBrains\u3001VSCode \u7b49\uff09</p>"},{"location":"acp/#_1","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"acp/#_2","title":"\u547d\u4ee4\u884c\u542f\u52a8","text":"<pre><code># \u76f4\u63a5\u542f\u52a8 ACP \u670d\u52a1\u5668\nagentica acp\n\n# \u6216\u8005\u4f7f\u7528 Python\npython -m agentica.cli acp\n</code></pre>"},{"location":"acp/#ide","title":"IDE \u914d\u7f6e","text":""},{"location":"acp/#zed","title":"Zed","text":"<p>\u7f16\u8f91 <code>~/.config/zed/settings.json</code>:</p> <pre><code>{\n  \"agent_servers\": {\n    \"Agentica\": {\n      \"type\": \"custom\",\n      \"command\": \"agentica\",\n      \"args\": [\"acp\"],\n      \"env\": {\n        \"OPENAI_API_KEY\": \"your-api-key\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"acp/#jetbrains-intellij-idea-pycharm-webstorm","title":"JetBrains (IntelliJ IDEA, PyCharm, WebStorm)","text":"<p>\u7f16\u8f91 <code>~/.jetbrains/acp.json</code>:</p> <pre><code>{\n  \"agent_servers\": {\n    \"Agentica\": {\n      \"command\": \"/path/to/agentica\",\n      \"args\": [\"acp\"],\n      \"env\": {\n        \"OPENAI_API_KEY\": \"your-api-key\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"acp/#session","title":"Session \u7ba1\u7406","text":"<p>ACP \u7684\u6838\u5fc3\u662f Session \u7ba1\u7406\uff0c\u6bcf\u4e2a\u7528\u6237\u4ea4\u4e92\u90fd\u5728\u72ec\u7acb\u7684 Session \u4e2d\u8fdb\u884c\uff1a</p> <pre><code>from agentica.acp import SessionManager, ACPSession\n\n# \u521b\u5efa Session \u7ba1\u7406\u5668\nmanager = SessionManager()\n\n# \u521b\u5efa\u65b0 Session\nsession = manager.create_session(mode=\"chat\")\nprint(f\"Session ID: {session.id}\")  # \u4f8b\u5982: \"a1b2c3d4\"\n\n# \u6dfb\u52a0\u6d88\u606f\nsession.add_message(\"user\", \"Hello, can you help me refactor this code?\")\nsession.add_message(\"assistant\", \"Of course! Let me analyze the code.\")\n\n# \u66f4\u65b0\u72b6\u6001\nsession.update_status(\"running\")\n\n# \u83b7\u53d6\u4f1a\u8bdd\u4fe1\u606f\ninfo = session.to_dict()\nprint(f\"Messages: {info['message_count']}\")\nprint(f\"Status: {info['status']}\")\n\n# \u6e05\u7406\nmanager.delete_session(session.id)\n</code></pre>"},{"location":"acp/#session_1","title":"Session \u6a21\u5f0f","text":"<ul> <li><code>default</code> - \u9ed8\u8ba4\u6a21\u5f0f\uff0c\u901a\u7528\u5bf9\u8bdd</li> <li><code>chat</code> - \u804a\u5929\u6a21\u5f0f</li> <li><code>plan</code> - \u89c4\u5212\u6a21\u5f0f\uff0c\u7528\u4e8e\u590d\u6742\u4efb\u52a1\u5206\u89e3</li> <li><code>edit</code> - \u7f16\u8f91\u6a21\u5f0f\uff0c\u4e13\u6ce8\u4e8e\u4ee3\u7801\u7f16\u8f91</li> </ul>"},{"location":"acp/#session_2","title":"Session \u72b6\u6001","text":"<ul> <li><code>created</code> - \u5df2\u521b\u5efa</li> <li><code>running</code> - \u8fd0\u884c\u4e2d</li> <li><code>paused</code> - \u5df2\u6682\u505c</li> <li><code>completed</code> - \u5df2\u5b8c\u6210</li> <li><code>error</code> - \u51fa\u9519</li> <li><code>cancelled</code> - \u5df2\u53d6\u6d88</li> </ul>"},{"location":"acp/#_3","title":"\u53ef\u7528\u5de5\u5177","text":"<p>ACP \u6a21\u5f0f\u4e0b\u66b4\u9732\u4ee5\u4e0b\u5de5\u5177\u7ed9 IDE\uff1a</p> \u5de5\u5177 \u63cf\u8ff0 \u53c2\u6570 <code>read_file</code> \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9 <code>file_path</code>, <code>offset</code>, <code>limit</code> <code>write_file</code> \u5199\u5165\u6587\u4ef6 <code>file_path</code>, <code>content</code> <code>edit_file</code> \u7f16\u8f91\u6587\u4ef6 <code>file_path</code>, <code>old_string</code>, <code>new_string</code> <code>ls</code> \u5217\u51fa\u76ee\u5f55 <code>directory</code> <code>glob</code> \u6587\u4ef6\u6a21\u5f0f\u5339\u914d <code>pattern</code>, <code>path</code> <code>grep</code> \u6587\u672c\u641c\u7d22 <code>pattern</code>, <code>path</code>, <code>include</code> <code>execute</code> \u6267\u884c\u547d\u4ee4 <code>command</code> <code>web_search</code> \u7f51\u9875\u641c\u7d22 <code>queries</code>, <code>max_results</code>"},{"location":"acp/#_4","title":"\u534f\u8bae\u65b9\u6cd5","text":""},{"location":"acp/#core-methods","title":"Core Methods","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>initialize</code> \u521d\u59cb\u5316\u8fde\u63a5 <code>shutdown</code> \u4f18\u96c5\u5173\u95ed <code>exit</code> \u9000\u51fa\u670d\u52a1\u5668"},{"location":"acp/#tool-methods","title":"Tool Methods","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>tools/list</code> \u5217\u51fa\u53ef\u7528\u5de5\u5177 <code>tools/call</code> \u8c03\u7528\u5de5\u5177"},{"location":"acp/#session-methods","title":"Session Methods (\u6838\u5fc3)","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>session/new</code> \u521b\u5efa\u65b0\u4f1a\u8bdd <code>session/prompt</code> \u53d1\u9001\u63d0\u793a\u5e76\u83b7\u53d6\u54cd\u5e94 <code>session/load</code> \u52a0\u8f7d\u4f1a\u8bdd <code>session/cancel</code> \u53d6\u6d88\u4f1a\u8bdd <code>session/delete</code> \u5220\u9664\u4f1a\u8bdd <code>session/list</code> \u5217\u51fa\u7684\u6709\u4f1a\u8bdd"},{"location":"acp/#notification-methods","title":"Notification Methods","text":"\u65b9\u6cd5 \u63cf\u8ff0 <code>notifications/progress</code> \u8fdb\u5ea6\u66f4\u65b0 <code>notifications/complete</code> \u5b8c\u6210\u901a\u77e5 <code>notifications/session/update</code> \u4f1a\u8bdd\u66f4\u65b0"},{"location":"acp/#_5","title":"\u6d41\u5f0f\u8f93\u51fa","text":"<p>ACP \u652f\u6301\u6d41\u5f0f\u8f93\u51fa\uff0c\u5b9e\u65f6\u901a\u77e5\u5ba2\u6237\u7aef\u8fdb\u5ea6\uff1a</p> <pre><code>from agentica.acp import ACPHandlers\n\nhandlers = ACPHandlers()\n\n# \u521b\u5efa\u4f1a\u8bdd\nsession = handlers._session_manager.create_session()\n\n# \u5904\u7406\u5e26\u6d41\u5f0f\u8f93\u51fa\u7684\u63d0\u793a\nresult = handlers.handle_session_prompt({\n    \"sessionId\": session.id,\n    \"prompt\": \"Refactor this code\",\n    \"stream\": True\n})\n\n# \u6d41\u5f0f\u8f93\u51fa\u4f1a\u81ea\u52a8\u53d1\u9001 notifications/session/update \u901a\u77e5\n</code></pre>"},{"location":"acp/#_6","title":"\u4ee3\u7801\u793a\u4f8b","text":""},{"location":"acp/#_7","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>from agentica.acp import ACPServer\n\n# \u521b\u5efa\u5e76\u542f\u52a8 ACP \u670d\u52a1\u5668\nserver = ACPServer()\nserver.run()\n</code></pre>"},{"location":"acp/#agent","title":"\u4f7f\u7528\u81ea\u5b9a\u4e49 Agent","text":"<pre><code>from agentica.acp import ACPServer\nfrom agentica import DeepAgent, OpenAIChat\n\n# \u521b\u5efa\u81ea\u5b9a\u4e49 Agent\nagent = DeepAgent(\n    model=OpenAIChat(),\n    name=\"MyACPAgent\",\n)\n\n# \u542f\u52a8 ACP \u670d\u52a1\u5668\nserver = ACPServer(agent=agent)\nserver.run()\n</code></pre>"},{"location":"acp/#_8","title":"\u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u578b","text":"<pre><code>from agentica.acp import ACPServer\nfrom agentica import ZhipuAI\n\n# \u4f7f\u7528\u81ea\u5b9a\u4e49\u6a21\u578b\nmodel = ZhipuAI()\nserver = ACPServer(model=model)\nserver.run()\n</code></pre>"},{"location":"acp/#session_3","title":"Session \u7ba1\u7406\u793a\u4f8b","text":"<pre><code>from agentica.acp import SessionManager, SessionStatus\n\n# \u521b\u5efa\u7ba1\u7406\u5668\nmanager = SessionManager(max_sessions=100)\n\n# \u521b\u5efa\u4f1a\u8bdd\nsession = manager.create_session(\n    mode=\"plan\",\n    initial_context={\"project\": \"my-app\", \"language\": \"python\"}\n)\n\n# \u7ba1\u7406\u4f1a\u8bdd\nsessions = manager.list_sessions()\nstats = manager.get_stats()\n\n# \u6e05\u7406\u65e7\u4f1a\u8bdd\nmanager._cleanup_old_sessions(max_age_hours=24)\n</code></pre>"},{"location":"acp/#_9","title":"\u67b6\u6784","text":"<pre><code>agentica/acp/\n\u251c\u2500\u2500 __init__.py       # \u6a21\u5757\u5bfc\u51fa\n\u251c\u2500\u2500 types.py          # ACP \u6570\u636e\u6a21\u578b (ACPRequest, ACPResponse, ACPTool, etc.)\n\u251c\u2500\u2500 protocol.py       # JSON-RPC \u534f\u8bae\u5904\u7406\u5668\n\u251c\u2500\u2500 handlers.py       # \u65b9\u6cd5\u5904\u7406\u5668 (initialize, session/*, tools/*)\n\u251c\u2500\u2500 session.py        # Session \u7ba1\u7406 (SessionManager, ACPSession)\n\u251c\u2500\u2500 server.py         # ACP Server \u4e3b\u7c7b\n</code></pre>"},{"location":"acp/#_10","title":"\u5b9e\u73b0\u7ec6\u8282","text":""},{"location":"acp/#json-rpc","title":"JSON-RPC \u6d88\u606f\u683c\u5f0f","text":"<pre><code>Content-Length: &lt;length&gt;\\r\\n\n\\r\\n\n&lt;json_body&gt;\n</code></pre>"},{"location":"acp/#_11","title":"\u8bf7\u6c42\u683c\u5f0f","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"session/prompt\",\n  \"params\": {\n    \"sessionId\": \"abc123\",\n    \"prompt\": \"Hello\",\n    \"stream\": true\n  }\n}\n</code></pre>"},{"location":"acp/#_12","title":"\u54cd\u5e94\u683c\u5f0f","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"sessionId\": \"abc123\",\n    \"content\": \"Hi there!\",\n    \"status\": \"completed\"\n  }\n}\n</code></pre>"},{"location":"acp/#id","title":"\u901a\u77e5\u683c\u5f0f (\u65e0 id)","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"notifications/progress\",\n  \"params\": {\n    \"sessionId\": \"abc123\",\n    \"type\": \"content\",\n    \"content\": \"Processing...\"\n  }\n}\n</code></pre>"},{"location":"acp/#_13","title":"\u9519\u8bef\u683c\u5f0f","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"error\": {\n    \"code\": -32601,\n    \"message\": \"Method not found\"\n  }\n}\n</code></pre>"},{"location":"acp/#_14","title":"\u9519\u8bef\u7801","text":"\u9519\u8bef\u7801 \u63cf\u8ff0 -32700 Parse error -32600 Invalid request -32601 Method not found -32602 Invalid params -32603 Internal error -32000 ~ -32099 Server error"},{"location":"acp/#_15","title":"\u6d4b\u8bd5","text":"<p>\u8fd0\u884c\u6d4b\u8bd5\uff1a</p> <pre><code># \u8fd0\u884c\u6240\u6709 ACP \u6d4b\u8bd5\npython -m pytest tests/test_acp.py -v\n\n# \u8fd0\u884c\u7279\u5b9a\u6d4b\u8bd5\npython -m pytest tests/test_acp.py::TestACPSession -v\n\n# \u8fd0\u884c\u793a\u4f8b\npython examples/acp_demo/test_acp.py\n</code></pre>"},{"location":"acp/#_16","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>ACP Specification</li> <li>JetBrains ACP Docs</li> <li>OpenHands ACP Integration</li> <li>i-am-bee/acp - ACP Python SDK</li> </ul>"},{"location":"config_tech_v2/","title":"Agentica Agent V2 \u67b6\u6784\u5347\u7ea7\u65b9\u6848\uff08\u6700\u7ec8\u7248\uff09","text":"<p>\u878d\u5408 config_tech.md\uff08\u6e10\u8fdb\u8fc1\u79fb\uff09\u548c\u539f config_tech_v2.md\uff08\u65ad\u88c2\u91cd\u6784\uff09\u4e24\u4e2a\u65b9\u6848\u7684\u4f18\u52bf\u3002 \u6838\u5fc3\u51b3\u7b56\uff1a\u4fdd\u6301 dataclass \u57fa\u7c7b + V2 \u53c2\u6570\u5206\u5c42 + V1 \u7684 RunConfig + Session \u5265\u79bb + \u4e00\u6b21\u6027 breaking change\u3002</p>"},{"location":"config_tech_v2/#_1","title":"\u4e00\u3001\u73b0\u72b6\u8bca\u65ad","text":""},{"location":"config_tech_v2/#11","title":"1.1 \u6838\u5fc3\u6570\u636e","text":"\u6307\u6807 \u503c Agent <code>__init__</code> \u53c2\u6570\u603b\u6570 57\uff08\u542b 7 \u4e2a\u517c\u5bb9\u522b\u540d\uff09 \u53bb\u6389\u522b\u540d\u540e\u5b9e\u9645\u53c2\u6570 50 \u793a\u4f8b\u4e2d\u4f7f\u7528\u8fc7\u7684\u53c2\u6570 ~25 90% \u7684\u793a\u4f8b\u53ea\u7528\u5230\u7684\u53c2\u6570 <code>model</code> + <code>instructions</code> + <code>tools</code>"},{"location":"config_tech_v2/#12-top-10","title":"1.2 \u4f7f\u7528\u9891\u7387 Top 10","text":"\u53c2\u6570 \u51fa\u73b0\u6b21\u6570 \u8bf4\u660e <code>model</code> 25+ \u51e0\u4e4e\u6240\u6709\u793a\u4f8b <code>instructions</code> 12 \u7b2c\u4e8c\u9ad8\u9891 <code>name</code> 9 \u591a Agent / Workflow <code>response_model</code> 7 \u7ed3\u6784\u5316\u8f93\u51fa <code>tools</code> 6 \u51fd\u6570\u8c03\u7528 <code>description</code> 5 Agent \u4eba\u683c <code>add_history_to_messages</code> 5 \u591a\u8f6e\u5bf9\u8bdd <code>knowledge</code> 5 RAG <code>search_knowledge</code> 5 RAG \u641c\u7d22 <code>debug</code> 5 \u8c03\u8bd5"},{"location":"config_tech_v2/#13","title":"1.3 \u6838\u5fc3\u95ee\u9898","text":"<p>\u4e0d\u662f\"\u53c2\u6570\u591a\"\uff0c\u800c\u662f\u6df7\u5408\u4e86\u4e0d\u540c\u5173\u6ce8\u5c42\u6b21\u7684\u6982\u5ff5\u5230\u540c\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u3002</p> <p>\u5f53\u524d Agent \u540c\u65f6\u627f\u62c5\u4e86\uff1a - Agent \u5b9a\u4e49\uff08\u6211\u662f\u8c01\u3001\u6211\u80fd\u505a\u4ec0\u4e48\uff09 - Prompt \u5de5\u7a0b\uff08\u600e\u4e48\u6784\u5efa system message\uff09 - Session \u7ba1\u7406\uff08\u4f1a\u8bdd\u521b\u5efa/\u6062\u590d/\u6301\u4e45\u5316\uff09 - Memory \u7ba1\u7406\uff08\u5386\u53f2\u6d88\u606f\u3001\u7528\u6237\u8bb0\u5fc6\uff09 - \u8fd0\u884c\u65f6\u72b6\u6001\uff08run_id, run_response\uff09</p>"},{"location":"config_tech_v2/#_2","title":"\u4e8c\u3001\u8bbe\u8ba1\u51b3\u7b56\u4e0e\u53d6\u820d","text":""},{"location":"config_tech_v2/#21-dataclassinitfalse","title":"2.1 \u57fa\u7c7b\u9009\u62e9\uff1a\u4fdd\u6301 <code>@dataclass(init=False)</code>","text":"<p>\u4e0d\u8fc1\u79fb\u5230 Pydantic BaseModel\u3002 \u539f\u56e0\uff1a</p> <ol> <li>\u5f53\u524d Agent \u4f7f\u7528 7 \u4e2a mixin \u7684\u76f4\u63a5\u591a\u7ee7\u627f\uff0cPydantic \u7684 <code>ModelMetaclass</code> \u5bf9 MRO \u548c <code>__init__</code> \u7684\u63a5\u7ba1\u4e0e mixin \u4f53\u7cfb\u6709\u517c\u5bb9\u6027\u98ce\u9669</li> <li>Agent \u6301\u6709 <code>Callable</code>\u3001\u53ef\u53d8\u5217\u8868\u3001<code>AgentMemory</code> \u7b49\u590d\u6742\u7c7b\u578b\uff0cdataclass \u7684\u5bbd\u677e\u7c7b\u578b\u7ea6\u675f\u66f4\u9002\u5408</li> <li>\u624b\u5199 <code>__init__</code> \u867d\u7136\u957f\uff0c\u4f46\u4ece 300 \u884c\u7cbe\u7b80\u5230 ~80 \u884c\u540e\u5b8c\u5168\u53ef\u63a7</li> <li>\u6570\u636e\u6a21\u578b\uff08RunResponse, Tool, Function\uff09\u5df2\u7ecf\u7528 BaseModel\uff0cAgent \u4f5c\u4e3a\"\u884c\u4e3a\u5bb9\u5668\"\u7528 dataclass \u66f4\u5408\u9002</li> </ol> <p>\u5e8f\u5217\u5316\u9700\u6c42\u901a\u8fc7 <code>to_dict()</code> / <code>from_dict()</code> \u65b9\u6cd5\u624b\u52a8\u5b9e\u73b0\uff0c\u4e0d\u4f9d\u8d56 BaseModel\u3002</p>"},{"location":"config_tech_v2/#22-breaking-change","title":"2.2 \u517c\u5bb9\u6027\u7b56\u7565\uff1a\u4e00\u6b21\u6027 breaking change","text":"<p>\u9879\u76ee\u5904\u4e8e async-first \u91cd\u6784\u671f\uff0c\u5df2\u7ecf\u505a\u4e86\u7834\u574f\u6027\u53d8\u66f4\uff08\u53bb\u6389 <code>arun</code>/<code>aresponse</code>\uff09\u3002\u5728\u6b64\u7a97\u53e3\u671f\uff1a - \u76f4\u63a5\u5220\u9664 7 \u4e2a\u517c\u5bb9\u522b\u540d\uff0c\u4e0d\u505a deprecation \u5468\u671f - \u76f4\u63a5\u5220\u9664\u5e9f\u5f03\u53c2\u6570\uff0c\u4e0d\u52a0 warning - \u6240\u6709 examples \u548c tests \u540c\u6b65\u66f4\u65b0</p>"},{"location":"config_tech_v2/#23","title":"2.3 \u53c2\u8003\u6846\u67b6","text":"\u7ef4\u5ea6 OpenAI SDK MetaGPT Agentica (\u5f53\u524d) Agentica V2 \u6784\u9020\u53c2\u6570 ~15 ~15 ~57 ~22 Session \u7ba1\u7406 \u5916\u90e8 Environment Agent \u5185\u90e8 \u5916\u90e8 SessionManager \u8fd0\u884c\u65f6\u914d\u7f6e Runner \u53c2\u6570 RoleContext Agent \u5b57\u6bb5 RunConfig Prompt \u6784\u5efa instructions goal+constraints ~16 \u7ec6\u7c92\u5ea6\u53c2\u6570 PromptConfig \u6253\u5305"},{"location":"config_tech_v2/#v2","title":"\u4e09\u3001V2 \u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"config_tech_v2/#31","title":"3.1 \u8bbe\u8ba1\u539f\u5219","text":"<ol> <li>Agent \u662f\u5b9a\u4e49\uff0c\u4e0d\u662f\u5bb9\u5668 \u2014 \u53ea\u63cf\u8ff0\"\u6211\u662f\u8c01\u3001\u6211\u80fd\u505a\u4ec0\u4e48\"</li> <li>\u5206\u5c42\u914d\u7f6e \u2014 \u6838\u5fc3\u53c2\u6570\u5e73\u94fa\uff0c\u9ad8\u7ea7\u914d\u7f6e\u6253\u5305\u6210 Config \u5bf9\u8c61</li> <li>\u8fd0\u884c\u65f6\u72b6\u6001\u4e0d\u66b4\u9732 \u2014 run_id, run_response \u7b49\u5185\u90e8\u7ba1\u7406</li> <li>RunConfig \u7ba1\u8fd0\u884c\u65f6 \u2014 stream\u3001timeout \u7b49\u6bcf\u6b21 run \u53ef\u80fd\u4e0d\u540c\u7684\u53c2\u6570\u72ec\u7acb\u51fa\u6765</li> <li>Session \u5916\u7f6e \u2014 \u7531\u72ec\u7acb SessionManager \u7ba1\u7406\uff0cAgent \u4e0d\u6301\u6709 session/db \u5b57\u6bb5</li> </ol>"},{"location":"config_tech_v2/#32","title":"3.2 \u53c2\u6570\u5206\u5c42\u67b6\u6784","text":"<pre><code>Agent V2 (~22 \u53c2\u6570)\n\u2502\n\u251c\u2500\u2500 \u7b2c\u4e00\u5c42\uff1a\u6838\u5fc3\u5b9a\u4e49\uff08\u5f00\u53d1\u8005\u5fc5\u987b\u77e5\u9053\u7684\uff09\n\u2502   \u251c\u2500\u2500 model              # \u6a21\u578b\n\u2502   \u251c\u2500\u2500 name               # \u540d\u5b57\n\u2502   \u251c\u2500\u2500 agent_id           # \u552f\u4e00\u6807\u8bc6\n\u2502   \u251c\u2500\u2500 instructions       # \u6307\u4ee4 (str | List[str] | Callable)\n\u2502   \u251c\u2500\u2500 description        # \u63cf\u8ff0\uff08\u56e2\u961f\u4e2d\u7528\u4e8e\u4ea4\u63a5\u8bf4\u660e\uff09\n\u2502   \u251c\u2500\u2500 tools              # \u5de5\u5177\u5217\u8868\n\u2502   \u251c\u2500\u2500 knowledge          # \u77e5\u8bc6\u5e93\n\u2502   \u251c\u2500\u2500 team               # \u56e2\u961f\u6210\u5458\n\u2502   \u251c\u2500\u2500 workspace          # \u5de5\u4f5c\u7a7a\u95f4\n\u2502   \u2514\u2500\u2500 response_model     # \u7ed3\u6784\u5316\u8f93\u51fa\u7c7b\u578b\n\u2502\n\u251c\u2500\u2500 \u7b2c\u4e8c\u5c42\uff1a\u5e38\u7528\u914d\u7f6e\uff08\u6309\u9700\u8bbe\u7f6e\uff0c\u6709\u5408\u7406\u9ed8\u8ba4\u503c\uff09\n\u2502   \u251c\u2500\u2500 add_history_to_messages  # \u591a\u8f6e\u5bf9\u8bdd\n\u2502   \u251c\u2500\u2500 num_history_responses    # \u5386\u53f2\u8f6e\u6570\n\u2502   \u251c\u2500\u2500 search_knowledge         # Agentic RAG\n\u2502   \u251c\u2500\u2500 output_language          # \u8f93\u51fa\u8bed\u8a00\n\u2502   \u251c\u2500\u2500 markdown                 # Markdown \u683c\u5f0f\n\u2502   \u251c\u2500\u2500 structured_outputs       # \u7ed3\u6784\u5316\u8f93\u51fa\u6a21\u5f0f\n\u2502   \u251c\u2500\u2500 debug               # \u8c03\u8bd5\u6a21\u5f0f\n\u2502   \u2514\u2500\u2500 monitoring               # \u76d1\u63a7\uff08Langfuse\uff09\n\u2502\n\u251c\u2500\u2500 \u7b2c\u4e09\u5c42\uff1a\u6253\u5305\u914d\u7f6e\uff08\u9ad8\u7ea7\u7528\u6237\uff09\n\u2502   \u251c\u2500\u2500 prompt_config: PromptConfig      # Prompt \u5de5\u7a0b\u7ec6\u8282\n\u2502   \u251c\u2500\u2500 tool_config: ToolConfig          # \u5de5\u5177\u8c03\u7528\u7ec6\u8282\n\u2502   \u251c\u2500\u2500 memory_config: MemoryConfig      # \u8bb0\u5fc6\u914d\u7f6e\n\u2502   \u2514\u2500\u2500 team_config: TeamConfig          # \u56e2\u961f\u534f\u4f5c\u7ec6\u8282\n\u2502\n\u251c\u2500\u2500 \u8fd0\u884c\u65f6\u914d\u7f6e\uff08\u4e0d\u5728 Agent \u6784\u9020\u51fd\u6570\uff0c\u5728 run() \u8c03\u7528\u5904\uff09\n\u2502   \u2514\u2500\u2500 RunConfig  # stream, timeout, response_model \u8986\u76d6, tool_choice \u8986\u76d6\n\u2502\n\u2514\u2500\u2500 \u5916\u7f6e\u6a21\u5757\uff08\u4e0d\u5728 Agent \u6784\u9020\u51fd\u6570\uff09\n    \u251c\u2500\u2500 SessionManager     # \u4f1a\u8bdd\u6301\u4e45\u5316 CRUD\n    \u2514\u2500\u2500 RunResponse        # \u8fd0\u884c\u7ed3\u679c\n</code></pre>"},{"location":"config_tech_v2/#33","title":"3.3 \u6838\u5fc3\u7c7b\u5b9a\u4e49","text":"<pre><code>@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, TeamMixin, ToolsMixin, PrinterMixin):\n    \"\"\"AI Agent \u2014 \u5b9a\u4e49\u667a\u80fd\u4f53\u7684\u8eab\u4efd\u548c\u80fd\u529b\u3002\n\n    Agent \u53ea\u5173\u5fc3\"\u6211\u662f\u8c01\u3001\u6211\u80fd\u505a\u4ec0\u4e48\"\uff0c\u4e0d\u7ba1\u4f1a\u8bdd\u6301\u4e45\u5316\u3002\n    Session \u7ba1\u7406\u7531\u5916\u90e8 SessionManager \u5904\u7406\u3002\n\n    Example - \u6700\u7b80\u7528\u6cd5:\n        &gt;&gt;&gt; agent = Agent(instructions=\"You are a helpful assistant.\")\n        &gt;&gt;&gt; response = await agent.run(\"Hello!\")\n\n    Example - \u5b8c\u6574\u914d\u7f6e:\n        &gt;&gt;&gt; agent = Agent(\n        ...     name=\"analyst\",\n        ...     model=OpenAIChat(id=\"gpt-4o\"),\n        ...     instructions=\"You are a data analyst.\",\n        ...     tools=[web_search, calculator],\n        ...     knowledge=my_knowledge,\n        ...     response_model=AnalysisReport,\n        ... )\n    \"\"\"\n\n    # ============================\n    # \u7b2c\u4e00\u5c42\uff1a\u6838\u5fc3\u5b9a\u4e49\uff08~10 \u53c2\u6570\uff09\n    # ============================\n    model: Optional[Model] = None\n    name: Optional[str] = None\n    agent_id: str = \"\"                     # default_factory in __init__\n    description: Optional[str] = None\n    instructions: Optional[Union[str, List[str], Callable]] = None\n    tools: Optional[List[Union[ModelTool, Tool, Callable, Dict, Function]]] = None\n    knowledge: Optional[Knowledge] = None\n    team: Optional[List[\"Agent\"]] = None\n    workspace: Optional[Workspace] = None\n    response_model: Optional[Type[Any]] = None\n\n    # ============================\n    # \u7b2c\u4e8c\u5c42\uff1a\u5e38\u7528\u914d\u7f6e\uff08~8 \u53c2\u6570\uff09\n    # ============================\n    add_history_to_messages: bool = False\n    num_history_responses: int = 3\n    search_knowledge: bool = True\n    output_language: Optional[str] = None\n    markdown: bool = False\n    structured_outputs: bool = False\n    debug: bool = False\n    monitoring: bool = False\n\n    # ============================\n    # \u7b2c\u4e09\u5c42\uff1a\u6253\u5305\u914d\u7f6e\n    # ============================\n    prompt_config: PromptConfig = field(default_factory=PromptConfig)\n    tool_config: ToolConfig = field(default_factory=ToolConfig)\n    memory_config: MemoryConfig = field(default_factory=MemoryConfig)\n    team_config: TeamConfig = field(default_factory=TeamConfig)\n\n    # ============================\n    # \u8fd0\u884c\u65f6\uff08\u5185\u90e8\u7ba1\u7406\uff0c\u4e0d\u66b4\u9732\u7ed9\u6784\u9020\u51fd\u6570\uff09\n    # ============================\n    memory: AgentMemory = field(default_factory=AgentMemory)\n    run_id: Optional[str] = field(default=None, init=False, repr=False)\n    run_input: Optional[Any] = field(default=None, init=False, repr=False)\n    run_response: RunResponse = field(default_factory=RunResponse, init=False, repr=False)\n    _cancelled: bool = field(default=False, init=False, repr=False)\n\n    def __init__(self, *, model=None, name=None, agent_id=None, ...):\n        # ~80 \u884c\uff0c\u53ea\u505a\u5b57\u6bb5\u8d4b\u503c + workspace_path \u5feb\u6377\u65b9\u5f0f\n        self.agent_id = agent_id or str(uuid4())\n        self.model = model\n        self.name = name\n        # ... \u5176\u4f59\u5b57\u6bb5\u76f4\u63a5\u8d4b\u503c\uff0c\u65e0\u522b\u540d\u6620\u5c04 ...\n</code></pre>"},{"location":"config_tech_v2/#34-runconfig-config_techmd","title":"3.4 RunConfig\uff08\u4ece config_tech.md \u65b9\u6848\u5438\u6536\uff09","text":"<pre><code>@dataclass\nclass RunConfig:\n    \"\"\"Per-run configuration. Overrides Agent defaults when provided.\n\n    \u628a\"\u6bcf\u6b21 run \u53ef\u80fd\u4e0d\u540c\"\u7684\u53c2\u6570\u4ece Agent \u6784\u9020\u51fd\u6570\u79fb\u5230 run() \u8c03\u7528\u5904\u3002\n    Agent \u4e0a\u7684\u540c\u540d\u5b57\u6bb5\uff08\u5982 response_model\uff09\u4ecd\u4f5c\u4e3a\u9ed8\u8ba4\u503c\uff0cRunConfig \u8986\u76d6\u3002\n\n    Example:\n        &gt;&gt;&gt; response = await agent.run(\"\u5206\u6790\u6570\u636e\", config=RunConfig(\n        ...     stream=True,\n        ...     run_timeout=30,\n        ...     response_model=AnalysisReport,\n        ... ))\n    \"\"\"\n    stream: bool = False\n    stream_intermediate_steps: bool = False\n    response_model: Optional[Type[Any]] = None\n    structured_outputs: Optional[bool] = None\n    tool_choice: Optional[Union[str, Dict[str, Any]]] = None\n    run_timeout: Optional[float] = None\n    first_token_timeout: Optional[float] = None\n    save_response_to_file: Optional[str] = None\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u9700\u8981 RunConfig\uff1a - <code>stream</code>/<code>timeout</code> \u662f\"\u8fd9\u4e00\u6b21\u8fd0\u884c\"\u7684\u914d\u7f6e\uff0c\u4e0d\u662f Agent \u7684\u56fa\u6709\u5c5e\u6027 - \u907f\u514d <code>run()</code> \u7b7e\u540d\u65e0\u9650\u81a8\u80c0\u2014\u2014\u65b0\u589e\u8fd0\u884c\u65f6\u53c2\u6570\u53ea\u9700\u52a0\u5230 RunConfig - Agent \u4e0a\u7684 <code>response_model</code>\u3001<code>structured_outputs</code> \u662f\u9ed8\u8ba4\u503c\uff0cRunConfig \u53ef\u4ee5\u8986\u76d6</p>"},{"location":"config_tech_v2/#35-config","title":"3.5 Config \u5bf9\u8c61\u5b9a\u4e49","text":"<pre><code>@dataclass\nclass PromptConfig:\n    \"\"\"Prompt \u6784\u5efa\u76f8\u5173\u7684\u9ad8\u7ea7\u914d\u7f6e\u3002\n\n    \u5927\u90e8\u5206\u7528\u6237\u53ea\u9700 Agent.instructions\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f9b\u9ad8\u7ea7\u5b9a\u5236\u3002\n    \"\"\"\n    # \u81ea\u5b9a\u4e49 system prompt\uff08\u8986\u76d6\u9ed8\u8ba4\u6784\u5efa\u903b\u8f91\uff09\n    system_prompt: Optional[Union[str, Callable]] = None\n    system_prompt_template: Optional[PromptTemplate] = None\n    use_default_system_message: bool = True\n    system_message_role: str = \"system\"\n    user_message_role: str = \"user\"\n    user_prompt_template: Optional[PromptTemplate] = None\n    use_default_user_message: bool = True\n\n    # System message \u6784\u5efa\u7ec6\u8282\n    task: Optional[str] = None\n    role: Optional[str] = None\n    guidelines: Optional[List[str]] = None\n    expected_output: Optional[str] = None\n    additional_context: Optional[str] = None\n    introduction: Optional[str] = None\n    references_format: Literal[\"json\", \"yaml\"] = \"json\"\n\n    # Prompt \u884c\u4e3a\u5f00\u5173\n    add_name_to_instructions: bool = False\n    add_datetime_to_instructions: bool = True\n    prevent_hallucinations: bool = False\n    prevent_prompt_leakage: bool = False\n    limit_tool_access: bool = False\n    enable_agentic_prompt: bool = False\n\n\n@dataclass\nclass ToolConfig:\n    \"\"\"\u5de5\u5177\u8c03\u7528\u76f8\u5173\u7684\u9ad8\u7ea7\u914d\u7f6e\u3002\"\"\"\n    support_tool_calls: bool = True\n    tool_call_limit: Optional[int] = None\n    tool_choice: Optional[Union[str, Dict[str, Any]]] = None\n    auto_load_mcp: bool = False\n    read_chat_history: bool = False\n    read_tool_call_history: bool = False\n    update_knowledge: bool = False\n    add_references: bool = False\n    compress_tool_results: bool = False\n    compression_manager: Optional[Any] = None\n\n\n@dataclass\nclass MemoryConfig:\n    \"\"\"\u8bb0\u5fc6\u4e0e Workspace \u76f8\u5173\u7684\u9ad8\u7ea7\u914d\u7f6e\u3002\"\"\"\n    load_workspace_context: bool = True\n    load_workspace_memory: bool = True\n    memory_days: int = 2\n\n\n@dataclass\nclass TeamConfig:\n    \"\"\"\u56e2\u961f\u534f\u4f5c\u76f8\u5173\u7684\u9ad8\u7ea7\u914d\u7f6e\u3002\"\"\"\n    role: Optional[str] = None\n    respond_directly: bool = False\n    add_transfer_instructions: bool = True\n    team_response_separator: str = \"\\n\"\n</code></pre>"},{"location":"config_tech_v2/#36-sessionmanager-agent","title":"3.6 SessionManager\uff08\u4ece Agent \u5265\u79bb\uff09","text":"<p>\u8bbe\u8ba1\u9009\u62e9\uff1a SessionManager \u53ea\u7ba1\u6570\u636e\u52a0\u8f7d/\u4fdd\u5b58\uff0c<code>agent.run()</code> \u4ecd\u7136\u662f\u6267\u884c\u4e3b\u4f53\u3002 \u4e0d\u5f15\u5165 <code>sm.run()</code> \u65b9\u6cd5\uff0c\u907f\u514d\"\u4e24\u79cd run \u65b9\u5f0f\"\u7684\u8ba4\u77e5\u8d1f\u62c5\u3002</p> <pre><code>class SessionManager:\n    \"\"\"\u72ec\u7acb\u7684\u4f1a\u8bdd\u7ba1\u7406\u5668\u3002\n\n    Agent \u662f\u65e0\u72b6\u6001\u5b9a\u4e49\uff0cSessionManager \u7ba1\u7406\u4f1a\u8bdd\u7684\u751f\u547d\u5468\u671f\u3002\n    SessionManager \u53ea\u8d1f\u8d23 load/save\uff0c\u4e0d\u53c2\u4e0e\u6267\u884c\u3002\n\n    Example:\n        &gt;&gt;&gt; agent = Agent(instructions=\"You are helpful.\")\n        &gt;&gt;&gt; sm = SessionManager(db=SqliteDb(\"agent.db\"))\n        &gt;&gt;&gt;\n        &gt;&gt;&gt; # \u521b\u5efa\u65b0\u4f1a\u8bdd\n        &gt;&gt;&gt; session = await sm.create_session(agent, user_id=\"alice\")\n        &gt;&gt;&gt;\n        &gt;&gt;&gt; # \u52a0\u8f7d\u4f1a\u8bdd \u2192 \u8fd0\u884c \u2192 \u4fdd\u5b58\n        &gt;&gt;&gt; await sm.load(agent, session)\n        &gt;&gt;&gt; response = await agent.run(\"Hello!\")\n        &gt;&gt;&gt; await sm.save(agent, session)\n        &gt;&gt;&gt;\n        &gt;&gt;&gt; # \u6062\u590d\u5df2\u6709\u4f1a\u8bdd\n        &gt;&gt;&gt; session = await sm.get_session(session_id=\"xxx\")\n        &gt;&gt;&gt; await sm.load(agent, session)\n        &gt;&gt;&gt; response = await agent.run(\"Continue our conversation\")\n        &gt;&gt;&gt; await sm.save(agent, session)\n    \"\"\"\n\n    def __init__(self, db: BaseDb, *, user_id: Optional[str] = None):\n        self.db = db\n        self.user_id = user_id\n\n    async def create_session(\n        self, agent: Agent, user_id: Optional[str] = None\n    ) -&gt; Session:\n        \"\"\"\u521b\u5efa\u65b0\u4f1a\u8bdd\u3002\"\"\"\n        ...\n\n    async def get_session(self, session_id: str) -&gt; Session:\n        \"\"\"\u4ece DB \u83b7\u53d6\u4f1a\u8bdd\u5143\u6570\u636e\u3002\"\"\"\n        ...\n\n    async def load(self, agent: Agent, session: Session) -&gt; None:\n        \"\"\"\u4ece DB \u52a0\u8f7d\u4f1a\u8bdd\uff0c\u6062\u590d agent.memory \u72b6\u6001\u3002\"\"\"\n        ...\n\n    async def save(self, agent: Agent, session: Session) -&gt; None:\n        \"\"\"\u628a agent.memory \u6301\u4e45\u5316\u5230 DB\u3002\"\"\"\n        ...\n\n    async def list_sessions(\n        self, agent_id: Optional[str] = None, user_id: Optional[str] = None\n    ) -&gt; List[Session]:\n        ...\n\n    async def delete_session(self, session_id: str) -&gt; None:\n        ...\n\n    async def rename_session(self, session_id: str, name: str) -&gt; None:\n        ...\n\n\n@dataclass\nclass Session:\n    \"\"\"\u4f1a\u8bdd\u6570\u636e\u5bf9\u8c61\u3002\"\"\"\n    session_id: str\n    agent_id: str\n    user_id: Optional[str] = None\n    session_name: Optional[str] = None\n    memory: AgentMemory = field(default_factory=AgentMemory)\n    state: Dict[str, Any] = field(default_factory=dict)\n    created_at: Optional[datetime] = None\n    updated_at: Optional[datetime] = None\n</code></pre>"},{"location":"config_tech_v2/#37-agentrun","title":"3.7 Agent.run() \u63a5\u53e3","text":"<pre><code>class Agent:\n    async def run(\n        self,\n        message: Optional[Union[str, List, Dict, Message]] = None,\n        *,\n        images: Optional[Sequence[Any]] = None,\n        videos: Optional[Sequence[Any]] = None,\n        audio: Optional[Any] = None,\n        messages: Optional[Sequence[Union[Dict, Message]]] = None,\n        config: Optional[RunConfig] = None,\n    ) -&gt; RunResponse:\n        \"\"\"\u6267\u884c\u4e00\u8f6e\u5bf9\u8bdd\u3002\n\n        \u5982\u679c\u9700\u8981\u591a\u8f6e\u5bf9\u8bdd\u4e14\u4e0d\u9700\u8981\u6301\u4e45\u5316\uff0cAgent \u5185\u90e8 memory \u81ea\u52a8\u7ef4\u62a4\u4e0a\u4e0b\u6587\u3002\n        \u5982\u679c\u9700\u8981\u6301\u4e45\u5316\uff0c\u4f7f\u7528 SessionManager.load() / save() \u5728 run \u524d\u540e\u7ba1\u7406\u3002\n        \"\"\"\n        ...\n\n    async def run_stream(\n        self,\n        message: Optional[Union[str, List, Dict, Message]] = None,\n        *,\n        images: Optional[Sequence[Any]] = None,\n        videos: Optional[Sequence[Any]] = None,\n        audio: Optional[Any] = None,\n        messages: Optional[Sequence[Union[Dict, Message]]] = None,\n        config: Optional[RunConfig] = None,\n    ) -&gt; AsyncIterator[RunResponse]:\n        ...\n\n    def run_sync(self, message=None, **kwargs) -&gt; RunResponse:\n        \"\"\"\u540c\u6b65\u9002\u914d\u5668\uff0c\u5185\u90e8\u8c03\u7528 run()\u3002\"\"\"\n        ...\n\n    def run_stream_sync(self, message=None, **kwargs) -&gt; Iterator[RunResponse]:\n        \"\"\"\u540c\u6b65\u6d41\u5f0f\u9002\u914d\u5668\u3002\"\"\"\n        ...\n</code></pre>"},{"location":"config_tech_v2/#_3","title":"\u56db\u3001\u5220\u9664\u6e05\u5355","text":""},{"location":"config_tech_v2/#41","title":"4.1 \u76f4\u63a5\u5220\u9664\u7684\u53c2\u6570","text":"\u53c2\u6570 \u7406\u7531 \u53bb\u5411 <code>llm</code> \u517c\u5bb9\u522b\u540d \u7528 <code>model</code> <code>knowledge_base</code> \u517c\u5bb9\u522b\u540d \u7528 <code>knowledge</code> <code>add_chat_history_to_messages</code> \u517c\u5bb9\u522b\u540d \u7528 <code>add_history_to_messages</code> <code>add_knowledge_references_to_prompt</code> \u517c\u5bb9\u522b\u540d \u7528 <code>ToolConfig.add_references</code> <code>output_model</code> \u517c\u5bb9\u522b\u540d \u7528 <code>response_model</code> <code>output_file</code> \u517c\u5bb9\u522b\u540d \u7528 <code>RunConfig.save_response_to_file</code> <code>debug</code> \u517c\u5bb9\u522b\u540d \u7528 <code>debug</code> <code>enable_user_memories</code> \u5df2\u5e9f\u5f03 Workspace \u66ff\u4ee3 <code>images</code> \u6784\u9020\u65f6\u4e0d\u9700\u8981 <code>run(images=...)</code> <code>videos</code> \u6784\u9020\u65f6\u4e0d\u9700\u8981 <code>run(videos=...)</code> <code>agent_data</code> \u65e0\u4f7f\u7528\u573a\u666f \u5220\u9664 <code>user_data</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>Session.state</code> <code>session_id</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>SessionManager</code> <code>session_name</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>SessionManager</code> <code>session_state</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>Session.state</code> <code>session_data</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>Session</code> <code>db</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>SessionManager</code> <code>user_id</code> \u5c5e\u4e8e\u4f1a\u8bdd <code>SessionManager</code> / <code>Session</code> <code>stream</code> \u8fd0\u884c\u65f6\u914d\u7f6e <code>run()</code> vs <code>run_stream()</code> \u533a\u5206 <code>stream_intermediate_steps</code> \u8fd0\u884c\u65f6\u914d\u7f6e <code>RunConfig</code> <code>run_timeout</code> \u8fd0\u884c\u65f6\u914d\u7f6e <code>RunConfig</code> <code>first_token_timeout</code> \u8fd0\u884c\u65f6\u914d\u7f6e <code>RunConfig</code> <code>save_response_to_file</code> \u8fd0\u884c\u65f6\u914d\u7f6e <code>RunConfig</code> <code>add_messages</code> \u8fd0\u884c\u65f6\u8f93\u5165 <code>run(messages=...)</code> <code>context</code> \u8fd0\u884c\u65f6\u8f93\u5165 <code>run()</code> \u5185\u90e8\u5904\u7406 <code>add_context</code> \u5185\u90e8\u903b\u8f91 \u6709 context \u5c31\u7528 <code>resolve_context</code> \u5185\u90e8\u903b\u8f91 \u5220\u9664 <code>parse_response</code> \u5185\u90e8\u903b\u8f91 \u6709 response_model \u81ea\u52a8 parse <code>workspace_path</code> \u5feb\u6377\u65b9\u5f0f <code>workspace=Workspace(path)</code> <code>retriever</code> Knowledge \u5185\u90e8 <code>Knowledge</code> \u81ea\u884c\u7ba1\u7406"},{"location":"config_tech_v2/#42-config","title":"4.2 \u79fb\u5165 Config \u5bf9\u8c61\u7684\u53c2\u6570","text":"\u4ece Agent \u9876\u5c42 \u79fb\u5165 <code>system_prompt</code>, <code>system_prompt_template</code>, <code>use_default_system_message</code>, <code>system_message_role</code>, <code>user_message_role</code>, <code>user_prompt_template</code>, <code>use_default_user_message</code> <code>PromptConfig</code> <code>task</code>, <code>role</code>, <code>guidelines</code>, <code>expected_output</code>, <code>additional_context</code>, <code>introduction</code> <code>PromptConfig</code> <code>add_name_to_instructions</code>, <code>add_datetime_to_instructions</code>, <code>prevent_hallucinations</code>, <code>prevent_prompt_leakage</code>, <code>limit_tool_access</code>, <code>enable_agentic_prompt</code> <code>PromptConfig</code> <code>references_format</code> <code>PromptConfig</code> <code>support_tool_calls</code>, <code>tool_call_limit</code>, <code>tool_choice</code>, <code>auto_load_mcp</code> <code>ToolConfig</code> <code>read_chat_history</code>, <code>read_tool_call_history</code>, <code>update_knowledge</code>, <code>add_references</code> <code>ToolConfig</code> <code>compress_tool_results</code>, <code>compression_manager</code> <code>ToolConfig</code> <code>load_workspace_context</code>, <code>load_workspace_memory</code>, <code>memory_days</code> <code>MemoryConfig</code> <code>respond_directly</code>, <code>add_transfer_instructions</code>, <code>team_response_separator</code> <code>TeamConfig</code>"},{"location":"config_tech_v2/#mixin","title":"\u4e94\u3001Mixin \u91cd\u6784","text":""},{"location":"config_tech_v2/#51","title":"5.1 \u7ee7\u627f\u94fe\u53d8\u5316","text":"<pre><code># \u5f53\u524d (V1)\n@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, SessionMixin, TeamMixin, ToolsMixin, PrinterMixin, MediaMixin)\n\n# V2\n@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, TeamMixin, ToolsMixin, PrinterMixin)\n</code></pre> <p>\u5220\u9664\uff1a - SessionMixin \u2014 \u5168\u90e8\u8fc1\u79fb\u5230\u72ec\u7acb <code>SessionManager</code> - MediaMixin \u2014 <code>images</code>/<code>videos</code> \u79fb\u5230 <code>run()</code> \u53c2\u6570\uff0c<code>add_image()</code>/<code>add_video()</code> \u65b9\u6cd5\u4e0d\u518d\u9700\u8981</p>"},{"location":"config_tech_v2/#52-runnermixin","title":"5.2 RunnerMixin \u7626\u8eab","text":"<p><code>_run_impl</code> \u4e2d\u79fb\u9664 session IO \u6b65\u9aa4\uff1a</p> <pre><code># \u5f53\u524d _run_impl \u6d41\u7a0b\n1. self.update_model()\n2. self._resolve_context()\n3. await self.read_from_storage()      \u2190 \u5220\u9664\n4. self.add_introduction()\n5. await self.get_messages_for_run()\n6. await self.model.response()\n7. self.memory.add_messages()\n8. await self.write_to_storage()       \u2190 \u5220\u9664\n9. self.save_run_response_to_file()\n\n# V2 _run_impl \u6d41\u7a0b\uff08\u7eaf\u6267\u884c\uff09\n1. update_model()\n2. get_messages_for_run()\n3. model.response() / model.response_stream()\n4. memory.add_messages()\n5. return RunResponse\n</code></pre> <p>Session \u52a0\u8f7d/\u4fdd\u5b58\u7531\u8c03\u7528\u65b9\u901a\u8fc7 SessionManager \u63a7\u5236\u3002</p>"},{"location":"config_tech_v2/#53-promptsmixin","title":"5.3 PromptsMixin \u9002\u914d","text":"<p>Mixin \u5185\u90e8\u4ece <code>self.prevent_hallucinations</code> \u6539\u4e3a\u8bfb\u53d6 <code>self.prompt_config.prevent_hallucinations</code>\u3002 \u540c\u7406\u5176\u4ed6\u88ab\u79fb\u5165 Config \u7684\u5b57\u6bb5\u3002\u8fd9\u662f\u673a\u68b0\u6027\u66ff\u6362\uff0c\u4e0d\u6d89\u53ca\u903b\u8f91\u53d8\u5316\u3002</p>"},{"location":"config_tech_v2/#54-mixin","title":"5.4 Mixin \u72b6\u6001\u603b\u89c8","text":"Mixin \u72b6\u6001 \u8bf4\u660e PromptsMixin \u9002\u914d \u4ece <code>self.xxx</code> \u6539\u4e3a <code>self.prompt_config.xxx</code> RunnerMixin \u7626\u8eab \u79fb\u9664 session IO\uff0c\u652f\u6301 RunConfig \u53c2\u6570 TeamMixin \u9002\u914d \u4ece <code>self.xxx</code> \u6539\u4e3a <code>self.team_config.xxx</code> ToolsMixin \u9002\u914d \u4ece <code>self.xxx</code> \u6539\u4e3a <code>self.tool_config.xxx</code> PrinterMixin \u4fdd\u6301\u4e0d\u53d8 SessionMixin \u5220\u9664 \u2192 <code>SessionManager</code> MediaMixin \u5220\u9664 \u2192 <code>run()</code> \u53c2\u6570"},{"location":"config_tech_v2/#api","title":"\u516d\u3001\u7528\u6237 API \u5bf9\u6bd4","text":""},{"location":"config_tech_v2/#61","title":"6.1 \u6700\u7b80\u7528\u6cd5\uff08\u65e0\u53d8\u5316\uff09","text":"<pre><code>agent = Agent(model=OpenAIChat(id=\"gpt-4o\"))\nresponse = agent.run_sync(\"Hello!\")\n</code></pre>"},{"location":"config_tech_v2/#62","title":"6.2 \u5e26\u5de5\u5177\u548c\u6307\u4ee4\uff08\u65e0\u53d8\u5316\uff09","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    name=\"analyst\",\n    instructions=\"You are a data analyst.\",\n    tools=[web_search, calculator],\n    description=\"Data analysis expert\",\n)\n</code></pre>"},{"location":"config_tech_v2/#63","title":"6.3 \u591a\u8f6e\u5bf9\u8bdd + \u6301\u4e45\u5316","text":"<pre><code># V1 \u2014 Session \u6df7\u5728 Agent \u91cc\nagent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=\"You are helpful.\",\n    db=SqliteDb(\"agent.db\"),\n    session_id=\"session-123\",\n    user_id=\"alice\",\n    add_history_to_messages=True,\n)\nresponse = agent.run_sync(\"Hello!\")\nresponse = agent.run_sync(\"Continue...\")\n\n# V2 \u2014 Session \u72ec\u7acb\u7ba1\u7406\nagent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=\"You are helpful.\",\n    add_history_to_messages=True,\n)\nsm = SessionManager(db=SqliteDb(\"agent.db\"))\nsession = await sm.create_session(agent, user_id=\"alice\")\nawait sm.load(agent, session)\nresponse = await agent.run(\"Hello!\")\nresponse = await agent.run(\"Continue...\")\nawait sm.save(agent, session)\n\n# V2 \u5feb\u6377\u65b9\u5f0f \u2014 \u4e0d\u9700\u8981\u6301\u4e45\u5316\u65f6\nagent = Agent(instructions=\"You are helpful.\", add_history_to_messages=True)\nresponse = agent.run_sync(\"Hello!\")       # \u5185\u90e8 memory \u81ea\u52a8\u7ef4\u62a4\u4e0a\u4e0b\u6587\nresponse = agent.run_sync(\"Continue...\")  # \u81ea\u52a8\u4fdd\u6301\u591a\u8f6e\n</code></pre>"},{"location":"config_tech_v2/#64-rag","title":"6.4 RAG\uff08\u65e0\u53d8\u5316\uff09","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    knowledge=my_knowledge,\n    search_knowledge=True,\n    add_history_to_messages=True,\n    markdown=True,\n)\n</code></pre>"},{"location":"config_tech_v2/#65-prompt","title":"6.5 \u9ad8\u7ea7 Prompt \u5b9a\u5236","text":"<pre><code># V1 \u2014 \u901a\u8fc7 prompt_config \u6253\u5305\nagent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=\"...\",\n    output_language=\"zh\",\n    markdown=True,\n    prompt_config=PromptConfig(\n        prevent_hallucinations=True,\n        prevent_prompt_leakage=True,\n        add_datetime_to_instructions=True,\n        system_message_role=\"system\",\n    ),\n)\n\n# \u5e38\u7528\u914d\u7f6e\u4fdd\u7559\u9876\u5c42\nagent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=\"...\",\n    output_language=\"zh\",\n    markdown=True,\n)\n</code></pre>"},{"location":"config_tech_v2/#66","title":"6.6 \u56e2\u961f","text":"<pre><code># V1\nleader = Agent(\n    name=\"leader\",\n    team=[analyst, writer],\n    add_transfer_instructions=True,\n    respond_directly=False,\n)\n\n# V2\nleader = Agent(\n    name=\"leader\",\n    team=[analyst, writer],\n    team_config=TeamConfig(\n        add_transfer_instructions=True,\n        respond_directly=False,\n    ),\n)\n</code></pre>"},{"location":"config_tech_v2/#67-runconfig","title":"6.7 RunConfig \u8fd0\u884c\u65f6\u8986\u76d6\uff08\u65b0\u80fd\u529b\uff09","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=\"You are a data analyst.\",\n    response_model=BriefReport,        # Agent \u9ed8\u8ba4\u8f93\u51fa\u7c7b\u578b\n)\n\n# \u8fd9\u6b21\u8981\u6d41\u5f0f + \u4e0d\u540c\u8f93\u51fa\u7c7b\u578b + \u8d85\u65f6\u63a7\u5236\nresponse = await agent.run(\n    \"\u5206\u6790\u8fd9\u6bb5\u4ee3\u7801\",\n    config=RunConfig(\n        stream=True,\n        response_model=DetailedReport,  # \u8986\u76d6\u9ed8\u8ba4\n        run_timeout=30,\n    ),\n)\n\n# \u4e0d\u4f20 config \u65f6\u4f7f\u7528 Agent \u4e0a\u7684\u9ed8\u8ba4\u503c\nresponse = await agent.run(\"\u5feb\u901f\u5206\u6790\")  # \u7528 BriefReport\n</code></pre>"},{"location":"config_tech_v2/#_4","title":"\u4e03\u3001\u8fc1\u79fb\u8ba1\u5212","text":""},{"location":"config_tech_v2/#phase-1-config-runconfig","title":"Phase 1\uff1a\u53c2\u6570\u5206\u5c42 + Config \u5bf9\u8c61 + RunConfig","text":"<ol> <li>\u521b\u5efa <code>PromptConfig</code>, <code>ToolConfig</code>, <code>MemoryConfig</code>, <code>TeamConfig</code> \u56db\u4e2a dataclass \u2192 <code>agentica/agent/config.py</code></li> <li>\u521b\u5efa <code>RunConfig</code> dataclass \u2192 <code>agentica/run_config.py</code></li> <li>\u91cd\u5199 Agent <code>__init__</code>\uff1a\u5220\u9664\u522b\u540d\u3001\u5220\u9664\u5e9f\u5f03\u53c2\u6570\u3001\u5c06\u9ad8\u7ea7\u53c2\u6570\u6536\u5165 Config \u5bf9\u8c61</li> <li>\u9002\u914d\u6240\u6709 Mixin\uff1a<code>self.xxx</code> \u2192 <code>self.prompt_config.xxx</code> / <code>self.tool_config.xxx</code> \u7b49</li> <li><code>images</code>/<code>videos</code>/<code>add_messages</code> \u4ece\u6784\u9020\u53c2\u6570\u79fb\u5230 <code>run()</code> \u53c2\u6570</li> <li><code>run()</code> / <code>run_stream()</code> \u7b7e\u540d\u589e\u52a0 <code>config: Optional[RunConfig] = None</code></li> <li>\u8fd0\u884c\u65f6\u5b57\u6bb5\uff08<code>run_id</code>, <code>run_input</code>, <code>run_response</code>\uff09\u4fdd\u7559\u4e3a <code>field(init=False)</code></li> <li>\u5220\u9664 <code>MediaMixin</code>\uff0c\u5176\u903b\u8f91\u5185\u8054\u5230 RunnerMixin</li> <li>\u66f4\u65b0\u6240\u6709 tests \u548c examples</li> </ol>"},{"location":"config_tech_v2/#phase-2session","title":"Phase 2\uff1aSession \u5265\u79bb","text":"<ol> <li>\u521b\u5efa\u72ec\u7acb <code>SessionManager</code> \u7c7b \u2192 <code>agentica/session.py</code></li> <li>\u521b\u5efa <code>Session</code> \u6570\u636e\u5bf9\u8c61</li> <li>\u5c06 <code>SessionMixin</code> \u7684\u65b9\u6cd5\u8fc1\u79fb\u5230 <code>SessionManager</code></li> <li>\u4ece Agent \u5220\u9664 session \u76f8\u5173\u5b57\u6bb5\uff1a<code>session_id</code>, <code>session_name</code>, <code>session_state</code>, <code>session_data</code>, <code>db</code>, <code>user_id</code>, <code>user_data</code>, <code>_agent_session</code></li> <li>\u4ece\u7ee7\u627f\u94fe\u4e2d\u79fb\u9664 <code>SessionMixin</code></li> <li>RunnerMixin \u4e2d\u79fb\u9664 <code>read_from_storage()</code> / <code>write_to_storage()</code> \u8c03\u7528</li> <li>Agent \u4fdd\u7559\u5185\u90e8 <code>memory: AgentMemory</code> \u7528\u4e8e\u65e0\u6301\u4e45\u5316\u7684\u4e34\u65f6\u591a\u8f6e\u5bf9\u8bdd</li> <li>\u66f4\u65b0\u6240\u6709 examples</li> </ol>"},{"location":"config_tech_v2/#phase-3","title":"Phase 3\uff1a\u6e05\u7406 + \u6d4b\u8bd5","text":"<ol> <li>\u5220\u9664\u65e0\u7528\u53c2\u6570\uff1a<code>agent_data</code>, <code>resolve_context</code>, <code>add_context</code>, <code>parse_response</code></li> <li>\u5220\u9664 <code>enable_user_memories</code></li> <li><code>workspace_path</code> \u5feb\u6377\u65b9\u5f0f\u5185\u8054\u5230 <code>__init__</code>\uff08<code>if workspace_path: self.workspace = Workspace(path=workspace_path)</code>\uff09</li> <li>\u5168\u91cf\u8dd1 <code>pytest tests/ -v</code></li> <li>\u66f4\u65b0\u6240\u6709 examples \u548c README</li> </ol>"},{"location":"config_tech_v2/#agent","title":"\u516b\u3001\u6700\u7ec8 Agent \u7b7e\u540d\u4e00\u89c8","text":"<p>Phase 3 \u5b8c\u6210\u540e\uff1a</p> <pre><code>@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, TeamMixin, ToolsMixin, PrinterMixin):\n    def __init__(\n        self,\n        *,\n        # ---- \u6838\u5fc3\u5b9a\u4e49 ----\n        model: Optional[Model] = None,\n        name: Optional[str] = None,\n        agent_id: Optional[str] = None,\n        description: Optional[str] = None,\n        instructions: Optional[Union[str, List[str], Callable]] = None,\n        tools: Optional[List[Union[ModelTool, Tool, Callable, Dict, Function]]] = None,\n        knowledge: Optional[Knowledge] = None,\n        team: Optional[List[\"Agent\"]] = None,\n        workspace: Optional[Union[Workspace, str]] = None,  # str \u2192 Workspace(path=str)\n        response_model: Optional[Type[Any]] = None,\n        # ---- \u5e38\u7528\u914d\u7f6e ----\n        add_history_to_messages: bool = False,\n        num_history_responses: int = 3,\n        search_knowledge: bool = True,\n        output_language: Optional[str] = None,\n        markdown: bool = False,\n        structured_outputs: bool = False,\n        debug: bool = False,\n        monitoring: bool = False,\n        # ---- \u6253\u5305\u914d\u7f6e ----\n        prompt_config: Optional[PromptConfig] = None,\n        tool_config: Optional[ToolConfig] = None,\n        memory_config: Optional[MemoryConfig] = None,\n        team_config: Optional[TeamConfig] = None,\n        # ---- \u8fd0\u884c\u65f6\u5185\u90e8 ----\n        memory: Optional[AgentMemory] = None,\n    ):\n        ...\n</code></pre> <p>\u53c2\u6570\u8ba1\u6570\uff1a10\uff08\u6838\u5fc3\uff09+ 8\uff08\u5e38\u7528\uff09+ 4\uff08Config\uff09+ 1\uff08memory\uff09= 23 \u4e2a\u3002</p>"},{"location":"config_tech_v2/#_5","title":"\u4e5d\u3001\u98ce\u9669\u63a7\u5236","text":"\u98ce\u9669 \u6982\u7387 \u7f13\u89e3\u65b9\u6848 \u5916\u90e8\u7528\u6237\u5728\u7528\u522b\u540d\u53c2\u6570 \u4f4e\uff08\u65e9\u671f\u9879\u76ee\uff09 \u76f4\u63a5\u5220\u9664\uff0cCHANGELOG \u8bf4\u660e Session \u5265\u79bb\u5bfc\u81f4\u591a\u8f6e\u5bf9\u8bdd API \u53d8\u5316 \u9ad8 Agent \u4fdd\u7559\u5185\u90e8 memory\uff0c\u65e0 SessionManager \u65f6\u81ea\u52a8\u4e34\u65f6\u591a\u8f6e Mixin \u5185\u90e8 <code>self.xxx</code> \u5927\u91cf\u6539\u4e3a <code>self.prompt_config.xxx</code> \u4e2d \u673a\u68b0\u6027\u66ff\u6362\uff0c\u6bcf\u4e2a Phase \u8dd1\u5b8c\u6574 tests RunConfig \u4e0e Agent \u9ed8\u8ba4\u503c\u7684\u5408\u5e76\u903b\u8f91 \u4f4e <code>_run_impl</code> \u5f00\u5934\u505a <code>config = config or RunConfig()</code>\uff0c\u5b57\u6bb5\u4e3a None \u65f6 fallback \u5230 Agent \u9ed8\u8ba4 dataclass \u4e0d\u652f\u6301 <code>model_dump_json()</code> \u5e8f\u5217\u5316 \u4f4e \u624b\u52a8\u5b9e\u73b0 <code>to_dict()</code> / <code>from_dict()</code>\uff0c\u6ee1\u8db3\u914d\u7f6e\u5bfc\u51fa\u9700\u6c42"},{"location":"config_tech_v2/#_6","title":"\u5341\u3001\u9884\u671f\u6536\u76ca","text":"\u6307\u6807 V1\uff08\u5f53\u524d\uff09 V2 \u6784\u9020\u53c2\u6570\u6570 57 23\uff08\u6838\u5fc3\u53ef\u89c1\uff09 <code>__init__</code> \u4ee3\u7801\u884c\u6570 300+ ~80 \u65b0\u624b\u7406\u89e3\u6210\u672c \u8bfb\u534a\u5929\u6587\u6863 \u770b\u524d 10 \u4e2a\u53c2\u6570\u5373\u53ef\u4e0a\u624b IDE \u63d0\u793a \u5237 3 \u5c4f \u4e00\u5c4f\u641e\u5b9a Session \u7ba1\u7406 \u4e0e Agent \u8026\u5408 \u72ec\u7acb\u6a21\u5757\uff0c\u53ef\u72ec\u7acb\u6d4b\u8bd5 \u8fd0\u884c\u65f6\u914d\u7f6e \u6784\u9020\u65f6\u56fa\u5b9a RunConfig \u6309\u9700\u8986\u76d6 \u5e76\u53d1\u5b89\u5168 Agent \u6301\u6709\u8fd0\u884c\u65f6\u72b6\u6001\uff0c\u4e0d\u53ef\u5e76\u53d1 \u8fd0\u884c\u65f6\u72b6\u6001\u5728\u6808\u5e27\u5185\uff0c\u53ef\u5e76\u53d1\uff08Phase 3 \u540e\uff09 \u591a\u8f6e\u5bf9\u8bdd \u5fc5\u987b\u5728\u6784\u9020\u65f6\u914d\u7f6e db/session_id \u8fd0\u884c\u65f6\u901a\u8fc7 SessionManager \u7ba1\u7406 Mixin \u7ee7\u627f\u94fe 7 \u4e2a 5 \u4e2a"},{"location":"paper/","title":"Agentica: An Async-First Agent Framework with Structured Concurrency for Autonomous Research and Software Engineering","text":"<p>Target Venue: AAAI 2027</p> <p>Status: Draft \u2014 experimental results sections marked with <code>[TODO]</code> placeholders</p>"},{"location":"paper/#abstract","title":"Abstract","text":"<p>Large language model (LLM) agents have demonstrated remarkable potential in autonomous research and software engineering tasks. However, existing agent frameworks suffer from fundamental architectural limitations: synchronous execution bottlenecks that serialize independent tool calls, lack of structured concurrency guarantees for parallel operations, fragmented session management that separates execution state from the agent itself, and insufficient context management for long-horizon tasks. We present Agentica, an async-first agent framework built on Python 3.12 that introduces several key innovations: (1) structured concurrent tool execution via <code>asyncio.TaskGroup</code> with per-task exception isolation, providing formal safety guarantees that no partial results are lost on individual tool failures; (2) a three-layer tool abstraction (Tool \u2192 Function \u2192 FunctionCall) with memory-safe weak references and transparent sync/async boundary bridging; (3) an Agent-as-Session unified state model where the agent itself serves as the session carrier through token-aware run history management, eliminating the architectural fragmentation of separate Runner/Session abstractions; (4) a DeepAgent extension featuring dual-threshold hysteresis context management with formal convergence properties and HEARTBEAT-style iteration control; and (5) a dual-level guardrail system supporting both agent-level and tool-level input/output validation. We formalize the agent execution model as a state transition system and prove key safety properties including exception isolation, termination guarantees, and context bound enforcement. We evaluate on three challenging benchmarks \u2014 GAIA, SWE-bench Verified, and Terminal-Bench \u2014 demonstrating that architectural design choices in the agent framework significantly impact task completion rates, efficiency, and reliability. Our results show that structured concurrency yields <code>[TODO: X%]</code> speedup on multi-tool tasks, dual-threshold context management improves long-horizon task completion by <code>[TODO: X%]</code>, and overall performance is competitive with or exceeds state-of-the-art agent systems.</p>"},{"location":"paper/#1-introduction","title":"1. Introduction","text":"<p>The emergence of LLM-based autonomous agents has catalyzed a paradigm shift in how complex tasks are approached \u2014 from software engineering (Jimenez et al., 2024) to deep research (Xu &amp; Peng, 2025) and general-purpose assistance (Mialon et al., 2023). Unlike simple chatbots that produce single-turn responses, agents engage in multi-step reasoning, invoke external tools, coordinate with sub-agents, and maintain persistent state across extended interactions.</p> <p>Despite rapid progress, current agent frameworks face several architectural challenges that limit their effectiveness on hard, long-horizon tasks:</p> <p>Challenge 1: Sequential tool execution. When an LLM returns multiple tool calls in a single response (e.g., searching the web while simultaneously reading a file), most frameworks execute them sequentially. MetaGPT (Hong et al., 2023) processes actions in a pipeline; CrewAI uses sequential task execution; LangGraph's <code>ToolNode</code> dispatches tools one at a time. The OpenAI Agents SDK does not document its internal concurrency model for tool calls. Only AutoGen v0.4 adopts an async-first design, but through an Actor-based message-passing model rather than structured concurrency. This serialization wastes wall-clock time on I/O-bound operations that could safely proceed in parallel.</p> <p>Challenge 2: Lack of structured concurrency guarantees. Even frameworks that support async execution (e.g., via <code>asyncio.gather</code>) lack structured concurrency semantics. When one tool call fails, <code>asyncio.gather</code> with <code>return_exceptions=False</code> cancels all sibling tasks, potentially losing partial results. With <code>return_exceptions=True</code>, error propagation becomes the developer's responsibility. Neither approach is satisfactory for production agent systems. We formalize this as a partial failure isolation property (Definition 1) and prove that <code>asyncio.TaskGroup</code> with per-task exception capture satisfies it.</p> <p>Challenge 3: Fragmented session management. The dominant design pattern separates execution (Runner) from state (Session), as exemplified by the OpenAI Agents SDK where Agent is a declarative config, Runner drives execution, and Session stores conversation history. This three-way split introduces architectural friction: the developer must explicitly coordinate runner-session lifecycles, state is not inherently owned by the reasoning entity, and multi-turn context must be manually threaded through external session objects.</p> <p>Challenge 4: Context overflow in long-horizon tasks. Deep research tasks often require dozens of tool calls and accumulate context that exceeds the model's effective window. Hard truncation loses critical information; naive summarization may discard important details. The Deep Research survey (Xu &amp; Peng, 2025) identifies context management as one of three core engineering challenges alongside hallucination control and process explainability. Single-threshold mechanisms suffer from compression oscillation when context fluctuates near the threshold.</p> <p>Challenge 5: Insufficient safety mechanisms for tool-level operations. While agent-level guardrails (validating overall input/output) exist in frameworks like the OpenAI Agents SDK, individual tool calls \u2014 which interact directly with file systems, databases, and external APIs \u2014 lack fine-grained validation. A single malformed tool call can corrupt state or leak sensitive data.</p> <p>To address these challenges, we present Agentica, an async-first agent framework with the following contributions:</p> <ol> <li> <p>Structured concurrent tool execution with formal safety guarantees using Python 3.12's <code>asyncio.TaskGroup</code>. We formalize the agent execution loop as a state transition system (Section 3.2) and prove that our three-phase execution protocol satisfies the partial failure isolation property \u2014 a failed tool does not cancel sibling executions, and all results (successful or failed) are preserved in original order. To the best of our knowledge, Agentica is the first agent framework to employ structured concurrency for tool execution.</p> </li> <li> <p>Three-layer tool abstraction (Tool \u2192 Function \u2192 FunctionCall) that separates registration, schema definition, and invocation. Functions maintain memory-safe weak references (<code>weakref</code>) to their parent Agent, preventing circular reference memory leaks in the <code>Agent \u2192 Model \u2192 functions \u2192 Function._agent \u2192 Agent</code> reference chain. The <code>FunctionCall.execute()</code> method auto-detects sync/async entrypoints and routes sync functions through <code>run_in_executor()</code>, making the async boundary transparent to tool authors.</p> </li> <li> <p>Agent-as-Session unified state model that merges execution, reasoning, and session state into the Agent itself. Unlike the OpenAI Agents SDK's Runner/Session separation, Agentica's <code>AgentMemory</code> stores structured run history (<code>runs: List[AgentRun]</code>) directly within the agent, with token-aware history retrieval (<code>get_messages_from_last_n_runs()</code>) that provides automatic budget-constrained context assembly. This eliminates the session management boilerplate and enables the agent to be the single source of truth for its own conversational state (Section 3.4).</p> </li> <li> <p>DeepAgent with dual-threshold hysteresis context management. We introduce a two-threshold mechanism with formal convergence analysis (Section 3.5): a soft threshold ($\\theta_s$) triggers compression, a hard threshold ($\\theta_h$) forces answer generation, with the hysteresis gap ($\\theta_h - \\theta_s$) providing provable oscillation avoidance. Combined with HEARTBEAT-style iteration checkpoints, this enables reliable long-horizon task completion.</p> </li> <li> <p>Dual-level guardrail system providing both agent-level (<code>InputGuardrail</code>, <code>OutputGuardrail</code>) and tool-level (<code>ToolInputGuardrail</code>, <code>ToolOutputGuardrail</code>) validation with async-compatible decorator patterns \u2014 the first framework to provide fine-grained per-tool-call safety validation.</p> </li> <li> <p>File-based workspace memory using Markdown files (<code>AGENT.md</code>, <code>MEMORY.md</code>, <code>USER.md</code>, etc.) that are human-readable, auditable, git-versionable, and support multi-user isolation under <code>users/{user_id}/</code> directories.</p> </li> </ol> <p>We evaluate on three complementary benchmarks: - GAIA (Mialon et al., 2023): 165 general AI assistant tasks testing multi-step reasoning and tool use - SWE-bench Verified (Jimenez et al., 2024; OpenAI, 2024): 500 real-world software engineering tasks from GitHub - Terminal-Bench (Merrill et al., 2026): 89 hard, realistic tasks in Docker-based terminal environments spanning software engineering, ML/AI, cybersecurity, and system administration</p>"},{"location":"paper/#2-related-work","title":"2. Related Work","text":""},{"location":"paper/#21-agent-frameworks","title":"2.1 Agent Frameworks","text":"<p>MetaGPT (Hong et al., 2023) introduced the SOP-as-Prompt paradigm, encoding human standard operating procedures as structured prompt sequences for multi-agent collaboration. Its publish-subscribe communication mechanism and executable feedback loop represent significant advances. However, MetaGPT's execution model is fundamentally sequential at the orchestration level \u2014 agents execute in pipeline order following a waterfall paradigm. While individual roles use <code>async def run()</code>, this serves only for non-blocking LLM I/O; inter-agent coordination remains synchronous. MetaGPT was published as an ICLR 2024 Oral paper.</p> <p>AutoGen (Wu et al., 2023) proposed a multi-agent conversation framework based on conversable agents. AutoGen v0.4 (January 2025) introduced a complete redesign with an event-driven Actor model runtime supporting distributed deployment. While AutoGen v0.4 is async-first through its Actor-based message bus, it achieves concurrency through message passing rather than structured concurrency primitives, and tool execution within a single agent turn remains sequential.</p> <p>OpenAI Agents SDK (OpenAI, 2025) succeeded the experimental Swarm framework, providing a lightweight agent abstraction where Agents are declarative configuration objects and a stateless Runner class handles execution. The SDK supports handoff-based multi-agent coordination and tripwire-pattern guardrails. Its Python 3.9 minimum requirement precludes the use of <code>asyncio.TaskGroup</code> (introduced in Python 3.11), and the internal tool execution concurrency model is not publicly documented. Hosted tools (WebSearch, FileSearch, CodeInterpreter) create practical vendor lock-in to OpenAI's Responses API.</p> <p>LangGraph (LangChain, 2023) models agent workflows as stateful directed graphs with checkpoint-based persistence. While powerful for complex workflow orchestration, its <code>ToolNode</code> component executes tools sequentially, and the graph-based abstraction introduces overhead for simpler agent patterns.</p> <p>CrewAI (Moura, 2024) uses role-based agent design with sequential and hierarchical process strategies. It is synchronous-first with no native async architecture or parallel tool execution.</p> <p>Table 1 summarizes the architectural comparison.</p> <p>Table 1: Architectural Comparison of Agent Frameworks</p> Dimension Agentica MetaGPT AutoGen v0.4 OpenAI Agents SDK LangGraph CrewAI Execution Model Async-first (native) Async I/O, sync orchestration Async (Actor model) Async-primary Dual (sync + async) Sync-first Tool Concurrency <code>TaskGroup</code> (structured) Sequential Sequential (per turn) Undocumented Sequential (<code>ToolNode</code>) Sequential Tool Abstraction 3-layer hierarchy Action-level Function registration <code>@function_tool</code> flat <code>@tool</code> decorator <code>BaseTool</code> class Session Model Agent-as-Session (unified) Environment shared state ConversableAgent state Runner + Session (split) Checkpointer (external) Memory (external) Multi-Agent <code>as_tool()</code> delegation Pub-sub pipeline GroupChat + Actor Handoffs + agents-as-tools Graph sub-nodes Sequential/Hierarchical Guardrails Agent + Tool level None None Agent level only None None Memory AgentMemory + Workspace 3-tier (working/shared/LT) Message history Sessions (SQLite/Redis) Checkpoints + Store SQLite + Entity Python Version &gt;= 3.12 &gt;= 3.9 &gt;= 3.10 &gt;= 3.9 &gt;= 3.9 &gt;= 3.10 Academic Paper This work ICLR 2024 Oral arXiv 2023 None None None"},{"location":"paper/#22-deep-research-systems","title":"2.2 Deep Research Systems","text":"<p>Deep Research represents a new paradigm where AI agents automate end-to-end research workflows (Xu &amp; Peng, 2025; Wang et al., 2025). The comprehensive survey by Xu &amp; Peng (2025) analyzed 80+ implementations and proposed a four-dimensional taxonomy: foundation models, tool utilization, task planning, and knowledge synthesis. Wang et al. (2025) defined three evolutionary stages: Agentic Search, Integrated Research, and Full-stack AI Scientist.</p> <p>Commercial systems include OpenAI Deep Research (based on o3 with reinforcement learning), Google Gemini Deep Research (million-token context), Perplexity Deep Research, and Anthropic Claude Research. Open-source alternatives include OpenDeepResearcher, Auto-Deep-Research, and OpenManus.</p> <p>Agentica's DeepAgent module contributes to this landscape with its dual-threshold context management mechanism and HEARTBEAT-style iteration control \u2014 engineering innovations that address the context overflow and premature termination problems identified as core challenges in the field.</p>"},{"location":"paper/#23-benchmarks-for-agent-evaluation","title":"2.3 Benchmarks for Agent Evaluation","text":"<p>GAIA (Mialon et al., 2023) evaluates general AI assistants on 466 real-world tasks (165 public validation, 301 private test) requiring multi-step reasoning, multi-modal processing, and tool use. Human baseline is ~92%; top AI systems achieve &lt;30% on average, highlighting the immense difficulty gap.</p> <p>SWE-bench (Jimenez et al., 2024) evaluates software engineering agents on real GitHub issues from 12 Python repositories. SWE-bench Verified (OpenAI, 2024) is a 500-task human-verified subset. The JoyCode Agent currently leads at 74.6%, demonstrating that agent scaffolding outperforms bare model capability (Claude 3.7 Sonnet achieves 70.3% without scaffolding).</p> <p>Terminal-Bench (Merrill et al., 2026) is a curated benchmark of 89 hard, realistic tasks executed in Docker-based terminal environments. Tasks span software engineering (32.6%), computing (21.3%), ML/AI (11.2%), cybersecurity (9.0%), DevOps (4.5%), and other domains. Tasks range from hours to days of expert human effort. The current best system (GPT-5.3-Codex with Simple Codex agent) achieves 75.1%, while smaller models score as low as 3%. Evaluation uses outcome-based container state inspection with at least 5 trials per configuration (32,155 total trials) and 95% confidence intervals.</p>"},{"location":"paper/#3-architecture","title":"3. Architecture","text":""},{"location":"paper/#31-overview","title":"3.1 Overview","text":"<p>Agentica is built on three design principles:</p> <ol> <li> <p>Async-first: All core methods (<code>run()</code>, <code>response()</code>, <code>execute()</code>, <code>invoke()</code>) are natively <code>async</code>. Synchronous adapters (<code>run_sync()</code>, <code>run_stream_sync()</code>) wrap the async implementations via background thread + event loop patterns.</p> </li> <li> <p>Separation of concerns via mixins: The <code>Agent</code> class uses <code>@dataclass(init=False)</code> with direct multiple inheritance from pure method-container mixins:</p> </li> </ol> <pre><code>@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, SessionMixin,\n            TeamMixin, ToolsMixin, PrinterMixin, MediaMixin):\n</code></pre> <p>Each mixin provides a specific capability (execution, prompts, session management, multi-agent delegation, tool management, output formatting, media handling) without carrying state or <code>__init__</code>. This design enables IDE jump-to-definition and avoids the fragile base class problem.</p> <ol> <li>Pydantic for data, dataclass for behavior: Data structures (<code>Model</code>, <code>Tool</code>, <code>Function</code>, <code>RunResponse</code>) use Pydantic <code>BaseModel</code> for validation and serialization. The <code>Agent</code> class uses <code>@dataclass</code> deliberately \u2014 it has mutable fields (Callable, lists), complex initialization with alias handling, and does not need Pydantic's validation overhead.</li> </ol> <p>Figure 1 illustrates the overall architecture.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Agent Layer                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502RunnerMix \u2502 \u2502PromptMix \u2502 \u2502SessionMix\u2502 \u2502 TeamMixin \u2502  \u2502\n\u2502  \u2502 run()    \u2502 \u2502 sys_msg  \u2502 \u2502 load()   \u2502 \u2502 as_tool() \u2502  \u2502\n\u2502  \u2502 stream() \u2502 \u2502 usr_msg  \u2502 \u2502 save()   \u2502 \u2502 transfer()\u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       \u2502                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502              _run_impl() [async generator]       \u2502   \u2502\n\u2502  \u2502  Single execution engine with Langfuse tracing   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502       \u2502            Model Layer                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Model (async abstract: invoke, response,        \u2502   \u2502\n\u2502  \u2502         invoke_stream, response_stream)           \u2502   \u2502\n\u2502  \u2502                                                   \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502  \u2502 run_function_calls() [asyncio.TaskGroup]    \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  Phase 1: Emit started events               \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  Phase 2: Parallel execution (TaskGroup)    \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  Phase 3: Sequential result processing      \u2502  \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Tool Layer                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Tool   \u2502\u2500\u2500\u2500&gt;\u2502 Function \u2502\u2500\u2500\u2500&gt;\u2502   FunctionCall   \u2502   \u2502\n\u2502  \u2502(container)\u2502   \u2502(schema + \u2502    \u2502   (invocation)   \u2502   \u2502\n\u2502  \u2502          \u2502    \u2502 weakref) \u2502    \u2502   .execute()     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 auto sync/async  \u2502   \u2502\n\u2502                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  Memory Layer                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 AgentMemory \u2502         \u2502      Workspace            \u2502  \u2502\n\u2502  \u2502 (runtime,   \u2502         \u2502  AGENT.md | PERSONA.md    \u2502  \u2502\n\u2502  \u2502  token-     \u2502         \u2502  users/{id}/MEMORY.md     \u2502  \u2502\n\u2502  \u2502  aware)     \u2502         \u2502  users/{id}/USER.md       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Guardrail Layer                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Agent-Level      \u2502  \u2502     Tool-Level             \u2502   \u2502\n\u2502  \u2502  InputGuardrail   \u2502  \u2502  ToolInputGuardrail        \u2502   \u2502\n\u2502  \u2502  OutputGuardrail  \u2502  \u2502  ToolOutputGuardrail       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"paper/#32-formal-execution-model","title":"3.2 Formal Execution Model","text":"<p>We formalize the agent execution loop as a state transition system to enable rigorous reasoning about safety properties.</p> <p>Definition 1 (Agent State). An agent state is a tuple $S = (M, H, C, \\sigma)$ where: - $M = [m_1, ..., m_k]$ is the message history - $H \\subseteq \\mathcal{R}$ is the set of completed runs stored in <code>AgentMemory.runs</code> - $C \\in \\mathbb{N}$ is the estimated context token count - $\\sigma \\in {idle, running, terminated}$ is the execution status</p> <p>Definition 2 (Execution Step). A single execution step transforms state $S_i$ to $S_{i+1}$:</p> <p>$$S_i \\xrightarrow{\\text{LLM}} (r, T) \\xrightarrow{\\text{Execute}} S_{i+1}$$</p> <p>where $r$ is the model's text response and $T = {t_1, ..., t_n}$ is the set of tool calls. The execution proceeds in three phases:</p> <ul> <li>Phase 1: For each $t_j \\in T$, emit <code>started</code> event (sequential, preserving order)</li> <li>Phase 2: Execute all $t_j$ concurrently: $\\text{results} = \\text{TaskGroup}({t_1, ..., t_n})$</li> <li>Phase 3: Process results in original order (sequential)</li> </ul> <p>Theorem 1 (Partial Failure Isolation). Under the <code>asyncio.TaskGroup</code> execution model with per-task exception capture, if tool call $t_j$ raises exception $e_j$, then for all $t_k$ where $k \\neq j$: (a) $t_k$ is not cancelled, (b) $t_k$'s result (success or its own exception) is preserved, and (c) results are returned in the original order $[r_1, ..., r_n]$.</p> <p>Proof sketch. Each task $t_j$ is wrapped in <code>async def _execute_one(j, fc)</code> which catches <code>ToolCallException</code> and generic <code>Exception</code> locally, storing them in <code>results[j]</code>. The <code>TaskGroup</code> only propagates <code>BaseExceptionGroup</code> if an uncaught exception escapes a task. Since all exceptions are caught within <code>_execute_one</code>, the TaskGroup exits normally with all tasks completed. Phase 3 iterates <code>results</code> in index order $0, 1, ..., n-1$, preserving the original sequence. $\\square$</p> <p>This is strictly stronger than <code>asyncio.gather(return_exceptions=True)</code>, which provides (b) and (c) but not the structured lifetime guarantee that all tasks complete within a well-defined scope.</p> <p>Definition 3 (Termination Condition). The agent terminates when any of: (a) the model produces no tool calls (natural completion), (b) context $C &gt; \\theta_h$ (hard threshold), (c) step count exceeds <code>max_rounds</code>, or (d) a <code>StopAgentRun</code> flow control exception is raised.</p>"},{"location":"paper/#33-structured-concurrent-tool-execution","title":"3.3 Structured Concurrent Tool Execution","text":"<p>When the LLM returns $N$ tool calls in a single response, Agentica executes them in three phases:</p> <p>Phase 1 (Sequential): Emit events. For each tool call $t_i$, emit a <code>tool_call_started</code> event preserving the original order. This ensures deterministic event ordering for streaming consumers.</p> <p>Phase 2 (Parallel): Execute. All $N$ tool calls execute concurrently within an <code>asyncio.TaskGroup</code>:</p> <pre><code>async with asyncio.TaskGroup() as tg:\n    tasks = [tg.create_task(_execute_one(i, fc))\n             for i, fc in enumerate(function_calls)]\n</code></pre> <p>Each task wraps its execution in a try/except that captures <code>ToolCallException</code> and generic exceptions locally, preventing one failure from cancelling sibling tasks. This is the key advantage over <code>asyncio.gather(return_exceptions=True)</code> \u2014 structured concurrency guarantees that all tasks complete (successfully or with captured exceptions) before the TaskGroup exits.</p> <p>For sync tool entrypoints, <code>FunctionCall._call_func()</code> auto-detects via <code>inspect.iscoroutinefunction()</code> and routes through <code>loop.run_in_executor()</code>:</p> <pre><code>async def _call_func(self, func, **kwargs):\n    if inspect.iscoroutinefunction(func):\n        return await func(**kwargs)\n    loop = asyncio.get_running_loop()\n    return await loop.run_in_executor(\n        None, functools.partial(func, **kwargs))\n</code></pre> <p>Phase 3 (Sequential): Process results. Results are processed in the original order, constructing tool response messages, handling flow control exceptions (<code>StopAgentRun</code>, <code>RetryAgentRun</code>), and emitting <code>tool_call_completed</code> events.</p> <p>This three-phase design achieves maximum parallelism in Phase 2 while maintaining deterministic ordering in Phases 1 and 3.</p>"},{"location":"paper/#34-three-layer-tool-abstraction","title":"3.4 Three-Layer Tool Abstraction","text":"<p>The tool system uses a three-layer hierarchy that separates concerns:</p> <p>Tool is a container that groups related functions (e.g., <code>BuiltinFileTool</code> contains <code>ls</code>, <code>read_file</code>, <code>write_file</code>, <code>edit_file</code>, <code>glob</code>, <code>grep</code>). Tools register functions via <code>self.register(self.method_name)</code>.</p> <p>Function holds the schema (name, description, JSON Schema parameters) and entrypoint callable. <code>Function.from_callable()</code> is a factory that auto-generates tool definitions from Python functions using <code>inspect.signature()</code> and <code>get_type_hints()</code>. A key design choice: Functions hold a weak reference (<code>weakref.ref</code>) to their parent Agent, breaking the circular reference chain <code>Agent \u2192 Model \u2192 functions \u2192 Function._agent \u2192 Agent</code> that would otherwise prevent garbage collection.</p> <p><code>_safe_validate_call()</code> wraps Pydantic's <code>validate_call</code> to strip unresolvable forward-reference annotations (e.g., <code>self: \"Agent\"</code> on mixin methods), enabling Pydantic validation on methods that use PEP 563 postponed annotations.</p> <p>FunctionCall represents a single invocation with arguments, result, error, and call ID. Its <code>execute()</code> method is the sole execution entry point \u2014 async-only, with pre/post hook support and the sync/async auto-detection described in Section 3.2.</p>"},{"location":"paper/#35-agent-as-session-unified-state-model","title":"3.5 Agent-as-Session: Unified State Model","text":"<p>A fundamental design divergence exists between Agentica and other frameworks in how session state is managed. We identify three patterns in existing frameworks:</p> <p>Pattern A: Stateless Runner + External Session (OpenAI Agents SDK). The Agent is a declarative configuration object (model, tools, instructions); a stateless <code>Runner</code> class drives execution; a separate <code>Session</code> object (backed by SQLite or Redis) stores conversation history. The developer must explicitly pass session references through the execution pipeline:</p> <pre><code># OpenAI Agents SDK pattern\nagent = Agent(name=\"assistant\", model=\"gpt-4o\", tools=[...])\nresult = await Runner.run(agent, \"query\", session=session)\n# Agent has no memory of previous interactions without session\n</code></pre> <p>Pattern B: Environment-Mediated State (MetaGPT, AutoGen). Agents communicate through a shared environment or message bus. State is distributed across the environment, individual agent memories, and communication channels.</p> <p>Pattern C: Agent-as-Session (Agentica). The Agent itself is the session carrier. <code>AgentMemory</code> is embedded directly within the agent and maintains structured run history:</p> <pre><code>class AgentMemory(BaseModel):\n    runs: List[AgentRun] = []      # Structured run history\n    messages: List[Message] = []    # Current context window\n    summary: Optional[SessionSummary] = None  # Compacted history\n</code></pre> <p>The key mechanism is <code>get_messages_from_last_n_runs()</code>, which provides token-budget-aware history assembly:</p> <ol> <li>Iterate runs from most recent to oldest</li> <li>For each run, extract conversation messages (filtering tool calls)</li> <li>Apply progressive truncation: older runs get more aggressive content truncation</li> <li>Stop when the token budget is exhausted</li> </ol> <p>This design has several advantages over Pattern A:</p> <ul> <li>Single source of truth: The agent owns its own state. No coordination between runner, session, and agent objects is needed.</li> <li>Token-aware context assembly: History messages are automatically budget-constrained, preventing context overflow during multi-turn interactions.</li> <li>Progressive information decay: Older runs are truncated more aggressively (tool results summarized to <code>tool_result_max_chars</code>), mimicking human memory where recent events are recalled with more detail.</li> <li>Zero-configuration multi-turn: Multi-turn conversations work by default without explicit session management code.</li> </ul> <p>Session persistence is handled orthogonally by <code>SessionMixin</code>, which serializes the agent state (including <code>AgentMemory</code>) to storage backends via <code>write_to_storage()</code>. This separates the concerns of state ownership (Agent) from state persistence (SessionMixin + storage backend).</p> <p>Table 2: Session Management Pattern Comparison</p> Property Stateless Runner (OpenAI) Agent-as-Session (Ours) State ownership External Session object Agent itself Multi-turn setup Explicit session passing Automatic (built-in) Token budget Manual management Automatic (<code>max_tokens</code> param) History truncation Application-level Framework-level (progressive) Persistence Session backend required Optional (SessionMixin) Serialization Session.to_dict() AgentMemory.to_dict() \u2192 SessionRow"},{"location":"paper/#36-deepagent-deep-research-extension","title":"3.6 DeepAgent: Deep Research Extension","text":"<p><code>DeepAgent</code> extends <code>Agent</code> with capabilities specifically designed for long-horizon research and complex task completion:</p> <p>Built-in Tool Suite. DeepAgent automatically includes file system tools (<code>ls</code>, <code>read_file</code>, <code>write_file</code>, <code>edit_file</code>, <code>glob</code>, <code>grep</code>), code execution (<code>execute</code> with async subprocess and graceful SIGTERM\u2192SIGKILL termination), web tools (<code>web_search</code>, <code>fetch_url</code>), task management (<code>write_todos</code>, <code>read_todos</code>), sub-agent delegation (<code>task</code>), and skill management (<code>list_skills</code>, <code>get_skill_info</code>).</p> <p>Dual-Threshold Hysteresis Context Management. We introduce a two-threshold mechanism for handling context window overflow with provable oscillation avoidance:</p> <ul> <li>Soft threshold ($\\theta_s$): When estimated context tokens exceed $\\theta_s$, the system triggers context compression (summarizing older tool results). Default: $\\theta_s = 0.6 \\times (C_w - C_{out})$, where $C_w$ is the model's context window and $C_{out}$ is the maximum output tokens.</li> <li>Hard threshold ($\\theta_h$): When tokens exceed $\\theta_h$, the system forces answer generation via a specialized prompt. Default: $\\theta_h = 0.8 \\times (C_w - C_{out})$.</li> </ul> <p>Theorem 2 (Oscillation Avoidance). Let $C_i$ denote the context token count at step $i$, and let $\\Delta_c &gt; 0$ be the average tokens freed by a compression operation. If $\\theta_h - \\theta_s &gt; \\Delta_c$, then the system does not oscillate between compression and normal execution. Specifically, after compression at step $i$ reduces $C_i$ to $C_i' \\leq \\theta_s$, the system will not trigger compression again until at least $\\lceil(\\theta_s - C_i' + 1) / \\delta\\rceil$ new steps, where $\\delta$ is the average token increment per step.</p> <p>Proof sketch. After compression, $C_i' \\leq \\theta_s$. Each subsequent step adds $\\delta$ tokens on average. Compression is only re-triggered when $C_j \\geq \\theta_s$, requiring at least $(\\theta_s - C_i') / \\delta$ steps. Meanwhile, forced termination only occurs at $\\theta_h$, and since $\\theta_h - \\theta_s &gt; \\Delta_c$, compression at $\\theta_s$ always completes before the hard limit is reached. $\\square$</p> <p>This contrasts with single-threshold systems where $\\theta_s = \\theta_h$: compression frees $\\Delta_c$ tokens, the next tool call adds $\\delta$ tokens, and if $\\delta &gt; \\Delta_c$, the system immediately re-triggers compression \u2014 an oscillation pattern observed in practice.</p> <p>HEARTBEAT-Style Iteration Control. Inspired by the MemGPT heartbeat mechanism, DeepAgent injects iteration checkpoint prompts at configurable intervals during multi-round execution:</p> <pre><code>Step {N} checkpoint:\n- Have you fully solved the problem?\n- Are there any remaining tasks in the task list?\n- Did you verify your changes?\nIf not complete, continue working. Do NOT end your turn prematurely.\n</code></pre> <p>This addresses the common failure mode where models prematurely declare task completion.</p> <p>Repetitive Behavior Detection. A sliding window (<code>deque(maxlen=10)</code>) tracks recent tool calls. When $k$ consecutive calls invoke the same tool (default $k=3$), a warning prompt redirects the agent's strategy, preventing unproductive loops.</p> <p>Deep Research Prompt System. A structured 6-phase prompt methodology guides thorough investigation: (1) Problem analysis and plan formulation, (2) Iterative information gathering with explicit failure handling, (3) Multi-source cross-validation, (4) Constraint checklist verification, (5) Calculation and operation verification via code execution, (6) Clear narration with citation requirements.</p>"},{"location":"paper/#37-dual-level-guardrail-system","title":"3.7 Dual-Level Guardrail System","text":"<p>Agentica provides guardrails at two granularities:</p> <p>Agent-level guardrails (<code>InputGuardrail</code>, <code>OutputGuardrail</code>) validate the entire agent run's input or output. These use a decorator pattern:</p> <pre><code>@input_guardrail\nasync def check_sensitive_content(context, agent, input_message):\n    # Validation logic\n    return GuardrailFunctionOutput(output_info={\"safe\": True})\n</code></pre> <p>Tool-level guardrails (<code>ToolInputGuardrail</code>, <code>ToolOutputGuardrail</code>) validate individual tool call arguments and results. This is critical because a single tool call may access file systems, execute code, or call external APIs:</p> <pre><code>@tool_input_guardrail\nasync def validate_file_path(context, agent, tool_input):\n    # Ensure file path is within allowed directory\n    return ToolGuardrailFunctionOutput(output_info={\"valid\": True})\n</code></pre> <p>Both levels raise specific exceptions (<code>InputGuardrailTripwireTriggered</code>, <code>ToolInputGuardrailTripwireTriggered</code>, etc.) to halt execution when violations are detected.</p>"},{"location":"paper/#38-file-based-workspace-memory","title":"3.8 File-Based Workspace Memory","text":"<p>Agentica's persistent memory uses a file-based workspace with the following directory structure:</p> <pre><code>workspace/\n\u251c\u2500\u2500 AGENT.md          # Agent instructions (global)\n\u251c\u2500\u2500 PERSONA.md        # Agent persona (global)\n\u251c\u2500\u2500 TOOLS.md          # Tool documentation (global)\n\u251c\u2500\u2500 users/\n\u2502   \u251c\u2500\u2500 default/\n\u2502   \u2502   \u251c\u2500\u2500 USER.md       # User information\n\u2502   \u2502   \u251c\u2500\u2500 MEMORY.md     # Long-term memory\n\u2502   \u2502   \u2514\u2500\u2500 memory/       # Daily memory entries\n\u2502   \u2514\u2500\u2500 {user_id}/        # Multi-user isolation\n</code></pre> <p>This design provides several advantages over database-backed memory: - Auditability: Markdown files are human-readable and inspectable - Version control: Standard git operations track memory evolution - Portability: No database dependencies; works with any file system - Multi-user isolation: Each user's data is physically separated</p> <p>All memory operations (<code>get_context_prompt()</code>, <code>get_memory_prompt()</code>, <code>write_memory()</code>, <code>save_memory()</code>) are async, with file I/O wrapped in <code>run_in_executor()</code> to avoid blocking the event loop.</p>"},{"location":"paper/#39-model-provider-abstraction","title":"3.9 Model Provider Abstraction","text":"<p>The <code>Model</code> base class defines four abstract async methods: <code>invoke()</code>, <code>invoke_stream()</code>, <code>response()</code>, <code>response_stream()</code>. Provider implementations use the <code>@override</code> decorator (Python 3.12) for explicit intent:</p> <ul> <li><code>OpenAIChat</code>: Native async OpenAI client</li> <li><code>Claude</code>: <code>AsyncAnthropic</code> client with native async <code>messages.create()</code> and <code>messages.stream()</code></li> <li><code>OpenAILike</code>: Extends <code>OpenAIChat</code> for compatible APIs (DeepSeek, Qwen, ZhipuAI, Doubao, Moonshot, etc.)</li> </ul> <p>This unified async interface ensures that all model providers behave identically from the framework's perspective, with the async boundary handled transparently.</p>"},{"location":"paper/#4-experimental-setup","title":"4. Experimental Setup","text":""},{"location":"paper/#41-benchmarks","title":"4.1 Benchmarks","text":"<p>We evaluate on three complementary benchmarks to assess different aspects of agent capability:</p> <p>GAIA (General AI Assistants). We use the 165-question public validation set. Tasks require multi-step reasoning, web search, file parsing, code execution, and multi-modal understanding. Evaluation uses exact-match scoring on deterministic answers.</p> <p>SWE-bench Verified. We use the 500-task human-verified subset. Each task requires producing a code patch that resolves a real GitHub issue and passes the repository's test suite. Evaluation uses resolved rate (percentage of tasks where the patch passes all associated tests).</p> <p>Terminal-Bench 2.0. We use the 89-task benchmark executed in Docker-based terminal environments. Tasks span software engineering, computing, ML/AI, cybersecurity, and system administration. Each configuration is run 5 times, reporting resolution rate with 95% confidence intervals.</p>"},{"location":"paper/#42-baselines","title":"4.2 Baselines","text":"<p>We compare against the following agent systems:</p> System Framework Type Key Characteristics OpenAI Agents SDK + GPT-4o Commercial framework Handoff-based coordination, hosted tools MetaGPT SOP-driven pipeline ICLR 2024 Oral, structured communication AutoGen v0.4 Actor-based async Multi-agent conversation, distributed runtime OpenHands CodeAct framework Unified code action space, Docker sandbox Terminus 2 Neutral scaffold Headless terminal tool, used in Terminal-Bench <p>For fair comparison, all configurations use the same underlying LLM where possible.</p>"},{"location":"paper/#43-configurations","title":"4.3 Configurations","text":"<p>We evaluate two Agentica configurations:</p> <ol> <li>Agentica-Base: Standard <code>Agent</code> with user-provided tools. Tests the core async-first execution engine and structured concurrency.</li> <li>Agentica-Deep: <code>DeepAgent</code> with built-in tools, deep research prompt, dual-threshold context management, and HEARTBEAT iteration control. Tests the full deep research pipeline.</li> </ol>"},{"location":"paper/#44-ablation-studies","title":"4.4 Ablation Studies","text":"<p>To isolate the contribution of each architectural component:</p> Ablation What is removed/changed <code>-TaskGroup</code> Replace <code>asyncio.TaskGroup</code> with sequential tool execution <code>-DualThreshold</code> Remove context management (no soft/hard limits) <code>-HEARTBEAT</code> Remove iteration checkpoint prompts <code>-DeepPrompt</code> Replace deep research prompt with standard prompt <code>-ToolGuardrails</code> Remove tool-level guardrails (keep agent-level only) <code>-AgentAsSession</code> Replace with external session management (OpenAI SDK pattern)"},{"location":"paper/#45-parameter-sensitivity-analysis","title":"4.5 Parameter Sensitivity Analysis","text":"<p>We analyze sensitivity to the dual-threshold parameters with the following grid:</p> Parameter Values Tested Soft threshold $\\theta_s$ 0.4, 0.5, 0.6, 0.7 (\u00d7 effective context) Hard threshold $\\theta_h$ 0.7, 0.8, 0.9 (\u00d7 effective context) HEARTBEAT frequency 3, 5, 7, 10 (steps) Repetition window $k$ 2, 3, 5 (consecutive calls) <p>Constraint: $\\theta_s &lt; \\theta_h$ in all configurations.</p>"},{"location":"paper/#46-statistical-significance","title":"4.6 Statistical Significance","text":"<p>All results are reported with 95% confidence intervals. For GAIA and SWE-bench, we use 3 independent runs with different random seeds and report Wilson score intervals for pass rates. For Terminal-Bench, we follow the benchmark protocol of 5 runs per configuration with bootstrap confidence intervals.</p>"},{"location":"paper/#5-results","title":"5. Results","text":""},{"location":"paper/#51-main-results","title":"5.1 Main Results","text":"<p>Table 3: GAIA Benchmark Results (165 validation tasks)</p> System Level 1 Level 2 Level 3 Average Agentica-Deep <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Agentica-Base <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> OpenAI Agents SDK + GPT-4o <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> MetaGPT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> AutoGen v0.4 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Human baseline ~95% ~92% ~88% ~92% <p>Table 4: SWE-bench Verified Results (500 tasks)</p> System Resolved Rate Agentica-Deep <code>[TODO]</code> Agentica-Base <code>[TODO]</code> OpenHands <code>[TODO]</code> AutoGen v0.4 <code>[TODO]</code> Bare model (no framework) <code>[TODO]</code> <p>Table 5: Terminal-Bench 2.0 Results (89 tasks, 5 runs each)</p> System Resolution Rate (\u00b195% CI) Agentica-Deep <code>[TODO]</code> \u00b1 <code>[TODO]</code> Agentica-Base <code>[TODO]</code> \u00b1 <code>[TODO]</code> Terminus 2 (same model) <code>[TODO]</code> \u00b1 <code>[TODO]</code> OpenHands (same model) <code>[TODO]</code> \u00b1 <code>[TODO]</code> Claude Code (same model) <code>[TODO]</code> \u00b1 <code>[TODO]</code>"},{"location":"paper/#52-structured-concurrency-speedup","title":"5.2 Structured Concurrency Speedup","text":"<p>Table 6: Wall-clock time comparison \u2014 TaskGroup parallel vs. sequential tool execution</p> Benchmark Avg tools/turn Sequential (s) Parallel (s) Speedup GAIA <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7 SWE-bench <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7 Terminal-Bench <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7"},{"location":"paper/#53-ablation-study","title":"5.3 Ablation Study","text":"<p>Table 7: Ablation results on GAIA (Level 2+3) and Terminal-Bench</p> Configuration GAIA (L2+L3) Terminal-Bench Agentica-Deep (full) <code>[TODO]</code> <code>[TODO]</code> \u2212 TaskGroup <code>[TODO]</code> <code>[TODO]</code> \u2212 DualThreshold <code>[TODO]</code> <code>[TODO]</code> \u2212 HEARTBEAT <code>[TODO]</code> <code>[TODO]</code> \u2212 DeepPrompt <code>[TODO]</code> <code>[TODO]</code> \u2212 ToolGuardrails <code>[TODO]</code> <code>[TODO]</code> \u2212 AgentAsSession <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper/#54-parameter-sensitivity-analysis","title":"5.4 Parameter Sensitivity Analysis","text":"<p>Table 8: Dual-threshold parameter sensitivity on GAIA Level 2+3 (long-horizon tasks)</p> $\\theta_s$ $\\theta_h$ Completion Rate Forced Termination Rate Compression Count 0.4 0.7 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.4 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.5 0.7 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.5 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.6 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.6 0.9 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.7 0.9 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <p>Table 9: HEARTBEAT frequency sensitivity on Terminal-Bench</p> Checkpoint Frequency Resolution Rate Premature Termination Rate Avg Steps Every 3 steps <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Every 5 steps (default) <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Every 7 steps <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Every 10 steps <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> No HEARTBEAT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper/#55-context-management-effectiveness","title":"5.5 Context Management Effectiveness","text":"<p>Table 10: Long-horizon task completion with and without dual-threshold context management</p> Context Management Tasks completed (&gt;10 tool calls) Avg. context tokens at completion Forced termination rate None <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Hard threshold only <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Dual threshold (ours) <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper/#56-efficiency-analysis","title":"5.6 Efficiency Analysis","text":"<p>Table 11: Token consumption and API cost comparison</p> System Avg tokens/task Avg API calls/task Avg cost/task ($) Agentica-Deep <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Agentica-Base <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> OpenAI Agents SDK <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> MetaGPT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper/#6-analysis","title":"6. Analysis","text":""},{"location":"paper/#61-when-does-structured-concurrency-help","title":"6.1 When Does Structured Concurrency Help?","text":"<p><code>[TODO: Analysis of which task types benefit most from parallel tool execution \u2014 likely I/O-bound tasks with multiple independent tool calls (e.g., simultaneous web searches, parallel file reads). Include speedup as a function of average tools-per-turn. Show that speedup approaches N\u00d7 for N independent I/O-bound tools and is bounded by Amdahl's law for mixed CPU/IO workloads. Include wall-clock time distributions.]</code></p>"},{"location":"paper/#62-agent-as-session-vs-external-session-management","title":"6.2 Agent-as-Session vs. External Session Management","text":"<p><code>[TODO: Quantitative comparison of the Agent-as-Session pattern vs. the external session pattern (OpenAI SDK style). Metrics: (a) lines of code required for multi-turn setup, (b) memory efficiency (token usage for history assembly), (c) context assembly latency, (d) success rate on multi-turn tasks from GAIA that require information from previous turns. Hypothesis: Agent-as-Session should show lower boilerplate and comparable or better multi-turn accuracy due to automatic token-aware history management.]</code></p>"},{"location":"paper/#63-dual-threshold-vs-single-threshold-context-management","title":"6.3 Dual-Threshold vs. Single-Threshold Context Management","text":"<p><code>[TODO: Analysis of the hysteresis mechanism \u2014 show that single-threshold systems oscillate between compression and normal execution, while dual-threshold provides stable behavior. Include context token trajectory plots for representative long-horizon tasks. Verify Theorem 2 empirically by measuring compression trigger counts under single-threshold ($\\theta_s = \\theta_h$) vs. dual-threshold configurations.]</code></p>"},{"location":"paper/#64-impact-of-deep-research-prompt","title":"6.4 Impact of Deep Research Prompt","text":"<p><code>[TODO: Qualitative analysis of how the 6-phase deep research prompt affects agent behavior \u2014 does it increase cross-validation attempts? Does it reduce hallucination in cited sources? Compare citation accuracy between standard and deep research prompts. Include examples of behavior differences on specific GAIA tasks.]</code></p>"},{"location":"paper/#65-error-analysis","title":"6.5 Error Analysis","text":"<p><code>[TODO: Categorize failure modes across benchmarks with quantitative breakdown: - Tool execution failures (timeout, permission, network): X% of failures - Context overflow (task abandoned due to token limits): X% - Repetitive behavior (agent stuck in loop): X% - Reasoning errors (wrong approach despite sufficient information): X% - Premature termination (agent declares done before completing task): X% Include per-benchmark breakdown and analysis of which Agentica features address which failure modes.]</code></p>"},{"location":"paper/#66-case-studies","title":"6.6 Case Studies","text":"<p><code>[TODO: Include 2-3 detailed case studies showing step-by-step execution traces: 1. A GAIA Level 3 task showing structured concurrency benefit (multiple parallel web searches) 2. A Terminal-Bench task showing dual-threshold context management in action (compression triggered, then successful completion) 3. A SWE-bench task showing how HEARTBEAT iteration control prevented premature termination For each case, show the execution timeline, tool calls, context token trajectory, and final outcome compared to baseline systems.]</code></p>"},{"location":"paper/#67-limitations","title":"6.7 Limitations","text":"<p>We acknowledge several limitations:</p> <ol> <li> <p>Python version requirement: Agentica requires Python 3.12+, which limits adoption in environments with older Python versions. The structured concurrency benefits require <code>asyncio.TaskGroup</code> (Python 3.11+), and the <code>@override</code> decorator requires Python 3.12.</p> </li> <li> <p>Benchmark coverage: Our evaluation focuses on three benchmarks. Additional evaluation on domain-specific benchmarks (e.g., xbench-DeepSearch for research quality, WebArena for web navigation) would provide a more comprehensive picture.</p> </li> <li> <p>Model dependence: Like all agent frameworks, performance is fundamentally bounded by the underlying LLM's capabilities. Our architectural contributions improve efficiency and reliability but cannot compensate for fundamental reasoning limitations.</p> </li> <li> <p>No formal SOP support: Unlike MetaGPT's SOP-as-Prompt paradigm, Agentica does not encode domain-specific standard operating procedures. For highly structured workflows (e.g., software development lifecycle), MetaGPT's approach may be more appropriate.</p> </li> </ol>"},{"location":"paper/#7-conclusion","title":"7. Conclusion","text":"<p>We presented Agentica, an async-first agent framework that introduces several architectural innovations: (1) structured concurrent tool execution via <code>asyncio.TaskGroup</code> with formally proven partial failure isolation guarantees; (2) a three-layer tool abstraction with memory-safe weak references; (3) the Agent-as-Session unified state model that embeds token-aware session management directly within the agent, eliminating the architectural fragmentation of separate Runner/Session abstractions; (4) dual-threshold hysteresis context management with provable oscillation avoidance for long-horizon tasks; (5) dual-level guardrails for both agent and tool operations; and (6) file-based workspace memory with multi-user isolation.</p> <p>Our evaluation across three challenging benchmarks \u2014 GAIA, SWE-bench Verified, and Terminal-Bench \u2014 demonstrates that framework-level architectural decisions significantly impact agent performance. <code>[TODO: Summarize key quantitative findings.]</code> The structured concurrency mechanism provides <code>[TODO]</code> speedup on multi-tool tasks, the dual-threshold context management improves long-horizon task completion by <code>[TODO]</code>, and the Agent-as-Session pattern reduces multi-turn management complexity while maintaining competitive accuracy.</p> <p>These results support the broader observation that agent scaffolding design matters as much as model capability \u2014 a finding consistent with recent SWE-bench results where framework-augmented agents outperform bare models by 10-20% (JoyCode Agent at 74.6% vs. Claude 3.7 Sonnet at 70.3%). Furthermore, the formal analysis (Theorems 1-2) provides theoretical grounding for design choices that are often made heuristically in the agent framework community.</p> <p>Future work includes: (1) extending the structured concurrency model to multi-agent parallel execution with dependency-aware scheduling, (2) adaptive threshold tuning based on task complexity estimation (replacing static $\\theta_s, \\theta_h$ with learned thresholds), (3) integration of retrieval-augmented generation into the workspace memory system, (4) speculative parallel hypothesis evaluation via lightweight agent cloning, and (5) evaluation on additional domain-specific benchmarks (WebArena, xbench-DeepSearch).</p>"},{"location":"paper/#references","title":"References","text":"<p>Hong, S., Zhuge, M., Chen, J., Zheng, X., Cheng, Y., Zhang, C., Wang, J., Wang, Z., Yau, S.K.S., Lin, Z., Zhou, L., Ran, C., Xiao, L., Wu, C., &amp; Schmidhuber, J. (2023). MetaGPT: Meta Programming for A Multi-Agent Collaborative Framework. ICLR 2024 (Oral). arXiv:2308.00352.</p> <p>Jimenez, C.E., Yang, J., Wettig, A., Yao, S., Pei, K., Press, O., &amp; Narasimhan, K. (2024). SWE-bench: Can Language Models Resolve Real-World GitHub Issues? ICLR 2024. arXiv:2310.06770.</p> <p>Merrill, M.A., Shaw, A.G., Carlini, N., Li, B., Raj, H., Bercovich, I., Shi, L., Shin, J.Y., Walshe, T., Buchanan, E.K., et al. (2026). Terminal-Bench: Benchmarking Agents on Hard, Realistic Tasks in Command Line Interfaces. arXiv:2601.11868.</p> <p>Mialon, G., Fourrier, C., Swift, C., Wolf, T., LeCun, Y., &amp; Scialom, T. (2023). GAIA: A Benchmark for General AI Assistants. arXiv:2311.12983.</p> <p>OpenAI. (2025). New Tools for Building Agents. https://openai.com/index/new-tools-for-building-agents/.</p> <p>Packer, C., Wooders, S., Lin, K., Fang, V., Patil, S.G., Stoica, I., &amp; Gonzalez, J.E. (2023). MemGPT: Towards LLMs as Operating Systems. arXiv:2310.08560.</p> <p>Smith, N., Garrett, A., &amp; Calvert, B. (2022). PEP 654 \u2014 Exception Groups and except*. Python Enhancement Proposals.</p> <p>Wang, R., et al. (2025). Deep Research: A Survey. arXiv:2512.02038.</p> <p>Wu, Q., Bansal, G., Zhang, J., Wu, Y., Li, B., Zhu, E., Jiang, L., Zhang, X., Zhang, S., Liu, J., Awadallah, A.H., White, R.W., Burger, D., &amp; Wang, C. (2023). AutoGen: Enabling Next-Gen LLM Applications via Multi-Agent Conversation. arXiv:2308.08155.</p> <p>Xu, R., &amp; Peng, J. (2025). A Comprehensive Survey of Deep Research: Systems, Methodologies, and Applications. arXiv:2506.12594.</p> <p>Yang, J., Jimenez, C.E., Wettig, A., Liber, K., Yao, S., Pei, K., Press, O., &amp; Narasimhan, K. (2024). SWE-agent: Agent-Computer Interfaces Enable Automated Software Engineering. arXiv:2405.15793.</p> <p>Yao, S., Zhao, J., Yu, D., Du, N., Shafran, I., Narasimhan, K., &amp; Cao, Y. (2023). ReAct: Synergizing Reasoning and Acting in Language Models. ICLR 2023. arXiv:2210.03629.</p>"},{"location":"paper/#appendix-a-deepagent-deep-research-prompt","title":"Appendix A: DeepAgent Deep Research Prompt","text":"<p>The complete deep research system prompt is available in the supplementary material. Key phases:</p> <ol> <li>Initiate Investigation: Analyze the problem, identify key information points, formulate investigation plan using task management tools.</li> <li>Iterative Information Gathering &amp; Reflection: Handle search failures explicitly, evaluate information sufficiency, pursue depth, consider source reliability.</li> <li>Multi-Source Cross-Validation: Use different tools/sources to verify key claims; explicitly state when switching tools due to effectiveness.</li> <li>Constraint Checklist: Review all constraints and confirm coverage before synthesizing.</li> <li>Calculation &amp; Operation Verification: Verify all computations via code execution before finalizing.</li> <li>Clear Narration: Explain tool call rationale, expected results, actual results, and next steps.</li> </ol>"},{"location":"paper/#appendix-b-terminal-bench-task-distribution","title":"Appendix B: Terminal-Bench Task Distribution","text":"<p>Terminal-Bench 2.0 contains 89 tasks across the following categories:</p> Category % Example Tasks Software Engineering 32.6% build-linux-kernel-qemu, fix-ocaml-gc, build-pov-ray Computing 21.3% regex-chess, chess-best-move, gpt2-codegolf ML/AI/Data Science 11.2% train-fasttext, caffe-cifar-10, mcmc-sampling-stan General SE 11.2% financial-document-processor, reshard-c4-data Cybersecurity 9.0% crack-7z-hash, feal-differential-cryptanalysis, fix-code-vulnerability DevOps/Cloud 4.5% configure-git-webserver, nginx-request-logging Personal Assistant 3.4% Various personal productivity tasks Video Processing 2.2% Video manipulation and conversion tasks <p>Current leaderboard (top 5, as of Feb 2026):</p> Rank Agent Model Accuracy 1 Simple Codex GPT-5.3-Codex 75.1% 2 CodeBrain-1 GPT-5.3-Codex 70.3% 3 Droid Claude Opus 4.6 69.9% 4 Mux GPT-5.3-Codex 68.5% 5 Deep Agents GPT-5.2-Codex 66.5%"},{"location":"paper/#appendix-c-reproducibility","title":"Appendix C: Reproducibility","text":"<p>All code is available at <code>[TODO: GitHub URL]</code>. Experiments use: - Python 3.12+ - Docker for Terminal-Bench and SWE-bench environments - GAIA validation set from HuggingFace - Configuration files for all benchmark runs included in repository</p> <p>To reproduce Terminal-Bench results: <pre><code>pip install terminal-bench\ntb run --agent agentica --model [MODEL] \\\n    --dataset-name terminal-bench-core \\\n    --dataset-version 2.0 --n-concurrent 8\n</code></pre></p>"},{"location":"paper_zh/","title":"Agentica: \u57fa\u4e8e\u7ed3\u6784\u5316\u5e76\u53d1\u7684\u5f02\u6b65\u4f18\u5148\u667a\u80fd\u4f53\u6846\u67b6\u2014\u2014\u9762\u5411\u81ea\u4e3b\u7814\u7a76\u4e0e\u8f6f\u4ef6\u5de5\u7a0b","text":"<p>\u76ee\u6807\u4f1a\u8bae: AAAI 2027</p> <p>\u72b6\u6001: \u8349\u7a3f \u2014 \u5b9e\u9a8c\u7ed3\u679c\u90e8\u5206\u4ee5 <code>[TODO]</code> \u6807\u8bb0\u5f85\u586b\u5145</p>"},{"location":"paper_zh/#_1","title":"\u6458\u8981","text":"<p>\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u667a\u80fd\u4f53\u5728\u81ea\u4e3b\u7814\u7a76\u548c\u8f6f\u4ef6\u5de5\u7a0b\u4efb\u52a1\u4e2d\u5c55\u73b0\u51fa\u5de8\u5927\u6f5c\u529b\u3002\u7136\u800c\uff0c\u73b0\u6709\u667a\u80fd\u4f53\u6846\u67b6\u5b58\u5728\u6839\u672c\u6027\u7684\u67b6\u6784\u5c40\u9650\uff1a\u540c\u6b65\u6267\u884c\u74f6\u9888\u5bfc\u81f4\u72ec\u7acb\u5de5\u5177\u8c03\u7528\u88ab\u4e32\u884c\u5316\u3001\u7f3a\u4e4f\u7ed3\u6784\u5316\u5e76\u53d1\u4fdd\u8bc1\u3001\u4f1a\u8bdd\u7ba1\u7406\u788e\u7247\u5316\uff08\u6267\u884c\u72b6\u6001\u4e0e\u667a\u80fd\u4f53\u672c\u8eab\u5206\u79bb\uff09\u3001\u4ee5\u53ca\u957f\u7a0b\u4efb\u52a1\u4e2d\u7684\u4e0a\u4e0b\u6587\u7ba1\u7406\u4e0d\u8db3\u3002\u672c\u6587\u63d0\u51fa Agentica\uff0c\u4e00\u4e2a\u57fa\u4e8e Python 3.12 \u7684\u5f02\u6b65\u4f18\u5148\u667a\u80fd\u4f53\u6846\u67b6\uff0c\u5f15\u5165\u4ee5\u4e0b\u5173\u952e\u521b\u65b0\uff1a(1) \u57fa\u4e8e <code>asyncio.TaskGroup</code> \u7684\u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c\uff0c\u63d0\u4f9b\u9010\u4efb\u52a1\u5f02\u5e38\u9694\u79bb\u7684\u5f62\u5f0f\u5316\u5b89\u5168\u4fdd\u8bc1\uff1b(2) \u4e09\u5c42\u5de5\u5177\u62bd\u8c61\uff08Tool \u2192 Function \u2192 FunctionCall\uff09\uff0c\u91c7\u7528\u5185\u5b58\u5b89\u5168\u7684\u5f31\u5f15\u7528\u548c\u900f\u660e\u7684\u540c\u6b65/\u5f02\u6b65\u8fb9\u754c\u6865\u63a5\uff1b(3) Agent-as-Session \u7edf\u4e00\u72b6\u6001\u6a21\u578b\uff0c\u667a\u80fd\u4f53\u81ea\u8eab\u4f5c\u4e3a\u4f1a\u8bdd\u8f7d\u4f53\uff0c\u901a\u8fc7 token \u611f\u77e5\u7684\u8fd0\u884c\u5386\u53f2\u7ba1\u7406\u6d88\u9664 Runner/Session \u5206\u79bb\u5e26\u6765\u7684\u67b6\u6784\u788e\u7247\u5316\uff1b(4) DeepAgent \u6df1\u5ea6\u7814\u7a76\u6269\u5c55\uff0c\u5177\u5907\u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406\uff08\u9644\u5f62\u5f0f\u5316\u6536\u655b\u6027\u8d28\uff09\u548c HEARTBEAT \u5f0f\u8fed\u4ee3\u63a7\u5236\uff1b(5) \u53cc\u5c42\u7ea7\u62a4\u680f\u7cfb\u7edf\uff0c\u540c\u65f6\u652f\u6301\u667a\u80fd\u4f53\u7ea7\u548c\u5de5\u5177\u7ea7\u7684\u8f93\u5165/\u8f93\u51fa\u9a8c\u8bc1\u3002\u6211\u4eec\u5c06\u667a\u80fd\u4f53\u6267\u884c\u6a21\u578b\u5f62\u5f0f\u5316\u4e3a\u72b6\u6001\u8f6c\u6362\u7cfb\u7edf\uff0c\u5e76\u8bc1\u660e\u4e86\u5f02\u5e38\u9694\u79bb\u3001\u7ec8\u6b62\u4fdd\u8bc1\u548c\u4e0a\u4e0b\u6587\u8fb9\u754c\u5f3a\u5236\u7b49\u5173\u952e\u5b89\u5168\u6027\u8d28\u3002\u5728\u4e09\u4e2a\u57fa\u51c6\u6d4b\u8bd5\u2014\u2014GAIA\u3001SWE-bench Verified \u548c Terminal-Bench \u4e0a\u7684\u8bc4\u4f30\u8868\u660e\uff0c\u667a\u80fd\u4f53\u6846\u67b6\u7684\u67b6\u6784\u8bbe\u8ba1\u663e\u8457\u5f71\u54cd\u4efb\u52a1\u5b8c\u6210\u7387\u3001\u6548\u7387\u548c\u53ef\u9760\u6027\u3002\u5b9e\u9a8c\u7ed3\u679c\u663e\u793a\uff0c\u7ed3\u6784\u5316\u5e76\u53d1\u5728\u591a\u5de5\u5177\u4efb\u52a1\u4e0a\u5b9e\u73b0\u4e86 <code>[TODO: X%]</code> \u7684\u52a0\u901f\uff0c\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u5c06\u957f\u7a0b\u4efb\u52a1\u5b8c\u6210\u7387\u63d0\u5347\u4e86 <code>[TODO: X%]</code>\uff0c\u6574\u4f53\u6027\u80fd\u8fbe\u5230\u6216\u8d85\u8fc7\u5f53\u524d\u6700\u4f18\u667a\u80fd\u4f53\u7cfb\u7edf\u3002</p>"},{"location":"paper_zh/#1","title":"1. \u5f15\u8a00","text":"<p>\u57fa\u4e8e LLM \u7684\u81ea\u4e3b\u667a\u80fd\u4f53\u7684\u51fa\u73b0\uff0c\u63a8\u52a8\u4e86\u590d\u6742\u4efb\u52a1\u5904\u7406\u65b9\u5f0f\u7684\u8303\u5f0f\u8f6c\u53d8\u2014\u2014\u4ece\u8f6f\u4ef6\u5de5\u7a0b\uff08Jimenez et al., 2024\uff09\u5230\u6df1\u5ea6\u7814\u7a76\uff08Xu &amp; Peng, 2025\uff09\u518d\u5230\u901a\u7528\u52a9\u624b\uff08Mialon et al., 2023\uff09\u3002\u4e0d\u540c\u4e8e\u4ea7\u751f\u5355\u8f6e\u56de\u590d\u7684\u7b80\u5355\u804a\u5929\u673a\u5668\u4eba\uff0c\u667a\u80fd\u4f53\u9700\u8981\u8fdb\u884c\u591a\u6b65\u63a8\u7406\u3001\u8c03\u7528\u5916\u90e8\u5de5\u5177\u3001\u534f\u8c03\u5b50\u667a\u80fd\u4f53\uff0c\u5e76\u5728\u957f\u65f6\u95f4\u4ea4\u4e92\u4e2d\u7ef4\u62a4\u6301\u4e45\u72b6\u6001\u3002</p> <p>\u5c3d\u7ba1\u8fdb\u5c55\u8fc5\u901f\uff0c\u5f53\u524d\u667a\u80fd\u4f53\u6846\u67b6\u9762\u4e34\u82e5\u5e72\u67b6\u6784\u5c42\u9762\u7684\u6311\u6218\uff0c\u9650\u5236\u4e86\u5176\u5728\u56f0\u96be\u957f\u7a0b\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\uff1a</p> <p>\u6311\u6218 1\uff1a\u987a\u5e8f\u5de5\u5177\u6267\u884c\u3002 \u5f53 LLM \u5728\u5355\u6b21\u56de\u590d\u4e2d\u8fd4\u56de\u591a\u4e2a\u5de5\u5177\u8c03\u7528\uff08\u5982\u540c\u65f6\u8fdb\u884c\u7f51\u7edc\u641c\u7d22\u548c\u6587\u4ef6\u8bfb\u53d6\uff09\uff0c\u5927\u591a\u6570\u6846\u67b6\u5c06\u5176\u4e32\u884c\u6267\u884c\u3002MetaGPT\uff08Hong et al., 2023\uff09\u4ee5\u6d41\u6c34\u7ebf\u65b9\u5f0f\u5904\u7406\u52a8\u4f5c\uff1bCrewAI \u4f7f\u7528\u987a\u5e8f\u4efb\u52a1\u6267\u884c\uff1bLangGraph \u7684 <code>ToolNode</code> \u9010\u4e00\u8c03\u5ea6\u5de5\u5177\u3002OpenAI Agents SDK \u672a\u516c\u5f00\u5176\u5185\u90e8\u5de5\u5177\u5e76\u53d1\u6a21\u578b\u3002\u4ec5 AutoGen v0.4 \u91c7\u7528\u5f02\u6b65\u4f18\u5148\u8bbe\u8ba1\uff0c\u4f46\u57fa\u4e8e Actor \u6d88\u606f\u4f20\u9012\u6a21\u578b\u800c\u975e\u7ed3\u6784\u5316\u5e76\u53d1\u3002\u8fd9\u79cd\u4e32\u884c\u5316\u5728\u53ef\u5b89\u5168\u5e76\u884c\u7684 I/O \u5bc6\u96c6\u578b\u64cd\u4f5c\u4e0a\u6d6a\u8d39\u4e86\u5927\u91cf\u65f6\u95f4\u3002</p> <p>\u6311\u6218 2\uff1a\u7f3a\u4e4f\u7ed3\u6784\u5316\u5e76\u53d1\u4fdd\u8bc1\u3002 \u5373\u4f7f\u652f\u6301\u5f02\u6b65\u6267\u884c\u7684\u6846\u67b6\uff08\u5982\u901a\u8fc7 <code>asyncio.gather</code>\uff09\u4e5f\u7f3a\u4e4f\u7ed3\u6784\u5316\u5e76\u53d1\u8bed\u4e49\u3002\u5f53\u4e00\u4e2a\u5de5\u5177\u8c03\u7528\u5931\u8d25\u65f6\uff0c<code>asyncio.gather</code> \u5728 <code>return_exceptions=False</code> \u6a21\u5f0f\u4e0b\u4f1a\u53d6\u6d88\u6240\u6709\u5144\u5f1f\u4efb\u52a1\uff0c\u5bfc\u81f4\u90e8\u5206\u7ed3\u679c\u4e22\u5931\uff1b\u5728 <code>return_exceptions=True</code> \u6a21\u5f0f\u4e0b\uff0c\u9519\u8bef\u4f20\u64ad\u6210\u4e3a\u5f00\u53d1\u8005\u7684\u8d1f\u62c5\u3002\u4e24\u79cd\u65b9\u5f0f\u5bf9\u751f\u4ea7\u7ea7\u667a\u80fd\u4f53\u7cfb\u7edf\u5747\u4e0d\u7406\u60f3\u3002\u6211\u4eec\u5c06\u6b64\u5f62\u5f0f\u5316\u4e3a\u90e8\u5206\u6545\u969c\u9694\u79bb\u6027\u8d28\uff08\u5b9a\u4e49 1\uff09\uff0c\u5e76\u8bc1\u660e\u5e26\u9010\u4efb\u52a1\u5f02\u5e38\u6355\u83b7\u7684 <code>asyncio.TaskGroup</code> \u6ee1\u8db3\u8be5\u6027\u8d28\u3002</p> <p>\u6311\u6218 3\uff1a\u4f1a\u8bdd\u7ba1\u7406\u788e\u7247\u5316\u3002 \u4e3b\u6d41\u8bbe\u8ba1\u6a21\u5f0f\u5c06\u6267\u884c\uff08Runner\uff09\u4e0e\u72b6\u6001\uff08Session\uff09\u5206\u79bb\uff0c\u4ee5 OpenAI Agents SDK \u4e3a\u4ee3\u8868\u2014\u2014Agent \u662f\u58f0\u660e\u5f0f\u914d\u7f6e\uff0cRunner \u9a71\u52a8\u6267\u884c\uff0cSession \u5b58\u50a8\u5bf9\u8bdd\u5386\u53f2\u3002\u8fd9\u79cd\u4e09\u65b9\u5206\u79bb\u5f15\u5165\u67b6\u6784\u6469\u64e6\uff1a\u5f00\u53d1\u8005\u5fc5\u987b\u663e\u5f0f\u534f\u8c03 runner-session \u751f\u547d\u5468\u671f\uff0c\u72b6\u6001\u4e0d\u7531\u63a8\u7406\u5b9e\u4f53\u5185\u5728\u62e5\u6709\uff0c\u591a\u8f6e\u4e0a\u4e0b\u6587\u9700\u624b\u52a8\u901a\u8fc7\u5916\u90e8 session \u5bf9\u8c61\u4f20\u9012\u3002</p> <p>\u6311\u6218 4\uff1a\u957f\u7a0b\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587\u6ea2\u51fa\u3002 \u6df1\u5ea6\u7814\u7a76\u4efb\u52a1\u901a\u5e38\u9700\u8981\u6570\u5341\u6b21\u5de5\u5177\u8c03\u7528\uff0c\u7d2f\u79ef\u7684\u4e0a\u4e0b\u6587\u8d85\u51fa\u6a21\u578b\u6709\u6548\u7a97\u53e3\u3002\u786c\u622a\u65ad\u4e22\u5931\u5173\u952e\u4fe1\u606f\uff1b\u6734\u7d20\u6458\u8981\u53ef\u80fd\u9057\u6f0f\u91cd\u8981\u7ec6\u8282\u3002\u6df1\u5ea6\u7814\u7a76\u7efc\u8ff0\uff08Xu &amp; Peng, 2025\uff09\u5c06\u4e0a\u4e0b\u6587\u7ba1\u7406\u5217\u4e3a\u4e09\u5927\u6838\u5fc3\u5de5\u7a0b\u6311\u6218\u4e4b\u4e00\u3002\u5355\u9608\u503c\u673a\u5236\u5728\u4e0a\u4e0b\u6587\u5728\u9608\u503c\u9644\u8fd1\u6ce2\u52a8\u65f6\u4f1a\u51fa\u73b0\u538b\u7f29\u632f\u8361\u3002</p> <p>\u6311\u6218 5\uff1a\u5de5\u5177\u7ea7\u64cd\u4f5c\u7684\u5b89\u5168\u673a\u5236\u4e0d\u8db3\u3002 \u867d\u7136 OpenAI Agents SDK \u7b49\u6846\u67b6\u63d0\u4f9b\u4e86\u667a\u80fd\u4f53\u7ea7\u62a4\u680f\uff08\u9a8c\u8bc1\u6574\u4f53\u8f93\u5165/\u8f93\u51fa\uff09\uff0c\u4f46\u4e0e\u6587\u4ef6\u7cfb\u7edf\u3001\u6570\u636e\u5e93\u548c\u5916\u90e8 API \u76f4\u63a5\u4ea4\u4e92\u7684\u5355\u4e2a\u5de5\u5177\u8c03\u7528\u7f3a\u4e4f\u7ec6\u7c92\u5ea6\u9a8c\u8bc1\u3002\u4e00\u4e2a\u683c\u5f0f\u9519\u8bef\u7684\u5de5\u5177\u8c03\u7528\u5373\u53ef\u7834\u574f\u72b6\u6001\u6216\u6cc4\u9732\u654f\u611f\u6570\u636e\u3002</p> <p>\u4e3a\u5e94\u5bf9\u4e0a\u8ff0\u6311\u6218\uff0c\u6211\u4eec\u63d0\u51fa Agentica\uff0c\u4e00\u4e2a\u5f02\u6b65\u4f18\u5148\u667a\u80fd\u4f53\u6846\u67b6\uff0c\u4e3b\u8981\u8d21\u732e\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5177\u6709\u5f62\u5f0f\u5316\u5b89\u5168\u4fdd\u8bc1\u7684\u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c\uff0c\u4f7f\u7528 Python 3.12 \u7684 <code>asyncio.TaskGroup</code>\u3002\u6211\u4eec\u5c06\u667a\u80fd\u4f53\u6267\u884c\u5faa\u73af\u5f62\u5f0f\u5316\u4e3a\u72b6\u6001\u8f6c\u6362\u7cfb\u7edf\uff08\u7b2c 3.2 \u8282\uff09\uff0c\u5e76\u8bc1\u660e\u4e09\u9636\u6bb5\u6267\u884c\u534f\u8bae\u6ee1\u8db3\u90e8\u5206\u6545\u969c\u9694\u79bb\u6027\u8d28\u2014\u2014\u5355\u4e2a\u5de5\u5177\u5931\u8d25\u4e0d\u4f1a\u53d6\u6d88\u5144\u5f1f\u6267\u884c\uff0c\u6240\u6709\u7ed3\u679c\uff08\u6210\u529f\u6216\u5931\u8d25\uff09\u4ee5\u539f\u59cb\u987a\u5e8f\u4fdd\u7559\u3002\u636e\u6211\u4eec\u6240\u77e5\uff0cAgentica \u662f\u9996\u4e2a\u5c06\u7ed3\u6784\u5316\u5e76\u53d1\u5e94\u7528\u4e8e\u5de5\u5177\u6267\u884c\u7684\u667a\u80fd\u4f53\u6846\u67b6\u3002</p> </li> <li> <p>\u4e09\u5c42\u5de5\u5177\u62bd\u8c61\uff08Tool \u2192 Function \u2192 FunctionCall\uff09\uff0c\u5206\u79bb\u6ce8\u518c\u3001\u6a21\u5f0f\u5b9a\u4e49\u548c\u8c03\u7528\u3002Function \u901a\u8fc7\u5f31\u5f15\u7528\uff08<code>weakref</code>\uff09\u6301\u6709\u5bf9\u7236 Agent \u7684\u5185\u5b58\u5b89\u5168\u5f15\u7528\uff0c\u6253\u7834 <code>Agent \u2192 Model \u2192 functions \u2192 Function._agent \u2192 Agent</code> \u5faa\u73af\u5f15\u7528\u94fe\u3002<code>FunctionCall.execute()</code> \u81ea\u52a8\u68c0\u6d4b\u540c\u6b65/\u5f02\u6b65\u5165\u53e3\u5e76\u901a\u8fc7 <code>run_in_executor()</code> \u8def\u7531\u540c\u6b65\u51fd\u6570\uff0c\u4f7f\u5f02\u6b65\u8fb9\u754c\u5bf9\u5de5\u5177\u4f5c\u8005\u900f\u660e\u3002</p> </li> <li> <p>Agent-as-Session \u7edf\u4e00\u72b6\u6001\u6a21\u578b\uff0c\u5c06\u6267\u884c\u3001\u63a8\u7406\u548c\u4f1a\u8bdd\u72b6\u6001\u5408\u5e76\u5230 Agent \u81ea\u8eab\u3002\u4e0d\u540c\u4e8e OpenAI Agents SDK \u7684 Runner/Session \u5206\u79bb\uff0cAgentica \u7684 <code>AgentMemory</code> \u76f4\u63a5\u5728\u667a\u80fd\u4f53\u5185\u90e8\u5b58\u50a8\u7ed3\u6784\u5316\u8fd0\u884c\u5386\u53f2\uff08<code>runs: List[AgentRun]</code>\uff09\uff0c\u901a\u8fc7 token \u611f\u77e5\u7684\u5386\u53f2\u68c0\u7d22\uff08<code>get_messages_from_last_n_runs()</code>\uff09\u63d0\u4f9b\u81ea\u52a8\u9884\u7b97\u53d7\u9650\u7684\u4e0a\u4e0b\u6587\u7ec4\u88c5\uff0c\u6d88\u9664\u4f1a\u8bdd\u7ba1\u7406\u6837\u677f\u4ee3\u7801\uff08\u7b2c 3.5 \u8282\uff09\u3002</p> </li> <li> <p>DeepAgent \u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406\u3002\u5f15\u5165\u5e26\u5f62\u5f0f\u5316\u6536\u655b\u5206\u6790\u7684\u53cc\u9608\u503c\u673a\u5236\uff08\u7b2c 3.6 \u8282\uff09\uff1a\u8f6f\u9608\u503c\uff08$\\theta_s$\uff09\u89e6\u53d1\u538b\u7f29\uff0c\u786c\u9608\u503c\uff08$\\theta_h$\uff09\u5f3a\u5236\u751f\u6210\u56de\u7b54\uff0c\u6ede\u56de\u95f4\u9699\uff08$\\theta_h - \\theta_s$\uff09\u63d0\u4f9b\u53ef\u8bc1\u660e\u7684\u632f\u8361\u907f\u514d\u3002\u7ed3\u5408 HEARTBEAT \u5f0f\u8fed\u4ee3\u68c0\u67e5\u70b9\uff0c\u5b9e\u73b0\u53ef\u9760\u7684\u957f\u7a0b\u4efb\u52a1\u5b8c\u6210\u3002</p> </li> <li> <p>\u53cc\u5c42\u7ea7\u62a4\u680f\u7cfb\u7edf\uff0c\u540c\u65f6\u63d0\u4f9b\u667a\u80fd\u4f53\u7ea7\uff08<code>InputGuardrail</code>\u3001<code>OutputGuardrail</code>\uff09\u548c\u5de5\u5177\u7ea7\uff08<code>ToolInputGuardrail</code>\u3001<code>ToolOutputGuardrail</code>\uff09\u9a8c\u8bc1\u2014\u2014\u9996\u4e2a\u63d0\u4f9b\u7ec6\u7c92\u5ea6\u9010\u5de5\u5177\u8c03\u7528\u5b89\u5168\u9a8c\u8bc1\u7684\u6846\u67b6\u3002</p> </li> <li> <p>\u57fa\u4e8e\u6587\u4ef6\u7684\u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6\uff0c\u4f7f\u7528 Markdown \u6587\u4ef6\uff08<code>AGENT.md</code>\u3001<code>MEMORY.md</code>\u3001<code>USER.md</code> \u7b49\uff09\uff0c\u5177\u5907\u4eba\u7c7b\u53ef\u8bfb\u3001\u53ef\u5ba1\u8ba1\u3001\u53ef Git \u7248\u672c\u63a7\u5236\u7684\u7279\u6027\uff0c\u652f\u6301 <code>users/{user_id}/</code> \u76ee\u5f55\u4e0b\u7684\u591a\u7528\u6237\u9694\u79bb\u3002</p> </li> </ol> <p>\u6b64\u5916\uff0cAgentica \u63d0\u4f9b MCP + ACP \u53cc\u534f\u8bae\u5de5\u5177\u751f\u6001\u3001\u57fa\u4e8e Markdown \u7684\u58f0\u660e\u5f0f Skill \u6280\u80fd\u7cfb\u7edf\u3001\u4ee5\u53ca\u8986\u76d6 6 \u79cd\u5411\u91cf\u6570\u636e\u5e93\u548c 13 \u79cd\u5d4c\u5165\u6a21\u578b\u7684\u5b8c\u6574 RAG \u57fa\u7840\u8bbe\u65bd\uff0c\u6784\u6210\u4e86\u4e00\u4e2a\u9762\u5411\u751f\u4ea7\u73af\u5883\u7684\u5b8c\u6574\u667a\u80fd\u4f53\u5f00\u53d1\u5e73\u53f0\u3002</p> <p>\u6211\u4eec\u5728\u4e09\u4e2a\u4e92\u8865\u7684\u57fa\u51c6\u6d4b\u8bd5\u4e0a\u8fdb\u884c\u8bc4\u4f30\uff1a - GAIA\uff08Mialon et al., 2023\uff09\uff1a165 \u4e2a\u901a\u7528 AI \u52a9\u624b\u4efb\u52a1\uff0c\u6d4b\u8bd5\u591a\u6b65\u63a8\u7406\u548c\u5de5\u5177\u4f7f\u7528 - SWE-bench Verified\uff08Jimenez et al., 2024; OpenAI, 2024\uff09\uff1a500 \u4e2a\u6765\u81ea GitHub \u7684\u771f\u5b9e\u8f6f\u4ef6\u5de5\u7a0b\u4efb\u52a1 - Terminal-Bench\uff08Merrill et al., 2026\uff09\uff1a89 \u4e2a\u57fa\u4e8e Docker \u7ec8\u7aef\u73af\u5883\u7684\u9ad8\u96be\u5ea6\u4efb\u52a1\uff0c\u6db5\u76d6\u8f6f\u4ef6\u5de5\u7a0b\u3001ML/AI\u3001\u7f51\u7edc\u5b89\u5168\u548c\u7cfb\u7edf\u7ba1\u7406</p>"},{"location":"paper_zh/#2","title":"2. \u76f8\u5173\u5de5\u4f5c","text":""},{"location":"paper_zh/#21","title":"2.1 \u667a\u80fd\u4f53\u6846\u67b6","text":"<p>MetaGPT\uff08Hong et al., 2023\uff09\u5f15\u5165\u4e86 SOP-as-Prompt \u8303\u5f0f\uff0c\u5c06\u4eba\u7c7b\u6807\u51c6\u64cd\u4f5c\u6d41\u7a0b\u7f16\u7801\u4e3a\u7ed3\u6784\u5316\u63d0\u793a\u5e8f\u5217\u7528\u4e8e\u591a\u667a\u80fd\u4f53\u534f\u4f5c\u3002\u5176\u53d1\u5e03-\u8ba2\u9605\u901a\u4fe1\u673a\u5236\u548c\u53ef\u6267\u884c\u53cd\u9988\u5faa\u73af\u662f\u91cd\u8981\u8fdb\u5c55\u3002\u7136\u800c\uff0cMetaGPT \u7684\u7f16\u6392\u5c42\u6267\u884c\u6a21\u578b\u672c\u8d28\u4e0a\u662f\u987a\u5e8f\u7684\u2014\u2014\u667a\u80fd\u4f53\u6309\u6d41\u6c34\u7ebf\u987a\u5e8f\u6267\u884c\u3002\u867d\u7136\u5404\u89d2\u8272\u4f7f\u7528 <code>async def run()</code>\uff0c\u4f46\u4ec5\u7528\u4e8e\u975e\u963b\u585e LLM I/O\uff1b\u667a\u80fd\u4f53\u95f4\u534f\u8c03\u4ecd\u4e3a\u540c\u6b65\u3002\u53d1\u8868\u4e3a ICLR 2024 Oral\u3002</p> <p>AutoGen\uff08Wu et al., 2023\uff09\u63d0\u51fa\u4e86\u57fa\u4e8e\u53ef\u5bf9\u8bdd\u667a\u80fd\u4f53\u7684\u591a\u667a\u80fd\u4f53\u5bf9\u8bdd\u6846\u67b6\u3002AutoGen v0.4\uff082025 \u5e74 1 \u6708\uff09\u5f15\u5165\u4e86\u4e8b\u4ef6\u9a71\u52a8\u7684 Actor \u6a21\u578b\u8fd0\u884c\u65f6\u3002\u867d\u7136\u901a\u8fc7 Actor \u6d88\u606f\u603b\u7ebf\u5b9e\u73b0\u5f02\u6b65\u4f18\u5148\uff0c\u4f46\u5176\u5e76\u53d1\u901a\u8fc7\u6d88\u606f\u4f20\u9012\u800c\u975e\u7ed3\u6784\u5316\u5e76\u53d1\u539f\u8bed\u5b9e\u73b0\uff0c\u5355\u8f6e\u5185\u7684\u5de5\u5177\u6267\u884c\u4ecd\u4e3a\u987a\u5e8f\u3002</p> <p>OpenAI Agents SDK\uff08OpenAI, 2025\uff09\u7ee7\u627f\u5b9e\u9a8c\u6027 Swarm \u6846\u67b6\uff0c\u63d0\u4f9b\u8f7b\u91cf\u7ea7\u667a\u80fd\u4f53\u62bd\u8c61\u2014\u2014Agent \u4e3a\u58f0\u660e\u5f0f\u914d\u7f6e\u5bf9\u8c61\uff0c\u65e0\u72b6\u6001 Runner \u7c7b\u9a71\u52a8\u6267\u884c\u3002\u652f\u6301\u57fa\u4e8e handoff \u7684\u591a\u667a\u80fd\u4f53\u534f\u8c03\u548c tripwire \u6a21\u5f0f\u62a4\u680f\u3002\u5176 Python 3.9 \u6700\u4f4e\u8981\u6c42\u6392\u9664\u4e86 <code>asyncio.TaskGroup</code>\uff08Python 3.11 \u5f15\u5165\uff09\u7684\u4f7f\u7528\uff0c\u5185\u90e8\u5de5\u5177\u6267\u884c\u5e76\u53d1\u6a21\u578b\u672a\u516c\u5f00\u3002\u6258\u7ba1\u5de5\u5177\uff08WebSearch\u3001FileSearch\u3001CodeInterpreter\uff09\u5b9e\u9645\u4e0a\u9020\u6210\u5bf9 OpenAI Responses API \u7684\u5382\u5546\u9501\u5b9a\u3002</p> <p>LangGraph\uff08LangChain, 2023\uff09\u5c06\u667a\u80fd\u4f53\u5de5\u4f5c\u6d41\u5efa\u6a21\u4e3a\u6709\u72b6\u6001\u6709\u5411\u56fe\u3002\u867d\u7136\u5bf9\u590d\u6742\u5de5\u4f5c\u6d41\u7f16\u6392\u529f\u80fd\u5f3a\u5927\uff0c\u4f46\u5176 <code>ToolNode</code> \u7ec4\u4ef6\u987a\u5e8f\u6267\u884c\u5de5\u5177\uff0c\u56fe\u62bd\u8c61\u5bf9\u7b80\u5355\u667a\u80fd\u4f53\u6a21\u5f0f\u5f15\u5165\u989d\u5916\u5f00\u9500\u3002</p> <p>CrewAI\uff08Moura, 2024\uff09\u4f7f\u7528\u57fa\u4e8e\u89d2\u8272\u7684\u667a\u80fd\u4f53\u8bbe\u8ba1\u3002\u540c\u6b65\u4f18\u5148\uff0c\u65e0\u539f\u751f\u5f02\u6b65\u67b6\u6784\u6216\u5e76\u884c\u5de5\u5177\u6267\u884c\u3002</p> <p>\u8868 1 \u603b\u7ed3\u4e86\u67b6\u6784\u5bf9\u6bd4\u3002</p> <p>\u8868 1\uff1a\u667a\u80fd\u4f53\u6846\u67b6\u67b6\u6784\u5bf9\u6bd4</p> \u7ef4\u5ea6 Agentica MetaGPT AutoGen v0.4 OpenAI Agents SDK LangGraph CrewAI \u6267\u884c\u6a21\u578b \u5f02\u6b65\u4f18\u5148\uff08\u539f\u751f\uff09 \u5f02\u6b65 I/O\uff0c\u540c\u6b65\u7f16\u6392 \u5f02\u6b65\uff08Actor \u6a21\u578b\uff09 \u5f02\u6b65\u4e3a\u4e3b \u53cc\u6a21\u5f0f \u540c\u6b65\u4f18\u5148 \u5de5\u5177\u5e76\u53d1 <code>TaskGroup</code>\uff08\u7ed3\u6784\u5316\uff09 \u987a\u5e8f \u987a\u5e8f\uff08\u6bcf\u8f6e\uff09 \u672a\u516c\u5f00 \u987a\u5e8f\uff08<code>ToolNode</code>\uff09 \u987a\u5e8f \u5de5\u5177\u62bd\u8c61 \u4e09\u5c42\u5c42\u6b21\u7ed3\u6784 Action \u7ea7 \u51fd\u6570\u6ce8\u518c <code>@function_tool</code> \u6241\u5e73 <code>@tool</code> \u88c5\u9970\u5668 <code>BaseTool</code> \u7c7b \u4f1a\u8bdd\u6a21\u578b Agent-as-Session\uff08\u7edf\u4e00\uff09 \u73af\u5883\u5171\u4eab\u72b6\u6001 ConversableAgent \u72b6\u6001 Runner + Session\uff08\u5206\u79bb\uff09 Checkpointer\uff08\u5916\u90e8\uff09 Memory\uff08\u5916\u90e8\uff09 \u591a\u667a\u80fd\u4f53 <code>as_tool()</code> \u59d4\u6258 \u53d1\u5e03-\u8ba2\u9605\u6d41\u6c34\u7ebf GroupChat + Actor Handoffs + agents-as-tools \u56fe\u5b50\u8282\u70b9 \u987a\u5e8f/\u5c42\u6b21 \u5de5\u5177\u534f\u8bae MCP + ACP \u53cc\u534f\u8bae \u65e0 \u65e0 MCP \u65e0 MCP \u6280\u80fd\u6269\u5c55 Markdown Skill \u7cfb\u7edf \u65e0 \u65e0 \u65e0 \u65e0 \u65e0 RAG \u57fa\u7840\u8bbe\u65bd 6 \u5411\u91cf\u5e93 + 13 Embedding \u65e0 \u65e0 Faiss \u65e0 \u6709\u9650 \u62a4\u680f \u667a\u80fd\u4f53 + \u5de5\u5177\u7ea7 \u65e0 \u65e0 \u4ec5\u667a\u80fd\u4f53\u7ea7 \u65e0 \u65e0 \u8bb0\u5fc6 AgentMemory + Workspace \u4e09\u5c42\uff08\u5de5\u4f5c/\u5171\u4eab/\u957f\u671f\uff09 \u6d88\u606f\u5386\u53f2 Sessions\uff08SQLite/Redis\uff09 Checkpoints + Store SQLite + Entity Python \u7248\u672c &gt;= 3.12 &gt;= 3.9 &gt;= 3.10 &gt;= 3.9 &gt;= 3.9 &gt;= 3.10 \u5b66\u672f\u8bba\u6587 \u672c\u6587 ICLR 2024 Oral arXiv 2023 \u65e0 \u65e0 \u65e0"},{"location":"paper_zh/#22","title":"2.2 \u6df1\u5ea6\u7814\u7a76\u7cfb\u7edf","text":"<p>\u6df1\u5ea6\u7814\u7a76\uff08Deep Research\uff09\u4ee3\u8868\u4e86 AI \u667a\u80fd\u4f53\u81ea\u52a8\u5316\u7aef\u5230\u7aef\u7814\u7a76\u5de5\u4f5c\u6d41\u7684\u65b0\u8303\u5f0f\uff08Xu &amp; Peng, 2025; Wang et al., 2025\uff09\u3002Xu &amp; Peng\uff082025\uff09\u7684\u7efc\u5408\u7efc\u8ff0\u5206\u6790\u4e86 80+ \u79cd\u5b9e\u73b0\uff0c\u63d0\u51fa\u4e86\u56db\u7ef4\u5206\u7c7b\u4f53\u7cfb\uff1a\u57fa\u7840\u6a21\u578b\u3001\u5de5\u5177\u5229\u7528\u3001\u4efb\u52a1\u89c4\u5212\u548c\u77e5\u8bc6\u7efc\u5408\u3002Wang et al.\uff082025\uff09\u5b9a\u4e49\u4e86\u4e09\u4e2a\u6f14\u8fdb\u9636\u6bb5\uff1a\u667a\u80fd\u641c\u7d22\u3001\u96c6\u6210\u7814\u7a76\u548c\u5168\u6808 AI \u79d1\u5b66\u5bb6\u3002</p> <p>\u5546\u4e1a\u7cfb\u7edf\u5305\u62ec OpenAI Deep Research\uff08\u57fa\u4e8e o3 \u4e0e\u5f3a\u5316\u5b66\u4e60\uff09\u3001Google Gemini Deep Research\uff08\u767e\u4e07 token \u4e0a\u4e0b\u6587\uff09\u3001Perplexity Deep Research \u548c Anthropic Claude Research\u3002\u5f00\u6e90\u66ff\u4ee3\u65b9\u6848\u5305\u62ec OpenDeepResearcher\u3001Auto-Deep-Research \u548c OpenManus\u3002</p> <p>Agentica \u7684 DeepAgent \u6a21\u5757\u4ee5\u5176\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u673a\u5236\u548c HEARTBEAT \u5f0f\u8fed\u4ee3\u63a7\u5236\u4e3a\u8be5\u9886\u57df\u505a\u51fa\u8d21\u732e\u2014\u2014\u8fd9\u4e9b\u5de5\u7a0b\u521b\u65b0\u89e3\u51b3\u4e86\u88ab\u8bc6\u522b\u4e3a\u6838\u5fc3\u6311\u6218\u7684\u4e0a\u4e0b\u6587\u6ea2\u51fa\u548c\u8fc7\u65e9\u7ec8\u6b62\u95ee\u9898\u3002</p>"},{"location":"paper_zh/#23","title":"2.3 \u667a\u80fd\u4f53\u8bc4\u4f30\u57fa\u51c6","text":"<p>GAIA\uff08Mialon et al., 2023\uff09\u5728 466 \u4e2a\u771f\u5b9e\u4e16\u754c\u4efb\u52a1\uff08165 \u4e2a\u516c\u5f00\u9a8c\u8bc1\u96c6\uff0c301 \u4e2a\u79c1\u6709\u6d4b\u8bd5\u96c6\uff09\u4e0a\u8bc4\u4f30\u901a\u7528 AI \u52a9\u624b\uff0c\u9700\u8981\u591a\u6b65\u63a8\u7406\u3001\u591a\u6a21\u6001\u5904\u7406\u548c\u5de5\u5177\u4f7f\u7528\u3002\u4eba\u7c7b\u57fa\u7ebf\u7ea6 92%\uff1b\u9876\u7ea7 AI \u7cfb\u7edf\u5e73\u5747\u4e0d\u5230 30%\uff0c\u51f8\u663e\u4e86\u5de8\u5927\u7684\u80fd\u529b\u5dee\u8ddd\u3002</p> <p>SWE-bench\uff08Jimenez et al., 2024\uff09\u5728\u6765\u81ea 12 \u4e2a Python \u4ed3\u5e93\u7684\u771f\u5b9e GitHub issue \u4e0a\u8bc4\u4f30\u8f6f\u4ef6\u5de5\u7a0b\u667a\u80fd\u4f53\u3002SWE-bench Verified\uff08OpenAI, 2024\uff09\u662f 500 \u4e2a\u4eba\u5de5\u9a8c\u8bc1\u5b50\u96c6\u3002JoyCode Agent \u5f53\u524d\u4ee5 74.6% \u9886\u5148\uff0c\u8868\u660e\u667a\u80fd\u4f53\u811a\u624b\u67b6\u4f18\u4e8e\u88f8\u6a21\u578b\u80fd\u529b\uff08Claude 3.7 Sonnet \u65e0\u6846\u67b6\u65f6\u4e3a 70.3%\uff09\u3002</p> <p>Terminal-Bench\uff08Merrill et al., 2026\uff09\u662f 89 \u4e2a\u5728 Docker \u7ec8\u7aef\u73af\u5883\u4e2d\u6267\u884c\u7684\u9ad8\u96be\u5ea6\u4efb\u52a1\u57fa\u51c6\u3002\u4efb\u52a1\u6db5\u76d6\u8f6f\u4ef6\u5de5\u7a0b\uff0832.6%\uff09\u3001\u8ba1\u7b97\uff0821.3%\uff09\u3001ML/AI\uff0811.2%\uff09\u3001\u7f51\u7edc\u5b89\u5168\uff089.0%\uff09\u3001DevOps\uff084.5%\uff09\u7b49\u9886\u57df\u3002\u4efb\u52a1\u96be\u5ea6\u4ece\u6570\u5c0f\u65f6\u5230\u6570\u5929\u7684\u4e13\u5bb6\u4eba\u529b\u3002\u5f53\u524d\u6700\u4f73\u7cfb\u7edf\uff08GPT-5.3-Codex + Simple Codex agent\uff09\u8fbe\u5230 75.1%\u3002\u8bc4\u4f30\u4f7f\u7528\u57fa\u4e8e\u7ed3\u679c\u7684\u5bb9\u5668\u72b6\u6001\u68c0\u67e5\uff0c\u6bcf\u914d\u7f6e\u81f3\u5c11 5 \u6b21\u8fd0\u884c\uff08\u5171 32,155 \u6b21\uff09\uff0c\u62a5\u544a 95% \u7f6e\u4fe1\u533a\u95f4\u3002</p>"},{"location":"paper_zh/#3","title":"3. \u67b6\u6784","text":""},{"location":"paper_zh/#31","title":"3.1 \u6982\u8ff0","text":"<p>Agentica \u5efa\u7acb\u5728\u4e09\u4e2a\u8bbe\u8ba1\u539f\u5219\u4e4b\u4e0a\uff1a</p> <ol> <li> <p>\u5168\u94fe\u8def\u5f02\u6b65\u4f18\u5148\uff1a\u4e0d\u4ec5 Agent \u5c42\u7684\u6838\u5fc3\u65b9\u6cd5\uff08<code>run()</code>\u3001<code>response()</code>\uff09\u4e3a\u539f\u751f <code>async</code>\uff0c\u800c\u662f\u4ece Model \u5c42\uff08<code>invoke()</code>\u3001<code>response_stream()</code>\uff09\u3001Tool \u5c42\uff08<code>FunctionCall.execute()</code>\uff09\u3001\u6570\u636e\u5e93\u5c42\uff08<code>read_from_storage()</code>\u3001<code>write_to_storage()</code>\uff09\u5230\u6587\u4ef6 I/O \u5c42\uff08<code>Workspace.save_memory()</code>\uff09\u5168\u90e8\u91c7\u7528 async \u5b9e\u73b0\u3002\u540c\u6b65\u5de5\u5177\u901a\u8fc7 <code>run_in_executor()</code> \u81ea\u52a8\u6865\u63a5\uff0c\u540c\u6b65\u9002\u914d\u5668\uff08<code>run_sync()</code>\u3001<code>run_stream_sync()</code>\uff09\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b + \u4e8b\u4ef6\u5faa\u73af\u6a21\u5f0f\u5305\u88c5\u5f02\u6b65\u5b9e\u73b0\u3002\u8fd9\u79cd\u5168\u94fe\u8def\u5f02\u6b65\u8bbe\u8ba1\u786e\u4fdd\u5728\u9ad8\u5e76\u53d1 Web \u670d\u52a1\u573a\u666f\u4e0b\u4e0d\u963b\u585e\u4e8b\u4ef6\u5faa\u73af\u3002</p> </li> <li> <p>\u901a\u8fc7 mixin \u5206\u79bb\u5173\u6ce8\u70b9\uff1a<code>Agent</code> \u7c7b\u4f7f\u7528 <code>@dataclass(init=False)</code> \u4e0e\u7eaf\u65b9\u6cd5\u5bb9\u5668 mixin \u7684\u591a\u91cd\u7ee7\u627f\uff1a</p> </li> </ol> <pre><code>@dataclass(init=False)\nclass Agent(PromptsMixin, RunnerMixin, SessionMixin,\n            TeamMixin, ToolsMixin, PrinterMixin, MediaMixin):\n</code></pre> <p>\u6bcf\u4e2a mixin \u63d0\u4f9b\u7279\u5b9a\u80fd\u529b\uff08\u6267\u884c\u3001\u63d0\u793a\u8bcd\u3001\u4f1a\u8bdd\u7ba1\u7406\u3001\u591a\u667a\u80fd\u4f53\u59d4\u6258\u3001\u5de5\u5177\u7ba1\u7406\u3001\u8f93\u51fa\u683c\u5f0f\u5316\u3001\u5a92\u4f53\u5904\u7406\uff09\uff0c\u4e0d\u643a\u5e26\u72b6\u6001\u6216 <code>__init__</code>\u3002</p> <ol> <li>Pydantic \u7ba1\u6570\u636e\uff0cdataclass \u7ba1\u884c\u4e3a\uff1a\u6570\u636e\u7ed3\u6784\uff08<code>Model</code>\u3001<code>Tool</code>\u3001<code>Function</code>\u3001<code>RunResponse</code>\uff09\u4f7f\u7528 Pydantic <code>BaseModel</code>\u3002<code>Agent</code> \u7c7b\u523b\u610f\u4f7f\u7528 <code>@dataclass</code>\u2014\u2014\u5b83\u6709\u53ef\u53d8\u5b57\u6bb5\uff08Callable\u3001lists\uff09\u3001\u590d\u6742\u521d\u59cb\u5316\u548c\u522b\u540d\u5904\u7406\uff0c\u4e0d\u9700\u8981 Pydantic \u7684\u9a8c\u8bc1\u5f00\u9500\u3002</li> </ol> <p>\u56fe 1 \u5c55\u793a\u4e86\u6574\u4f53\u67b6\u6784\u3002</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Agent \u5c42                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502RunnerMix \u2502 \u2502PromptMix \u2502 \u2502SessionMix\u2502 \u2502 TeamMixin \u2502  \u2502\n\u2502  \u2502 run()    \u2502 \u2502 sys_msg  \u2502 \u2502 load()   \u2502 \u2502 as_tool() \u2502  \u2502\n\u2502  \u2502 stream() \u2502 \u2502 usr_msg  \u2502 \u2502 save()   \u2502 \u2502 transfer()\u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       \u2502                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502           _run_impl() [\u5f02\u6b65\u751f\u6210\u5668]                \u2502   \u2502\n\u2502  \u2502        \u7edf\u4e00\u6267\u884c\u5f15\u64ce + Langfuse \u94fe\u8def\u8ffd\u8e2a            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502       \u2502            Model \u5c42                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  Model\uff08\u5f02\u6b65\u62bd\u8c61\uff1ainvoke, response,               \u2502   \u2502\n\u2502  \u2502         invoke_stream, response_stream\uff09           \u2502   \u2502\n\u2502  \u2502                                                   \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502  \u2502 run_function_calls() [asyncio.TaskGroup]    \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  \u9636\u6bb5 1\uff1a\u53d1\u9001 started \u4e8b\u4ef6\uff08\u987a\u5e8f\uff09           \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  \u9636\u6bb5 2\uff1a\u5e76\u884c\u6267\u884c\uff08TaskGroup\uff09               \u2502  \u2502   \u2502\n\u2502  \u2502  \u2502  \u9636\u6bb5 3\uff1a\u987a\u5e8f\u5904\u7406\u7ed3\u679c                        \u2502  \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                    Tool \u5c42                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Tool   \u2502\u2500\u2500\u2500&gt;\u2502 Function \u2502\u2500\u2500\u2500&gt;\u2502   FunctionCall   \u2502   \u2502\n\u2502  \u2502 (\u5bb9\u5668)   \u2502    \u2502(\u6a21\u5f0f +   \u2502    \u2502    (\u8c03\u7528)        \u2502   \u2502\n\u2502  \u2502          \u2502    \u2502 weakref) \u2502    \u2502   .execute()     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 \u81ea\u52a8\u540c\u6b65/\u5f02\u6b65    \u2502   \u2502\n\u2502                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                  Memory \u5c42                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 AgentMemory \u2502         \u2502      Workspace            \u2502  \u2502\n\u2502  \u2502 (\u8fd0\u884c\u65f6,    \u2502         \u2502  AGENT.md | PERSONA.md    \u2502  \u2502\n\u2502  \u2502  token      \u2502         \u2502  users/{id}/MEMORY.md     \u2502  \u2502\n\u2502  \u2502  \u611f\u77e5)      \u2502         \u2502  users/{id}/USER.md       \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                 Guardrail \u5c42                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  \u667a\u80fd\u4f53\u7ea7          \u2502  \u2502     \u5de5\u5177\u7ea7                  \u2502   \u2502\n\u2502  \u2502  InputGuardrail   \u2502  \u2502  ToolInputGuardrail        \u2502   \u2502\n\u2502  \u2502  OutputGuardrail  \u2502  \u2502  ToolOutputGuardrail       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"paper_zh/#32","title":"3.2 \u5f62\u5f0f\u5316\u6267\u884c\u6a21\u578b","text":"<p>\u6211\u4eec\u5c06\u667a\u80fd\u4f53\u6267\u884c\u5faa\u73af\u5f62\u5f0f\u5316\u4e3a\u72b6\u6001\u8f6c\u6362\u7cfb\u7edf\uff0c\u4ee5\u652f\u6301\u5bf9\u5b89\u5168\u6027\u8d28\u7684\u4e25\u683c\u63a8\u7406\u3002</p> <p>\u5b9a\u4e49 1\uff08\u667a\u80fd\u4f53\u72b6\u6001\uff09\u3002 \u667a\u80fd\u4f53\u72b6\u6001\u662f\u4e00\u4e2a\u56db\u5143\u7ec4 $S = (M, H, C, \\sigma)$\uff0c\u5176\u4e2d\uff1a - $M = [m_1, ..., m_k]$ \u4e3a\u6d88\u606f\u5386\u53f2 - $H \\subseteq \\mathcal{R}$ \u4e3a\u5b58\u50a8\u5728 <code>AgentMemory.runs</code> \u4e2d\u7684\u5df2\u5b8c\u6210\u8fd0\u884c\u96c6\u5408 - $C \\in \\mathbb{N}$ \u4e3a\u4f30\u8ba1\u7684\u4e0a\u4e0b\u6587 token \u6570 - $\\sigma \\in {idle, running, terminated}$ \u4e3a\u6267\u884c\u72b6\u6001</p> <p>\u5b9a\u4e49 2\uff08\u6267\u884c\u6b65\u9aa4\uff09\u3002 \u5355\u4e2a\u6267\u884c\u6b65\u9aa4\u5c06\u72b6\u6001 $S_i$ \u8f6c\u6362\u4e3a $S_{i+1}$\uff1a</p> <p>$$S_i \\xrightarrow{\\text{LLM}} (r, T) \\xrightarrow{\\text{Execute}} S_{i+1}$$</p> <p>\u5176\u4e2d $r$ \u4e3a\u6a21\u578b\u6587\u672c\u56de\u590d\uff0c$T = {t_1, ..., t_n}$ \u4e3a\u5de5\u5177\u8c03\u7528\u96c6\u5408\u3002\u6267\u884c\u5206\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u9636\u6bb5 1\uff1a\u5bf9\u6bcf\u4e2a $t_j \\in T$\uff0c\u53d1\u9001 <code>started</code> \u4e8b\u4ef6\uff08\u987a\u5e8f\uff0c\u4fdd\u5e8f\uff09</li> <li>\u9636\u6bb5 2\uff1a\u5e76\u53d1\u6267\u884c\u6240\u6709 $t_j$\uff1a$\\text{results} = \\text{TaskGroup}({t_1, ..., t_n})$</li> <li>\u9636\u6bb5 3\uff1a\u6309\u539f\u59cb\u987a\u5e8f\u5904\u7406\u7ed3\u679c\uff08\u987a\u5e8f\uff09</li> </ul> <p>\u5b9a\u7406 1\uff08\u90e8\u5206\u6545\u969c\u9694\u79bb\uff09\u3002 \u5728\u5e26\u9010\u4efb\u52a1\u5f02\u5e38\u6355\u83b7\u7684 <code>asyncio.TaskGroup</code> \u6267\u884c\u6a21\u578b\u4e0b\uff0c\u82e5\u5de5\u5177\u8c03\u7528 $t_j$ \u629b\u51fa\u5f02\u5e38 $e_j$\uff0c\u5219\u5bf9\u6240\u6709 $t_k$\uff08$k \\neq j$\uff09\uff1a(a) $t_k$ \u4e0d\u88ab\u53d6\u6d88\uff0c(b) $t_k$ \u7684\u7ed3\u679c\uff08\u6210\u529f\u6216\u5176\u81ea\u8eab\u5f02\u5e38\uff09\u88ab\u4fdd\u7559\uff0c(c) \u7ed3\u679c\u4ee5\u539f\u59cb\u987a\u5e8f $[r_1, ..., r_n]$ \u8fd4\u56de\u3002</p> <p>\u8bc1\u660e\u6982\u8981\u3002 \u6bcf\u4e2a\u4efb\u52a1 $t_j$ \u88ab\u5305\u88c5\u5728 <code>async def _execute_one(j, fc)</code> \u4e2d\uff0c\u8be5\u51fd\u6570\u5728\u672c\u5730\u6355\u83b7 <code>ToolCallException</code> \u548c\u901a\u7528 <code>Exception</code>\uff0c\u5b58\u50a8\u5728 <code>results[j]</code> \u4e2d\u3002<code>TaskGroup</code> \u4ec5\u5728\u672a\u6355\u83b7\u5f02\u5e38\u9003\u9038\u4efb\u52a1\u65f6\u4f20\u64ad <code>BaseExceptionGroup</code>\u3002\u7531\u4e8e\u6240\u6709\u5f02\u5e38\u5747\u5728 <code>_execute_one</code> \u5185\u88ab\u6355\u83b7\uff0cTaskGroup \u6b63\u5e38\u9000\u51fa\uff0c\u6240\u6709\u4efb\u52a1\u5b8c\u6210\u3002\u9636\u6bb5 3 \u6309\u7d22\u5f15\u987a\u5e8f $0, 1, ..., n-1$ \u904d\u5386 <code>results</code>\uff0c\u4fdd\u6301\u539f\u59cb\u5e8f\u5217\u3002$\\square$</p> <p>\u8fd9\u4e25\u683c\u5f3a\u4e8e <code>asyncio.gather(return_exceptions=True)</code>\u2014\u2014\u540e\u8005\u63d0\u4f9b (b) \u548c (c)\uff0c\u4f46\u4e0d\u63d0\u4f9b\u6240\u6709\u4efb\u52a1\u5728\u660e\u786e\u754c\u5b9a\u8303\u56f4\u5185\u5b8c\u6210\u7684\u7ed3\u6784\u5316\u751f\u547d\u5468\u671f\u4fdd\u8bc1\u3002</p> <p>\u5b9a\u4e49 3\uff08\u7ec8\u6b62\u6761\u4ef6\uff09\u3002 \u667a\u80fd\u4f53\u5728\u4ee5\u4e0b\u4efb\u4e00\u6761\u4ef6\u6ee1\u8db3\u65f6\u7ec8\u6b62\uff1a(a) \u6a21\u578b\u4e0d\u4ea7\u751f\u5de5\u5177\u8c03\u7528\uff08\u81ea\u7136\u5b8c\u6210\uff09\uff0c(b) \u4e0a\u4e0b\u6587 $C &gt; \\theta_h$\uff08\u786c\u9608\u503c\uff09\uff0c(c) \u6b65\u6570\u8d85\u8fc7 <code>max_rounds</code>\uff0c(d) \u629b\u51fa <code>StopAgentRun</code> \u6d41\u63a7\u5f02\u5e38\u3002</p>"},{"location":"paper_zh/#33","title":"3.3 \u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c","text":"<p>\u5f53 LLM \u5728\u5355\u6b21\u56de\u590d\u4e2d\u8fd4\u56de $N$ \u4e2a\u5de5\u5177\u8c03\u7528\u65f6\uff0cAgentica \u5206\u4e09\u9636\u6bb5\u6267\u884c\uff1a</p> <p>\u9636\u6bb5 1\uff08\u987a\u5e8f\uff09\uff1a\u53d1\u9001\u4e8b\u4ef6\u3002 \u5bf9\u6bcf\u4e2a\u5de5\u5177\u8c03\u7528 $t_i$\uff0c\u6309\u987a\u5e8f\u53d1\u9001 <code>tool_call_started</code> \u4e8b\u4ef6\uff0c\u786e\u4fdd\u6d41\u5f0f\u6d88\u8d39\u8005\u83b7\u5f97\u786e\u5b9a\u6027\u4e8b\u4ef6\u987a\u5e8f\u3002</p> <p>\u9636\u6bb5 2\uff08\u5e76\u884c\uff09\uff1a\u6267\u884c\u3002 \u6240\u6709 $N$ \u4e2a\u5de5\u5177\u8c03\u7528\u5728 <code>asyncio.TaskGroup</code> \u4e2d\u5e76\u53d1\u6267\u884c\uff1a</p> <pre><code>async with asyncio.TaskGroup() as tg:\n    tasks = [tg.create_task(_execute_one(i, fc))\n             for i, fc in enumerate(function_calls)]\n</code></pre> <p>\u6bcf\u4e2a\u4efb\u52a1\u5728 try/except \u4e2d\u6355\u83b7\u5f02\u5e38\uff0c\u9632\u6b62\u5355\u4e2a\u5931\u8d25\u53d6\u6d88\u5144\u5f1f\u4efb\u52a1\u3002</p> <p>\u5bf9\u4e8e\u540c\u6b65\u5de5\u5177\u5165\u53e3\uff0c<code>FunctionCall._call_func()</code> \u901a\u8fc7 <code>inspect.iscoroutinefunction()</code> \u81ea\u52a8\u68c0\u6d4b\u5e76\u901a\u8fc7 <code>run_in_executor()</code> \u8def\u7531\uff1a</p> <pre><code>async def _call_func(self, func, **kwargs):\n    if inspect.iscoroutinefunction(func):\n        return await func(**kwargs)\n    loop = asyncio.get_running_loop()\n    return await loop.run_in_executor(\n        None, functools.partial(func, **kwargs))\n</code></pre> <p>\u9636\u6bb5 3\uff08\u987a\u5e8f\uff09\uff1a\u5904\u7406\u7ed3\u679c\u3002 \u6309\u539f\u59cb\u987a\u5e8f\u5904\u7406\u7ed3\u679c\uff0c\u6784\u5efa\u5de5\u5177\u54cd\u5e94\u6d88\u606f\uff0c\u5904\u7406\u6d41\u63a7\u5f02\u5e38\uff08<code>StopAgentRun</code>\u3001<code>RetryAgentRun</code>\uff09\uff0c\u53d1\u9001 <code>tool_call_completed</code> \u4e8b\u4ef6\u3002</p> <p>\u4e09\u9636\u6bb5\u8bbe\u8ba1\u5728\u9636\u6bb5 2 \u5b9e\u73b0\u6700\u5927\u5e76\u884c\u6027\uff0c\u540c\u65f6\u5728\u9636\u6bb5 1 \u548c 3 \u7ef4\u6301\u786e\u5b9a\u6027\u987a\u5e8f\u3002</p>"},{"location":"paper_zh/#34","title":"3.4 \u4e09\u5c42\u5de5\u5177\u62bd\u8c61","text":"<p>\u5de5\u5177\u7cfb\u7edf\u4f7f\u7528\u5206\u79bb\u5173\u6ce8\u70b9\u7684\u4e09\u5c42\u5c42\u6b21\u7ed3\u6784\uff1a</p> <p>Tool \u662f\u5c06\u76f8\u5173\u51fd\u6570\u5206\u7ec4\u7684\u5bb9\u5668\uff08\u5982 <code>BuiltinFileTool</code> \u5305\u542b <code>ls</code>\u3001<code>read_file</code>\u3001<code>write_file</code>\u3001<code>edit_file</code>\u3001<code>glob</code>\u3001<code>grep</code>\uff09\u3002</p> <p>Function \u6301\u6709\u6a21\u5f0f\uff08\u540d\u79f0\u3001\u63cf\u8ff0\u3001JSON Schema \u53c2\u6570\uff09\u548c\u5165\u53e3\u53ef\u8c03\u7528\u5bf9\u8c61\u3002<code>Function.from_callable()</code> \u5de5\u5382\u65b9\u6cd5\u4f7f\u7528 <code>inspect.signature()</code> \u548c <code>get_type_hints()</code> \u4ece Python \u51fd\u6570\u81ea\u52a8\u751f\u6210\u5de5\u5177\u5b9a\u4e49\u3002\u5173\u952e\u8bbe\u8ba1\uff1aFunction \u901a\u8fc7\u5f31\u5f15\u7528\uff08<code>weakref.ref</code>\uff09\u6301\u6709\u5bf9\u7236 Agent \u7684\u5f15\u7528\uff0c\u6253\u7834 <code>Agent \u2192 Model \u2192 functions \u2192 Function._agent \u2192 Agent</code> \u5faa\u73af\u5f15\u7528\u94fe\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p><code>_safe_validate_call()</code> \u5305\u88c5 Pydantic \u7684 <code>validate_call</code>\uff0c\u5265\u79bb\u4e0d\u53ef\u89e3\u6790\u7684\u524d\u5411\u5f15\u7528\u6ce8\u89e3\uff08\u5982 mixin \u65b9\u6cd5\u4e0a\u7684 <code>self: \"Agent\"</code>\uff09\uff0c\u4f7f Pydantic \u9a8c\u8bc1\u80fd\u7528\u4e8e PEP 563 \u5ef6\u8fdf\u6ce8\u89e3\u7684\u65b9\u6cd5\u3002</p> <p>FunctionCall \u8868\u793a\u5355\u6b21\u8c03\u7528\uff0c\u5305\u542b\u53c2\u6570\u3001\u7ed3\u679c\u3001\u9519\u8bef\u548c\u8c03\u7528 ID\u3002\u5176 <code>execute()</code> \u65b9\u6cd5\u662f\u552f\u4e00\u6267\u884c\u5165\u53e3\u2014\u2014\u4ec5\u5f02\u6b65\uff0c\u652f\u6301\u524d/\u540e\u94a9\u5b50\u548c\u7b2c 3.3 \u8282\u63cf\u8ff0\u7684\u540c\u6b65/\u5f02\u6b65\u81ea\u52a8\u68c0\u6d4b\u3002</p> <p>Agent-as-Tool \u7edf\u4e00\u6267\u884c\u8def\u5f84\u3002 \u4e09\u5c42\u62bd\u8c61\u7684\u4e00\u4e2a\u91cd\u8981\u63a8\u8bba\u662f\u5b50\u667a\u80fd\u4f53\u8c03\u7528\u4e0e\u666e\u901a\u5de5\u5177\u8c03\u7528\u5171\u4eab\u540c\u4e00\u6267\u884c\u7ba1\u9053\u3002<code>Agent.as_tool()</code> \u5c06\u4efb\u610f Agent \u5305\u88c5\u4e3a\u6807\u51c6 <code>Function</code> \u5bf9\u8c61\uff0c\u5176\u5165\u53e3\u4e3a\u5f02\u6b65\u51fd\u6570 <code>await self.run(message)</code>\u3002\u8fd9\u610f\u5473\u7740\u5728 TaskGroup \u5e76\u884c\u6267\u884c\u9636\u6bb5\uff0c\u5b50\u667a\u80fd\u4f53\u8c03\u7528\u548c\u6587\u4ef6\u8bfb\u53d6\u3001\u7f51\u7edc\u641c\u7d22\u7b49\u666e\u901a\u5de5\u5177\u8c03\u7528\u5728\u540c\u4e00\u4e2a <code>asyncio.TaskGroup</code> \u4e2d\u5e76\u53d1\u2014\u2014\u7236\u667a\u80fd\u4f53\u53ef\u4ee5\u540c\u65f6\u8c03\u5ea6\u591a\u4e2a\u5b50\u667a\u80fd\u4f53\u548c\u5de5\u5177\uff0c\u65e0\u9700\u4efb\u4f55\u7279\u6b8a\u5904\u7406\u3002\u8fd9\u79cd\u7edf\u4e00\u6027\u662f\u5176\u4ed6\u6846\u67b6\uff08\u5982 OpenAI SDK \u7684 handoffs \u9700\u8981\u7279\u6b8a\u8def\u7531\u3001AutoGen \u7684 Actor \u6d88\u606f\u4f20\u9012\u9700\u8981\u72ec\u7acb\u901a\u9053\uff09\u6240\u4e0d\u5177\u5907\u7684\u3002</p>"},{"location":"paper_zh/#35-agent-as-session","title":"3.5 Agent-as-Session\uff1a\u7edf\u4e00\u72b6\u6001\u6a21\u578b","text":"<p>Agentica \u4e0e\u5176\u4ed6\u6846\u67b6\u5728\u4f1a\u8bdd\u72b6\u6001\u7ba1\u7406\u4e0a\u5b58\u5728\u6839\u672c\u7684\u8bbe\u8ba1\u5206\u6b67\u3002\u6211\u4eec\u8bc6\u522b\u51fa\u73b0\u6709\u6846\u67b6\u4e2d\u7684\u4e09\u79cd\u6a21\u5f0f\uff1a</p> <p>\u6a21\u5f0f A\uff1a\u65e0\u72b6\u6001 Runner + \u5916\u90e8 Session\uff08OpenAI Agents SDK\uff09\u3002Agent \u4e3a\u58f0\u660e\u5f0f\u914d\u7f6e\u5bf9\u8c61\uff1b\u65e0\u72b6\u6001 <code>Runner</code> \u7c7b\u9a71\u52a8\u6267\u884c\uff1b\u72ec\u7acb\u7684 <code>Session</code> \u5bf9\u8c61\uff08SQLite \u6216 Redis \u540e\u7aef\uff09\u5b58\u50a8\u5bf9\u8bdd\u5386\u53f2\u3002\u5f00\u53d1\u8005\u987b\u663e\u5f0f\u4f20\u9012 session \u5f15\u7528\uff1a</p> <pre><code># OpenAI Agents SDK \u6a21\u5f0f\nagent = Agent(name=\"assistant\", model=\"gpt-4o\", tools=[...])\nresult = await Runner.run(agent, \"query\", session=session)\n# \u6ca1\u6709 session\uff0cAgent \u65e0\u6cd5\u8bb0\u4f4f\u4e4b\u524d\u7684\u4ea4\u4e92\n</code></pre> <p>\u6a21\u5f0f B\uff1a\u73af\u5883\u4e2d\u4ecb\u72b6\u6001\uff08MetaGPT\u3001AutoGen\uff09\u3002\u667a\u80fd\u4f53\u901a\u8fc7\u5171\u4eab\u73af\u5883\u6216\u6d88\u606f\u603b\u7ebf\u901a\u4fe1\uff0c\u72b6\u6001\u5206\u6563\u5728\u73af\u5883\u3001\u5404\u667a\u80fd\u4f53\u8bb0\u5fc6\u548c\u901a\u4fe1\u901a\u9053\u4e2d\u3002</p> <p>\u6a21\u5f0f C\uff1aAgent-as-Session\uff08Agentica\uff09\u3002Agent \u81ea\u8eab\u5373\u4e3a\u4f1a\u8bdd\u8f7d\u4f53\u3002<code>AgentMemory</code> \u76f4\u63a5\u5d4c\u5165\u667a\u80fd\u4f53\u5185\u90e8\uff0c\u7ef4\u62a4\u7ed3\u6784\u5316\u8fd0\u884c\u5386\u53f2\uff1a</p> <pre><code>class AgentMemory(BaseModel):\n    runs: List[AgentRun] = []      # \u7ed3\u6784\u5316\u8fd0\u884c\u5386\u53f2\n    messages: List[Message] = []    # \u5f53\u524d\u4e0a\u4e0b\u6587\u7a97\u53e3\n    summary: Optional[SessionSummary] = None  # \u538b\u7f29\u5386\u53f2\n</code></pre> <p>\u5173\u952e\u673a\u5236\u662f <code>get_messages_from_last_n_runs()</code>\uff0c\u63d0\u4f9btoken \u9884\u7b97\u611f\u77e5\u7684\u5386\u53f2\u7ec4\u88c5\uff1a</p> <ol> <li>\u4ece\u6700\u8fd1\u5230\u6700\u65e9\u904d\u5386\u8fd0\u884c\u8bb0\u5f55</li> <li>\u5bf9\u6bcf\u6b21\u8fd0\u884c\uff0c\u63d0\u53d6\u5bf9\u8bdd\u6d88\u606f\uff08\u8fc7\u6ee4\u5de5\u5177\u8c03\u7528\uff09</li> <li>\u5e94\u7528\u6e10\u8fdb\u5f0f\u622a\u65ad\uff1a\u8d8a\u65e9\u7684\u8fd0\u884c\u88ab\u66f4\u79ef\u6781\u5730\u622a\u65ad</li> <li>\u5f53 token \u9884\u7b97\u8017\u5c3d\u65f6\u505c\u6b62</li> </ol> <p>\u8be5\u8bbe\u8ba1\u76f8\u5bf9\u6a21\u5f0f A \u7684\u4f18\u52bf\uff1a</p> <ul> <li>\u5355\u4e00\u4e8b\u5b9e\u6765\u6e90\uff1a\u667a\u80fd\u4f53\u62e5\u6709\u81ea\u5df1\u7684\u72b6\u6001\uff0c\u65e0\u9700\u534f\u8c03 runner\u3001session \u548c agent \u5bf9\u8c61</li> <li>token \u611f\u77e5\u4e0a\u4e0b\u6587\u7ec4\u88c5\uff1a\u5386\u53f2\u6d88\u606f\u81ea\u52a8\u53d7\u9884\u7b97\u7ea6\u675f\uff0c\u9632\u6b62\u591a\u8f6e\u4ea4\u4e92\u4e2d\u7684\u4e0a\u4e0b\u6587\u6ea2\u51fa</li> <li>\u6e10\u8fdb\u5f0f\u4fe1\u606f\u8870\u51cf\uff1a\u8f83\u65e9\u7684\u8fd0\u884c\u88ab\u66f4\u79ef\u6781\u5730\u622a\u65ad\uff08\u5de5\u5177\u7ed3\u679c\u6458\u8981\u81f3 <code>tool_result_max_chars</code>\uff09\uff0c\u6a21\u62df\u4eba\u7c7b\u8bb0\u5fc6\u4e2d\u8fd1\u671f\u4e8b\u4ef6\u56de\u5fc6\u66f4\u8be6\u7ec6\u7684\u7279\u6027</li> <li>\u96f6\u914d\u7f6e\u591a\u8f6e\u5bf9\u8bdd\uff1a\u591a\u8f6e\u5bf9\u8bdd\u9ed8\u8ba4\u53ef\u7528\uff0c\u65e0\u9700\u663e\u5f0f\u4f1a\u8bdd\u7ba1\u7406\u4ee3\u7801</li> </ul> <p>\u4f1a\u8bdd\u6301\u4e45\u5316\u7531 <code>SessionMixin</code> \u6b63\u4ea4\u5904\u7406\uff0c\u901a\u8fc7 <code>write_to_storage()</code> \u5c06\u667a\u80fd\u4f53\u72b6\u6001\uff08\u542b <code>AgentMemory</code>\uff09\u5e8f\u5217\u5316\u5230\u5b58\u50a8\u540e\u7aef\u3002\u8fd9\u5206\u79bb\u4e86\u72b6\u6001\u6240\u6709\u6743\uff08Agent\uff09\u548c\u72b6\u6001\u6301\u4e45\u5316\uff08SessionMixin + \u5b58\u50a8\u540e\u7aef\uff09\u7684\u5173\u6ce8\u70b9\u3002</p> <p>\u8868 2\uff1a\u4f1a\u8bdd\u7ba1\u7406\u6a21\u5f0f\u5bf9\u6bd4</p> \u5c5e\u6027 \u65e0\u72b6\u6001 Runner\uff08OpenAI\uff09 Agent-as-Session\uff08\u672c\u6587\uff09 \u72b6\u6001\u6240\u6709\u6743 \u5916\u90e8 Session \u5bf9\u8c61 Agent \u81ea\u8eab \u591a\u8f6e\u8bbe\u7f6e \u663e\u5f0f\u4f20\u9012 session \u81ea\u52a8\uff08\u5185\u7f6e\uff09 Token \u9884\u7b97 \u624b\u52a8\u7ba1\u7406 \u81ea\u52a8\uff08<code>max_tokens</code> \u53c2\u6570\uff09 \u5386\u53f2\u622a\u65ad \u5e94\u7528\u5c42 \u6846\u67b6\u5c42\uff08\u6e10\u8fdb\u5f0f\uff09 \u6301\u4e45\u5316 \u5fc5\u987b\u6709 Session \u540e\u7aef \u53ef\u9009\uff08SessionMixin\uff09 \u5e8f\u5217\u5316 Session.to_dict() AgentMemory.to_dict() \u2192 SessionRow"},{"location":"paper_zh/#36-deepagent","title":"3.6 DeepAgent\uff1a\u6df1\u5ea6\u7814\u7a76\u6269\u5c55","text":"<p><code>DeepAgent</code> \u7ee7\u627f <code>Agent</code>\uff0c\u589e\u52a0\u4e86\u4e13\u4e3a\u957f\u7a0b\u7814\u7a76\u548c\u590d\u6742\u4efb\u52a1\u8bbe\u8ba1\u7684\u80fd\u529b\uff1a</p> <p>\u5185\u7f6e\u5de5\u5177\u5957\u4ef6\u3002 DeepAgent \u81ea\u52a8\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\u5de5\u5177\uff08<code>ls</code>\u3001<code>read_file</code>\u3001<code>write_file</code>\u3001<code>edit_file</code>\u3001<code>glob</code>\u3001<code>grep</code>\uff09\u3001\u4ee3\u7801\u6267\u884c\uff08<code>execute</code>\uff0c\u5f02\u6b65\u5b50\u8fdb\u7a0b\uff0c\u4f18\u96c5\u7684 SIGTERM\u2192SIGKILL \u7ec8\u6b62\uff09\u3001\u7f51\u7edc\u5de5\u5177\uff08<code>web_search</code>\u3001<code>fetch_url</code>\uff09\u3001\u4efb\u52a1\u7ba1\u7406\uff08<code>write_todos</code>\u3001<code>read_todos</code>\uff09\u3001\u5b50\u667a\u80fd\u4f53\u59d4\u6258\uff08<code>task</code>\uff0c\u5185\u90e8\u57fa\u4e8e <code>as_tool()</code> \u6a21\u5f0f\uff0c\u5b50\u667a\u80fd\u4f53\u5728 TaskGroup \u4e2d\u4e0e\u666e\u901a\u5de5\u5177\u5171\u4eab\u5e76\u884c\u7ba1\u9053\uff09\u548c\u6280\u80fd\u7ba1\u7406\uff08<code>list_skills</code>\u3001<code>get_skill_info</code>\uff09\u3002</p> <p>\u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406\u3002 \u6211\u4eec\u5f15\u5165\u5177\u6709\u53ef\u8bc1\u660e\u632f\u8361\u907f\u514d\u6027\u7684\u53cc\u9608\u503c\u673a\u5236\uff1a</p> <ul> <li>\u8f6f\u9608\u503c\uff08$\\theta_s$\uff09\uff1a\u5f53\u4f30\u8ba1\u4e0a\u4e0b\u6587 token \u8d85\u8fc7 $\\theta_s$ \u65f6\uff0c\u89e6\u53d1\u4e0a\u4e0b\u6587\u538b\u7f29\uff08\u6458\u8981\u8f83\u65e7\u7684\u5de5\u5177\u7ed3\u679c\uff09\u3002\u9ed8\u8ba4\uff1a$\\theta_s = 0.6 \\times (C_w - C_{out})$\uff0c\u5176\u4e2d $C_w$ \u4e3a\u6a21\u578b\u4e0a\u4e0b\u6587\u7a97\u53e3\uff0c$C_{out}$ \u4e3a\u6700\u5927\u8f93\u51fa token\u3002</li> <li>\u786c\u9608\u503c\uff08$\\theta_h$\uff09\uff1a\u5f53 token \u8d85\u8fc7 $\\theta_h$ \u65f6\uff0c\u901a\u8fc7\u4e13\u7528\u63d0\u793a\u5f3a\u5236\u751f\u6210\u56de\u7b54\u3002\u9ed8\u8ba4\uff1a$\\theta_h = 0.8 \\times (C_w - C_{out})$\u3002</li> </ul> <p>\u5b9a\u7406 2\uff08\u632f\u8361\u907f\u514d\uff09\u3002 \u8bbe $C_i$ \u4e3a\u7b2c $i$ \u6b65\u7684\u4e0a\u4e0b\u6587 token \u6570\uff0c$\\Delta_c &gt; 0$ \u4e3a\u538b\u7f29\u64cd\u4f5c\u5e73\u5747\u91ca\u653e\u7684 token \u6570\u3002\u82e5 $\\theta_h - \\theta_s &gt; \\Delta_c$\uff0c\u5219\u7cfb\u7edf\u4e0d\u4f1a\u5728\u538b\u7f29\u548c\u6b63\u5e38\u6267\u884c\u4e4b\u95f4\u632f\u8361\u3002\u5177\u4f53\u5730\uff0c\u5728\u7b2c $i$ \u6b65\u538b\u7f29\u5c06 $C_i$ \u964d\u81f3 $C_i' \\leq \\theta_s$ \u540e\uff0c\u7cfb\u7edf\u5728\u81f3\u5c11 $\\lceil(\\theta_s - C_i' + 1) / \\delta\\rceil$ \u4e2a\u65b0\u6b65\u9aa4\u5185\u4e0d\u4f1a\u518d\u6b21\u89e6\u53d1\u538b\u7f29\uff0c\u5176\u4e2d $\\delta$ \u4e3a\u6bcf\u6b65\u5e73\u5747 token \u589e\u91cf\u3002</p> <p>\u8bc1\u660e\u6982\u8981\u3002 \u538b\u7f29\u540e $C_i' \\leq \\theta_s$\u3002\u6bcf\u4e2a\u540e\u7eed\u6b65\u9aa4\u5e73\u5747\u589e\u52a0 $\\delta$ \u4e2a token\u3002\u538b\u7f29\u4ec5\u5728 $C_j \\geq \\theta_s$ \u65f6\u91cd\u65b0\u89e6\u53d1\uff0c\u9700\u8981\u81f3\u5c11 $(\\theta_s - C_i') / \\delta$ \u6b65\u3002\u7531\u4e8e $\\theta_h - \\theta_s &gt; \\Delta_c$\uff0c\u5728 $\\theta_s$ \u5904\u7684\u538b\u7f29\u603b\u80fd\u5728\u786c\u9650\u5236\u5230\u8fbe\u524d\u5b8c\u6210\u3002$\\square$</p> <p>\u5bf9\u6bd4\u5355\u9608\u503c\u7cfb\u7edf\uff08$\\theta_s = \\theta_h$\uff09\uff1a\u538b\u7f29\u91ca\u653e $\\Delta_c$ \u4e2a token\uff0c\u4e0b\u4e00\u6b21\u5de5\u5177\u8c03\u7528\u589e\u52a0 $\\delta$ \u4e2a token\uff0c\u82e5 $\\delta &gt; \\Delta_c$\uff0c\u7cfb\u7edf\u7acb\u5373\u91cd\u65b0\u89e6\u53d1\u538b\u7f29\u2014\u2014\u8fd9\u662f\u5b9e\u8df5\u4e2d\u89c2\u5bdf\u5230\u7684\u632f\u8361\u6a21\u5f0f\u3002</p> <p>HEARTBEAT \u5f0f\u8fed\u4ee3\u63a7\u5236\u3002 \u53d7 MemGPT \u5fc3\u8df3\u673a\u5236\u542f\u53d1\uff0cDeepAgent \u5728\u591a\u8f6e\u6267\u884c\u671f\u95f4\u4ee5\u53ef\u914d\u7f6e\u95f4\u9694\u6ce8\u5165\u8fed\u4ee3\u68c0\u67e5\u70b9\u63d0\u793a\uff1a</p> <pre><code>\u7b2c {N} \u6b65\u68c0\u67e5\u70b9\uff1a\n- \u4f60\u662f\u5426\u5df2\u5b8c\u5168\u89e3\u51b3\u4e86\u95ee\u9898\uff1f\n- \u4efb\u52a1\u5217\u8868\u4e2d\u662f\u5426\u8fd8\u6709\u5269\u4f59\u4efb\u52a1\uff1f\n- \u4f60\u662f\u5426\u9a8c\u8bc1\u4e86\u4f60\u7684\u4fee\u6539\uff1f\n\u5982\u672a\u5b8c\u6210\uff0c\u8bf7\u7ee7\u7eed\u5de5\u4f5c\u3002\u4e0d\u8981\u8fc7\u65e9\u7ed3\u675f\u4f60\u7684\u56de\u5408\u3002\n</code></pre> <p>\u8fd9\u89e3\u51b3\u4e86\u6a21\u578b\u8fc7\u65e9\u5ba3\u5e03\u4efb\u52a1\u5b8c\u6210\u7684\u5e38\u89c1\u5931\u8d25\u6a21\u5f0f\u3002</p> <p>\u91cd\u590d\u884c\u4e3a\u68c0\u6d4b\u3002 \u6ed1\u52a8\u7a97\u53e3\uff08<code>deque(maxlen=10)</code>\uff09\u8ddf\u8e2a\u6700\u8fd1\u7684\u5de5\u5177\u8c03\u7528\u3002\u5f53\u8fde\u7eed $k$ \u6b21\u8c03\u7528\u76f8\u540c\u5de5\u5177\uff08\u9ed8\u8ba4 $k=3$\uff09\u65f6\uff0c\u8b66\u544a\u63d0\u793a\u91cd\u5b9a\u5411\u667a\u80fd\u4f53\u7b56\u7565\uff0c\u9632\u6b62\u975e\u751f\u4ea7\u6027\u5faa\u73af\u3002</p> <p>\u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u7cfb\u7edf\u3002 \u7ed3\u6784\u5316\u7684\u516d\u9636\u6bb5\u63d0\u793a\u65b9\u6cd5\u8bba\u6307\u5bfc\u6df1\u5165\u8c03\u67e5\uff1a(1) \u95ee\u9898\u5206\u6790\u4e0e\u8ba1\u5212\u5236\u5b9a\uff0c(2) \u8fed\u4ee3\u4fe1\u606f\u6536\u96c6\u4e0e\u663e\u5f0f\u5931\u8d25\u5904\u7406\uff0c(3) \u591a\u6e90\u4ea4\u53c9\u9a8c\u8bc1\uff0c(4) \u7ea6\u675f\u68c0\u67e5\u6e05\u5355\u9a8c\u8bc1\uff0c(5) \u901a\u8fc7\u4ee3\u7801\u6267\u884c\u8fdb\u884c\u8ba1\u7b97\u548c\u64cd\u4f5c\u9a8c\u8bc1\uff0c(6) \u5e26\u5f15\u7528\u8981\u6c42\u7684\u6e05\u6670\u53d9\u8ff0\u3002</p> <p>\u8868 2.3\uff1aDeepAgent \u6df1\u5ea6\u7814\u7a76\u80fd\u529b\u5bf9\u6bd4</p> \u80fd\u529b Agentica DeepAgent OpenAI SDK AutoGen MetaGPT CrewAI \u5185\u7f6e\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c ls/read/write/edit/glob/grep \u65e0 \u65e0 \u65e0 \u65e0 \u5f02\u6b65\u4ee3\u7801\u6267\u884c async subprocess \u65e0 \u6709 \u6709 \u6709 \u5b50 Agent \u59d4\u6d3e task\uff08\u5171\u4eab TaskGroup\uff09 \u65e0 \u6709 \u6709 \u6709 \u6b65\u8fdb\u53cd\u601d \u6bcf N \u6b65 \u65e0 \u65e0 \u65e0 \u65e0 \u4e0a\u4e0b\u6587\u6ea2\u51fa\u7ba1\u7406 \u53cc\u9608\u503c\u6ede\u56de \u65e0 \u65e0 \u65e0 \u65e0 \u91cd\u590d\u884c\u4e3a\u68c0\u6d4b \u6ed1\u52a8\u7a97\u53e3 \u65e0 \u65e0 \u65e0 \u65e0 HEARTBEAT \u5f3a\u5236\u8fed\u4ee3 \u53ef\u914d\u7f6e\u9891\u7387 \u65e0 \u65e0 \u65e0 \u65e0 \u4efb\u52a1\u5217\u8868\u7ba1\u7406 write_todos/read_todos \u65e0 \u65e0 \u65e0 \u6709 \u6280\u80fd\u7cfb\u7edf list_skills/get_skill_info \u65e0 \u65e0 \u65e0 \u65e0"},{"location":"paper_zh/#37","title":"3.7 \u53cc\u5c42\u7ea7\u62a4\u680f\u7cfb\u7edf","text":"<p>Agentica \u5728\u4e24\u4e2a\u7c92\u5ea6\u4e0a\u63d0\u4f9b\u62a4\u680f\uff1a</p> <p>\u667a\u80fd\u4f53\u7ea7\u62a4\u680f\uff08<code>InputGuardrail</code>\u3001<code>OutputGuardrail</code>\uff09\u9a8c\u8bc1\u6574\u4e2a\u667a\u80fd\u4f53\u8fd0\u884c\u7684\u8f93\u5165\u6216\u8f93\u51fa\uff0c\u4f7f\u7528\u88c5\u9970\u5668\u6a21\u5f0f\uff1a</p> <pre><code>@input_guardrail\nasync def check_sensitive_content(context, agent, input_message):\n    # \u9a8c\u8bc1\u903b\u8f91\n    return GuardrailFunctionOutput(output_info={\"safe\": True})\n</code></pre> <p>\u5de5\u5177\u7ea7\u62a4\u680f\uff08<code>ToolInputGuardrail</code>\u3001<code>ToolOutputGuardrail</code>\uff09\u9a8c\u8bc1\u5355\u4e2a\u5de5\u5177\u8c03\u7528\u7684\u53c2\u6570\u548c\u7ed3\u679c\u3002\u8fd9\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u4e3a\u5355\u4e2a\u5de5\u5177\u8c03\u7528\u53ef\u80fd\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\u3001\u6267\u884c\u4ee3\u7801\u6216\u8c03\u7528\u5916\u90e8 API\uff1a</p> <pre><code>@tool_input_guardrail\nasync def validate_file_path(context, agent, tool_input):\n    # \u786e\u4fdd\u6587\u4ef6\u8def\u5f84\u5728\u5141\u8bb8\u76ee\u5f55\u5185\n    return ToolGuardrailFunctionOutput(output_info={\"valid\": True})\n</code></pre> <p>\u4e24\u4e2a\u5c42\u7ea7\u5747\u901a\u8fc7\u7279\u5b9a\u5f02\u5e38\uff08<code>InputGuardrailTripwireTriggered</code>\u3001<code>ToolInputGuardrailTripwireTriggered</code> \u7b49\uff09\u5728\u68c0\u6d4b\u5230\u8fdd\u89c4\u65f6\u7ec8\u6b62\u6267\u884c\u3002</p>"},{"location":"paper_zh/#38","title":"3.8 \u57fa\u4e8e\u6587\u4ef6\u7684\u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6","text":"<p>Agentica \u7684\u6301\u4e45\u8bb0\u5fc6\u4f7f\u7528\u57fa\u4e8e\u6587\u4ef6\u7684\u5de5\u4f5c\u7a7a\u95f4\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>workspace/\n\u251c\u2500\u2500 AGENT.md          # \u667a\u80fd\u4f53\u6307\u4ee4\uff08\u5168\u5c40\uff09\n\u251c\u2500\u2500 PERSONA.md        # \u667a\u80fd\u4f53\u4eba\u683c\uff08\u5168\u5c40\uff09\n\u251c\u2500\u2500 TOOLS.md          # \u5de5\u5177\u6587\u6863\uff08\u5168\u5c40\uff09\n\u251c\u2500\u2500 users/\n\u2502   \u251c\u2500\u2500 default/\n\u2502   \u2502   \u251c\u2500\u2500 USER.md       # \u7528\u6237\u4fe1\u606f\n\u2502   \u2502   \u251c\u2500\u2500 MEMORY.md     # \u957f\u671f\u8bb0\u5fc6\n\u2502   \u2502   \u2514\u2500\u2500 memory/       # \u6bcf\u65e5\u8bb0\u5fc6\u6761\u76ee\n\u2502   \u2514\u2500\u2500 {user_id}/        # \u591a\u7528\u6237\u9694\u79bb\n</code></pre> <p>\u76f8\u6bd4\u6570\u636e\u5e93\u5b58\u50a8\u7684\u8bb0\u5fc6\uff0c\u8be5\u8bbe\u8ba1\u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a - \u53ef\u5ba1\u8ba1\uff1aMarkdown \u6587\u4ef6\u4eba\u7c7b\u53ef\u8bfb\u3001\u53ef\u68c0\u67e5 - \u7248\u672c\u63a7\u5236\uff1a\u6807\u51c6 git \u64cd\u4f5c\u8ffd\u8e2a\u8bb0\u5fc6\u6f14\u53d8 - \u53ef\u79fb\u690d\uff1a\u65e0\u6570\u636e\u5e93\u4f9d\u8d56\uff0c\u9002\u7528\u4e8e\u4efb\u4f55\u6587\u4ef6\u7cfb\u7edf - \u591a\u7528\u6237\u9694\u79bb\uff1a\u6bcf\u4e2a\u7528\u6237\u7684\u6570\u636e\u7269\u7406\u5206\u79bb</p> <p>\u6240\u6709\u8bb0\u5fc6\u64cd\u4f5c\uff08<code>get_context_prompt()</code>\u3001<code>get_memory_prompt()</code>\u3001<code>write_memory()</code>\u3001<code>save_memory()</code>\uff09\u5747\u4e3a\u5f02\u6b65\uff0c\u6587\u4ef6 I/O \u901a\u8fc7 <code>run_in_executor()</code> \u5305\u88c5\u4ee5\u907f\u514d\u963b\u585e\u4e8b\u4ef6\u5faa\u73af\u3002</p>"},{"location":"paper_zh/#39","title":"3.9 \u6a21\u578b\u63d0\u4f9b\u8005\u62bd\u8c61","text":"<p><code>Model</code> \u57fa\u7c7b\u5b9a\u4e49\u56db\u4e2a\u5f02\u6b65\u62bd\u8c61\u65b9\u6cd5\uff1a<code>invoke()</code>\u3001<code>invoke_stream()</code>\u3001<code>response()</code>\u3001<code>response_stream()</code>\u3002\u63d0\u4f9b\u8005\u5b9e\u73b0\u4f7f\u7528 <code>@override</code> \u88c5\u9970\u5668\uff08Python 3.12\uff09\u8868\u8fbe\u663e\u5f0f\u610f\u56fe\uff1a</p> <ul> <li><code>OpenAIChat</code>\uff1a\u539f\u751f\u5f02\u6b65 OpenAI \u5ba2\u6237\u7aef</li> <li><code>Claude</code>\uff1a<code>AsyncAnthropic</code> \u5ba2\u6237\u7aef\uff0c\u539f\u751f\u5f02\u6b65 <code>messages.create()</code> \u548c <code>messages.stream()</code></li> <li><code>OpenAILike</code>\uff1a\u6269\u5c55 <code>OpenAIChat</code> \u652f\u6301\u517c\u5bb9 API\uff08DeepSeek\u3001Qwen\u3001ZhipuAI\u3001Doubao\u3001Moonshot \u7b49\uff09</li> </ul> <p>\u7edf\u4e00\u5f02\u6b65\u63a5\u53e3\u786e\u4fdd\u6240\u6709\u6a21\u578b\u63d0\u4f9b\u8005\u4ece\u6846\u67b6\u89d2\u5ea6\u884c\u4e3a\u4e00\u81f4\uff0c\u5f02\u6b65\u8fb9\u754c\u900f\u660e\u5904\u7406\u3002</p>"},{"location":"paper_zh/#310-mcp-acp","title":"3.10 \u53cc\u534f\u8bae\u5de5\u5177\u751f\u6001\uff1aMCP + ACP","text":"<p>Agentica \u540c\u65f6\u652f\u6301\u4e24\u79cd\u6807\u51c6\u5316\u534f\u8bae\uff0c\u5b9e\u73b0\u8de8\u6846\u67b6\u7684\u5de5\u5177\u4e92\u64cd\u4f5c\u548c IDE \u6df1\u5ea6\u96c6\u6210\uff1a</p> <p>MCP\uff08Model Context Protocol\uff09 \u662f Anthropic \u63d0\u51fa\u7684\u5de5\u5177\u534f\u8bae\u6807\u51c6\uff0cAgentica \u652f\u6301\u5168\u90e8\u4e09\u79cd\u4f20\u8f93\u65b9\u5f0f\uff1aStdio\u3001SSE \u548c StreamableHTTP\u3002\u901a\u8fc7 <code>MCPClient</code> \u5f02\u6b65\u5ba2\u6237\u7aef\uff0cAgent \u53ef\u52a8\u6001\u53d1\u73b0\u548c\u8c03\u7528\u4efb\u610f MCP \u670d\u52a1\u5668\u66b4\u9732\u7684\u5de5\u5177\uff0c\u65e0\u9700\u9884\u5148\u6ce8\u518c\u3002MCP \u5de5\u5177\u5728\u8fd0\u884c\u65f6\u88ab\u81ea\u52a8\u8f6c\u6362\u4e3a Agentica \u7684 <code>Function</code> \u5bf9\u8c61\uff0c\u878d\u5165\u4e09\u5c42\u5de5\u5177\u62bd\u8c61\uff0c\u4e0e\u5185\u7f6e\u5de5\u5177\u5171\u4eab TaskGroup \u5e76\u884c\u6267\u884c\u3002</p> <p>ACP\uff08Agent Communication Protocol\uff09 \u662f\u9762\u5411 IDE \u96c6\u6210\u7684 JSON-RPC over stdio \u534f\u8bae\u3002Agentica \u7684 <code>ACPServer</code> \u5b9e\u73b0\u5b8c\u6574\u7684\u4f1a\u8bdd\u7ba1\u7406\u3001\u5de5\u5177\u8c03\u7528\u4ee3\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c\u548c\u7ec8\u7aef\u547d\u4ee4\u6267\u884c\uff0c\u53ef\u76f4\u63a5\u4f5c\u4e3a IDE \u7f16\u7801\u52a9\u624b\u540e\u7aef\u3002\u5728\u5df2\u8c03\u7814\u7684\u4e3b\u6d41\u6846\u67b6\u4e2d\uff0cAgentica \u662f\u552f\u4e00\u540c\u65f6\u652f\u6301 MCP \u548c ACP \u7684\u6846\u67b6\u3002</p> <p>\u8868 2.5\uff1a\u534f\u8bae\u652f\u6301\u5bf9\u6bd4</p> \u534f\u8bae Agentica OpenAI SDK AutoGen MetaGPT CrewAI MCP\uff08Stdio/SSE/HTTP\uff09 \u5168\u90e8\u652f\u6301 \u4ec5 Stdio \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u90e8\u5206\u652f\u6301 ACP\uff08IDE \u96c6\u6210\uff09 \u5b8c\u6574\u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301 \u4e0d\u652f\u6301"},{"location":"paper_zh/#311-skill","title":"3.11 Skill \u6280\u80fd\u7cfb\u7edf\uff1a\u58f0\u660e\u5f0f\u80fd\u529b\u6269\u5c55","text":"<p>\u53d7 Anthropic Claude Skills \u542f\u53d1\uff0cAgentica \u5f15\u5165\u57fa\u4e8e Markdown \u7684 Skill \u6280\u80fd\u7cfb\u7edf\uff0c\u652f\u6301\u7eaf\u6587\u672c\u7ea7\u7684\u667a\u80fd\u4f53\u80fd\u529b\u6269\u5c55\uff1a</p> <pre><code>---\nname: commit\ndescription: Git commit helper\ntrigger: /commit\nrequires: [git]\nallowed-tools: [shell]\n---\n# Git Commit Skill\nWhen user says /commit, analyze staged changes and generate\nconventional commit message...\n</code></pre> <p>Skill \u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a(1) YAML frontmatter \u5b9a\u4e49\u5143\u6570\u636e\uff08\u540d\u79f0\u3001\u89e6\u53d1\u5668\u3001\u4f9d\u8d56\u5de5\u5177\uff09\uff0c(2) Markdown \u6b63\u6587\u5b9a\u4e49\u884c\u4e3a\u6307\u4ee4\uff0c(3) \u76ee\u5f55\u5c42\u6b21\u5b9a\u4e49\u4f18\u5148\u7ea7\uff08\u9879\u76ee\u7ea7 &gt; \u7528\u6237\u7ea7 &gt; \u5185\u7f6e\uff09\u3002<code>SkillLoader</code> \u5728\u9996\u6b21\u4f7f\u7528\u65f6\u60f0\u6027\u52a0\u8f7d\uff0c<code>SkillRegistry</code> \u901a\u8fc7\u5168\u5c40\u5355\u4f8b\u7ba1\u7406\u6ce8\u518c\u548c\u89e6\u53d1\u5339\u914d\u3002</p> <p>\u8be5\u7cfb\u7edf\u4f7f\u975e\u5f00\u53d1\u8005\u4e5f\u80fd\u901a\u8fc7\u7f16\u8f91 Markdown \u6587\u4ef6\u6269\u5c55\u667a\u80fd\u4f53\u80fd\u529b\uff0c\u65e0\u9700\u7f16\u5199\u4ee3\u7801\u3002\u5728\u5176\u4ed6\u4e3b\u6d41\u6846\u67b6\u4e2d\u672a\u53d1\u73b0\u7c7b\u4f3c\u673a\u5236\u3002DeepAgent \u901a\u8fc7 <code>list_skills</code> \u548c <code>get_skill_info</code> \u5de5\u5177\u5c06\u6280\u80fd\u7cfb\u7edf\u66b4\u9732\u7ed9 LLM\uff0c\u4f7f\u5176\u53ef\u52a8\u6001\u67e5\u8be2\u548c\u4f7f\u7528\u5df2\u6ce8\u518c\u7684\u6280\u80fd\u3002</p>"},{"location":"paper_zh/#312-rag","title":"3.12 RAG \u68c0\u7d22\u589e\u5f3a\u751f\u6210\u57fa\u7840\u8bbe\u65bd","text":"<p>Agentica \u63d0\u4f9b\u5b8c\u6574\u7684 RAG \u57fa\u7840\u8bbe\u65bd\uff0c\u901a\u8fc7 <code>Knowledge</code> \u62bd\u8c61\u7edf\u4e00\u591a\u79cd\u5411\u91cf\u6570\u636e\u5e93\u548c\u5d4c\u5165\u6a21\u578b\uff1a</p> \u7ec4\u4ef6 \u652f\u6301\u9009\u9879 \u5411\u91cf\u6570\u636e\u5e93 ChromaDB\u3001LanceDB\u3001PGVector\u3001Pinecone\u3001Qdrant\u3001\u5185\u5b58\u5411\u91cf\u5e93 Embedding \u6a21\u578b OpenAI\u3001Anthropic\u3001HuggingFace\u3001Sentence Transformers \u7b49 13 \u79cd \u6570\u636e\u5e93\u540e\u7aef SQLite\u3001PostgreSQL\u3001MySQL\u3001Redis\u3001Memory\u3001JSON \u751f\u6001\u9002\u914d LangChain VectorStore \u9002\u914d\u3001LlamaIndex Reader \u9002\u914d <p>Agent \u901a\u8fc7 <code>search_knowledge_base</code> \u5de5\u5177\u81ea\u52a8\u68c0\u7d22\u76f8\u5173\u6587\u6863\u3002\u5411\u91cf\u68c0\u7d22\u64cd\u4f5c\u901a\u8fc7 <code>run_in_executor()</code> \u5f02\u6b65\u5316\uff0c\u4e0e\u5168\u94fe\u8def\u5f02\u6b65\u67b6\u6784\u4fdd\u6301\u4e00\u81f4\u3002\u76f8\u6bd4 OpenAI Agents SDK\uff08\u65e0\u5185\u7f6e RAG\uff09\u548c AutoGen\uff08\u9700\u81ea\u884c\u5b9e\u73b0\uff09\uff0cAgentica \u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684 RAG \u80fd\u529b\u3002</p>"},{"location":"paper_zh/#4","title":"4. \u5b9e\u9a8c\u8bbe\u7f6e","text":""},{"location":"paper_zh/#41","title":"4.1 \u57fa\u51c6\u6d4b\u8bd5","text":"<p>\u6211\u4eec\u5728\u4e09\u4e2a\u4e92\u8865\u7684\u57fa\u51c6\u6d4b\u8bd5\u4e0a\u8bc4\u4f30\u667a\u80fd\u4f53\u4e0d\u540c\u65b9\u9762\u7684\u80fd\u529b\uff1a</p> <p>GAIA\uff08\u901a\u7528 AI \u52a9\u624b\uff09\u3002\u4f7f\u7528 165 \u9898\u516c\u5f00\u9a8c\u8bc1\u96c6\u3002\u4efb\u52a1\u9700\u8981\u591a\u6b65\u63a8\u7406\u3001\u7f51\u7edc\u641c\u7d22\u3001\u6587\u4ef6\u89e3\u6790\u3001\u4ee3\u7801\u6267\u884c\u548c\u591a\u6a21\u6001\u7406\u89e3\u3002\u8bc4\u4f30\u4f7f\u7528\u786e\u5b9a\u6027\u7b54\u6848\u7684\u7cbe\u786e\u5339\u914d\u3002</p> <p>SWE-bench Verified\u3002\u4f7f\u7528 500 \u4e2a\u4eba\u5de5\u9a8c\u8bc1\u5b50\u96c6\u3002\u6bcf\u4e2a\u4efb\u52a1\u9700\u8981\u751f\u6210\u4ee3\u7801\u8865\u4e01\u89e3\u51b3\u771f\u5b9e GitHub issue \u5e76\u901a\u8fc7\u4ed3\u5e93\u6d4b\u8bd5\u5957\u4ef6\u3002\u8bc4\u4f30\u4f7f\u7528\u89e3\u51b3\u7387\uff08\u8865\u4e01\u901a\u8fc7\u6240\u6709\u76f8\u5173\u6d4b\u8bd5\u7684\u4efb\u52a1\u767e\u5206\u6bd4\uff09\u3002</p> <p>Terminal-Bench 2.0\u300289 \u4e2a\u5728 Docker \u7ec8\u7aef\u73af\u5883\u4e2d\u6267\u884c\u7684\u4efb\u52a1\uff0c\u6db5\u76d6\u8f6f\u4ef6\u5de5\u7a0b\u3001\u8ba1\u7b97\u3001ML/AI\u3001\u7f51\u7edc\u5b89\u5168\u548c\u7cfb\u7edf\u7ba1\u7406\u3002\u6bcf\u914d\u7f6e\u8fd0\u884c 5 \u6b21\uff0c\u62a5\u544a\u89e3\u51b3\u7387\u53ca 95% \u7f6e\u4fe1\u533a\u95f4\u3002</p>"},{"location":"paper_zh/#42","title":"4.2 \u57fa\u7ebf\u7cfb\u7edf","text":"<p>\u4e0e\u4ee5\u4e0b\u667a\u80fd\u4f53\u7cfb\u7edf\u5bf9\u6bd4\uff1a</p> \u7cfb\u7edf \u6846\u67b6\u7c7b\u578b \u5173\u952e\u7279\u6027 OpenAI Agents SDK + GPT-4o \u5546\u4e1a\u6846\u67b6 \u57fa\u4e8e handoff \u7684\u534f\u8c03\uff0c\u6258\u7ba1\u5de5\u5177 MetaGPT SOP \u9a71\u52a8\u6d41\u6c34\u7ebf ICLR 2024 Oral\uff0c\u7ed3\u6784\u5316\u901a\u4fe1 AutoGen v0.4 Actor \u5f02\u6b65 \u591a\u667a\u80fd\u4f53\u5bf9\u8bdd\uff0c\u5206\u5e03\u5f0f\u8fd0\u884c\u65f6 OpenHands CodeAct \u6846\u67b6 \u7edf\u4e00\u4ee3\u7801\u52a8\u4f5c\u7a7a\u95f4\uff0cDocker \u6c99\u7bb1 Terminus 2 \u4e2d\u7acb\u811a\u624b\u67b6 \u65e0\u5934\u7ec8\u7aef\u5de5\u5177\uff0cTerminal-Bench \u4f7f\u7528 <p>\u4e3a\u516c\u5e73\u5bf9\u6bd4\uff0c\u6240\u6709\u914d\u7f6e\u5c3d\u53ef\u80fd\u4f7f\u7528\u76f8\u540c\u5e95\u5c42 LLM\u3002</p>"},{"location":"paper_zh/#43","title":"4.3 \u914d\u7f6e","text":"<p>\u8bc4\u4f30\u4e24\u79cd Agentica \u914d\u7f6e\uff1a</p> <ol> <li>Agentica-Base\uff1a\u6807\u51c6 <code>Agent</code> + \u7528\u6237\u63d0\u4f9b\u5de5\u5177\u3002\u6d4b\u8bd5\u6838\u5fc3\u5f02\u6b65\u4f18\u5148\u6267\u884c\u5f15\u64ce\u548c\u7ed3\u6784\u5316\u5e76\u53d1\u3002</li> <li>Agentica-Deep\uff1a<code>DeepAgent</code> + \u5185\u7f6e\u5de5\u5177\u3001\u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u3001\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u548c HEARTBEAT \u8fed\u4ee3\u63a7\u5236\u3002\u6d4b\u8bd5\u5b8c\u6574\u6df1\u5ea6\u7814\u7a76\u6d41\u6c34\u7ebf\u3002</li> </ol>"},{"location":"paper_zh/#44","title":"4.4 \u6d88\u878d\u5b9e\u9a8c","text":"<p>\u4e3a\u9694\u79bb\u5404\u67b6\u6784\u7ec4\u4ef6\u7684\u8d21\u732e\uff1a</p> \u6d88\u878d\u9879 \u79fb\u9664/\u53d8\u66f4\u5185\u5bb9 <code>-TaskGroup</code> \u5c06 <code>asyncio.TaskGroup</code> \u66ff\u6362\u4e3a\u987a\u5e8f\u5de5\u5177\u6267\u884c <code>-DualThreshold</code> \u79fb\u9664\u4e0a\u4e0b\u6587\u7ba1\u7406\uff08\u65e0\u8f6f/\u786c\u9650\u5236\uff09 <code>-HEARTBEAT</code> \u79fb\u9664\u8fed\u4ee3\u68c0\u67e5\u70b9\u63d0\u793a <code>-DeepPrompt</code> \u5c06\u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u66ff\u6362\u4e3a\u6807\u51c6\u63d0\u793a <code>-ToolGuardrails</code> \u79fb\u9664\u5de5\u5177\u7ea7\u62a4\u680f\uff08\u4fdd\u7559\u667a\u80fd\u4f53\u7ea7\uff09 <code>-AgentAsSession</code> \u66ff\u6362\u4e3a\u5916\u90e8\u4f1a\u8bdd\u7ba1\u7406\uff08OpenAI SDK \u6a21\u5f0f\uff09"},{"location":"paper_zh/#45","title":"4.5 \u53c2\u6570\u654f\u611f\u6027\u5206\u6790","text":"<p>\u4ee5\u4e0b\u7f51\u683c\u5206\u6790\u53cc\u9608\u503c\u53c2\u6570\u654f\u611f\u6027\uff1a</p> \u53c2\u6570 \u6d4b\u8bd5\u503c \u8f6f\u9608\u503c $\\theta_s$ 0.4, 0.5, 0.6, 0.7\uff08\u00d7 \u6709\u6548\u4e0a\u4e0b\u6587\uff09 \u786c\u9608\u503c $\\theta_h$ 0.7, 0.8, 0.9\uff08\u00d7 \u6709\u6548\u4e0a\u4e0b\u6587\uff09 HEARTBEAT \u9891\u7387 3, 5, 7, 10\uff08\u6b65\uff09 \u91cd\u590d\u7a97\u53e3 $k$ 2, 3, 5\uff08\u8fde\u7eed\u8c03\u7528\uff09 <p>\u7ea6\u675f\uff1a\u6240\u6709\u914d\u7f6e\u4e2d $\\theta_s &lt; \\theta_h$\u3002</p>"},{"location":"paper_zh/#46","title":"4.6 \u7edf\u8ba1\u663e\u8457\u6027","text":"<p>\u6240\u6709\u7ed3\u679c\u62a5\u544a 95% \u7f6e\u4fe1\u533a\u95f4\u3002GAIA \u548c SWE-bench \u4f7f\u7528 3 \u6b21\u72ec\u7acb\u8fd0\u884c\uff08\u4e0d\u540c\u968f\u673a\u79cd\u5b50\uff09\uff0c\u62a5\u544a Wilson \u5f97\u5206\u533a\u95f4\u3002Terminal-Bench \u9075\u5faa\u57fa\u51c6\u534f\u8bae\uff0c\u6bcf\u914d\u7f6e 5 \u6b21\u8fd0\u884c\uff0c\u4f7f\u7528 bootstrap \u7f6e\u4fe1\u533a\u95f4\u3002</p>"},{"location":"paper_zh/#5","title":"5. \u5b9e\u9a8c\u7ed3\u679c","text":""},{"location":"paper_zh/#51","title":"5.1 \u4e3b\u8981\u7ed3\u679c","text":"<p>\u8868 3\uff1aGAIA \u57fa\u51c6\u7ed3\u679c\uff08165 \u4e2a\u9a8c\u8bc1\u4efb\u52a1\uff09</p> \u7cfb\u7edf Level 1 Level 2 Level 3 \u5e73\u5747 Agentica-Deep <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Agentica-Base <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> OpenAI Agents SDK + GPT-4o <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> MetaGPT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> AutoGen v0.4 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u4eba\u7c7b\u57fa\u7ebf ~95% ~92% ~88% ~92% <p>\u8868 4\uff1aSWE-bench Verified \u7ed3\u679c\uff08500 \u4e2a\u4efb\u52a1\uff09</p> \u7cfb\u7edf \u89e3\u51b3\u7387 Agentica-Deep <code>[TODO]</code> Agentica-Base <code>[TODO]</code> OpenHands <code>[TODO]</code> AutoGen v0.4 <code>[TODO]</code> \u88f8\u6a21\u578b\uff08\u65e0\u6846\u67b6\uff09 <code>[TODO]</code> <p>\u8868 5\uff1aTerminal-Bench 2.0 \u7ed3\u679c\uff0889 \u4e2a\u4efb\u52a1\uff0c\u6bcf\u914d\u7f6e 5 \u6b21\uff09</p> \u7cfb\u7edf \u89e3\u51b3\u7387\uff08\u00b195% CI\uff09 Agentica-Deep <code>[TODO]</code> \u00b1 <code>[TODO]</code> Agentica-Base <code>[TODO]</code> \u00b1 <code>[TODO]</code> Terminus 2\uff08\u76f8\u540c\u6a21\u578b\uff09 <code>[TODO]</code> \u00b1 <code>[TODO]</code> OpenHands\uff08\u76f8\u540c\u6a21\u578b\uff09 <code>[TODO]</code> \u00b1 <code>[TODO]</code> Claude Code\uff08\u76f8\u540c\u6a21\u578b\uff09 <code>[TODO]</code> \u00b1 <code>[TODO]</code>"},{"location":"paper_zh/#52","title":"5.2 \u7ed3\u6784\u5316\u5e76\u53d1\u52a0\u901f","text":"<p>\u8868 6\uff1aTaskGroup \u5e76\u884c vs \u987a\u5e8f\u5de5\u5177\u6267\u884c\u7684\u65f6\u949f\u65f6\u95f4\u5bf9\u6bd4</p> \u57fa\u51c6\u6d4b\u8bd5 \u5e73\u5747\u5de5\u5177\u6570/\u8f6e \u987a\u5e8f\uff08\u79d2\uff09 \u5e76\u884c\uff08\u79d2\uff09 \u52a0\u901f\u6bd4 GAIA <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7 SWE-bench <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7 Terminal-Bench <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>\u00d7"},{"location":"paper_zh/#53","title":"5.3 \u6d88\u878d\u5b9e\u9a8c","text":"<p>\u8868 7\uff1aGAIA\uff08Level 2+3\uff09\u548c Terminal-Bench \u6d88\u878d\u7ed3\u679c</p> \u914d\u7f6e GAIA (L2+L3) Terminal-Bench Agentica-Deep\uff08\u5b8c\u6574\uff09 <code>[TODO]</code> <code>[TODO]</code> \u2212 TaskGroup <code>[TODO]</code> <code>[TODO]</code> \u2212 DualThreshold <code>[TODO]</code> <code>[TODO]</code> \u2212 HEARTBEAT <code>[TODO]</code> <code>[TODO]</code> \u2212 DeepPrompt <code>[TODO]</code> <code>[TODO]</code> \u2212 ToolGuardrails <code>[TODO]</code> <code>[TODO]</code> \u2212 AgentAsSession <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper_zh/#54","title":"5.4 \u53c2\u6570\u654f\u611f\u6027\u5206\u6790","text":"<p>\u8868 8\uff1aGAIA Level 2+3 \u4e0a\u53cc\u9608\u503c\u53c2\u6570\u654f\u611f\u6027\uff08\u957f\u7a0b\u4efb\u52a1\uff09</p> $\\theta_s$ $\\theta_h$ \u5b8c\u6210\u7387 \u5f3a\u5236\u7ec8\u6b62\u7387 \u538b\u7f29\u6b21\u6570 0.4 0.7 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.4 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.5 0.7 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.5 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.6 0.8 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.6 0.9 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> 0.7 0.9 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> <p>\u8868 9\uff1aTerminal-Bench \u4e0a HEARTBEAT \u9891\u7387\u654f\u611f\u6027</p> \u68c0\u67e5\u70b9\u9891\u7387 \u89e3\u51b3\u7387 \u8fc7\u65e9\u7ec8\u6b62\u7387 \u5e73\u5747\u6b65\u6570 \u6bcf 3 \u6b65 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u6bcf 5 \u6b65\uff08\u9ed8\u8ba4\uff09 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u6bcf 7 \u6b65 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u6bcf 10 \u6b65 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u65e0 HEARTBEAT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper_zh/#55","title":"5.5 \u4e0a\u4e0b\u6587\u7ba1\u7406\u6548\u679c","text":"<p>\u8868 10\uff1a\u6709/\u65e0\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u7684\u957f\u7a0b\u4efb\u52a1\u5b8c\u6210\u60c5\u51b5</p> \u4e0a\u4e0b\u6587\u7ba1\u7406 \u5df2\u5b8c\u6210\u4efb\u52a1\uff08&gt;10 \u6b21\u5de5\u5177\u8c03\u7528\uff09 \u5b8c\u6210\u65f6\u5e73\u5747\u4e0a\u4e0b\u6587 token \u5f3a\u5236\u7ec8\u6b62\u7387 \u65e0 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u4ec5\u786c\u9608\u503c <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> \u53cc\u9608\u503c\uff08\u672c\u6587\uff09 <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper_zh/#56","title":"5.6 \u6548\u7387\u5206\u6790","text":"<p>\u8868 11\uff1aToken \u6d88\u8017\u4e0e API \u6210\u672c\u5bf9\u6bd4</p> \u7cfb\u7edf \u5e73\u5747 token/\u4efb\u52a1 \u5e73\u5747 API \u8c03\u7528/\u4efb\u52a1 \u5e73\u5747\u6210\u672c/\u4efb\u52a1\uff08$\uff09 Agentica-Deep <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> Agentica-Base <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> OpenAI Agents SDK <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code> MetaGPT <code>[TODO]</code> <code>[TODO]</code> <code>[TODO]</code>"},{"location":"paper_zh/#6","title":"6. \u5206\u6790\u4e0e\u8ba8\u8bba","text":""},{"location":"paper_zh/#61","title":"6.1 \u7ed3\u6784\u5316\u5e76\u53d1\u4f55\u65f6\u6709\u6548\uff1f","text":"<p><code>[TODO: \u5206\u6790\u54ea\u4e9b\u4efb\u52a1\u7c7b\u578b\u4ece\u5e76\u884c\u5de5\u5177\u6267\u884c\u4e2d\u83b7\u76ca\u6700\u591a\u2014\u2014\u53ef\u80fd\u662f\u591a\u4e2a\u72ec\u7acb\u5de5\u5177\u8c03\u7528\u7684 I/O \u5bc6\u96c6\u578b\u4efb\u52a1\uff08\u5982\u540c\u65f6\u8fdb\u884c\u591a\u4e2a\u7f51\u7edc\u641c\u7d22\u3001\u5e76\u884c\u6587\u4ef6\u8bfb\u53d6\uff09\u3002\u5305\u542b\u52a0\u901f\u6bd4\u4f5c\u4e3a\u5e73\u5747\u5de5\u5177\u6570/\u8f6e\u7684\u51fd\u6570\u56fe\u3002\u5c55\u793a\u52a0\u901f\u6bd4\u5bf9 N \u4e2a\u72ec\u7acb I/O \u5bc6\u96c6\u578b\u5de5\u5177\u8d8b\u8fd1 N\u00d7\uff0c\u4e14\u53d7 Amdahl \u5b9a\u5f8b\u7ea6\u675f\u3002\u5305\u542b\u65f6\u949f\u65f6\u95f4\u5206\u5e03\u56fe\u3002]</code></p>"},{"location":"paper_zh/#62-agent-as-session-vs","title":"6.2 Agent-as-Session vs \u5916\u90e8\u4f1a\u8bdd\u7ba1\u7406","text":"<p><code>[TODO: Agent-as-Session \u6a21\u5f0f\u4e0e\u5916\u90e8 session \u6a21\u5f0f\uff08OpenAI SDK \u98ce\u683c\uff09\u7684\u5b9a\u91cf\u5bf9\u6bd4\u3002\u6307\u6807\uff1a(a) \u591a\u8f6e\u8bbe\u7f6e\u6240\u9700\u4ee3\u7801\u884c\u6570\uff0c(b) \u5185\u5b58\u6548\u7387\uff08\u5386\u53f2\u7ec4\u88c5\u7684 token \u4f7f\u7528\uff09\uff0c(c) \u4e0a\u4e0b\u6587\u7ec4\u88c5\u5ef6\u8fdf\uff0c(d) \u9700\u8981\u524d\u8f6e\u4fe1\u606f\u7684 GAIA \u591a\u8f6e\u4efb\u52a1\u6210\u529f\u7387\u3002\u5047\u8bbe\uff1aAgent-as-Session \u5e94\u5c55\u793a\u66f4\u4f4e\u7684\u6837\u677f\u4ee3\u7801\u548c\u76f8\u5f53\u6216\u66f4\u597d\u7684\u591a\u8f6e\u51c6\u786e\u7387\u3002]</code></p>"},{"location":"paper_zh/#63-vs","title":"6.3 \u53cc\u9608\u503c vs \u5355\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406","text":"<p><code>[TODO: \u6ede\u56de\u673a\u5236\u5206\u6790\u2014\u2014\u5c55\u793a\u5355\u9608\u503c\u7cfb\u7edf\u5728\u538b\u7f29\u548c\u6b63\u5e38\u6267\u884c\u4e4b\u95f4\u632f\u8361\uff0c\u800c\u53cc\u9608\u503c\u63d0\u4f9b\u7a33\u5b9a\u884c\u4e3a\u3002\u5305\u542b\u4ee3\u8868\u6027\u957f\u7a0b\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587 token \u8f68\u8ff9\u56fe\u3002\u901a\u8fc7\u6d4b\u91cf\u5355\u9608\u503c\uff08$\\theta_s = \\theta_h$\uff09vs \u53cc\u9608\u503c\u914d\u7f6e\u4e0b\u7684\u538b\u7f29\u89e6\u53d1\u6b21\u6570\u6765\u5b9e\u8bc1\u9a8c\u8bc1\u5b9a\u7406 2\u3002]</code></p>"},{"location":"paper_zh/#64","title":"6.4 \u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u7684\u5f71\u54cd","text":"<p><code>[TODO: \u5b9a\u6027\u5206\u6790\u516d\u9636\u6bb5\u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u5982\u4f55\u5f71\u54cd\u667a\u80fd\u4f53\u884c\u4e3a\u2014\u2014\u662f\u5426\u589e\u52a0\u4e86\u4ea4\u53c9\u9a8c\u8bc1\u5c1d\u8bd5\uff1f\u662f\u5426\u51cf\u5c11\u4e86\u5f15\u7528\u6e90\u4e2d\u7684\u5e7b\u89c9\uff1f\u5bf9\u6bd4\u6807\u51c6\u63d0\u793a\u548c\u6df1\u5ea6\u7814\u7a76\u63d0\u793a\u7684\u5f15\u7528\u51c6\u786e\u7387\u3002\u5305\u542b\u7279\u5b9a GAIA \u4efb\u52a1\u7684\u884c\u4e3a\u5dee\u5f02\u793a\u4f8b\u3002]</code></p>"},{"location":"paper_zh/#65","title":"6.5 \u9519\u8bef\u5206\u6790","text":"<p><code>[TODO: \u8de8\u57fa\u51c6\u6d4b\u8bd5\u7684\u5931\u8d25\u6a21\u5f0f\u5b9a\u91cf\u5206\u7c7b\uff1a - \u5de5\u5177\u6267\u884c\u5931\u8d25\uff08\u8d85\u65f6\u3001\u6743\u9650\u3001\u7f51\u7edc\uff09\uff1a\u5360\u5931\u8d25\u7684 X% - \u4e0a\u4e0b\u6587\u6ea2\u51fa\uff08\u56e0 token \u9650\u5236\u653e\u5f03\u4efb\u52a1\uff09\uff1aX% - \u91cd\u590d\u884c\u4e3a\uff08\u667a\u80fd\u4f53\u9677\u5165\u5faa\u73af\uff09\uff1aX% - \u63a8\u7406\u9519\u8bef\uff08\u4fe1\u606f\u5145\u5206\u4f46\u65b9\u6cd5\u9519\u8bef\uff09\uff1aX% - \u8fc7\u65e9\u7ec8\u6b62\uff08\u667a\u80fd\u4f53\u5728\u5b8c\u6210\u524d\u5ba3\u5e03\u5b8c\u6210\uff09\uff1aX% \u5305\u542b\u9010\u57fa\u51c6\u5206\u89e3\u548c Agentica \u5404\u529f\u80fd\u89e3\u51b3\u54ea\u4e9b\u5931\u8d25\u6a21\u5f0f\u7684\u5206\u6790\u3002]</code></p>"},{"location":"paper_zh/#66","title":"6.6 \u6848\u4f8b\u7814\u7a76","text":"<p><code>[TODO: \u5305\u542b 2-3 \u4e2a\u8be6\u7ec6\u6848\u4f8b\u7814\u7a76\uff0c\u5c55\u793a\u9010\u6b65\u6267\u884c\u8f68\u8ff9\uff1a 1. \u4e00\u4e2a GAIA Level 3 \u4efb\u52a1\u5c55\u793a\u7ed3\u6784\u5316\u5e76\u53d1\u6536\u76ca\uff08\u591a\u4e2a\u5e76\u884c\u7f51\u7edc\u641c\u7d22\uff09 2. \u4e00\u4e2a Terminal-Bench \u4efb\u52a1\u5c55\u793a\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u5b9e\u9645\u8fd0\u4f5c\uff08\u89e6\u53d1\u538b\u7f29\u540e\u6210\u529f\u5b8c\u6210\uff09 3. \u4e00\u4e2a SWE-bench \u4efb\u52a1\u5c55\u793a HEARTBEAT \u8fed\u4ee3\u63a7\u5236\u5982\u4f55\u9632\u6b62\u8fc7\u65e9\u7ec8\u6b62 \u5bf9\u6bcf\u4e2a\u6848\u4f8b\uff0c\u5c55\u793a\u6267\u884c\u65f6\u95f4\u7ebf\u3001\u5de5\u5177\u8c03\u7528\u3001\u4e0a\u4e0b\u6587 token \u8f68\u8ff9\u548c\u4e0e\u57fa\u7ebf\u7cfb\u7edf\u5bf9\u6bd4\u7684\u6700\u7ec8\u7ed3\u679c\u3002]</code></p>"},{"location":"paper_zh/#67","title":"6.7 \u5c40\u9650\u6027","text":"<p>\u6211\u4eec\u627f\u8ba4\u4ee5\u4e0b\u5c40\u9650\uff1a</p> <ol> <li> <p>Python \u7248\u672c\u8981\u6c42\uff1aAgentica \u8981\u6c42 Python 3.12+\uff0c\u9650\u5236\u4e86\u65e7\u7248 Python \u73af\u5883\u7684\u4f7f\u7528\u3002\u7ed3\u6784\u5316\u5e76\u53d1\u9700\u8981 <code>asyncio.TaskGroup</code>\uff08Python 3.11+\uff09\uff0c<code>@override</code> \u88c5\u9970\u5668\u9700\u8981 Python 3.12\u3002</p> </li> <li> <p>\u57fa\u51c6\u8986\u76d6\u8303\u56f4\uff1a\u8bc4\u4f30\u805a\u7126\u4e09\u4e2a\u57fa\u51c6\u3002\u5728\u9886\u57df\u7279\u5b9a\u57fa\u51c6\uff08\u5982 xbench-DeepSearch \u8bc4\u4f30\u7814\u7a76\u8d28\u91cf\u3001WebArena \u8bc4\u4f30\u7f51\u9875\u5bfc\u822a\uff09\u4e0a\u7684\u989d\u5916\u8bc4\u4f30\u5c06\u63d0\u4f9b\u66f4\u5168\u9762\u7684\u56fe\u666f\u3002</p> </li> <li> <p>\u6a21\u578b\u4f9d\u8d56\u6027\uff1a\u4e0e\u6240\u6709\u667a\u80fd\u4f53\u6846\u67b6\u4e00\u6837\uff0c\u6027\u80fd\u6839\u672c\u4e0a\u53d7\u9650\u4e8e\u5e95\u5c42 LLM \u80fd\u529b\u3002\u6211\u4eec\u7684\u67b6\u6784\u8d21\u732e\u6539\u5584\u6548\u7387\u548c\u53ef\u9760\u6027\uff0c\u4f46\u65e0\u6cd5\u5f25\u8865\u6839\u672c\u6027\u7684\u63a8\u7406\u5c40\u9650\u3002</p> </li> <li> <p>\u65e0\u6b63\u5f0f SOP \u652f\u6301\uff1a\u4e0d\u540c\u4e8e MetaGPT \u7684 SOP-as-Prompt \u8303\u5f0f\uff0cAgentica \u4e0d\u7f16\u7801\u9886\u57df\u7279\u5b9a\u6807\u51c6\u64cd\u4f5c\u6d41\u7a0b\u3002\u5bf9\u4e8e\u9ad8\u5ea6\u7ed3\u6784\u5316\u7684\u5de5\u4f5c\u6d41\uff08\u5982\u8f6f\u4ef6\u5f00\u53d1\u751f\u547d\u5468\u671f\uff09\uff0cMetaGPT \u7684\u65b9\u6cd5\u53ef\u80fd\u66f4\u5408\u9002\u3002</p> </li> </ol>"},{"location":"paper_zh/#7","title":"7. \u7ed3\u8bba","text":"<p>\u672c\u6587\u63d0\u51fa Agentica\uff0c\u4e00\u4e2a\u5168\u94fe\u8def\u5f02\u6b65\u4f18\u5148\u667a\u80fd\u4f53\u6846\u67b6\uff0c\u5f15\u5165\u4ee5\u4e0b\u67b6\u6784\u521b\u65b0\uff1a(1) \u57fa\u4e8e <code>asyncio.TaskGroup</code> \u7684\u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c\uff0c\u5177\u6709\u5f62\u5f0f\u5316\u8bc1\u660e\u7684\u90e8\u5206\u6545\u969c\u9694\u79bb\u4fdd\u8bc1\uff0c\u5b50\u667a\u80fd\u4f53\u4e0e\u666e\u901a\u5de5\u5177\u5171\u4eab\u540c\u4e00\u5e76\u884c\u7ba1\u9053\uff08Agent-as-Tool\uff09\uff1b(2) \u5e26\u5185\u5b58\u5b89\u5168\u5f31\u5f15\u7528\u7684\u4e09\u5c42\u5de5\u5177\u62bd\u8c61\uff1b(3) Agent-as-Session \u7edf\u4e00\u72b6\u6001\u6a21\u578b\uff0c\u5c06 token \u611f\u77e5\u7684\u4f1a\u8bdd\u7ba1\u7406\u76f4\u63a5\u5d4c\u5165\u667a\u80fd\u4f53\uff1b(4) \u5177\u6709\u53ef\u8bc1\u660e\u632f\u8361\u907f\u514d\u6027\u7684\u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406\uff1b(5) \u667a\u80fd\u4f53\u548c\u5de5\u5177\u64cd\u4f5c\u7684\u53cc\u5c42\u7ea7\u62a4\u680f\uff1b(6) \u652f\u6301\u591a\u7528\u6237\u9694\u79bb\u7684\u57fa\u4e8e\u6587\u4ef6\u7684\u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6\u3002\u6b64\u5916\uff0c\u6846\u67b6\u63d0\u4f9b MCP + ACP \u53cc\u534f\u8bae\u5de5\u5177\u751f\u6001\u3001\u58f0\u660e\u5f0f Markdown Skill \u6280\u80fd\u7cfb\u7edf\u548c\u5b8c\u6574 RAG \u57fa\u7840\u8bbe\u65bd\uff0c\u6784\u6210\u9762\u5411\u751f\u4ea7\u73af\u5883\u7684\u5b8c\u6574\u667a\u80fd\u4f53\u5f00\u53d1\u5e73\u53f0\u3002</p> <p>\u5728\u4e09\u4e2a\u57fa\u51c6\u6d4b\u8bd5\u2014\u2014GAIA\u3001SWE-bench Verified \u548c Terminal-Bench \u4e0a\u7684\u8bc4\u4f30\u8868\u660e\uff0c\u6846\u67b6\u5c42\u9762\u7684\u67b6\u6784\u51b3\u7b56\u663e\u8457\u5f71\u54cd\u667a\u80fd\u4f53\u6027\u80fd\u3002<code>[TODO: \u603b\u7ed3\u5173\u952e\u5b9a\u91cf\u53d1\u73b0\u3002]</code> \u7ed3\u6784\u5316\u5e76\u53d1\u5728\u591a\u5de5\u5177\u4efb\u52a1\u4e0a\u63d0\u4f9b <code>[TODO]</code> \u52a0\u901f\uff0c\u53cc\u9608\u503c\u4e0a\u4e0b\u6587\u7ba1\u7406\u5c06\u957f\u7a0b\u4efb\u52a1\u5b8c\u6210\u7387\u63d0\u5347 <code>[TODO]</code>\uff0cAgent-as-Session \u6a21\u5f0f\u5728\u4fdd\u6301\u7ade\u4e89\u529b\u51c6\u786e\u7387\u7684\u540c\u65f6\u964d\u4f4e\u4e86\u591a\u8f6e\u7ba1\u7406\u590d\u6742\u5ea6\u3002</p> <p>\u8fd9\u4e9b\u7ed3\u679c\u652f\u6301\u4e00\u4e2a\u66f4\u5e7f\u6cdb\u7684\u89c2\u5bdf\uff1a\u667a\u80fd\u4f53\u811a\u624b\u67b6\u8bbe\u8ba1\u4e0e\u6a21\u578b\u80fd\u529b\u540c\u7b49\u91cd\u8981\u2014\u2014\u8fd9\u4e0e\u8fd1\u671f SWE-bench \u7ed3\u679c\u4e00\u81f4\uff0c\u6846\u67b6\u589e\u5f3a\u7684\u667a\u80fd\u4f53\u6bd4\u88f8\u6a21\u578b\u9ad8 10-20%\uff08JoyCode Agent 74.6% vs Claude 3.7 Sonnet 70.3%\uff09\u3002\u6b64\u5916\uff0c\u5f62\u5f0f\u5316\u5206\u6790\uff08\u5b9a\u7406 1-2\uff09\u4e3a\u667a\u80fd\u4f53\u6846\u67b6\u793e\u533a\u4e2d\u5e38\u51ed\u542f\u53d1\u5f0f\u505a\u51fa\u7684\u8bbe\u8ba1\u9009\u62e9\u63d0\u4f9b\u4e86\u7406\u8bba\u57fa\u7840\u3002</p> <p>\u672a\u6765\u5de5\u4f5c\u5305\u62ec\uff1a(1) \u5c06\u7ed3\u6784\u5316\u5e76\u53d1\u6a21\u578b\u6269\u5c55\u5230\u5177\u6709\u4f9d\u8d56\u611f\u77e5\u8c03\u5ea6\u7684\u591a\u667a\u80fd\u4f53\u5e76\u884c\u6267\u884c\uff0c(2) \u57fa\u4e8e\u4efb\u52a1\u590d\u6742\u5ea6\u4f30\u8ba1\u7684\u81ea\u9002\u5e94\u9608\u503c\u8c03\u4f18\uff08\u7528\u5b66\u4e60\u5230\u7684\u9608\u503c\u66ff\u4ee3\u9759\u6001 $\\theta_s, \\theta_h$\uff09\uff0c(3) \u5c06\u68c0\u7d22\u589e\u5f3a\u751f\u6210\u96c6\u6210\u5230\u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6\u7cfb\u7edf\uff0c(4) \u901a\u8fc7\u8f7b\u91cf\u7ea7\u667a\u80fd\u4f53\u514b\u9686\u8fdb\u884c\u6295\u673a\u5f0f\u5e76\u884c\u5047\u8bbe\u8bc4\u4f30\uff0c(5) \u5728\u66f4\u591a\u9886\u57df\u7279\u5b9a\u57fa\u51c6\uff08WebArena\u3001xbench-DeepSearch\uff09\u4e0a\u8bc4\u4f30\u3002</p>"},{"location":"paper_zh/#_2","title":"\u53c2\u8003\u6587\u732e","text":"<p>Hong, S., Zhuge, M., Chen, J., et al. (2023). MetaGPT: Meta Programming for A Multi-Agent Collaborative Framework. ICLR 2024 (Oral). arXiv:2308.00352.</p> <p>Jimenez, C.E., Yang, J., Wettig, A., et al. (2024). SWE-bench: Can Language Models Resolve Real-World GitHub Issues? ICLR 2024. arXiv:2310.06770.</p> <p>Merrill, M.A., Shaw, A.G., Carlini, N., et al. (2026). Terminal-Bench: Benchmarking Agents on Hard, Realistic Tasks in Command Line Interfaces. arXiv:2601.11868.</p> <p>Mialon, G., Fourrier, C., Swift, C., Wolf, T., LeCun, Y., &amp; Scialom, T. (2023). GAIA: A Benchmark for General AI Assistants. arXiv:2311.12983.</p> <p>OpenAI. (2025). New Tools for Building Agents. https://openai.com/index/new-tools-for-building-agents/.</p> <p>Packer, C., Wooders, S., Lin, K., et al. (2023). MemGPT: Towards LLMs as Operating Systems. arXiv:2310.08560.</p> <p>Smith, N., Garrett, A., &amp; Calvert, B. (2022). PEP 654 \u2014 Exception Groups and except*. Python Enhancement Proposals.</p> <p>Wang, R., et al. (2025). Deep Research: A Survey. arXiv:2512.02038.</p> <p>Wu, Q., Bansal, G., Zhang, J., et al. (2023). AutoGen: Enabling Next-Gen LLM Applications via Multi-Agent Conversation. arXiv:2308.08155.</p> <p>Xu, R., &amp; Peng, J. (2025). A Comprehensive Survey of Deep Research: Systems, Methodologies, and Applications. arXiv:2506.12594.</p> <p>Yang, J., Jimenez, C.E., Wettig, A., et al. (2024). SWE-agent: Agent-Computer Interfaces Enable Automated Software Engineering. arXiv:2405.15793.</p> <p>Yao, S., Zhao, J., Yu, D., et al. (2023). ReAct: Synergizing Reasoning and Acting in Language Models. ICLR 2023. arXiv:2210.03629.</p>"},{"location":"paper_zh/#adeepagent","title":"\u9644\u5f55 A\uff1aDeepAgent \u6df1\u5ea6\u7814\u7a76\u63d0\u793a","text":"<p>\u5b8c\u6574\u6df1\u5ea6\u7814\u7a76\u7cfb\u7edf\u63d0\u793a\u89c1\u8865\u5145\u6750\u6599\u3002\u5173\u952e\u9636\u6bb5\uff1a</p> <ol> <li>\u542f\u52a8\u8c03\u67e5\uff1a\u5206\u6790\u95ee\u9898\uff0c\u8bc6\u522b\u5173\u952e\u4fe1\u606f\u70b9\uff0c\u4f7f\u7528\u4efb\u52a1\u7ba1\u7406\u5de5\u5177\u5236\u5b9a\u8c03\u67e5\u8ba1\u5212\u3002</li> <li>\u8fed\u4ee3\u4fe1\u606f\u6536\u96c6\u4e0e\u53cd\u601d\uff1a\u663e\u5f0f\u5904\u7406\u641c\u7d22\u5931\u8d25\uff0c\u8bc4\u4f30\u4fe1\u606f\u5145\u5206\u6027\uff0c\u8ffd\u6c42\u6df1\u5ea6\uff0c\u8003\u8651\u6765\u6e90\u53ef\u9760\u6027\u3002</li> <li>\u591a\u6e90\u4ea4\u53c9\u9a8c\u8bc1\uff1a\u4f7f\u7528\u4e0d\u540c\u5de5\u5177/\u6765\u6e90\u9a8c\u8bc1\u5173\u952e\u58f0\u660e\uff1b\u5728\u56e0\u6709\u6548\u6027\u5207\u6362\u5de5\u5177\u65f6\u663e\u5f0f\u8bf4\u660e\u3002</li> <li>\u7ea6\u675f\u68c0\u67e5\u6e05\u5355\uff1a\u7efc\u5408\u524d\u5ba1\u67e5\u6240\u6709\u7ea6\u675f\u5e76\u786e\u8ba4\u8986\u76d6\u3002</li> <li>\u8ba1\u7b97\u4e0e\u64cd\u4f5c\u9a8c\u8bc1\uff1a\u6700\u7ec8\u786e\u5b9a\u524d\u901a\u8fc7\u4ee3\u7801\u6267\u884c\u9a8c\u8bc1\u6240\u6709\u8ba1\u7b97\u3002</li> <li>\u6e05\u6670\u53d9\u8ff0\uff1a\u89e3\u91ca\u5de5\u5177\u8c03\u7528\u539f\u56e0\u3001\u9884\u671f\u7ed3\u679c\u3001\u5b9e\u9645\u7ed3\u679c\u548c\u4e0b\u4e00\u6b65\u3002</li> </ol>"},{"location":"paper_zh/#bterminal-bench","title":"\u9644\u5f55 B\uff1aTerminal-Bench \u4efb\u52a1\u5206\u5e03","text":"<p>Terminal-Bench 2.0 \u5305\u542b 89 \u4e2a\u4efb\u52a1\uff0c\u5206\u5e03\u5982\u4e0b\uff1a</p> \u7c7b\u522b \u5360\u6bd4 \u793a\u4f8b\u4efb\u52a1 \u8f6f\u4ef6\u5de5\u7a0b 32.6% build-linux-kernel-qemu, fix-ocaml-gc, build-pov-ray \u8ba1\u7b97 21.3% regex-chess, chess-best-move, gpt2-codegolf ML/AI/\u6570\u636e\u79d1\u5b66 11.2% train-fasttext, caffe-cifar-10, mcmc-sampling-stan \u901a\u7528 SE 11.2% financial-document-processor, reshard-c4-data \u7f51\u7edc\u5b89\u5168 9.0% crack-7z-hash, feal-differential-cryptanalysis DevOps/\u4e91 4.5% configure-git-webserver, nginx-request-logging \u4e2a\u4eba\u52a9\u624b 3.4% \u5404\u7c7b\u4e2a\u4eba\u751f\u4ea7\u529b\u4efb\u52a1 \u89c6\u9891\u5904\u7406 2.2% \u89c6\u9891\u64cd\u4f5c\u548c\u8f6c\u6362\u4efb\u52a1 <p>\u5f53\u524d\u6392\u884c\u699c\uff08\u524d 5\uff0c\u622a\u81f3 2026 \u5e74 2 \u6708\uff09\uff1a</p> \u6392\u540d Agent \u6a21\u578b \u51c6\u786e\u7387 1 Simple Codex GPT-5.3-Codex 75.1% 2 CodeBrain-1 GPT-5.3-Codex 70.3% 3 Droid Claude Opus 4.6 69.9% 4 Mux GPT-5.3-Codex 68.5% 5 Deep Agents GPT-5.2-Codex 66.5%"},{"location":"paper_zh/#c","title":"\u9644\u5f55 C\uff1a\u53ef\u590d\u73b0\u6027","text":"<p>\u6240\u6709\u4ee3\u7801\u53ef\u5728 <code>[TODO: GitHub URL]</code> \u83b7\u53d6\u3002\u5b9e\u9a8c\u73af\u5883\uff1a - Python 3.12+ - Docker\uff08Terminal-Bench \u548c SWE-bench \u73af\u5883\uff09 - GAIA \u9a8c\u8bc1\u96c6\u6765\u81ea HuggingFace - \u6240\u6709\u57fa\u51c6\u8fd0\u884c\u7684\u914d\u7f6e\u6587\u4ef6\u5305\u542b\u5728\u4ed3\u5e93\u4e2d</p> <p>\u590d\u73b0 Terminal-Bench \u7ed3\u679c\uff1a <pre><code>pip install terminal-bench\ntb run --agent agentica --model [MODEL] \\\n    --dataset-name terminal-bench-core \\\n    --dataset-version 2.0 --n-concurrent 8\n</code></pre></p>"},{"location":"paper_zh/#d","title":"\u9644\u5f55 D\uff1a\u6539\u8fdb\u65b9\u5411\u4e0e\u8bba\u6587\u521b\u65b0\u6027\u5206\u6790","text":"<p>\u672c\u9644\u5f55\u8bb0\u5f55\u4e86\u6846\u67b6\u5f53\u524d\u9700\u8981\u6539\u8fdb\u7684\u5730\u65b9\u3001Benchmark \u6548\u679c\u63d0\u5347\u7684\u5177\u4f53\u7b56\u7565\uff0c\u4ee5\u53ca\u8bba\u6587\u521b\u65b0\u6027\u7684\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u4f9b\u540e\u7eed\u5b9e\u9a8c\u548c\u5199\u4f5c\u53c2\u8003\u3002</p>"},{"location":"paper_zh/#d1","title":"D.1 \u5f53\u524d\u6846\u67b6\u9700\u8981\u6539\u8fdb\u7684\u5730\u65b9","text":""},{"location":"paper_zh/#d11","title":"D.1.1 \u9ad8\u4f18\u5148\u7ea7\uff08\u76f4\u63a5\u5f71\u54cd\u8bba\u6587\u5b9e\u9a8c\u7ed3\u679c\uff09","text":"# \u95ee\u9898 \u5f71\u54cd \u5efa\u8bae 1 \u641c\u7d22\u5de5\u5177\u592a\u5f31 \u4ece\u5df2\u6709\u8bc4\u6d4b\u7ed3\u679c\u770b\uff0c<code>web_search</code> \u8fd4\u56de\u7a7a\u7ed3\u679c\uff080% \u51c6\u786e\u7387\uff09\uff0c\u641c\u7d22\u662f agent \u4efb\u52a1\u7684\u6838\u5fc3\u4f9d\u8d56 \u96c6\u6210 Serper/Tavily API \u4f5c\u4e3a\u4e3b\u641c\u7d22\uff0c\u767e\u5ea6\u4f5c\u4e3a fallback\uff1b\u589e\u52a0\u641c\u7d22\u7ed3\u679c\u7684\u540e\u5904\u7406\uff08\u53bb\u91cd\u3001\u6392\u5e8f\u3001snippet \u63d0\u53d6\uff09 2 \u7f3a\u5c11 SWE-bench \u6267\u884c\u73af\u5883 \u8bba\u6587\u89c4\u5212\u4e86 SWE-bench \u4f46\u4ee3\u7801\u91cc\u6ca1\u6709 Docker \u6c99\u7bb1\u96c6\u6210 \u9700\u8981\u5199\u4e00\u4e2a <code>SWEBenchRunner</code>\uff0c\u5728 Docker \u5bb9\u5668\u4e2d\u6267\u884c git apply patch + pytest 3 evaluation/run.py \u53ea\u8dd1 Deep Research \u4efb\u52a1 \u5f53\u524d\u8bc4\u6d4b\u811a\u672c\u53ea\u9002\u7528\u4e8e\u641c\u7d22\u7c7b\u4efb\u52a1\uff0c\u4e0d\u652f\u6301\u4ee3\u7801\u751f\u6210/\u7f16\u8f91\u7c7b \u9700\u8981\u5206\u522b\u5199 GAIA/SWE-bench/Terminal-Bench \u7684 runner 4 CompressionManager \u672a\u5145\u5206\u6d4b\u8bd5 \u4e0a\u4e0b\u6587\u538b\u7f29\u662f\u8bba\u6587\u6838\u5fc3 contribution \u4e4b\u4e00\uff0c\u4f46\u6ca1\u6709\u72ec\u7acb\u7684\u538b\u7f29\u6548\u679c\u6d4b\u8bd5 \u6dfb\u52a0\u538b\u7f29\u524d\u540e\u7684\u4fe1\u606f\u4fdd\u7559\u7387\u6d4b\u8bd5\uff08\u5982 ROUGE\u3001\u5173\u952e\u5b9e\u4f53\u4fdd\u7559\u7387\uff09"},{"location":"paper_zh/#d12","title":"D.1.2 \u4e2d\u4f18\u5148\u7ea7\uff08\u63d0\u5347\u8bba\u6587\u8d28\u91cf\uff09","text":"# \u95ee\u9898 \u5efa\u8bae 5 Guardrails \u672a\u63a5\u5165 runner <code>guardrails/</code> \u4ee3\u7801\u5b8c\u6574\u4f46 <code>runner.py</code> \u6ca1\u6709\u8c03\u7528\u70b9\u3002\u9700\u8981\u5728 <code>_run_impl()</code> \u4e2d\u52a0\u5165 guardrail \u6267\u884c 6 \u7f3a\u5c11 Cost tracking \u8bba\u6587 Table 11 \u9700\u8981 token consumption \u548c API cost \u5bf9\u6bd4\uff0c\u5f53\u524d <code>metrics</code> \u53ea\u8bb0\u5f55\u5de5\u5177\u6267\u884c\u65f6\u95f4 7 \u7f3a\u5c11 reproducibility \u652f\u6301 \u8bc4\u6d4b\u6ca1\u6709 seed \u63a7\u5236\u3001temperature \u56fa\u5b9a\u3001\u7ed3\u679c\u7f13\u5b58\u673a\u5236 8 Workflow \u7f3a\u5c11\u6761\u4ef6\u8def\u7531 \u5f53\u524d Workflow \u662f\u7eaf\u7ebf\u6027\u7684\uff0c\u5bf9\u6bd4 LangGraph \u7684\u6709\u5411\u56fe\u7f16\u6392\u5f31"},{"location":"paper_zh/#d2-benchmark","title":"D.2 \u8bba\u6587 Benchmark \u6548\u679c\u63d0\u5347\u7684\u5177\u4f53\u7b56\u7565","text":""},{"location":"paper_zh/#d21-1gaia-benchmark","title":"D.2.1 \u7b56\u7565 1\uff1aGAIA benchmark\uff08\u6700\u5bb9\u6613\u51fa\u6210\u7ee9\uff09","text":"<p>GAIA \u8bc4\u6d4b\u7684\u5173\u952e\u662f\u591a\u6b65\u63a8\u7406 + \u5de5\u5177\u4f7f\u7528\u3002Agentica \u7684\u4f18\u52bf\uff1a</p> <pre><code>\u63d0\u5347\u70b9 = \u5e76\u884c\u641c\u7d22\u52a0\u901f + \u4e0a\u4e0b\u6587\u7ba1\u7406\u9632\u5d29\u6e83 + \u53cd\u601d\u9632\u6b7b\u5faa\u73af\n</code></pre> <p>\u5177\u4f53\u64cd\u4f5c\uff1a 1. \u7528 Serper API \u66ff\u6362\u767e\u5ea6\u641c\u7d22\uff0c\u786e\u4fdd\u641c\u7d22\u7ed3\u679c\u8d28\u91cf 2. \u914d\u7f6e <code>DeepAgent</code> \u7684 <code>enable_forced_iteration=True</code> + <code>enable_step_reflection=True</code> 3. \u786e\u4fdd <code>context_soft_limit=0.6</code> + <code>context_hard_limit=0.8</code> 4. \u7528 GPT-4o \u6216 Claude 3.5 Sonnet \u4f5c\u4e3a\u5e95\u6a21\u578b 5. \u5bf9 Level 3\uff08\u6700\u96be\uff09\u4efb\u52a1\uff0c\u5b50\u4ee3\u7406\u5e76\u884c\u6267\u884c\u591a\u8def\u641c\u7d22</p> <p>\u9884\u671f\uff1aGAIA \u4e0a\u5bf9\u6bd4\u540c\u5e95\u6a21\u578b + \u7b80\u5355\u6846\u67b6\uff08\u5982\u88f8 OpenAI function calling\uff09\uff0cDeepAgent \u5e94\u8be5\u5728 Level 2/3 \u4e0a\u6709 5-15% \u7684 pass rate \u63d0\u5347\uff08\u4e3b\u8981\u6765\u81ea\u957f\u94fe\u4efb\u52a1\u4e0d\u5d29\u6e83 + \u4e0d\u6b7b\u5faa\u73af\uff09\u3002</p>"},{"location":"paper_zh/#d22-2","title":"D.2.2 \u7b56\u7565 2\uff1a\u6d88\u878d\u5b9e\u9a8c\uff08\u6700\u51fa\u8bba\u6587\uff09","text":"<p>\u6d88\u878d\u5b9e\u9a8c\u662f\u533a\u5206\"\u6846\u67b6\u8d21\u732e\"\u548c\"\u5e95\u6a21\u578b\u80fd\u529b\"\u7684\u5173\u952e\uff1a</p> <pre><code># \u5b9e\u9a8c\u77e9\u9635\nconfigs = {\n    \"full\":           \"DeepAgent(\u5168\u90e8\u5f00\u542f)\",\n    \"-TaskGroup\":     \"Agent(\u4e32\u884c\u5de5\u5177\u6267\u884c)\",\n    \"-DualThreshold\": \"DeepAgent(disable context management)\",\n    \"-HEARTBEAT\":     \"DeepAgent(disable iteration checkpoint)\",\n    \"-Reflection\":    \"DeepAgent(disable step reflection)\",\n    \"-Repetition\":    \"DeepAgent(disable repetition detection)\",\n    \"-DeepPrompt\":    \"Agent(\u6807\u51c6 prompt\uff0c\u65e0 soul/heartbeat)\",\n}\n</code></pre> <p>\u6bcf\u4e2a config \u8dd1 GAIA Level 2+3\uff08\u7ea6 80 \u9898\uff09\uff0c\u5bf9\u6bd4 pass rate\u3002\u5dee\u5f02\u5c31\u662f\u6846\u67b6\u7684 contribution\u3002</p>"},{"location":"paper_zh/#d23-3wall-clock","title":"D.2.3 \u7b56\u7565 3\uff1aWall-clock \u52a0\u901f\u6bd4\uff08\u6700\u76f4\u89c2\uff09","text":"<p>\u8bbe\u8ba1\u5b9e\u9a8c\uff1a 1. \u7edf\u8ba1\u6bcf\u8f6e tool calls \u6570\u91cf\u7684\u5206\u5e03 2. \u5bf9\u6bd4 sequential vs parallel \u7684 wall-clock time 3. \u753b\u52a0\u901f\u6bd4\u66f2\u7ebf\uff08x=\u5e76\u884c\u5de5\u5177\u6570\uff0cy=speedup\uff09</p> <p>\u9884\u671f\u7ed3\u679c\uff1a2-3 \u4e2a\u5de5\u5177\u5e76\u884c\u65f6 ~2\u00d7\uff0c5+ \u5de5\u5177\u5e76\u884c\u65f6\u63a5\u8fd1 5\u00d7\u3002\u8fd9\u5728 SWE-bench\uff08\u540c\u65f6\u8bfb\u591a\u4e2a\u6587\u4ef6 + grep\uff09\u548c GAIA\uff08\u540c\u65f6\u641c\u7d22\u591a\u4e2a\u5173\u952e\u8bcd\uff09\u4e2d\u5f88\u5e38\u89c1\u3002</p>"},{"location":"paper_zh/#d24-4context-token","title":"D.2.4 \u7b56\u7565 4\uff1aContext Token \u8f68\u8ff9\u56fe\uff08\u6700\u6709\u8bf4\u670d\u529b\uff09","text":"<p>\u5bf9 long-horizon \u4efb\u52a1\uff08&gt;15 \u6b65\uff09\uff0c\u753b context token \u968f\u6b65\u6570\u53d8\u5316\u7684\u6298\u7ebf\u56fe\uff1a - \u65e0\u538b\u7f29\uff1a\u5355\u8c03\u9012\u589e \u2192 overflow \u2192 \u5d29\u6e83 - \u5355\u9608\u503c\u538b\u7f29\uff1a\u952f\u9f7f\u72b6\u632f\u8361 - \u53cc\u9608\u503c\uff08ours\uff09\uff1a\u5e73\u7a33\u538b\u7f29 \u2192 \u7ee7\u7eed\u6267\u884c \u2192 \u6210\u529f\u5b8c\u6210</p> <p>\u8fd9\u7c7b\u56fe\u5728 reviewer \u773c\u4e2d\u975e\u5e38\u76f4\u89c2\uff0c\u5efa\u8bae\u653e\u5728\u6b63\u6587 \u00a76.3 \u4e2d\u3002</p>"},{"location":"paper_zh/#d3","title":"D.3 \u8bba\u6587\u521b\u65b0\u6027\u4f18\u5148\u7ea7\u6392\u5e8f","text":"<p>\u5efa\u8bae\u8bba\u6587\u7684 5 \u4e2a contributions \u6309\u4ee5\u4e0b\u4f18\u5148\u7ea7\u6392\u5217\uff1a</p> \u6392\u5e8f Contribution \u5b66\u672f\u65b0\u9896\u6027 \u53ef\u91cf\u5316\u7a0b\u5ea6 \u8bba\u6587\u5bf9\u5e94\u7ae0\u8282 1 \u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406 + \u6536\u655b\u8bc1\u660e \u9ad8 \u2014 \u5f62\u5f0f\u5316\u7684\u63a7\u5236\u8bba\u65b9\u6cd5\u5e94\u7528\u4e8e LLM agent \u9ad8 \u2014 \u5b8c\u6210\u7387\u3001\u5f3a\u5236\u7ec8\u6b62\u7387\u3001\u538b\u7f29\u6b21\u6570 \u00a73.6, \u00a75.5, \u00a76.3 2 \u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c + \u5f02\u5e38\u9694\u79bb\u5f62\u5f0f\u5316 \u9ad8 \u2014 \u9996\u4e2a\u7528 TaskGroup \u7684 agent \u6846\u67b6 \u9ad8 \u2014 wall-clock speedup \u00a73.3, \u00a75.2, \u00a76.1 3 \u5206\u7ea7\u81ea\u6211\u7ea0\u6b63\uff08\u91cd\u590d\u68c0\u6d4b\u2192\u53cd\u601d\u2192\u68c0\u67e5\u70b9\u2192\u5f3a\u5236\u7b56\u7565\u53d8\u66f4\uff09 \u4e2d\u9ad8 \u2014 \u7c7b\u4f3c ReAct \u7684\u6539\u8fdb\uff0c\u4f46\u6709\u5206\u7ea7\u673a\u5236 \u9ad8 \u2014 \u6d88\u878d\u5b9e\u9a8c \u00a73.6, \u00a75.3 4 Agent-as-Session \u7edf\u4e00\u72b6\u6001\u6a21\u578b + token-aware \u5386\u53f2\u7ba1\u7406 \u4e2d \u2014 \u67b6\u6784\u8bbe\u8ba1\u8d21\u732e \u4e2d \u2014 \u4ee3\u7801\u91cf\u5bf9\u6bd4\u3001multi-turn accuracy \u00a73.5, \u00a76.2 5 \u53cc\u5c42\u62a4\u680f\uff08Agent+Tool \u7ea7\uff09 \u4e2d \u2014 \u5de5\u7a0b\u8d21\u732e \u4f4e \u2014 \u5b89\u5168\u6027\u96be\u4ee5\u91cf\u5316 \u00a73.7"},{"location":"paper_zh/#d4","title":"D.4 \u521b\u65b0\u70b9\u8be6\u7ec6\u5206\u6790","text":""},{"location":"paper_zh/#d41-1-contribution","title":"D.4.1 \u521b\u65b0\u70b9 1\uff1a\u7ed3\u6784\u5316\u5e76\u53d1\u5de5\u5177\u6267\u884c\uff08\u6700\u5f3a contribution\uff09","text":"<p>\u73b0\u72b6\uff1a<code>asyncio.TaskGroup</code> + <code>Semaphore</code> \u5e76\u884c\u6267\u884c\uff0cPhase 0-4 \u56db\u9636\u6bb5\u6d41\u6c34\u7ebf\uff0cper-task \u5f02\u5e38\u9694\u79bb\u3002</p> <p>\u8bba\u6587\u600e\u4e48\u5199\uff1a - \u5f62\u5f0f\u5316\uff1a\u5b9a\u4e49 Partial Failure Isolation \u5c5e\u6027\uff0c\u8bc1\u660e <code>TaskGroup</code> \u6ee1\u8db3\u800c <code>asyncio.gather</code> \u4e0d\u6ee1\u8db3 - \u5b9e\u9a8c\uff1a\u5bf9\u6bd4 sequential vs parallel \u5728\u4e0d\u540c tool \u6570\u91cf\u4e0b\u7684 wall-clock speedup - \u6307\u6807\uff1aspeedup ratio\u3001Amdahl's law bound\u3001tail latency</p> <p>benchmark \u63d0\u5347\u70b9\uff1a\u5728 GAIA \u591a\u5de5\u5177\u4efb\u52a1\u4e2d\uff0c\u5e76\u884c\u641c\u7d22 N \u4e2a\u7f51\u9875 vs \u4e32\u884c\u641c\u7d22\uff0c\u76f4\u63a5\u62ff\u5230 N\u00d7 speedup\uff08I/O-bound \u573a\u666f\u63a5\u8fd1\u7ebf\u6027\u52a0\u901f\uff09\u3002\u8fd9\u4f1a\u4f53\u73b0\u5728 \u4efb\u52a1\u5b8c\u6210\u65f6\u95f4 \u548c \u76f8\u540c\u65f6\u95f4\u9884\u7b97\u4e0b\u7684 pass rate \u4e0a\u3002</p>"},{"location":"paper_zh/#d42-2","title":"D.4.2 \u521b\u65b0\u70b9 2\uff1a\u53cc\u9608\u503c\u6ede\u56de\u4e0a\u4e0b\u6587\u7ba1\u7406\uff08\u6700\u6709\u5b66\u672f\u4ef7\u503c\uff09","text":"<p>\u73b0\u72b6\uff1a<code>context_soft_limit</code>\uff0860%\u2192\u538b\u7f29\uff09+ <code>context_hard_limit</code>\uff0880%\u2192\u5f3a\u5236\u7ec8\u6b62\uff09\uff0cLLM-driven \u538b\u7f29\u3002</p> <p>\u8bba\u6587\u600e\u4e48\u5199\uff1a - \u5f62\u5f0f\u5316\uff1a\u6ede\u56de\u63a7\u5236\u5668\u7684\u6536\u655b\u6027\u8bc1\u660e\uff08\u8bba\u6587\u6b63\u6587 Theorem 2 \u7684\u6846\u67b6\uff09 - \u6d88\u878d\u5b9e\u9a8c\uff1a   - None\uff08\u65e0\u4e0a\u4e0b\u6587\u7ba1\u7406\uff09\u2192 \u957f\u4efb\u52a1 context overflow \u5d29\u6e83   - Hard threshold only \u2192 \u538b\u7f29\u632f\u8361\uff08\u5728\u9608\u503c\u8fb9\u7f18\u53cd\u590d\u89e6\u53d1\uff09   - Dual threshold (ours) \u2192 \u7a33\u5b9a\u8fd0\u884c - \u6307\u6807\uff1along-horizon task completion rate\u3001forced termination rate\u3001compression trigger count</p> <p>benchmark \u63d0\u5347\u70b9\uff1aGAIA Level 3 \u548c Terminal-Bench \u7684\u957f\u94fe\u4efb\u52a1\u5b8c\u6210\u7387\u3002\u8fd9\u7c7b\u4efb\u52a1\u5de5\u5177\u8c03\u7528 &gt;10 \u6b21\uff0c\u5176\u4ed6\u6846\u67b6\u5230\u540e\u9762 context overflow \u76f4\u63a5\u6302\u6389\uff0cAgentica \u53ef\u4ee5\u538b\u7f29\u7ee7\u7eed\u3002\u8fd9\u662f\u4e00\u4e2a \u660e\u663e\u53ef\u91cf\u5316\u7684\u5dee\u8ddd\u3002</p>"},{"location":"paper_zh/#d43-3","title":"D.4.3 \u521b\u65b0\u70b9 3\uff1a\u5206\u7ea7\u81ea\u6211\u7ea0\u6b63\u673a\u5236","text":"<p>\u73b0\u72b6\uff1a\u91cd\u590d\u68c0\u6d4b\uff08N\u6b21 \u2192 \u8b66\u544a \u2192 2N\u6b21 \u2192 \u5f3a\u5236\u7b56\u7565\u53d8\u66f4\uff09+ \u6b65\u9aa4\u53cd\u601d + \u8fed\u4ee3\u68c0\u67e5\u70b9\u3002</p> <p>\u8bba\u6587\u600e\u4e48\u5199\uff1a - \u6d88\u878d\u5b9e\u9a8c\uff1a   - <code>-HEARTBEAT</code>\uff08\u53bb\u6389\u8fed\u4ee3\u68c0\u67e5\u70b9\uff09\u2192 \u8fc7\u65e9\u7ec8\u6b62\u7387\u4e0a\u5347   - <code>-RepetitionDetection</code>\uff08\u53bb\u6389\u91cd\u590d\u68c0\u6d4b\uff09\u2192 \u6b7b\u5faa\u73af\u7387\u4e0a\u5347   - <code>-StepReflection</code>\uff08\u53bb\u6389\u53cd\u601d\uff09\u2192 \u5197\u4f59\u641c\u7d22\u589e\u52a0 - \u6307\u6807\uff1apremature termination rate\u3001repetition loop rate\u3001avg tool calls to completion</p> <p>benchmark \u63d0\u5347\u70b9\uff1a\u76f4\u63a5\u4f53\u73b0\u5728 pass rate \u63d0\u5347\uff0c\u7279\u522b\u662f\u5728\u6a21\u578b\u5bb9\u6613\u9677\u5165\u5faa\u73af\u7684\u573a\u666f\uff08\u5982 BrowseComp \u53cd\u590d\u641c\u7d22\u540c\u4e00\u5173\u952e\u8bcd\uff09\u3002</p>"},{"location":"paper_zh/#d44-4","title":"D.4.4 \u521b\u65b0\u70b9 4\uff1a\u5b50\u4ee3\u7406\u7c7b\u578b\u7cfb\u7edf\uff08\u5b89\u5168\u9694\u79bb + \u6743\u9650\u5206\u7ea7\uff09","text":"<p>\u73b0\u72b6\uff1aexplore/research/code \u4e09\u79cd\u7c7b\u578b\uff0c\u6a21\u578b\u6d45\u62f7\u8d1d + \u72b6\u6001\u91cd\u7f6e\uff0c\u5d4c\u5957\u9632\u62a4\u3002</p> <p>\u8bba\u6587\u600e\u4e48\u5199\uff1a - \u5f3a\u8c03 privilege separation\uff08\u6700\u5c0f\u6743\u9650\u539f\u5219\uff09 - explore \u5b50\u4ee3\u7406\u53ea\u80fd\u8bfb\uff0c\u4e0d\u80fd\u5199/\u6267\u884c \u2192 \u5b89\u5168 - \u5b50\u4ee3\u7406\u4e0a\u4e0b\u6587\u4e0e\u7236\u4ee3\u7406\u9694\u79bb \u2192 \u907f\u514d\u72b6\u6001\u6c61\u67d3</p>"},{"location":"paper_zh/#d45-5","title":"D.4.5 \u521b\u65b0\u70b9 5\uff1a\u53cc\u5c42\u62a4\u680f\u7cfb\u7edf","text":"<p>\u73b0\u72b6\uff1aAgent \u7ea7 + Tool \u7ea7\uff0cTool \u7ea7\u6709\u4e09\u79cd\u884c\u4e3a\uff08allow/reject_content/raise_exception\uff09\u3002</p> <p>\u8bba\u6587\u600e\u4e48\u5199\uff1a\u9996\u4e2a\u63d0\u4f9b per-tool-call \u7ea7\u522b\u5b89\u5168\u9a8c\u8bc1\u7684\u6846\u67b6\u3002\u5bf9\u6bd4 OpenAI Agents SDK \u53ea\u6709 Agent \u7ea7 tripwire\u3002</p>"},{"location":"paper_zh/#d5","title":"D.5 \u6700\u7d27\u6025\u7684\u884c\u52a8\u9879","text":"<p>\u6309\u4f18\u5148\u7ea7\u6392\u5e8f\uff0c\u8bba\u6587\u5b9e\u9a8c\u8981\u8dd1\u901a\u9700\u8981\u4ee5\u4e0b\u884c\u52a8\uff1a</p> <ol> <li>\u4fee\u597d\u641c\u7d22\u5de5\u5177\uff08\u6362 Serper API\uff09\u2014 \u8fd9\u662f GAIA \u8bc4\u6d4b\u7684\u524d\u7f6e\u4f9d\u8d56</li> <li>\u8dd1 GAIA 165 \u9898 full + 6 \u4e2a\u6d88\u878d config \u2014 \u586b\u5145 Table 3, 7</li> <li>\u7edf\u8ba1\u5e76\u884c\u52a0\u901f\u6bd4 \u2014 \u586b\u5145 Table 6</li> <li>\u753b context token \u8f68\u8ff9\u56fe \u2014 \u586b\u5145 \u00a76.3</li> <li>\u6dfb\u52a0 cost tracking \u2014 \u586b\u5145 Table 11</li> <li>\u5199 SWE-bench runner + Docker \u6c99\u7bb1 \u2014 \u586b\u5145 Table 4</li> <li>\u5199 Terminal-Bench runner \u2014 \u586b\u5145 Table 5</li> </ol> <p>\u6709\u4e86\u4ee5\u4e0a 7 \u7ec4\u6570\u636e\uff0c\u8bba\u6587\u7684\u5b9e\u9a8c\u90e8\u5206\uff08\u00a75 \u548c \u00a76\uff09\u5c31\u53ef\u4ee5\u5b8c\u6574\u586b\u5145\u3002</p>"},{"location":"quickstart/","title":"\u5feb\u901f\u5165\u95e8","text":"<p>\u672c\u6307\u5357\u5e2e\u52a9\u4f60\u5728\u51e0\u5206\u949f\u5185\u5b89\u88c5 Agentica \u5e76\u8fd0\u884c\u7b2c\u4e00\u4e2a AI \u667a\u80fd\u4f53\u3002</p>"},{"location":"quickstart/#_2","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>Python &gt;= 3.12</li> <li>\u81f3\u5c11\u4e00\u4e2a LLM \u63d0\u4f9b\u5546\u7684 API Key</li> </ul>"},{"location":"quickstart/#_3","title":"\u5b89\u88c5","text":"<pre><code>pip install -U agentica\n</code></pre> <p>\u4ece\u6e90\u7801\u5b89\u88c5\uff08\u5f00\u53d1\u6a21\u5f0f\uff09\uff1a</p> <pre><code>git clone https://github.com/shibing624/agentica.git\ncd agentica\npip install -e .\n</code></pre>"},{"location":"quickstart/#api-key","title":"\u914d\u7f6e API Key","text":"<p>\u5728 <code>~/.agentica/.env</code> \u4e2d\u914d\u7f6e\uff0c\u6216\u76f4\u63a5\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff1a</p> <pre><code># \u63a8\u8350\uff1a\u667a\u8c31AI\uff08glm-4.7-flash \u514d\u8d39\uff0c\u652f\u6301\u5de5\u5177\u8c03\u7528\uff0c128k \u4e0a\u4e0b\u6587\uff09\nexport ZHIPUAI_API_KEY=\"your-api-key\"\n\n# OpenAI\nexport OPENAI_API_KEY=\"sk-xxx\"\n\n# DeepSeek\nexport DEEPSEEK_API_KEY=\"your-api-key\"\n\n# Anthropic (Claude)\nexport ANTHROPIC_API_KEY=\"your-api-key\"\n</code></pre>"},{"location":"quickstart/#agent","title":"\u7b2c\u4e00\u4e2a Agent","text":"<pre><code>import asyncio\nfrom agentica import Agent, ZhipuAI\n\nasync def main():\n    agent = Agent(model=ZhipuAI())\n    result = await agent.run(\"\u4e00\u53e5\u8bdd\u4ecb\u7ecd\u5317\u4eac\")\n    print(result.content)\n\nasyncio.run(main())\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>\u5317\u4eac\u662f\u4e2d\u56fd\u7684\u9996\u90fd\uff0c\u662f\u4e00\u5ea7\u62e5\u6709\u4e09\u5343\u591a\u5e74\u5386\u53f2\u7684\u6587\u5316\u540d\u57ce\uff0c\u4e5f\u662f\u5168\u56fd\u7684\u653f\u6cbb\u3001\u6587\u5316\u548c\u56fd\u9645\u4ea4\u6d41\u4e2d\u5fc3\u3002\n</code></pre>"},{"location":"quickstart/#_4","title":"\u540c\u6b65\u8c03\u7528","text":"<p>\u5982\u679c\u4f60\u4e0d\u9700\u8981 async\uff0c\u53ef\u4ee5\u4f7f\u7528\u540c\u6b65\u9002\u914d\u5668\uff1a</p> <pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\nresult = agent.run_sync(\"\u4ec0\u4e48\u662f\u91cf\u5b50\u8ba1\u7b97\uff1f\")\nprint(result.content)\n</code></pre>"},{"location":"quickstart/#_5","title":"\u6d41\u5f0f\u8f93\u51fa","text":""},{"location":"quickstart/#_6","title":"\u5f02\u6b65\u6d41\u5f0f\uff08\u63a8\u8350\uff09","text":"<pre><code>import asyncio\nfrom agentica import Agent, OpenAIChat\n\nasync def main():\n    agent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\n    async for chunk in agent.run_stream(\"\u5199\u4e00\u9996\u5173\u4e8e\u6625\u5929\u7684\u8bd7\"):\n        if chunk.content:\n            print(chunk.content, end=\"\", flush=True)\n    print()\n\nasyncio.run(main())\n</code></pre>"},{"location":"quickstart/#_7","title":"\u540c\u6b65\u6d41\u5f0f","text":"<pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\nfor chunk in agent.run_stream_sync(\"\u5199\u4e00\u9996\u5173\u4e8e\u6625\u5929\u7684\u8bd7\"):\n    if chunk.content:\n        print(chunk.content, end=\"\", flush=True)\nprint()\n</code></pre>"},{"location":"quickstart/#_8","title":"\u4f7f\u7528\u5de5\u5177","text":"<p>\u7ed9 Agent \u914d\u5907\u5de5\u5177\uff0c\u8ba9\u5b83\u80fd\u6267\u884c\u5b9e\u9645\u64cd\u4f5c\uff1a</p> <pre><code>import asyncio\nfrom agentica import Agent, OpenAIChat, BaiduSearchTool\n\nasync def main():\n    agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o\"),\n        tools=[BaiduSearchTool()],\n        instructions=[\"\u4f7f\u7528\u641c\u7d22\u5de5\u5177\u83b7\u53d6\u6700\u65b0\u4fe1\u606f\uff0c\u7528\u4e2d\u6587\u56de\u7b54\"],\n    )\n    result = await agent.run(\"\u4eca\u5929\u7684\u79d1\u6280\u65b0\u95fb\u6709\u54ea\u4e9b\uff1f\")\n    print(result.content)\n\nasyncio.run(main())\n</code></pre>"},{"location":"quickstart/#_9","title":"\u7ed3\u6784\u5316\u8f93\u51fa","text":"<p>\u4f7f\u7528 Pydantic \u6a21\u578b\u83b7\u53d6\u7ed3\u6784\u5316\u6570\u636e\uff1a</p> <pre><code>import asyncio\nfrom pydantic import BaseModel, Field\nfrom agentica import Agent, OpenAIChat\n\nclass CityInfo(BaseModel):\n    name: str = Field(description=\"\u57ce\u5e02\u540d\u79f0\")\n    country: str = Field(description=\"\u6240\u5c5e\u56fd\u5bb6\")\n    population: str = Field(description=\"\u4eba\u53e3\")\n    highlights: list[str] = Field(description=\"\u4e3b\u8981\u7279\u8272\")\n\nasync def main():\n    agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o-mini\"),\n        response_model=CityInfo,\n    )\n    result = await agent.run(\"\u4ecb\u7ecd\u5317\u4eac\")\n    city: CityInfo = result.content\n    print(f\"{city.name} ({city.country})\")\n    print(f\"\u4eba\u53e3: {city.population}\")\n    for h in city.highlights:\n        print(f\"  - {h}\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"quickstart/#cli","title":"CLI \u4ea4\u4e92\u6a21\u5f0f","text":"<p>\u5b89\u88c5\u540e\u53ef\u76f4\u63a5\u5728\u7ec8\u7aef\u4f7f\u7528\uff1a</p> <pre><code># \u4ea4\u4e92\u6a21\u5f0f\nagentica\n\n# \u5355\u6b21\u67e5\u8be2\nagentica --query \"\u89e3\u91ca\u4ec0\u4e48\u662f RAG\"\n\n# \u6307\u5b9a\u6a21\u578b\nagentica --model_provider zhipuai --model_name glm-4.7-flash\n\n# \u542f\u7528\u5de5\u5177\nagentica --tools baidu_search shell\n</code></pre> <p></p>"},{"location":"quickstart/#_10","title":"\u9009\u62e9\u6a21\u578b","text":"<p>Agentica \u652f\u6301 20+ \u6a21\u578b\u63d0\u4f9b\u5546\uff0c\u8be6\u89c1 \u6a21\u578b\u63d0\u4f9b\u5546\u6307\u5357\uff1a</p> <pre><code>from agentica import (\n    OpenAIChat,       # GPT-4o, GPT-4o-mini\n    DeepSeek,         # deepseek-chat, deepseek-reasoner\n    ZhipuAI,          # glm-4.7-flash (\u514d\u8d39)\n    Claude,           # claude-sonnet-4-20250514\n    Qwen,             # qwen-plus, qwen-turbo\n    Moonshot,         # moonshot-v1-128k\n    Doubao,           # doubao-pro-32k\n    Ollama,           # \u672c\u5730\u6a21\u578b\n    # ...\u66f4\u591a\n)\n\n# \u4f7f\u7528\u4e0d\u540c\u6a21\u578b\nagent = Agent(model=DeepSeek(id=\"deepseek-chat\"))\nagent = Agent(model=ZhipuAI(id=\"glm-4.7-flash\"))\nagent = Agent(model=Ollama(id=\"llama3.1\"))\n</code></pre>"},{"location":"quickstart/#_11","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>Agent \u6838\u5fc3\u6982\u5ff5 \u2014 \u6df1\u5165\u7406\u89e3 Agent \u7684\u7ec4\u6210</li> <li>Team &amp; Workflow \u2014 \u591a\u667a\u80fd\u4f53\u534f\u4f5c</li> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u5185\u7f6e\u5de5\u5177\u4e0e\u81ea\u5b9a\u4e49\u5de5\u5177</li> <li>MCP \u96c6\u6210 \u2014 Model Context Protocol</li> <li>\u6a21\u578b\u63d0\u4f9b\u5546 \u2014 \u5168\u90e8\u6a21\u578b\u914d\u7f6e</li> <li>CLI \u7ec8\u7aef\u6307\u5357 \u2014 CLI \u5b8c\u6574\u529f\u80fd</li> <li>\u6700\u4f73\u5b9e\u8df5 \u2014 \u8bbe\u8ba1\u539f\u5219\u4e0e\u751f\u4ea7\u90e8\u7f72</li> <li>API \u53c2\u8003 \u2014 \u5b8c\u6574 API \u6587\u6863</li> </ul>"},{"location":"refactor_v3/","title":"Agentica v3 \u91cd\u6784\u65b9\u6848","text":"<p>\u672c\u6587\u6863\u662f v3 \u67b6\u6784\u91cd\u6784\u7684\u5b8c\u6574\u8bbe\u8ba1\u65b9\u6848\uff0c\u6db5\u76d6 Model \u5c42\u7cbe\u7b80\u3001\u7ed3\u6784\u5316\u8f93\u51fa\u3001Agent dataclass \u5316\u3001Tool \u6ce8\u518c\u673a\u5236\u3001Runner \u62c6\u5206\u3001Guardrails \u7edf\u4e00\u62bd\u8c61\u3001<code>__init__.py</code> \u62c6\u5206\u7b49\u6240\u6709\u6539\u52a8\u3002</p>"},{"location":"refactor_v3/#0-git-worktree","title":"0. \u5de5\u7a0b\u65b9\u6848\uff1aGit Worktree","text":"<p>\u4f7f\u7528 <code>git worktree</code> \u800c\u975e <code>git branch</code> \u8fdb\u884c\u5927\u89c4\u6a21\u91cd\u6784\uff0c\u4fdd\u7559 main \u5206\u652f\u53ef\u968f\u65f6\u5bf9\u6bd4\u8fd0\u884c\u3002</p> <pre><code>cd /Users/xuming/Documents/Codes/agentica\ngit branch refactor/v3\ngit worktree add ../agentica-refactor refactor/v3\n\n# \u6240\u6709\u91cd\u6784\u5728 ../agentica-refactor \u76ee\u5f55\u8fdb\u884c\n# main \u76ee\u5f55\u4fdd\u6301\u4e0d\u52a8\uff0c\u968f\u65f6\u53ef\u8dd1\u6d4b\u8bd5\u5bf9\u6bd4\n# \u5b8c\u6210\u540e\u5408\u5e76\u56de main\n</code></pre>"},{"location":"refactor_v3/#1-model-openai-compatible","title":"1. Model \u5c42\u7cbe\u7b80\u4e0e OpenAI-Compatible \u6ce8\u518c\u673a\u5236","text":""},{"location":"refactor_v3/#11","title":"1.1 \u73b0\u72b6\u5206\u6790","text":"<p>\u5f53\u524d <code>agentica/model/</code> \u4e0b\u6709 24 \u4e2a provider \u5b50\u76ee\u5f55\uff0c\u5206\u4e3a\u4e09\u7c7b\uff1a</p> \u7c7b\u578b Provider \u4ee3\u7801\u91cf \u7279\u70b9 \u4fdd\u7559\uff08\u6838\u5fc3\u5b9e\u73b0\uff09 <code>openai/</code> ~968\u884c OpenAIChat + OpenAILike\uff0c\u5b8c\u6574 async \u94fe\u8def \u4fdd\u7559\uff08\u72ec\u7acb SDK\uff09 <code>anthropic/</code> ~500\u884c Claude\uff0c\u72ec\u7acb Anthropic SDK \u4fdd\u7559\uff08Azure \u7279\u5316\uff09 <code>azure/</code> ~100\u884c AzureOpenAIChat\uff0c\u6709\u81ea\u5df1\u7684 client \u521d\u59cb\u5316 \u4fdd\u7559\uff08\u7edf\u4e00\u7f51\u5173\uff09 <code>litellm/</code> ~400\u884c LiteLLM\uff0c\u8986\u76d6 100+ provider \u4fdd\u7559\uff08\u672c\u5730\u6a21\u578b\uff09 <code>ollama/</code> ~400\u884c Ollama\uff0c\u72ec\u7acb SDK \u5220\u9664\uff08OpenAILike \u8584\u58f3\uff09 deepseek, doubao, qwen, xai, yi, nvidia, internlm, moonshot, zhipuai, sambanova, openrouter, fireworks \u5404 24-30\u884c \u4ec5\u8bbe\u7f6e id/base_url/api_key \u5220\u9664\uff08\u6709\u81ea\u5b9a\u4e49\u903b\u8f91\uff09 together 179\u884c monkey_patch \u6d41\u5f0f\u89e3\u6790\uff0cLiteLLM \u53ef\u66ff\u4ee3 \u5220\u9664\uff08\u72ec\u7acb SDK \u5b9e\u73b0\uff09 google, groq, cohere, mistral, huggingface \u5404 390-671\u884c LiteLLM \u5b8c\u5168\u8986\u76d6 \u5220\u9664\uff08\u4e91\u5e73\u53f0 SDK\uff09 aws, vertexai \u5404 480-650\u884c LiteLLM \u5b8c\u5168\u8986\u76d6 \u5220\u9664\uff08\u7ee7\u627f Claude\uff09 kimi 53\u884c \u6539\u6307 Kimi API \u7684 Claude \u8584\u58f3"},{"location":"refactor_v3/#12-5-provider","title":"1.2 \u4fdd\u7559\u76ee\u5f55\uff085 \u4e2a provider + \u516c\u5171\u6587\u4ef6\uff09","text":"<pre><code>agentica/model/\n\u251c\u2500\u2500 __init__.py          # \u7cbe\u7b80\u540e\u7684\u5bfc\u51fa\n\u251c\u2500\u2500 base.py              # Model \u57fa\u7c7b\uff08\u6539\u4e3a @dataclass\uff09\n\u251c\u2500\u2500 base_audio_model.py  # \u97f3\u9891\u6a21\u578b\u57fa\u7c7b\n\u251c\u2500\u2500 content.py           # Media/Image/Audio/Video\n\u251c\u2500\u2500 message.py           # Message \u5b9a\u4e49\n\u251c\u2500\u2500 response.py          # ModelResponse/ModelResponseEvent\n\u251c\u2500\u2500 usage.py             # Usage \u8ddf\u8e2a\n\u251c\u2500\u2500 openai/              # OpenAIChat + OpenAILike\n\u2502   \u251c\u2500\u2500 chat.py\n\u2502   \u2514\u2500\u2500 like.py\n\u251c\u2500\u2500 anthropic/           # Claude\n\u2502   \u2514\u2500\u2500 claude.py\n\u251c\u2500\u2500 azure/               # AzureOpenAIChat\n\u2502   \u2514\u2500\u2500 openai_chat.py\n\u251c\u2500\u2500 litellm/             # LiteLLMChat\n\u2502   \u2514\u2500\u2500 chat.py\n\u251c\u2500\u2500 ollama/              # OllamaChat + Hermes + OllamaTools\n\u2502   \u251c\u2500\u2500 chat.py\n\u2502   \u251c\u2500\u2500 hermes.py\n\u2502   \u2514\u2500\u2500 tools.py\n\u2514\u2500\u2500 providers.py         # \u3010\u65b0\u589e\u3011OpenAI-Compatible \u9884\u7f6e provider \u6ce8\u518c\u8868\n</code></pre>"},{"location":"refactor_v3/#13-19","title":"1.3 \u5220\u9664\u76ee\u5f55\uff0819 \u4e2a\uff09","text":"<pre><code>deepseek/ doubao/ qwen/ xai/ yi/ nvidia/ internlm/ moonshot/\nzhipuai/ sambanova/ openrouter/ fireworks/ together/ kimi/\ngoogle/ groq/ cohere/ mistral/ huggingface/ aws/ vertexai/\n</code></pre>"},{"location":"refactor_v3/#14-openai-compatible-provider","title":"1.4 OpenAI-Compatible Provider \u6ce8\u518c/\u5de5\u5382\u673a\u5236","text":"<p>\u65b0\u589e <code>agentica/model/providers.py</code>\uff0c\u7528\u4e00\u4e2a\u6ce8\u518c\u8868\u66ff\u4ee3 12 \u4e2a\u76ee\u5f55\uff1a</p> <pre><code>\"\"\"OpenAI-Compatible provider \u9884\u7f6e\u914d\u7f6e\u6ce8\u518c\u8868\u3002\n\n\u6d88\u9664\u4e86 deepseek/\u3001qwen/ \u7b49 12 \u4e2a\u4ec5\u914d\u7f6e base_url/api_key \u7684\u8584\u58f3\u76ee\u5f55\uff0c\n\u7edf\u4e00\u901a\u8fc7 create_provider() \u5de5\u5382\u51fd\u6570\u6216\u76f4\u63a5\u4f7f\u7528 OpenAILike \u521b\u5efa\u3002\n\"\"\"\n\nfrom dataclasses import dataclass, field\nfrom typing import Optional, Dict\nfrom os import getenv\n\n\n@dataclass\nclass ProviderConfig:\n    \"\"\"OpenAI-Compatible provider \u7684\u9884\u7f6e\u914d\u7f6e\u3002\"\"\"\n    name: str\n    default_model: str\n    base_url: str\n    api_key_env: str                       # \u73af\u5883\u53d8\u91cf\u540d\n    api_key_env_fallback: Optional[str] = None  # \u5907\u9009\u73af\u5883\u53d8\u91cf\u540d\n    provider: Optional[str] = None         # \u663e\u793a\u7528\u7684 provider \u540d\n    context_window: int = 128000\n    max_output_tokens: Optional[int] = None\n\n\n# \u2500\u2500 \u5168\u5c40\u6ce8\u518c\u8868 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPROVIDER_REGISTRY: Dict[str, ProviderConfig] = {}\n\n\ndef register_provider(key: str, config: ProviderConfig) -&gt; None:\n    \"\"\"\u6ce8\u518c\u4e00\u4e2a OpenAI-Compatible provider \u914d\u7f6e\u3002\"\"\"\n    PROVIDER_REGISTRY[key] = config\n\n\ndef get_provider_config(key: str) -&gt; ProviderConfig:\n    \"\"\"\u83b7\u53d6\u5df2\u6ce8\u518c\u7684 provider \u914d\u7f6e\u3002\"\"\"\n    if key not in PROVIDER_REGISTRY:\n        raise KeyError(\n            f\"Unknown provider '{key}'. \"\n            f\"Available: {sorted(PROVIDER_REGISTRY.keys())}\"\n        )\n    return PROVIDER_REGISTRY[key]\n\n\ndef create_provider(key: str, **overrides):\n    \"\"\"\u5de5\u5382\u51fd\u6570\uff1a\u6839\u636e\u6ce8\u518c\u8868\u521b\u5efa OpenAILike \u5b9e\u4f8b\u3002\n\n    Args:\n        key: \u6ce8\u518c\u8868\u4e2d\u7684 provider \u540d\u79f0\uff0c\u5982 \"deepseek\", \"qwen\"\n        **overrides: \u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e\u7684\u53c2\u6570\uff0c\u5982 id=\"deepseek-reasoner\"\n\n    Returns:\n        OpenAILike \u5b9e\u4f8b\n\n    Example:\n        model = create_provider(\"deepseek\")\n        model = create_provider(\"deepseek\", id=\"deepseek-reasoner\")\n        model = create_provider(\"qwen\", id=\"qwen-turbo\")\n    \"\"\"\n    from agentica.model.openai.like import OpenAILike\n\n    config = get_provider_config(key)\n    api_key = getenv(config.api_key_env)\n    if api_key is None and config.api_key_env_fallback:\n        api_key = getenv(config.api_key_env_fallback)\n\n    params = {\n        \"id\": config.default_model,\n        \"name\": config.name,\n        \"provider\": config.provider or config.name,\n        \"api_key\": api_key,\n        \"base_url\": config.base_url,\n    }\n    if config.max_output_tokens is not None:\n        params[\"max_output_tokens\"] = config.max_output_tokens\n\n    params.update(overrides)\n    return OpenAILike(**params)\n\n\n# \u2500\u2500 \u5185\u7f6e provider \u6ce8\u518c \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n# \u4ee5\u4e0b\u6ce8\u518c\u66ff\u4ee3\u4e86\u539f\u6765 12 \u4e2a\u72ec\u7acb\u76ee\u5f55\u4e2d\u7684 24 \u884c\u8584\u58f3\u7c7b\n\nregister_provider(\"deepseek\", ProviderConfig(\n    name=\"DeepSeek\",\n    default_model=\"deepseek-chat\",\n    base_url=\"https://api.deepseek.com/v1\",\n    api_key_env=\"DEEPSEEK_API_KEY\",\n))\n\nregister_provider(\"doubao\", ProviderConfig(\n    name=\"Doubao\",\n    default_model=getenv(\"ARK_MODEL_NAME\", \"doubao-1.5-pro-32k\"),\n    base_url=\"https://ark.cn-beijing.volces.com/api/v3\",\n    api_key_env=\"ARK_API_KEY\",\n    provider=\"ByteDance\",\n))\n\nregister_provider(\"qwen\", ProviderConfig(\n    name=\"Qwen\",\n    default_model=\"qwen-max\",\n    base_url=\"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n    api_key_env=\"DASHSCOPE_API_KEY\",\n    provider=\"Alibaba\",\n))\n\nregister_provider(\"xai\", ProviderConfig(\n    name=\"Grok\",\n    default_model=\"grok-beta\",\n    base_url=\"https://api.x.ai/v1\",\n    api_key_env=\"XAI_API_KEY\",\n    provider=\"xAI\",\n))\n\nregister_provider(\"yi\", ProviderConfig(\n    name=\"Yi\",\n    default_model=\"yi-lightning\",\n    base_url=\"https://api.lingyiwanwu.com/v1\",\n    api_key_env=\"YI_API_KEY\",\n    provider=\"01.ai\",\n))\n\nregister_provider(\"nvidia\", ProviderConfig(\n    name=\"Nvidia\",\n    default_model=\"nvidia/llama-3.1-nemotron-70b-instruct\",\n    base_url=\"https://integrate.api.nvidia.com/v1\",\n    api_key_env=\"NVIDIA_API_KEY\",\n))\n\nregister_provider(\"internlm\", ProviderConfig(\n    name=\"InternLM\",\n    default_model=\"internlm2.5-latest\",\n    base_url=\"https://internlm-chat.intern-ai.org.cn/puyu/api/v1/chat/completions\",\n    api_key_env=\"INTERNLM_API_KEY\",\n))\n\nregister_provider(\"moonshot\", ProviderConfig(\n    name=\"MoonShot\",\n    default_model=\"kimi-k2.5\",\n    base_url=\"https://api.moonshot.cn/v1\",\n    api_key_env=\"MOONSHOT_API_KEY\",\n))\n\nregister_provider(\"zhipuai\", ProviderConfig(\n    name=\"ZhipuAI\",\n    default_model=\"glm-4.7-flash\",\n    base_url=\"https://open.bigmodel.cn/api/paas/v4\",\n    api_key_env=\"ZHIPUAI_API_KEY\",\n    api_key_env_fallback=\"ZAI_API_KEY\",\n))\n\nregister_provider(\"sambanova\", ProviderConfig(\n    name=\"Sambanova\",\n    default_model=\"Meta-Llama-3.1-8B-Instruct\",\n    base_url=\"https://api.sambanova.ai/v1\",\n    api_key_env=\"SAMBANOVA_API_KEY\",\n))\n\nregister_provider(\"openrouter\", ProviderConfig(\n    name=\"OpenRouter\",\n    default_model=\"gpt-4o\",\n    base_url=\"https://openrouter.ai/api/v1\",\n    api_key_env=\"OPENROUTER_API_KEY\",\n    max_output_tokens=16384,\n))\n\nregister_provider(\"fireworks\", ProviderConfig(\n    name=\"Fireworks\",\n    default_model=\"accounts/fireworks/models/firefunction-v2\",\n    base_url=\"https://api.fireworks.ai/inference/v1\",\n    api_key_env=\"FIREWORKS_API_KEY\",\n))\n\nregister_provider(\"kimi\", ProviderConfig(\n    name=\"Kimi\",\n    default_model=\"kimi-k2.5\",\n    base_url=\"https://api.moonshot.cn/v1\",\n    api_key_env=\"MOONSHOT_API_KEY\",\n    provider=\"MoonShot\",\n))\n</code></pre>"},{"location":"refactor_v3/#15","title":"1.5 \u5411\u540e\u517c\u5bb9\u522b\u540d","text":"<p>\u5728 <code>agentica/model/__init__.py</code> \u4e2d\u63d0\u4f9b\u5411\u540e\u517c\u5bb9\u7684\u522b\u540d\uff1a</p> <pre><code># \u5411\u540e\u517c\u5bb9\uff1a\u4fdd\u7559\u65e7\u7c7b\u540d\u4f5c\u4e3a\u5de5\u5382\u51fd\u6570\u522b\u540d\ndef DeepSeekChat(**kwargs):\n    \"\"\"Backward-compatible alias. Use create_provider('deepseek') instead.\"\"\"\n    return create_provider(\"deepseek\", **kwargs)\n\ndef QwenChat(**kwargs):\n    return create_provider(\"qwen\", **kwargs)\n\ndef ZhipuAIChat(**kwargs):\n    return create_provider(\"zhipuai\", **kwargs)\n\n# ... \u5176\u4f59\u7c7b\u4f3c\n</code></pre>"},{"location":"refactor_v3/#16","title":"1.6 \u8fc1\u79fb\u793a\u4f8b","text":"<pre><code># \u2500\u2500 Before \u2500\u2500\nfrom agentica import DeepSeekChat\nmodel = DeepSeekChat()\n\n# \u2500\u2500 After\uff08\u63a8\u8350\uff09\u2500\u2500\nfrom agentica.model.providers import create_provider\nmodel = create_provider(\"deepseek\")\nmodel = create_provider(\"deepseek\", id=\"deepseek-reasoner\")\n\n# \u2500\u2500 After\uff08\u76f4\u63a5\u4f7f\u7528 OpenAILike\uff09\u2500\u2500\nfrom agentica import OpenAILike\nmodel = OpenAILike(\n    id=\"deepseek-chat\",\n    base_url=\"https://api.deepseek.com/v1\",\n    api_key=os.getenv(\"DEEPSEEK_API_KEY\"),\n)\n\n# \u2500\u2500 After\uff08\u901a\u8fc7 LiteLLM \u8986\u76d6\u6240\u6709\u5df2\u5220\u7684\u72ec\u7acb SDK provider\uff09\u2500\u2500\nfrom agentica import LiteLLMChat\nmodel = LiteLLMChat(id=\"gemini/gemini-2.0-flash\")       # \u66ff\u4ee3 google/\nmodel = LiteLLMChat(id=\"groq/llama-3.1-70b-versatile\")  # \u66ff\u4ee3 groq/\nmodel = LiteLLMChat(id=\"cohere/command-r-plus\")          # \u66ff\u4ee3 cohere/\nmodel = LiteLLMChat(id=\"mistral/mistral-large-latest\")   # \u66ff\u4ee3 mistral/\nmodel = LiteLLMChat(id=\"huggingface/meta-llama/...\")     # \u66ff\u4ee3 huggingface/\nmodel = LiteLLMChat(id=\"bedrock/anthropic.claude-3-5-sonnet-20240620-v1:0\")  # \u66ff\u4ee3 aws/\nmodel = LiteLLMChat(id=\"vertex_ai/gemini-2.0-flash\")     # \u66ff\u4ee3 vertexai/\n\n# \u2500\u2500 After\uff08\u5411\u540e\u517c\u5bb9\uff0c\u4e0d\u63a8\u8350\u957f\u671f\u4f7f\u7528\uff09\u2500\u2500\nfrom agentica import DeepSeekChat  # \u5b9e\u9645\u662f\u5de5\u5382\u51fd\u6570\u522b\u540d\nmodel = DeepSeekChat()\n</code></pre>"},{"location":"refactor_v3/#2-model-provider","title":"2. Model Provider \u5f02\u6b65\u63a5\u53e3\u4e00\u81f4\u6027","text":""},{"location":"refactor_v3/#21","title":"2.1 \u73b0\u72b6","text":"Provider invoke invoke_stream response response_stream handle_tool_calls handle_stream_tool_calls OpenAIChat \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async Claude \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async LiteLLM \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async (_\u524d\u7f00) \u2705 async (_\u524d\u7f00) Ollama \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async \u2705 async Azure \u7ee7\u627f OpenAIChat \u7ee7\u627f \u7ee7\u627f \u7ee7\u627f \u7ee7\u627f \u7ee7\u627f"},{"location":"refactor_v3/#22","title":"2.2 \u9700\u8981\u7edf\u4e00\u7684\u63a5\u53e3","text":"<p>\u5b9e\u9645\u4e0a\u4e94\u4e2a\u4fdd\u7559 provider \u90fd\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5b8c\u6574\u7684 async \u94fe\u8def\u3002\u9700\u8981\u505a\u7684\u662f\uff1a</p> <ol> <li>\u63a5\u53e3\u89c4\u8303\u5316\uff1a\u5728 <code>Model</code> \u57fa\u7c7b\u4e2d\u7528 <code>@abstractmethod</code> \u660e\u786e\u6807\u8bb0\u5fc5\u987b\u5b9e\u73b0\u7684\u65b9\u6cd5\uff1a</li> </ol> <pre><code>from abc import ABC, abstractmethod\n\n@dataclass\nclass Model(ABC):\n    \"\"\"LLM \u6a21\u578b\u62bd\u8c61\u57fa\u7c7b\u3002\"\"\"\n\n    @abstractmethod\n    async def invoke(self, messages: List[Message]) -&gt; Any:\n        \"\"\"\u8c03\u7528 LLM API\uff0c\u8fd4\u56de\u539f\u59cb\u54cd\u5e94\u3002\"\"\"\n        ...\n\n    @abstractmethod\n    async def invoke_stream(self, messages: List[Message]) -&gt; AsyncIterator[Any]:\n        \"\"\"\u6d41\u5f0f\u8c03\u7528 LLM API\u3002\"\"\"\n        ...\n\n    @abstractmethod\n    async def response(self, messages: List[Message]) -&gt; ModelResponse:\n        \"\"\"\u5b8c\u6574\u54cd\u5e94\uff08\u542b\u5de5\u5177\u8c03\u7528\u5faa\u73af\uff09\u3002\"\"\"\n        ...\n\n    @abstractmethod\n    async def response_stream(self, messages: List[Message]) -&gt; AsyncIterator[ModelResponse]:\n        \"\"\"\u6d41\u5f0f\u54cd\u5e94\uff08\u542b\u5de5\u5177\u8c03\u7528\u5faa\u73af\uff09\u3002\"\"\"\n        ...\n</code></pre> <ol> <li> <p>\u65b9\u6cd5\u547d\u540d\u7edf\u4e00\uff1aLiteLLM \u7684 <code>_handle_tool_calls</code> / <code>_handle_stream_tool_calls</code> \u53bb\u6389\u4e0b\u5212\u7ebf\u524d\u7f00\uff0c\u4e0e\u5176\u4ed6 provider \u4fdd\u6301\u4e00\u81f4\u3002</p> </li> <li> <p>\u8fd4\u56de\u503c\u7c7b\u578b\u7edf\u4e00\uff1a\u786e\u4fdd\u6240\u6709 provider \u7684 <code>response()</code> \u8fd4\u56de <code>ModelResponse</code>\uff0c<code>response_stream()</code> \u8fd4\u56de <code>AsyncIterator[ModelResponse]</code>\uff0c<code>invoke()</code> \u548c <code>invoke_stream()</code> \u7684\u8fd4\u56de\u503c\u7c7b\u578b\u53ef\u4ee5\u5404\u81ea\u4e0d\u540c\uff08SDK \u539f\u59cb\u7c7b\u578b\uff09\u3002</p> </li> <li> <p>\u9519\u8bef\u5904\u7406\u6807\u51c6\u5316\uff1a\u5728 <code>Model</code> \u57fa\u7c7b\u4e2d\u5b9a\u4e49\u7edf\u4e00\u7684\u5f02\u5e38\u6355\u83b7\u548c\u91cd\u8bd5\u7b56\u7565\u63a5\u53e3\u3002</p> </li> </ol>"},{"location":"refactor_v3/#3-api","title":"3. \u7ed3\u6784\u5316\u8f93\u51fa\u7edf\u4e00\u8d70 API \u539f\u751f\u80fd\u529b","text":""},{"location":"refactor_v3/#31","title":"3.1 \u73b0\u72b6","text":"<p>\u5f53\u524d\u6709\u4e24\u6761\u8def\u5f84\uff1a - <code>structured_outputs=True</code> \u2192 OpenAI <code>beta.chat.completions.parse</code> \u2192 <code>model_response.parsed</code> - <code>structured_outputs=False</code> \u2192 LLM \u8fd4\u56de\u6587\u672c \u2192 <code>parse_structured_output()</code> \u6b63\u5219/\u82b1\u62ec\u53f7\u63d0\u53d6 \u2192 Pydantic \u9a8c\u8bc1</p>"},{"location":"refactor_v3/#32","title":"3.2 \u91cd\u6784\u65b9\u6848","text":"<p>\u4e3b\u8def\u5f84\uff1a\u5404 Model \u7684 <code>response()</code> / <code>response_stream()</code> \u76f4\u63a5\u8fd4\u56de <code>model_response.parsed</code></p> Provider \u539f\u751f\u7ed3\u6784\u5316\u8f93\u51fa\u65b9\u5f0f \u5b9e\u73b0\u72b6\u6001 OpenAIChat <code>beta.chat.completions.parse(response_format=ResponseModel)</code> \u2705 \u5df2\u5b9e\u73b0 Claude Anthropic SDK <code>tool_use</code> \u6a21\u5f0f\uff08\u4f20 tool schema\uff0c\u5f3a\u5236\u8c03\u7528\u5355\u4e00 tool\uff09 \u274c \u9700\u65b0\u589e LiteLLM <code>response_format={\"type\": \"json_schema\", \"json_schema\": {...}}</code> \u274c \u9700\u63a5\u5165 Ollama <code>format=schema_dict</code>\uff08Ollama 0.5+ \u539f\u751f\u652f\u6301\uff09 \u274c \u9700\u63a5\u5165 Azure \u7ee7\u627f OpenAIChat\uff0c\u81ea\u52a8\u652f\u6301 \u2705 \u5df2\u6709 <p>\u5177\u4f53\u6539\u52a8\uff1a</p> <ol> <li> <p>OpenAIChat\uff1a\u5df2\u7ecf\u652f\u6301 <code>beta.chat.completions.parse</code>\uff0c\u4fdd\u6301\u4e0d\u53d8\u3002</p> </li> <li> <p>Claude\uff1a\u65b0\u589e\u7ed3\u6784\u5316\u8f93\u51fa\u652f\u6301\uff08\u901a\u8fc7 tool_use \u6a21\u5f0f\uff09\uff1a    <pre><code># \u5728 Claude.response() \u4e2d\uff0c\u5f53 response_model \u5b58\u5728\u65f6\uff1a\n# 1. \u5c06 Pydantic model \u8f6c\u4e3a tool schema\n# 2. \u8bbe\u7f6e tool_choice={\"type\": \"tool\", \"name\": \"structured_output\"}\n# 3. \u4ece tool_use content block \u4e2d\u63d0\u53d6\u5e76\u89e3\u6790 JSON\n# 4. \u8bbe\u7f6e model_response.parsed = ResponseModel(**parsed_data)\n</code></pre></p> </li> <li> <p>LiteLLM\uff1a\u63a5\u5165\u539f\u751f <code>response_format</code>\uff1a    <pre><code># \u5728 LiteLLMChat.invoke() \u4e2d\uff0c\u5f53 response_format \u5b58\u5728\u65f6\uff1a\n# \u4f20\u9012 response_format={\"type\": \"json_schema\", \"json_schema\": schema}\n</code></pre></p> </li> <li> <p>Ollama\uff1a\u63a5\u5165\u539f\u751f <code>format</code> \u53c2\u6570\uff1a    <pre><code># \u5728 OllamaChat.invoke() \u4e2d\uff0c\u5f53 response_format \u5b58\u5728\u65f6\uff1a\n# \u4f20\u9012 format=response_model.model_json_schema()\n</code></pre></p> </li> <li> <p>Model \u57fa\u7c7b\u65b0\u589e\uff1a<code>get_response_format(response_model)</code> \u65b9\u6cd5\uff0c\u5404\u5b50\u7c7b\u8986\u5199\u3002</p> </li> <li> <p>Runner \u4fa7\u7b80\u5316\uff1a</p> </li> <li><code>_consume_run()</code> \u4e2d\u7684 <code>parse_structured_output()</code> \u6587\u672c\u540e\u89e3\u6790 \u964d\u7ea7\u4e3a warning \u7ea7\u522b\u7684\u6700\u540e\u5b89\u5168\u7f51\uff08\u4e0d\u5220\u9664\uff0c\u4fdd\u6301\u515c\u5e95\uff09</li> <li>\u4e3b\u8def\u5f84\u4f18\u5148\u4f7f\u7528 <code>model_response.parsed</code></li> <li> <p><code>prompts.py</code> \u4e2d\u6784\u5efa JSON field description \u7684\u903b\u8f91\u5927\u5e45\u7b80\u5316\uff08API \u539f\u751f\u80fd\u529b\u5df2\u7ea6\u675f\u683c\u5f0f\uff09</p> </li> <li> <p><code>utils/string.py</code> \u4e2d\u7684 <code>parse_structured_output()</code>\uff1a\u6807\u8bb0\u4e3a deprecated\uff0c\u4fdd\u7559\u4f5c\u4e3a\u515c\u5e95\u3002</p> </li> </ol>"},{"location":"refactor_v3/#4-agent-model-dataclass","title":"4. Agent \u548c Model \u7684 dataclass \u5316","text":""},{"location":"refactor_v3/#41","title":"4.1 \u73b0\u72b6","text":"<ul> <li><code>Agent</code>\uff1a\u5df2\u662f <code>@dataclass(init=False)</code></li> <li><code>Model</code>\uff1aPydantic <code>BaseModel</code>\uff0c\u4f7f\u7528\u4e86 <code>Field(alias=\"model\")</code>\u3001<code>ConfigDict</code>\u3001<code>PrivateAttr</code></li> <li><code>Function</code>/<code>FunctionCall</code>/<code>ModelTool</code>\uff1aPydantic <code>BaseModel</code>\uff08\u9700\u8981\u5e8f\u5217\u5316\u80fd\u529b\uff09</li> <li><code>ModelResponse</code>\uff1a\u5df2\u662f <code>@dataclass</code></li> </ul>"},{"location":"refactor_v3/#42","title":"4.2 \u6539\u52a8\u8303\u56f4","text":"\u7c7b Before After \u7406\u7531 <code>Model</code> <code>BaseModel</code> <code>@dataclass</code> \u4e0e Agent \u4e00\u81f4\uff0c\u53bb\u6389 Pydantic \u4f9d\u8d56 <code>OpenAIChat</code> <code>Model(BaseModel)</code> <code>@dataclass</code> (\u7ee7\u627f Model) \u540c\u4e0a <code>Claude</code> <code>Model(BaseModel)</code> <code>@dataclass</code> \u540c\u4e0a <code>LiteLLMChat</code> <code>Model(BaseModel)</code> <code>@dataclass</code> \u540c\u4e0a <code>OllamaChat</code> <code>Model(BaseModel)</code> <code>@dataclass</code> \u540c\u4e0a <code>AzureOpenAIChat</code> <code>OpenAIChat</code> <code>@dataclass</code> \u540c\u4e0a <code>Function</code> <code>BaseModel</code> \u4fdd\u7559 BaseModel \u9700\u8981 JSON Schema \u751f\u6210\u548c\u5e8f\u5217\u5316 <code>FunctionCall</code> <code>BaseModel</code> \u4fdd\u7559 BaseModel \u9700\u8981\u5e8f\u5217\u5316 <code>ModelTool</code> <code>BaseModel</code> \u4fdd\u7559 BaseModel \u9700\u8981\u5e8f\u5217\u5316 <code>Message</code> <code>BaseModel</code> \u4fdd\u7559 BaseModel \u9700\u8981\u5e8f\u5217\u5316 <code>RunResponse</code> <code>BaseModel</code> \u4fdd\u7559 BaseModel \u9700\u8981\u5e8f\u5217\u5316"},{"location":"refactor_v3/#43-model","title":"4.3 Model \u57fa\u7c7b\u6539\u9020\u7ec6\u8282","text":"<pre><code># \u2500\u2500 Before \u2500\u2500\nclass Model(BaseModel):\n    id: str = Field(..., alias=\"model\")\n    name: Optional[str] = None\n    provider: Optional[str] = None\n    model_config = ConfigDict(arbitrary_types_allowed=True, populate_by_name=True)\n    _client: Optional[Any] = PrivateAttr(default=None)\n\n# \u2500\u2500 After \u2500\u2500\nfrom dataclasses import dataclass, field\nfrom abc import ABC, abstractmethod\n\n@dataclass\nclass Model(ABC):\n    id: str = \"not-provided\"       # \u53bb\u6389 alias\uff0c\u7edf\u4e00\u7528 id\n    name: Optional[str] = None\n    provider: Optional[str] = None\n    # ... \u5176\u4ed6\u5b57\u6bb5\n\n    # \u79c1\u6709\u5c5e\u6027\u7528 field(init=False, repr=False)\n    _client: Optional[Any] = field(init=False, repr=False, default=None)\n\n    def to_dict(self) -&gt; dict:\n        \"\"\"\u66ff\u4ee3 model_dump()\u3002\"\"\"\n        return {k: v for k, v in dataclasses.asdict(self).items()\n                if not k.startswith(\"_\")}\n</code></pre>"},{"location":"refactor_v3/#44","title":"4.4 \u7834\u574f\u6027\u53d8\u66f4","text":"<ul> <li><code>Model(model=\"gpt-4o\")</code> \u2192 <code>Model(id=\"gpt-4o\")</code>\uff08\u53bb\u6389 <code>alias=\"model\"</code>\uff09</li> <li><code>model.model_dump()</code> \u2192 <code>model.to_dict()</code></li> <li><code>model.model_copy()</code> \u2192 <code>copy.copy(model)</code> \u6216\u624b\u5199\u6d45\u62f7\u8d1d</li> <li><code>Field(default=...)</code> \u2192 <code>field(default=...)</code></li> <li><code>PrivateAttr()</code> \u2192 <code>field(init=False, repr=False)</code></li> </ul>"},{"location":"refactor_v3/#5-tool","title":"5. Tool \u6ce8\u518c\u673a\u5236","text":""},{"location":"refactor_v3/#51","title":"5.1 \u4fdd\u7559\u88f8\u51fd\u6570\u81ea\u52a8\u89e3\u6790","text":"<p>\u73b0\u6709 <code>Function.from_callable()</code> \u673a\u5236\u5b8c\u6574\u4fdd\u7559\uff0c\u7528\u6237\u53ef\u4ee5\u7ee7\u7eed\u4f20\u88f8\u51fd\u6570\uff1a</p> <pre><code>def calculate(expression: str) -&gt; str:\n    \"\"\"Evaluate a math expression.\"\"\"\n    return str(eval(expression))\n\nagent = Agent(tools=[calculate])  # \u81ea\u52a8\u89e3\u6790 docstring + type hints \u2192 Function\n</code></pre>"},{"location":"refactor_v3/#52-tool","title":"5.2 \u65b0\u589e @tool \u88c5\u9970\u5668","text":"<pre><code># agentica/tools/decorators.py\uff08\u65b0\u589e\u6587\u4ef6\uff09\nfrom functools import wraps\n\ndef tool(\n    name: str = None,\n    description: str = None,\n    show_result: bool = False,\n    sanitize_arguments: bool = True,\n):\n    \"\"\"\u88c5\u9970\u5668\uff1a\u4e3a\u51fd\u6570\u9644\u52a0\u5de5\u5177\u5143\u6570\u636e\uff0c\u4f20\u7ed9 Agent \u65f6\u81ea\u52a8\u8bc6\u522b\u3002\n\n    Example:\n        @tool(name=\"web_search\", description=\"Search the web\")\n        def search(query: str, max_results: int = 5) -&gt; str:\n            ...\n\n        agent = Agent(tools=[search])\n    \"\"\"\n    def decorator(func):\n        func._tool_metadata = {\n            \"name\": name or func.__name__,\n            \"description\": description or (func.__doc__ or \"\").strip(),\n            \"show_result\": show_result,\n            \"sanitize_arguments\": sanitize_arguments,\n        }\n        @wraps(func)\n        def wrapper(*args, **kwargs):\n            return func(*args, **kwargs)\n        wrapper._tool_metadata = func._tool_metadata\n        return wrapper\n    return decorator\n</code></pre>"},{"location":"refactor_v3/#53-tool-registry","title":"5.3 \u5168\u5c40 Tool Registry","text":"<pre><code># agentica/tools/registry.py\uff08\u65b0\u589e\u6587\u4ef6\uff09\nfrom typing import Dict, Union, Callable\n\n_TOOL_REGISTRY: Dict[str, Union[Callable, \"Tool\"]] = {}\n\n\ndef register_tool(name: str, tool_or_func) -&gt; None:\n    \"\"\"\u6ce8\u518c\u4e00\u4e2a\u5de5\u5177\u5230\u5168\u5c40\u6ce8\u518c\u8868\u3002\"\"\"\n    _TOOL_REGISTRY[name] = tool_or_func\n\n\ndef get_tool(name: str):\n    \"\"\"\u6309\u540d\u79f0\u83b7\u53d6\u5df2\u6ce8\u518c\u7684\u5de5\u5177\u3002\"\"\"\n    if name not in _TOOL_REGISTRY:\n        raise KeyError(f\"Tool '{name}' not found. Available: {sorted(_TOOL_REGISTRY.keys())}\")\n    return _TOOL_REGISTRY[name]\n\n\ndef list_tools() -&gt; list:\n    \"\"\"\u5217\u51fa\u6240\u6709\u5df2\u6ce8\u518c\u7684\u5de5\u5177\u540d\u79f0\u3002\"\"\"\n    return sorted(_TOOL_REGISTRY.keys())\n</code></pre>"},{"location":"refactor_v3/#54-functionfrom_callable","title":"5.4 Function.from_callable() \u589e\u5f3a","text":"<p>\u5728 <code>Function.from_callable()</code> \u4e2d\u589e\u52a0\u5bf9 <code>_tool_metadata</code> \u5c5e\u6027\u7684\u68c0\u6d4b\uff1a</p> <pre><code>@classmethod\ndef from_callable(cls, c: Callable, strict: bool = False) -&gt; \"Function\":\n    # \u68c0\u6d4b @tool \u88c5\u9970\u5668\u5143\u6570\u636e\n    metadata = getattr(c, \"_tool_metadata\", None)\n    if metadata:\n        return cls(\n            name=metadata[\"name\"],\n            description=metadata[\"description\"],\n            entrypoint=c,\n            show_result=metadata.get(\"show_result\", False),\n            sanitize_arguments=metadata.get(\"sanitize_arguments\", True),\n        )\n    # \u539f\u6709\u903b\u8f91\uff1a\u4ece docstring + type hints \u81ea\u52a8\u89e3\u6790\n    ...\n</code></pre>"},{"location":"refactor_v3/#6-runner","title":"6. Runner \u62c6\u5206","text":""},{"location":"refactor_v3/#61","title":"6.1 \u73b0\u72b6","text":"<p><code>RunnerMixin</code>\uff08724 \u884c\uff09\u662f\u4e00\u4e2a\u6df7\u5165\u7c7b\uff0c\u5305\u542b\u6240\u6709\u6267\u884c\u903b\u8f91\u3002<code>Agent</code> \u901a\u8fc7\u591a\u7ee7\u627f\u83b7\u5f97\u8fd9\u4e9b\u65b9\u6cd5\u3002</p>"},{"location":"refactor_v3/#62","title":"6.2 \u62c6\u5206\u65b9\u6848","text":"<p>\u65b0\u5efa <code>agentica/runner.py</code>\uff0c\u5c06 <code>RunnerMixin</code> \u62c6\u5206\u4e3a\u72ec\u7acb\u7684 <code>Runner</code> \u7c7b\uff1a</p> <pre><code># agentica/runner.py\nclass Runner:\n    \"\"\"Agent \u7684\u6267\u884c\u5f15\u64ce\u3002\u5904\u7406\u5355\u8f6e/\u591a\u8f6e LLM \u8c03\u7528 + \u5de5\u5177\u6267\u884c\u3002\n\n    Runner \u4e0e Agent \u89e3\u8026\uff1a\n    - Agent \u8d1f\u8d23\u5b9a\u4e49\uff08model, tools, instructions, prompt \u6784\u5efa\uff09\n    - Runner \u8d1f\u8d23\u6267\u884c\uff08LLM \u8c03\u7528\u3001\u5de5\u5177\u8c03\u7528\u3001\u6d41\u5f0f\u5904\u7406\u3001\u8bb0\u5fc6\u66f4\u65b0\uff09\n    \"\"\"\n\n    def __init__(self, agent: \"Agent\"):\n        self.agent = agent\n\n    async def _run_impl(\n        self, message, *, stream, audio, images, videos, messages, ...\n    ) -&gt; AsyncIterator[RunResponse]:\n        \"\"\"\u6838\u5fc3\u6267\u884c\u5f15\u64ce\uff08\u4ece RunnerMixin._run_impl \u8fc1\u79fb\uff09\u3002\"\"\"\n        ...\n\n    async def _consume_run(self, message, ...) -&gt; RunResponse:\n        \"\"\"\u6d88\u8d39 _run_impl \u751f\u6210\u5668\u5e76\u8fd4\u56de\u6700\u7ec8\u54cd\u5e94\u3002\"\"\"\n        ...\n\n    async def run(self, message=None, **kwargs) -&gt; RunResponse:\n        \"\"\"\u4e3b\u8981\u5f02\u6b65 API\uff08\u975e\u6d41\u5f0f\uff09\u3002\"\"\"\n        ...\n\n    async def run_stream(self, message=None, **kwargs) -&gt; AsyncIterator[RunResponse]:\n        \"\"\"\u6d41\u5f0f\u5f02\u6b65 API\u3002\"\"\"\n        ...\n\n    def run_sync(self, message=None, **kwargs) -&gt; RunResponse:\n        \"\"\"run() \u7684\u540c\u6b65\u5305\u88c5\u5668\u3002\"\"\"\n        ...\n\n    def run_stream_sync(self, message=None, **kwargs) -&gt; Iterator[RunResponse]:\n        \"\"\"run_stream() \u7684\u540c\u6b65\u5305\u88c5\u5668\u3002\"\"\"\n        ...\n</code></pre> <p>Agent \u4fa7\u6539\u9020\uff08\u4f18\u96c5\u59d4\u6258\uff09\uff1a</p> <pre><code># agentica/agent/base.py\n@dataclass(init=False)\nclass Agent(PromptsMixin, TeamMixin, ToolsMixin, PrinterMixin):\n    # \u6ce8\u610f\uff1a\u53bb\u6389\u4e86 RunnerMixin\n\n    def __init__(self, ...):\n        ...\n        self._runner = Runner(self)\n\n    # \u2500\u2500 \u516c\u5171 API \u4e0d\u53d8\uff0c\u7528\u6237\u4ee3\u7801\u96f6\u6539\u52a8 \u2500\u2500\n\n    async def run(self, message=None, **kwargs) -&gt; RunResponse:\n        return await self._runner.run(message, **kwargs)\n\n    async def run_stream(self, message=None, **kwargs) -&gt; AsyncIterator[RunResponse]:\n        async for chunk in self._runner.run_stream(message, **kwargs):\n            yield chunk\n\n    def run_sync(self, message=None, **kwargs) -&gt; RunResponse:\n        return self._runner.run_sync(message, **kwargs)\n\n    def run_stream_sync(self, message=None, **kwargs) -&gt; Iterator[RunResponse]:\n        return self._runner.run_stream_sync(message, **kwargs)\n</code></pre>"},{"location":"refactor_v3/#63","title":"6.3 \u4f18\u52bf","text":"<ul> <li>Agent \u516c\u5171 API \u5b8c\u5168\u4e0d\u53d8\uff1a<code>agent.run()</code> / <code>agent.run_stream()</code> / <code>agent.run_sync()</code> \u7b7e\u540d\u4fdd\u6301\u4e00\u81f4</li> <li>Runner \u53ef\u72ec\u7acb\u6d4b\u8bd5\uff1amock Agent \u5373\u53ef\u5355\u72ec\u6d4b\u8bd5\u6267\u884c\u903b\u8f91</li> <li>\u53ef\u6269\u5c55\uff1a<code>DeepAgent</code> \u53ef\u4ee5\u7528\u4e0d\u540c\u7684 Runner \u5b9e\u73b0\uff08\u5982 <code>DeepRunner</code>\uff09\uff0c\u65e0\u9700\u4fee\u6539 Agent \u57fa\u7c7b</li> <li>\u5173\u6ce8\u70b9\u5206\u79bb\uff1aAgent \u8d1f\u8d23\u300c\u662f\u4ec0\u4e48\u300d\uff08\u5b9a\u4e49\uff09\uff0cRunner \u8d1f\u8d23\u300c\u600e\u4e48\u505a\u300d\uff08\u6267\u884c\uff09</li> </ul>"},{"location":"refactor_v3/#7-guardrails","title":"7. Guardrails \u7edf\u4e00\u62bd\u8c61","text":""},{"location":"refactor_v3/#71","title":"7.1 \u73b0\u72b6\u5206\u6790","text":"<p><code>guardrails/base.py</code>\uff08615 \u884c\uff09\u548c <code>guardrails/tool.py</code>\uff08638 \u884c\uff09\u6709\u5927\u91cf\u7ed3\u6784\u91cd\u590d\uff1a</p> \u7ed3\u6784 base.py (Agent \u7ea7) tool.py (Tool \u7ea7) \u5f02\u5e38\u57fa\u7c7b <code>GuardrailTripwireTriggered</code> <code>ToolGuardrailTripwireTriggered</code> \u8f93\u5165\u5f02\u5e38 <code>InputGuardrailTripwireTriggered</code> <code>ToolInputGuardrailTripwireTriggered</code> \u8f93\u51fa\u5f02\u5e38 <code>OutputGuardrailTripwireTriggered</code> <code>ToolOutputGuardrailTripwireTriggered</code> \u51fd\u6570\u8f93\u51fa <code>GuardrailFunctionOutput</code> <code>ToolGuardrailFunctionOutput</code> \u8f93\u5165\u7ed3\u679c <code>InputGuardrailResult</code> <code>ToolInputGuardrailResult</code> \u8f93\u51fa\u7ed3\u679c <code>OutputGuardrailResult</code> <code>ToolOutputGuardrailResult</code> \u8f93\u5165 Guard <code>InputGuardrail</code> <code>ToolInputGuardrail</code> \u8f93\u51fa Guard <code>OutputGuardrail</code> <code>ToolOutputGuardrail</code> \u88c5\u9970\u5668 <code>@input_guardrail</code> / <code>@output_guardrail</code> <code>@tool_input_guardrail</code> / <code>@tool_output_guardrail</code> \u6267\u884c\u51fd\u6570 <code>run_input_guardrails()</code> / <code>run_output_guardrails()</code> <code>run_tool_input_guardrails()</code> / <code>run_tool_output_guardrails()</code> <p>\u4e24\u8005\u6838\u5fc3\u903b\u8f91\u51e0\u4e4e\u76f8\u540c\uff1aguard \u2192 validate \u2192 raise/reject \u6a21\u5f0f\u3002</p>"},{"location":"refactor_v3/#72","title":"7.2 \u91cd\u6784\u65b9\u6848\uff1a\u4e09\u5c42\u62bd\u8c61","text":"<pre><code>guardrails/\n\u251c\u2500\u2500 __init__.py          # \u516c\u5171 API \u5bfc\u51fa\n\u251c\u2500\u2500 core.py              # \u3010\u65b0\u589e\u3011\u7edf\u4e00\u62bd\u8c61\u5c42\n\u251c\u2500\u2500 agent.py             # \u539f base.py\uff0c\u7cbe\u7b80\u540e\u7ee7\u627f core\n\u2514\u2500\u2500 tool.py              # \u7cbe\u7b80\u540e\u7ee7\u627f core\n</code></pre> <p>\u6838\u5fc3\u62bd\u8c61\u5c42 <code>core.py</code>\uff1a</p> <pre><code>\"\"\"Guardrail \u7edf\u4e00\u62bd\u8c61\u5c42\u3002\n\n\u63d0\u4f9b\u57fa\u7840\u5f02\u5e38\u3001\u884c\u4e3a\u5b9a\u4e49\u3001Guard \u57fa\u7c7b\uff0c\nagent.py \u548c tool.py \u901a\u8fc7\u7ee7\u627f/\u7ec4\u5408\u5b9e\u73b0\u5177\u4f53\u903b\u8f91\u3002\n\"\"\"\n\nfrom dataclasses import dataclass\nfrom typing import Generic, TypeVar, Optional, Any, Callable, Union\nfrom enum import Enum\n\n\n# \u2500\u2500 \u884c\u4e3a\u5b9a\u4e49\uff08\u7edf\u4e00 Agent \u7ea7\u548c Tool \u7ea7\uff09 \u2500\u2500\n\nclass GuardrailAction(str, Enum):\n    \"\"\"Guardrail \u89e6\u53d1\u540e\u7684\u884c\u4e3a\u3002\"\"\"\n    ALLOW = \"allow\"              # \u901a\u8fc7\n    BLOCK = \"block\"              # \u963b\u65ad\uff08Agent \u7ea7\uff1a\u629b\u5f02\u5e38\uff1bTool \u7ea7\uff1a\u629b\u5f02\u5e38\uff09\n    REJECT_CONTENT = \"reject\"    # \u66ff\u6362\u5185\u5bb9\u7ee7\u7eed\uff08\u4ec5 Tool \u7ea7\u4f7f\u7528\uff09\n\n\n@dataclass\nclass GuardrailOutput:\n    \"\"\"Guardrail \u51fd\u6570\u7684\u7edf\u4e00\u8f93\u51fa\u3002\"\"\"\n    action: GuardrailAction\n    output_info: Any = None\n    reject_message: Optional[str] = None  # \u4ec5 REJECT_CONTENT \u65f6\u4f7f\u7528\n\n    @classmethod\n    def allow(cls, output_info=None):\n        return cls(action=GuardrailAction.ALLOW, output_info=output_info)\n\n    @classmethod\n    def block(cls, output_info=None):\n        return cls(action=GuardrailAction.BLOCK, output_info=output_info)\n\n    @classmethod\n    def reject(cls, message: str, output_info=None):\n        return cls(action=GuardrailAction.REJECT_CONTENT,\n                   reject_message=message, output_info=output_info)\n\n\n# \u2500\u2500 \u7edf\u4e00\u5f02\u5e38\u4f53\u7cfb \u2500\u2500\n\nclass GuardrailTriggered(Exception):\n    \"\"\"Guardrail \u89e6\u53d1\u7684\u57fa\u7840\u5f02\u5e38\u3002\"\"\"\n    def __init__(self, guardrail_name: str, output: GuardrailOutput):\n        self.guardrail_name = guardrail_name\n        self.output = output\n        super().__init__(f\"Guardrail '{guardrail_name}' triggered: {output.action.value}\")\n\n\n# \u2500\u2500 Guard \u57fa\u7c7b \u2500\u2500\n\nTData = TypeVar(\"TData\")\n\n@dataclass\nclass BaseGuardrail(Generic[TData]):\n    \"\"\"Guard \u57fa\u7c7b\uff1a\u5c01\u88c5\u9a8c\u8bc1\u51fd\u6570 + \u6267\u884c\u903b\u8f91\u3002\"\"\"\n    guardrail_function: Callable\n    name: Optional[str] = None\n\n    def __post_init__(self):\n        if self.name is None:\n            self.name = getattr(self.guardrail_function, \"__name__\", \"unnamed_guardrail\")\n\n    async def run(self, data: TData) -&gt; GuardrailOutput:\n        \"\"\"\u6267\u884c guardrail \u51fd\u6570\uff0c\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u51fd\u6570\u3002\"\"\"\n        import asyncio\n        result = self.guardrail_function(data)\n        if asyncio.iscoroutine(result):\n            result = await result\n\n        # \u517c\u5bb9\uff1a\u5982\u679c\u8fd4\u56de bool\uff0c\u8f6c\u4e3a GuardrailOutput\n        if isinstance(result, bool):\n            return GuardrailOutput.allow() if result else GuardrailOutput.block()\n        if isinstance(result, GuardrailOutput):\n            return result\n        raise TypeError(\n            f\"Guardrail '{self.name}' must return bool or GuardrailOutput, \"\n            f\"got {type(result)}\"\n        )\n\n\nasync def run_guardrails(guardrails, data, exception_class=GuardrailTriggered):\n    \"\"\"\u7edf\u4e00\u7684 guardrail \u6267\u884c\u5f15\u64ce\u3002\n\n    \u987a\u5e8f\u6267\u884c\u6240\u6709 guardrails\uff0c\u6839\u636e action \u51b3\u5b9a\u884c\u4e3a\uff1a\n    - ALLOW: \u7ee7\u7eed\n    - BLOCK: \u629b\u51fa exception_class\n    - REJECT_CONTENT: \u8fd4\u56de (reject_message, guardrail_result)\n    \"\"\"\n    results = []\n    for guard in guardrails:\n        output = await guard.run(data)\n        results.append(output)\n        if output.action == GuardrailAction.BLOCK:\n            raise exception_class(guard.name, output)\n        if output.action == GuardrailAction.REJECT_CONTENT:\n            return output, results  # \u8c03\u7528\u65b9\u5904\u7406\u66ff\u6362\n    return None, results  # \u5168\u90e8\u901a\u8fc7\n</code></pre> <p>\u7cbe\u7b80\u540e\u7684 <code>agent.py</code>\uff08\u539f base.py\uff09\uff1a</p> <pre><code>\"\"\"Agent \u7ea7 Guardrails\uff1a\u9a8c\u8bc1 Agent \u8f93\u5165/\u8f93\u51fa\u3002\"\"\"\n\nfrom .core import BaseGuardrail, GuardrailTriggered, GuardrailOutput, run_guardrails\n\n\nclass InputGuardrailTriggered(GuardrailTriggered):\n    \"\"\"\u8f93\u5165 guardrail \u89e6\u53d1\u5f02\u5e38\u3002\"\"\"\n    pass\n\n\nclass OutputGuardrailTriggered(GuardrailTriggered):\n    \"\"\"\u8f93\u51fa guardrail \u89e6\u53d1\u5f02\u5e38\u3002\"\"\"\n    pass\n\n\nclass InputGuardrail(BaseGuardrail):\n    \"\"\"Agent \u8f93\u5165\u9a8c\u8bc1\u5668\u3002\"\"\"\n    run_in_parallel: bool = False\n\n\nclass OutputGuardrail(BaseGuardrail):\n    \"\"\"Agent \u8f93\u51fa\u9a8c\u8bc1\u5668\u3002\"\"\"\n    pass\n\n\nasync def run_input_guardrails(guardrails, data):\n    return await run_guardrails(guardrails, data, InputGuardrailTriggered)\n\n\nasync def run_output_guardrails(guardrails, data):\n    return await run_guardrails(guardrails, data, OutputGuardrailTriggered)\n\n\n# \u88c5\u9970\u5668\ndef input_guardrail(func=None, *, name=None, run_in_parallel=False):\n    ...  # \u540c\u73b0\u6709\u903b\u8f91\uff0c\u4f46\u4ee3\u7801\u91cf\u5927\u5e45\u51cf\u5c11\n\ndef output_guardrail(func=None, *, name=None):\n    ...\n</code></pre> <p>\u7cbe\u7b80\u540e\u7684 <code>tool.py</code>\uff1a</p> <pre><code>\"\"\"Tool \u7ea7 Guardrails\uff1a\u9a8c\u8bc1\u5de5\u5177\u8c03\u7528\u8f93\u5165/\u8f93\u51fa\u3002\"\"\"\n\nfrom .core import BaseGuardrail, GuardrailTriggered, GuardrailOutput, run_guardrails\n\n\nclass ToolInputGuardrailTriggered(GuardrailTriggered):\n    pass\n\n\nclass ToolOutputGuardrailTriggered(GuardrailTriggered):\n    pass\n\n\nclass ToolInputGuardrail(BaseGuardrail):\n    pass\n\n\nclass ToolOutputGuardrail(BaseGuardrail):\n    pass\n\n\nasync def run_tool_input_guardrails(guardrails, data):\n    return await run_guardrails(guardrails, data, ToolInputGuardrailTriggered)\n\n\nasync def run_tool_output_guardrails(guardrails, data):\n    return await run_guardrails(guardrails, data, ToolOutputGuardrailTriggered)\n\n\n# \u88c5\u9970\u5668\ndef tool_input_guardrail(func=None, *, name=None):\n    ...\n\ndef tool_output_guardrail(func=None, *, name=None):\n    ...\n</code></pre>"},{"location":"refactor_v3/#73","title":"7.3 \u9884\u4f30\u6548\u679c","text":"\u6587\u4ef6 Before After base.py \u2192 agent.py 615 \u884c ~120 \u884c tool.py 638 \u884c ~120 \u884c core.py\uff08\u65b0\u589e\uff09 - ~100 \u884c \u603b\u8ba1 1253 \u884c ~340 \u884c <p>\u51cf\u5c11\u7ea6 73% \u7684\u4ee3\u7801\u91cf\u3002</p>"},{"location":"refactor_v3/#8-__init__py","title":"8. <code>__init__.py</code> \u7b80\u5316\u4e0e\u6309\u6a21\u5757\u62c6\u5206\u5bfc\u51fa","text":""},{"location":"refactor_v3/#81","title":"8.1 \u73b0\u72b6","text":"<p><code>agentica/__init__.py</code> \u6709 534 \u884c\uff0c\u6df7\u5408\u4e86\uff1a - \u5373\u65f6\u5bfc\u5165\uff08Model provider\u3001Agent\u3001\u6838\u5fc3\u7c7b\uff09 - \u61d2\u52a0\u8f7d\u903b\u8f91\uff0890+ \u4e2a\u540d\u79f0\uff0cthreading.Lock \u53cc\u91cd\u68c0\u67e5\u9501\uff09 - <code>__all__</code> \u5217\u8868 - <code>TYPE_CHECKING</code> \u5757</p>"},{"location":"refactor_v3/#82","title":"8.2 \u91cd\u6784\u65b9\u6848\uff1a\u6309\u6a21\u5757\u62c6\u5206\u5bfc\u51fa","text":"<p>\u539f\u5219\uff1a\u6839 <code>__init__.py</code> \u53ea\u5bfc\u51fa\u6700\u6838\u5fc3\u7684\u9876\u5c42 API\uff0c\u5176\u4f59\u6309\u5b50\u6a21\u5757\u6309\u9700\u5bfc\u5165\u3002</p> <p>\u7528\u6237\u89c6\u89d2\u7684\u5bfc\u5165\u65b9\u5f0f\u53d8\u5316\uff1a</p> <pre><code># \u2500\u2500 \u9876\u5c42 API\uff08\u4ece agentica \u76f4\u63a5\u5bfc\u5165\uff0c\u4e0d\u53d8\uff09\u2500\u2500\nfrom agentica import Agent, DeepAgent, Workflow, RunConfig\nfrom agentica import OpenAIChat, OpenAILike, LiteLLMChat, AzureOpenAIChat\nfrom agentica import Message, RunResponse, ModelResponse\nfrom agentica import Tool, Function\n\n# \u2500\u2500 Model \u76f8\u5173\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.model import Claude, OllamaChat\nfrom agentica.model.providers import create_provider\n\n# \u2500\u2500 \u5de5\u5177\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.tools import ShellTool, CodeTool, DalleTool\nfrom agentica.tools import SearchSerperTool, DuckDuckGoTool\n\n# \u2500\u2500 \u6570\u636e\u5e93\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.db import SqliteDb, PostgresDb, InMemoryDb\n\n# \u2500\u2500 \u77e5\u8bc6\u5e93 &amp; \u5411\u91cf\u5e93\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.knowledge import Knowledge, LlamaIndexKnowledge\nfrom agentica.vectordb import InMemoryVectorDb, SearchType\n\n# \u2500\u2500 Embedding\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.embedding import OpenAIEmbedding, OllamaEmbedding\n\n# \u2500\u2500 Guardrails\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.guardrails import InputGuardrail, OutputGuardrail\n\n# \u2500\u2500 MCP/ACP\uff08\u4ece\u5b50\u6a21\u5757\u5bfc\u5165\uff09\u2500\u2500\nfrom agentica.mcp import MCPConfig, McpTool\nfrom agentica.acp import ACPServer, ACPTool\n</code></pre> <p>\u7cbe\u7b80\u540e\u7684 <code>agentica/__init__.py</code>\uff1a</p> <pre><code>\"\"\"Agentica: Build AI Agents with ease.\n\nCore API:\n    from agentica import Agent, OpenAIChat\n\nSub-module imports:\n    from agentica.model import Claude, OllamaChat\n    from agentica.model.providers import create_provider\n    from agentica.tools import ShellTool, CodeTool\n    from agentica.db import SqliteDb\n\"\"\"\n\n# \u2500\u2500 \u914d\u7f6e \u2500\u2500\nfrom agentica.config import (\n    AGENTICA_HOME,\n    AGENTICA_DOTENV_PATH,\n    AGENTICA_LOG_LEVEL,\n)\n\n# \u2500\u2500 \u65e5\u5fd7 \u2500\u2500\nfrom agentica.utils.log import logger, set_log_level_to_debug\n\n# \u2500\u2500 \u6838\u5fc3 Model \u2500\u2500\nfrom agentica.model.base import Model\nfrom agentica.model.message import Message\nfrom agentica.model.response import ModelResponse, ModelResponseEvent\nfrom agentica.model.content import Media, Image, Audio, Video\nfrom agentica.model.usage import Usage\nfrom agentica.model.openai.chat import OpenAIChat\nfrom agentica.model.openai.like import OpenAILike\nfrom agentica.model.azure.openai_chat import AzureOpenAIChat\n\n# \u2500\u2500 \u6838\u5fc3 Agent \u2500\u2500\nfrom agentica.agent.base import Agent\nfrom agentica.deep_agent.base import DeepAgent\nfrom agentica.workflow.workflow import Workflow\n\n# \u2500\u2500 \u8fd0\u884c\u914d\u7f6e &amp; \u54cd\u5e94 \u2500\u2500\nfrom agentica.run.response import RunResponse, RunResponseExtraData\nfrom agentica.run.config import RunConfig\n\n# \u2500\u2500 \u5de5\u5177\u57fa\u7c7b \u2500\u2500\nfrom agentica.tools.base import Tool, Function, FunctionCall, ModelTool\n\n# \u2500\u2500 \u8bb0\u5fc6 \u2500\u2500\nfrom agentica.memory.base import AgentRun, SessionSummary, WorkingMemory\n\n# \u2500\u2500 \u6570\u636e\u5e93\u57fa\u7c7b \u2500\u2500\nfrom agentica.db.base import BaseDb\n\n# \u2500\u2500 \u5411\u540e\u517c\u5bb9\u522b\u540d\uff08provider \u5de5\u5382\u51fd\u6570\uff09\u2500\u2500\nfrom agentica.model.providers import create_provider\n\ndef DeepSeekChat(**kwargs):\n    return create_provider(\"deepseek\", **kwargs)\n\ndef QwenChat(**kwargs):\n    return create_provider(\"qwen\", **kwargs)\n\ndef ZhipuAIChat(**kwargs):\n    return create_provider(\"zhipuai\", **kwargs)\n\ndef MoonshotChat(**kwargs):\n    return create_provider(\"moonshot\", **kwargs)\n\ndef DoubaoChat(**kwargs):\n    return create_provider(\"doubao\", **kwargs)\n\ndef GrokChat(**kwargs):\n    return create_provider(\"xai\", **kwargs)\n\ndef YiChat(**kwargs):\n    return create_provider(\"yi\", **kwargs)\n\n# \u2500\u2500 \u61d2\u52a0\u8f7d\uff08\u4ec5\u4fdd\u7559\u5c11\u91cf\u9ad8\u9891\u4f46\u91cd\u578b\u7684\u4f9d\u8d56\uff09\u2500\u2500\ndef __getattr__(name):\n    _LAZY = {\n        \"Claude\": \"agentica.model.anthropic.claude\",\n        \"OllamaChat\": \"agentica.model.ollama.chat\",\n        \"LiteLLMChat\": \"agentica.model.litellm.chat\",\n    }\n    if name in _LAZY:\n        import importlib\n        module = importlib.import_module(_LAZY[name])\n        return getattr(module, name)\n    raise AttributeError(f\"module 'agentica' has no attribute '{name}'\")\n</code></pre>"},{"location":"refactor_v3/#83","title":"8.3 \u9884\u4f30\u6548\u679c","text":"\u6307\u6807 Before After <code>__init__.py</code> \u884c\u6570 534 \u884c ~100 \u884c \u5373\u65f6\u5bfc\u5165\u6570\u91cf ~50+ \u4e2a ~25 \u4e2a\uff08\u6838\u5fc3 API\uff09 \u61d2\u52a0\u8f7d\u540d\u79f0\u6570 ~90 \u4e2a ~3 \u4e2a\uff08\u5176\u4f59\u8d70\u5b50\u6a21\u5757\u5bfc\u5165\uff09 \u542f\u52a8 import \u8017\u65f6 \u8f83\u91cd \u663e\u8457\u51cf\u8f7b"},{"location":"refactor_v3/#9","title":"9. \u6267\u884c\u8ba1\u5212\u4e0e\u9636\u6bb5\u5212\u5206","text":""},{"location":"refactor_v3/#phase-1-model","title":"Phase 1: Model \u5c42\u7cbe\u7b80\uff08\u4f18\u5148\u7ea7\u6700\u9ad8\uff09","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 1.1 \u521b\u5efa <code>model/providers.py</code>\uff0c\u6ce8\u518c 13 \u4e2a OpenAI-Compatible provider \u65b0\u589e 1 \u6587\u4ef6 1.2 \u5220\u9664 19 \u4e2a provider \u5b50\u76ee\u5f55 \u5220\u9664 19 \u76ee\u5f55 ~40 \u6587\u4ef6 1.3 \u5728 <code>model/__init__.py</code> \u6dfb\u52a0\u5411\u540e\u517c\u5bb9\u522b\u540d \u4fee\u6539 1 \u6587\u4ef6 1.4 \u66f4\u65b0 <code>agentica/__init__.py</code>\uff0c\u5220\u9664\u5df2\u5220 provider \u7684\u5bfc\u5165 \u4fee\u6539 1 \u6587\u4ef6 1.5 \u66f4\u65b0\u6240\u6709 examples\uff08DeepSeekChat \u00d73, ZhipuAIChat \u00d75\uff09 \u4fee\u6539 8 \u6587\u4ef6"},{"location":"refactor_v3/#phase-2-modelagent-dataclass","title":"Phase 2: Model/Agent dataclass \u5316","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 2.1 <code>Model</code> \u57fa\u7c7b <code>BaseModel</code> \u2192 <code>@dataclass</code> + ABC \u4fee\u6539 <code>model/base.py</code> 2.2 \u53bb\u6389 <code>Field(alias=\"model\")</code>\uff0c\u7edf\u4e00\u7528 <code>id</code> \u4fee\u6539 <code>model/base.py</code> 2.3 OpenAIChat, Claude, LiteLLMChat, OllamaChat, AzureOpenAI \u540c\u6b65\u6539 \u4fee\u6539 5 \u6587\u4ef6 2.4 <code>model_dump()</code> \u2192 <code>to_dict()</code>\uff0c<code>PrivateAttr</code> \u2192 <code>field()</code> \u4fee\u6539 base + 5 provider 2.5 Model \u57fa\u7c7b\u52a0 <code>@abstractmethod</code> \u6807\u8bb0 \u4fee\u6539 <code>model/base.py</code>"},{"location":"refactor_v3/#phase-3","title":"Phase 3: \u5f02\u6b65\u63a5\u53e3\u4e00\u81f4\u6027 + \u7ed3\u6784\u5316\u8f93\u51fa","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 3.1 LiteLLM <code>_handle_tool_calls</code> \u53bb\u6389\u4e0b\u5212\u7ebf\u524d\u7f00 \u4fee\u6539 <code>litellm/chat.py</code> 3.2 Claude \u65b0\u589e\u7ed3\u6784\u5316\u8f93\u51fa\uff08tool_use \u6a21\u5f0f\uff09 \u4fee\u6539 <code>anthropic/claude.py</code> 3.3 LiteLLM \u63a5\u5165 <code>response_format</code> \u539f\u751f \u4fee\u6539 <code>litellm/chat.py</code> 3.4 Ollama \u63a5\u5165 <code>format=schema</code> \u539f\u751f \u4fee\u6539 <code>ollama/chat.py</code> 3.5 Model \u57fa\u7c7b\u65b0\u589e <code>get_response_format()</code> \u63a5\u53e3 \u4fee\u6539 <code>model/base.py</code> 3.6 Runner \u4fa7\uff1a\u4e3b\u8def\u5f84\u4f18\u5148\u7528 <code>parsed</code>\uff0c\u6587\u672c\u89e3\u6790\u964d\u7ea7\u4e3a\u515c\u5e95 \u4fee\u6539 <code>agent/runner.py</code> 3.7 <code>parse_structured_output()</code> \u6807\u8bb0 deprecated \u4fee\u6539 <code>utils/string.py</code>"},{"location":"refactor_v3/#phase-4-tool","title":"Phase 4: Tool \u6ce8\u518c\u673a\u5236","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 4.1 \u65b0\u589e <code>tools/decorators.py</code>\uff08@tool \u88c5\u9970\u5668\uff09 \u65b0\u589e 1 \u6587\u4ef6 4.2 \u65b0\u589e <code>tools/registry.py</code>\uff08\u5168\u5c40\u6ce8\u518c\u8868\uff09 \u65b0\u589e 1 \u6587\u4ef6 4.3 <code>Function.from_callable()</code> \u589e\u52a0 <code>_tool_metadata</code> \u68c0\u6d4b \u4fee\u6539 <code>tools/base.py</code> 4.4 <code>tools/__init__.py</code> \u5bfc\u51fa\u65b0\u589e API \u4fee\u6539 1 \u6587\u4ef6"},{"location":"refactor_v3/#phase-5-runner","title":"Phase 5: Runner \u62c6\u5206","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 5.1 \u65b0\u5efa <code>agentica/runner.py</code>\uff0c\u4ece <code>agent/runner.py</code> \u8fc1\u79fb\u903b\u8f91 \u65b0\u589e 1 \u6587\u4ef6 5.2 Agent \u53bb\u6389 RunnerMixin \u7ee7\u627f\uff0c\u6539\u4e3a\u6301\u6709 <code>_runner: Runner</code> \u4fee\u6539 <code>agent/base.py</code> 5.3 Agent \u7684 <code>run()</code>/<code>run_stream()</code> \u7b49\u59d4\u6258\u7ed9 Runner \u4fee\u6539 <code>agent/base.py</code> 5.4 \u5220\u9664 <code>agent/runner.py</code>\uff08\u539f RunnerMixin\uff09 \u5220\u9664 1 \u6587\u4ef6 5.5 DeepAgent \u9002\u914d\u65b0 Runner \u4fee\u6539 <code>deep_agent/base.py</code>"},{"location":"refactor_v3/#phase-6-guardrails","title":"Phase 6: Guardrails \u7edf\u4e00\u62bd\u8c61","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 6.1 \u65b0\u5efa <code>guardrails/core.py</code>\uff08\u7edf\u4e00\u62bd\u8c61\u5c42\uff09 \u65b0\u589e 1 \u6587\u4ef6 6.2 <code>guardrails/base.py</code> \u2192 <code>guardrails/agent.py</code>\uff0c\u7ee7\u627f core \u91cd\u5199 1 \u6587\u4ef6 6.3 <code>guardrails/tool.py</code> \u7cbe\u7b80\uff0c\u7ee7\u627f core \u91cd\u5199 1 \u6587\u4ef6 6.4 \u66f4\u65b0 <code>guardrails/__init__.py</code> \u5bfc\u51fa \u4fee\u6539 1 \u6587\u4ef6"},{"location":"refactor_v3/#phase-7-__init__py","title":"Phase 7: <code>__init__.py</code> \u7b80\u5316","text":"\u6b65\u9aa4 \u4efb\u52a1 \u6587\u4ef6\u53d8\u66f4 7.1 \u91cd\u5199 <code>agentica/__init__.py</code>\uff08~100 \u884c\uff09 \u4fee\u6539 1 \u6587\u4ef6 7.2 \u786e\u4fdd\u5404\u5b50\u6a21\u5757 <code>__init__.py</code> \u5bfc\u51fa\u5b8c\u6574 \u4fee\u6539\u591a\u4e2a <code>__init__.py</code> 7.3 \u9a8c\u8bc1\u6240\u6709 <code>from agentica import X</code> \u4ecd\u80fd\u6b63\u5e38\u5de5\u4f5c \u6d4b\u8bd5"},{"location":"refactor_v3/#phase-8","title":"Phase 8: \u6d4b\u8bd5 + \u6e05\u7406","text":"\u6b65\u9aa4 \u4efb\u52a1 8.1 \u8865\u5145 provider \u5de5\u5382\u51fd\u6570\u7684\u5355\u5143\u6d4b\u8bd5 8.2 \u8865\u5145\u5404 provider \u7ed3\u6784\u5316\u8f93\u51fa\u7684\u5355\u5143\u6d4b\u8bd5 8.3 \u8865\u5145 Runner \u72ec\u7acb\u6d4b\u8bd5 8.4 \u8865\u5145 Guardrail core \u6d4b\u8bd5 8.5 \u66f4\u65b0\u6240\u6709 examples \u6587\u4ef6 8.6 \u66f4\u65b0 CLAUDE.md \u67b6\u6784\u8bf4\u660e"},{"location":"refactor_v3/#10","title":"10. \u6267\u884c\u987a\u5e8f\u4f9d\u8d56\u56fe","text":"<pre><code>Phase 1 (Model\u7cbe\u7b80)\n    \u2193\nPhase 2 (dataclass\u5316)  \u2190\u2500 \u5148\u5220 19 \u76ee\u5f55\uff0c\u518d\u6539 5 \u4e2a provider \u5230 dataclass\n    \u2193\nPhase 3 (\u5f02\u6b65\u4e00\u81f4\u6027 + \u7ed3\u6784\u5316\u8f93\u51fa)  \u2190\u2500 Model \u63a5\u53e3\u7a33\u5b9a\u540e\u518d\u6539\n    \u2193\nPhase 4 (Tool\u6ce8\u518c)  \u2190\u2500 \u72ec\u7acb\uff0c\u53ef\u4e0e Phase 3 \u5e76\u884c\n    \u2193\nPhase 5 (Runner\u62c6\u5206)  \u2190\u2500 \u4f9d\u8d56 Phase 3\uff08\u7ed3\u6784\u5316\u8f93\u51fa\u7b80\u5316\u540e Runner \u903b\u8f91\u66f4\u6e05\u6670\uff09\n    \u2193\nPhase 6 (Guardrails\u7edf\u4e00)  \u2190\u2500 \u72ec\u7acb\uff0c\u53ef\u4e0e Phase 5 \u5e76\u884c\n    \u2193\nPhase 7 (__init__.py)  \u2190\u2500 \u6240\u6709\u6a21\u5757\u7a33\u5b9a\u540e\u6700\u540e\u5904\u7406\n    \u2193\nPhase 8 (\u6d4b\u8bd5\u6e05\u7406)\n</code></pre> <p>\u63a8\u8350\u6267\u884c\u987a\u5e8f\uff1a1 \u2192 2 \u2192 3 \u2192 (4 &amp; 5 \u5e76\u884c) \u2192 6 \u2192 7 \u2192 8</p> <p>\u6bcf\u4e2a Phase \u5b8c\u6210\u540e\u5355\u72ec commit\uff0c\u4fdd\u6301\u63d0\u4ea4\u7c92\u5ea6\u7ec6\uff0c\u4fbf\u4e8e review \u548c\u56de\u6eda\u3002</p>"},{"location":"refactor_v3/#11_1","title":"11. \u9884\u4f30\u53d8\u66f4\u7edf\u8ba1","text":"\u7ef4\u5ea6 Before After \u53d8\u5316 model/ \u5b50\u76ee\u5f55\u6570 24 5 -19 model/ \u603b\u4ee3\u7801\u884c\u6570 ~8000+ \u884c ~2600 \u884c -67% guardrails/ \u603b\u4ee3\u7801\u884c\u6570 1253 \u884c ~340 \u884c -73% <code>__init__.py</code> \u884c\u6570 534 \u884c ~100 \u884c -81% Agent \u7ee7\u627f\u7684 Mixin \u6570 5 \u4e2a 4 \u4e2a -1 (RunnerMixin \u2192 Runner) Pydantic \u4f9d\u8d56\uff08Model \u5c42\uff09 \u5168\u90e8 \u4ec5 Function/FunctionCall/Message/RunResponse \u5927\u5e45\u51cf\u5c11"},{"location":"refactor_v3/#12","title":"12. \u98ce\u9669\u4e0e\u5e94\u5bf9","text":"\u98ce\u9669 \u6982\u7387 \u5f71\u54cd \u5e94\u5bf9 \u5220\u9664 provider \u5bfc\u81f4\u7528\u6237\u4ee3\u7801\u62a5\u9519 \u9ad8 \u4e2d \u63d0\u4f9b\u5411\u540e\u517c\u5bb9\u522b\u540d + \u8fc1\u79fb\u6307\u5357 Model <code>alias=\"model\"</code> \u53bb\u6389\u5bfc\u81f4\u6784\u9020\u53c2\u6570\u53d8\u66f4 \u9ad8 \u9ad8 \u5168\u5c40\u641c\u7d22 <code>model=</code> \u6784\u9020\u8c03\u7528\uff0c\u7edf\u4e00\u6539\u4e3a <code>id=</code> dataclass \u4e0d\u652f\u6301 <code>model_dump()</code> \u9ad8 \u4e2d \u63d0\u4f9b <code>to_dict()</code> \u65b9\u6cd5 \u7ed3\u6784\u5316\u8f93\u51fa Claude/Ollama/LiteLLM \u539f\u751f\u652f\u6301\u7684\u517c\u5bb9\u6027 \u4e2d \u4e2d \u4fdd\u7559 <code>parse_structured_output()</code> \u4f5c\u4e3a\u515c\u5e95 Runner \u62c6\u5206\u540e DeepAgent \u9002\u914d \u4e2d \u4e2d DeepAgent \u4f7f\u7528\u81ea\u5df1\u7684 DeepRunner <code>__init__.py</code> \u62c6\u5206\u5bfc\u81f4\u73b0\u6709 <code>from agentica import X</code> \u5931\u8d25 \u9ad8 \u9ad8 \u5206\u4e24\u6b65\uff1a\u5148\u4fdd\u7559\u5168\u90e8\u5bfc\u51fa + \u61d2\u52a0\u8f7d\uff0c\u518d\u9010\u6b65\u8fc1\u79fb"},{"location":"tests/","title":"Agentica \u5355\u5143\u6d4b\u8bd5\u91cd\u6784\u65b9\u6848","text":"<p>\u76ee\u6807\uff1a\u57fa\u4e8e async-first \u67b6\u6784\uff0c\u91cd\u65b0\u8bbe\u8ba1\u6d4b\u8bd5\u7528\u4f8b\uff0c\u8986\u76d6\u6846\u67b6\u6838\u5fc3\u4f18\u52bf\u548c\u5168\u90e8\u5173\u952e\u80fd\u529b\u3002</p> <p>\u65e5\u671f: 2026-02-12 \u72b6\u6001: \u8bbe\u8ba1\u4e2d \u57fa\u7ebf: \u5f53\u524d tests/ \u5171 23 \u4e2a\u6587\u4ef6\uff0c~4849 \u884c</p>"},{"location":"tests/#_1","title":"\u4e00\u3001\u73b0\u72b6\u5206\u6790","text":""},{"location":"tests/#11","title":"1.1 \u5f53\u524d\u6d4b\u8bd5\u8986\u76d6\u60c5\u51b5","text":"\u6d4b\u8bd5\u6587\u4ef6 \u884c\u6570 \u8986\u76d6\u6a21\u5757 \u8bc4\u4f30 <code>test_agent.py</code> 315 Agent \u521d\u59cb\u5316\u3001\u5c5e\u6027\u3001\u8d85\u65f6 \u521d\u59cb\u5316\u8986\u76d6\u826f\u597d\uff0c\u7f3a\u5c11 run/run_stream \u6838\u5fc3\u8def\u5f84\u6d4b\u8bd5 <code>test_async_tool.py</code> 219 FunctionCall async execute \u57fa\u672c\u8986\u76d6\uff0c\u7f3a\u5c11\u5e76\u884c\u6267\u884c\u6d4b\u8bd5 <code>test_agent_as_tool.py</code> 274 Agent.as_tool() \u8986\u76d6\u826f\u597d <code>test_workflow.py</code> 143 Workflow \u521d\u59cb\u5316\u548c\u7b80\u5355 run \u7f3a\u5c11\u591a\u6b65\u7f16\u6392\u3001\u9519\u8bef\u5904\u7406 <code>test_memory.py</code> 383 AgentMemory, Memory, token \u622a\u65ad \u8986\u76d6\u826f\u597d <code>test_memory_leak.py</code> 259 weakref / GC \u65e0\u6cc4\u6f0f \u8986\u76d6\u826f\u597d <code>test_workspace.py</code> 267 Workspace \u6587\u4ef6\u8bfb\u5199\u3001\u8bb0\u5fc6 \u8986\u76d6\u826f\u597d\uff0c\u7f3a\u5c11\u5e76\u53d1\u5b89\u5168\u6d4b\u8bd5 <code>test_sanitize_messages.py</code> 189 Model.sanitize_messages \u8986\u76d6\u826f\u597d <code>test_vision_history.py</code> 531 \u591a\u6a21\u6001\u89c6\u89c9\u5386\u53f2\u6e05\u7406 \u8986\u76d6\u826f\u597d <code>test_guardrails.py</code> 420 \u8f93\u5165/\u8f93\u51fa/\u5de5\u5177\u5b88\u536b \u8986\u76d6\u826f\u597d <code>test_cli.py</code> 130 CLI \u914d\u7f6e\u548c\u5bfc\u5165 \u4ec5\u914d\u7f6e\u6d4b\u8bd5\uff0c\u7f3a\u5c11\u4ea4\u4e92\u6d41\u7a0b <code>test_deep_agent.py</code> 187 DeepAgent \u521d\u59cb\u5316 \u4ec5\u5c5e\u6027\u6d4b\u8bd5\uff0c\u7f3a\u5c11\u8fd0\u884c\u65f6\u884c\u4e3a <code>test_react_agent.py</code> 57 Agent \u57fa\u672c run \u8fc7\u4e8e\u7b80\u5355 <code>test_llm.py</code> 30 Model mock response \u8fc7\u4e8e\u7b80\u5355 <code>test_patch_tool.py</code> 229 PatchTool diff \u5e94\u7528 \u8986\u76d6\u826f\u597d <code>test_acp.py</code> 410 ACP \u534f\u8bae\u7c7b\u578b\u548c\u4f1a\u8bdd \u8986\u76d6\u826f\u597d <code>test_guardrails.py</code> 420 Guardrails \u88c5\u9970\u5668\u548c\u6267\u884c \u8986\u76d6\u826f\u597d \u5176\u4ed6\uff085 \u4e2a\uff09 ~590 \u5916\u90e8\u5de5\u5177/\u77e5\u8bc6\u5e93 \u9700\u8981\u5916\u90e8\u4f9d\u8d56\uff0c\u4fdd\u7559"},{"location":"tests/#12","title":"1.2 \u5173\u952e\u7f3a\u53e3","text":"\u7f3a\u53e3 \u4f18\u5148\u7ea7 \u8bf4\u660e Agent.run() \u5b8c\u6574\u8def\u5f84 P0 \u7f3a\u5c11 mock \u6a21\u578b\u4e0b\u7684\u5b8c\u6574 run/run_stream/run_sync/run_stream_sync \u6d4b\u8bd5 \u5e76\u884c\u5de5\u5177\u6267\u884c P0 <code>run_function_calls</code> \u7684 <code>asyncio.gather</code> \u5e76\u884c\u6267\u884c\u5b8c\u5168\u672a\u6d4b\u8bd5 \u6d41\u5f0f\u8f93\u51fa P0 <code>run_stream()</code> / <code>run_stream_sync()</code> \u672a\u6d4b\u8bd5 chunk \u6b63\u786e\u6027 \u591a\u5de5\u5177\u8c03\u7528\u56de\u8def P1 \u6a21\u578b\u8fd4\u56de tool_calls \u2192 \u6267\u884c\u5de5\u5177 \u2192 \u8fd4\u56de\u7ed3\u679c \u2192 \u6a21\u578b\u518d\u54cd\u5e94\u7684\u5b8c\u6574\u5faa\u73af Model \u57fa\u7c7b P1 <code>response()</code>/<code>response_stream()</code> \u62bd\u8c61\u63a5\u53e3\u3001<code>add_tool()</code>\u3001<code>get_tools_for_api()</code> PromptsMixin P1 <code>get_system_message()</code> \u548c <code>get_messages_for_run()</code> \u7684 async \u8def\u5f84 SessionMixin P1 <code>read_from_storage()</code>/<code>write_to_storage()</code> \u7684 async \u8def\u5f84 \u591a\u6a21\u6001\u8f93\u5165 P1 images/audio/videos \u53c2\u6570\u4f20\u9012\u548c\u6d88\u606f\u6784\u5efa RunResponse \u4e8b\u4ef6\u6d41 P1 RunEvent \u679a\u4e3e\u5728\u6d41\u5f0f\u573a\u666f\u4e0b\u7684\u5b8c\u6574\u6027 Workflow \u591a\u6b65 P2 \u591a Agent \u7f16\u6392\u3001\u6b65\u9aa4\u95f4\u72b6\u6001\u4f20\u9012 \u9519\u8bef\u6062\u590d P2 \u5de5\u5177\u5f02\u5e38 (StopAgentRun/RetryAgentRun)\u3001\u6a21\u578b\u8d85\u65f6\u3001\u7f51\u7edc\u5f02\u5e38 <code>__init__.py</code> \u61d2\u52a0\u8f7d P2 \u7ebf\u7a0b\u5b89\u5168\u61d2\u52a0\u8f7d\u3001\u6a21\u5757\u4e0d\u5b58\u5728\u65f6 fallback Prompt \u6a21\u5757 P3 PromptBuilder \u7ec4\u88c5\u3001\u5404\u6a21\u5757 MD \u52a0\u8f7d"},{"location":"tests/#_2","title":"\u4e8c\u3001\u6d4b\u8bd5\u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"tests/#21","title":"2.1 \u7edf\u4e00\u89c4\u8303","text":"<pre><code># \u6240\u6709\u65b0\u6d4b\u8bd5\u7edf\u4e00\u4f7f\u7528 pytest + pytest-asyncio\nimport pytest\nimport asyncio\nfrom unittest.mock import AsyncMock, MagicMock, patch\n\n# \u5f02\u6b65\u6d4b\u8bd5\u6807\u8bb0\n@pytest.mark.asyncio\nasync def test_example():\n    ...\n\n# \u540c\u6b65\u6d4b\u8bd5\u4e0d\u9700\u8981\u6807\u8bb0\ndef test_sync_example():\n    ...\n</code></pre> <p>\u547d\u540d\u89c4\u8303\uff1a - \u6587\u4ef6\uff1a<code>test_{module}.py</code> - \u7c7b\uff1a<code>Test{Module}{Feature}</code>\uff08\u53ef\u9009\uff0c\u7528 class \u5206\u7ec4\u76f8\u5173\u6d4b\u8bd5\uff09 - \u65b9\u6cd5\uff1a<code>test_{action}_{scenario}_{expected_result}</code></p> <p>Mock \u7b56\u7565\uff1a - Model \u5c42\uff1a\u7edf\u4e00\u4f7f\u7528 <code>AsyncMock</code> mock <code>response()</code> / <code>response_stream()</code> - \u5de5\u5177\u5c42\uff1a\u771f\u5b9e\u6267\u884c\u7b80\u5355\u51fd\u6570\uff0cmock \u5916\u90e8\u4f9d\u8d56 - DB/\u6587\u4ef6 I/O\uff1a\u4f7f\u7528 <code>tempfile</code> + <code>shutil.rmtree</code> \u6e05\u7406</p>"},{"location":"tests/#22","title":"2.2 \u6587\u4ef6\u7ed3\u6784","text":"<pre><code>tests/\n\u251c\u2500\u2500 conftest.py                      # \u5171\u4eab fixtures\uff08mock model\u3001mock agent \u7b49\uff09\n\u251c\u2500\u2500 test_agent_core.py               # [\u65b0] Agent \u56db\u4ef6\u5957\u6838\u5fc3\u8def\u5f84\n\u251c\u2500\u2500 test_agent_stream.py             # [\u65b0] \u6d41\u5f0f\u8f93\u51fa\u5b8c\u6574\u6d4b\u8bd5\n\u251c\u2500\u2500 test_agent_tools_integration.py  # [\u65b0] \u5de5\u5177\u8c03\u7528\u56de\u8def\uff08mock LLM\uff09\n\u251c\u2500\u2500 test_agent_multimodal.py         # [\u65b0] \u591a\u6a21\u6001\u8f93\u5165\uff08images/audio/videos\uff09\n\u251c\u2500\u2500 test_model_base.py               # [\u65b0] Model \u57fa\u7c7b + \u5e76\u884c\u5de5\u5177\u6267\u884c\n\u251c\u2500\u2500 test_model_providers.py          # [\u65b0] \u5404 Provider \u63a5\u53e3\u4e00\u81f4\u6027\n\u251c\u2500\u2500 test_prompts.py                  # [\u65b0] PromptBuilder + \u5404\u6a21\u5757\n\u251c\u2500\u2500 test_session.py                  # [\u65b0] SessionMixin async \u6301\u4e45\u5316\n\u251c\u2500\u2500 test_run_response.py             # [\u65b0] RunResponse/RunEvent \u5e8f\u5217\u5316\n\u251c\u2500\u2500 test_workflow_advanced.py        # [\u65b0] Workflow \u591a\u6b65\u7f16\u6392\n\u251c\u2500\u2500 test_lazy_loading.py             # [\u65b0] __init__.py \u61d2\u52a0\u8f7d\n\u251c\u2500\u2500 test_error_handling.py           # [\u65b0] \u5f02\u5e38\u548c\u6062\u590d\u8def\u5f84\n\u2502\n\u251c\u2500\u2500 test_agent.py                    # [\u4fdd\u7559] Agent \u521d\u59cb\u5316\u548c\u5c5e\u6027\n\u251c\u2500\u2500 test_async_tool.py               # [\u4fdd\u7559] \u5de5\u5177 async execute\n\u251c\u2500\u2500 test_agent_as_tool.py            # [\u4fdd\u7559] Agent.as_tool()\n\u251c\u2500\u2500 test_memory.py                   # [\u4fdd\u7559] AgentMemory\n\u251c\u2500\u2500 test_memory_leak.py              # [\u4fdd\u7559] weakref / GC\n\u251c\u2500\u2500 test_workspace.py                # [\u4fdd\u7559] Workspace \u6587\u4ef6\u64cd\u4f5c\n\u251c\u2500\u2500 test_sanitize_messages.py        # [\u4fdd\u7559] sanitize_messages\n\u251c\u2500\u2500 test_vision_history.py           # [\u4fdd\u7559] \u591a\u6a21\u6001\u89c6\u89c9\u5386\u53f2\n\u251c\u2500\u2500 test_guardrails.py               # [\u4fdd\u7559] \u5b88\u536b\u7cfb\u7edf\n\u251c\u2500\u2500 test_patch_tool.py               # [\u4fdd\u7559] PatchTool\n\u251c\u2500\u2500 test_acp.py                      # [\u4fdd\u7559] ACP \u534f\u8bae\n\u251c\u2500\u2500 test_cli.py                      # [\u4fdd\u7559] CLI \u914d\u7f6e\n\u251c\u2500\u2500 test_deep_agent.py               # [\u4fdd\u7559+\u589e\u5f3a] DeepAgent\n\u2514\u2500\u2500 ...                              # \u5176\u4ed6\u5916\u90e8\u5de5\u5177\u6d4b\u8bd5\u4fdd\u7559\n</code></pre>"},{"location":"tests/#_3","title":"\u4e09\u3001\u65b0\u589e\u6d4b\u8bd5\u7528\u4f8b\u8be6\u7ec6\u8bbe\u8ba1","text":""},{"location":"tests/#30-conftestpy-fixtures","title":"3.0 conftest.py \u2014 \u5171\u4eab Fixtures","text":"<pre><code># tests/conftest.py\n\"\"\"Shared fixtures for all test modules.\"\"\"\n\nimport pytest\nfrom unittest.mock import AsyncMock, MagicMock\nfrom agentica.agent import Agent\nfrom agentica.model.base import Model\nfrom agentica.model.message import Message\nfrom agentica.model.response import ModelResponse, ModelResponseEvent\nfrom agentica.run_response import RunResponse, RunEvent\nfrom agentica.tools.base import Function, FunctionCall\n\n\n@pytest.fixture\ndef mock_model():\n    \"\"\"Create a mock Model that returns a simple text response.\"\"\"\n    model = MagicMock(spec=Model)\n    model.id = \"mock-model\"\n    model.name = \"MockModel\"\n    model.provider = \"mock\"\n    model.tools = None\n    model.functions = {}\n    model.function_call_stack = None\n    model.run_tools = True\n    model.tool_call_limit = None\n    model.system_prompt = None\n    model.instructions = None\n    model.structured_outputs = None\n    model.supports_structured_outputs = False\n    model.context_window = 128000\n    model.max_output_tokens = None\n\n    # Default async response\n    mock_resp = ModelResponse(content=\"Hello from mock model!\")\n    model.response = AsyncMock(return_value=mock_resp)\n    model.response_stream = AsyncMock()\n    model.get_tools_for_api.return_value = None\n    model.add_tool = MagicMock()\n    model.sanitize_messages = Model.sanitize_messages  # Use real impl\n    model.to_dict.return_value = {\"id\": \"mock-model\"}\n    return model\n\n\n@pytest.fixture\ndef mock_model_with_tools():\n    \"\"\"Create a mock Model that returns tool_calls on first response,\n    then text on second response (simulating a tool-call round trip).\"\"\"\n    model = MagicMock(spec=Model)\n    model.id = \"mock-tool-model\"\n    model.name = \"MockToolModel\"\n    model.provider = \"mock\"\n    model.tools = []\n    model.functions = {}\n    model.function_call_stack = None\n    model.run_tools = True\n    model.tool_call_limit = None\n    model.system_prompt = None\n    model.instructions = None\n    model.structured_outputs = None\n    model.supports_structured_outputs = False\n    model.context_window = 128000\n    model.max_output_tokens = None\n    model.get_tools_for_api.return_value = []\n    model.add_tool = MagicMock()\n    model.sanitize_messages = Model.sanitize_messages\n    model.to_dict.return_value = {\"id\": \"mock-tool-model\"}\n    return model\n\n\n@pytest.fixture\ndef simple_agent(mock_model):\n    \"\"\"Create a simple Agent with a mock model.\"\"\"\n    agent = Agent(name=\"TestAgent\", model=mock_model)\n    return agent\n\n\ndef make_sync_tool(name: str = \"add\"):\n    \"\"\"Create a simple sync tool function.\"\"\"\n    def add(a: int, b: int) -&gt; str:\n        \"\"\"Add two numbers.\"\"\"\n        return str(a + b)\n    add.__name__ = name\n    return add\n\n\ndef make_async_tool(name: str = \"async_search\"):\n    \"\"\"Create a simple async tool function.\"\"\"\n    import asyncio\n    async def async_search(query: str) -&gt; str:\n        \"\"\"Search for something.\"\"\"\n        await asyncio.sleep(0.01)\n        return f\"Result for: {query}\"\n    async_search.__name__ = name\n    return async_search\n</code></pre>"},{"location":"tests/#31-test_agent_corepy-agent-p0","title":"3.1 test_agent_core.py \u2014 Agent \u56db\u4ef6\u5957\u6838\u5fc3\u8def\u5f84\uff08P0\uff09","text":"<p>\u8986\u76d6 async-first \u67b6\u6784\u7684\u6838\u5fc3\u4f18\u52bf\uff1a<code>run()</code> / <code>run_stream()</code> / <code>run_sync()</code> / <code>run_stream_sync()</code>\u3002</p> <pre><code>TestAgentRun\n\u251c\u2500\u2500 test_run_async_returns_run_response          # await agent.run(\"Hello\") \u8fd4\u56de RunResponse\n\u251c\u2500\u2500 test_run_async_content_matches_model_output   # content \u4e0e model.response \u4e00\u81f4\n\u251c\u2500\u2500 test_run_async_populates_run_id               # run_id \u81ea\u52a8\u751f\u6210\n\u251c\u2500\u2500 test_run_async_populates_session_id           # session_id \u6b63\u786e\u4f20\u9012\n\u251c\u2500\u2500 test_run_async_populates_agent_id             # agent_id \u6b63\u786e\u4f20\u9012\n\u251c\u2500\u2500 test_run_async_populates_model_id             # model \u5b57\u6bb5\u6b63\u786e\u8bbe\u7f6e\n\u251c\u2500\u2500 test_run_async_with_message_object            # \u4f20\u5165 Message \u5bf9\u8c61\n\u251c\u2500\u2500 test_run_async_with_dict_message              # \u4f20\u5165 dict \u6d88\u606f\n\u251c\u2500\u2500 test_run_async_with_messages_list             # \u4f20\u5165 messages \u5217\u8868\n\u251c\u2500\u2500 test_run_async_no_message_no_error            # \u7a7a\u6d88\u606f\u4e0d\u62a5\u9519\n\u251c\u2500\u2500 test_run_async_with_images                    # \u5e26 images \u53c2\u6570\n\u251c\u2500\u2500 test_run_async_with_audio                     # \u5e26 audio \u53c2\u6570\n\u251c\u2500\u2500 test_run_async_with_videos                    # \u5e26 videos \u53c2\u6570\n\u251c\u2500\u2500 test_run_async_stores_in_memory               # \u8fd0\u884c\u540e memory.runs \u589e\u52a0\n\u251c\u2500\u2500 test_run_async_history_messages               # add_history_to_messages=True \u65f6\u5386\u53f2\u6d88\u606f\u4f20\u7ed9 model\n\nTestAgentRunSync\n\u251c\u2500\u2500 test_run_sync_returns_run_response            # run_sync \u8fd4\u56de\u4e0e run \u76f8\u540c\u7ed3\u679c\n\u251c\u2500\u2500 test_run_sync_bridges_to_async_run            # run_sync \u5185\u90e8\u8c03\u7528 async run\n\u251c\u2500\u2500 test_run_sync_works_without_event_loop        # \u5728\u65e0\u4e8b\u4ef6\u5faa\u73af\u7684\u540c\u6b65\u4e0a\u4e0b\u6587\u4e2d\u6b63\u5e38\u5de5\u4f5c\n\u251c\u2500\u2500 test_run_sync_with_all_params                 # run_sync \u652f\u6301\u5b8c\u6574\u53c2\u6570\u4f20\u9012\n\nTestAgentRunStream\n\u251c\u2500\u2500 test_run_stream_yields_multiple_chunks        # run_stream \u4ea7\u751f\u591a\u4e2a chunk\n\u251c\u2500\u2500 test_run_stream_first_chunk_has_event         # \u6bcf\u4e2a chunk \u6709\u6b63\u786e\u7684 event\n\u251c\u2500\u2500 test_run_stream_final_content_complete        # \u6700\u7ec8\u62fc\u63a5\u5185\u5bb9\u4e0e\u5b8c\u6574\u54cd\u5e94\u4e00\u81f4\n\u251c\u2500\u2500 test_run_stream_intermediate_steps            # stream_intermediate_steps=True \u65f6\u4ea7\u751f\u989d\u5916\u4e8b\u4ef6\n\nTestAgentRunStreamSync\n\u251c\u2500\u2500 test_run_stream_sync_returns_iterator         # \u8fd4\u56de\u540c\u6b65 Iterator\n\u251c\u2500\u2500 test_run_stream_sync_yields_chunks            # \u4ea7\u751f\u4e0e run_stream \u76f8\u540c\u7684 chunk\n\u251c\u2500\u2500 test_run_stream_sync_in_for_loop              # \u53ef\u5728\u666e\u901a for \u5faa\u73af\u4e2d\u4f7f\u7528\n\u251c\u2500\u2500 test_run_stream_sync_thread_safe              # \u540e\u53f0\u7ebf\u7a0b\u6a21\u5f0f\u5b89\u5168\u9000\u51fa\n\nTestAgentTimeout\n\u251c\u2500\u2500 test_run_timeout_triggers_timeout_event        # [\u73b0\u6709] \u4fdd\u7559\u589e\u5f3a\n\u251c\u2500\u2500 test_first_token_timeout_in_stream             # [\u73b0\u6709] \u4fdd\u7559\u589e\u5f3a\n\u251c\u2500\u2500 test_run_timeout_in_stream                     # [\u73b0\u6709] \u4fdd\u7559\u589e\u5f3a\n\u251c\u2500\u2500 test_run_timeout_returns_partial_content        # \u8d85\u65f6\u524d\u7684\u90e8\u5206\u5185\u5bb9\u88ab\u4fdd\u7559\n</code></pre>"},{"location":"tests/#32-test_agent_streampy-p0","title":"3.2 test_agent_stream.py \u2014 \u6d41\u5f0f\u8f93\u51fa\u5b8c\u6574\u6d4b\u8bd5\uff08P0\uff09","text":"<p>\u8986\u76d6 streaming \u7684 RunEvent \u72b6\u6001\u673a\u3002</p> <pre><code>TestStreamEvents\n\u251c\u2500\u2500 test_stream_emits_run_started                 # \u7b2c\u4e00\u4e2a event \u4e3a RunStarted\n\u251c\u2500\u2500 test_stream_emits_run_response_for_content    # \u5185\u5bb9 chunk \u4e3a RunResponse event\n\u251c\u2500\u2500 test_stream_emits_tool_call_started           # \u5de5\u5177\u5f00\u59cb\u65f6\u53d1\u51fa ToolCallStarted\n\u251c\u2500\u2500 test_stream_emits_tool_call_completed         # \u5de5\u5177\u5b8c\u6210\u65f6\u53d1\u51fa ToolCallCompleted\n\u251c\u2500\u2500 test_stream_emits_run_completed               # \u6700\u540e\u4e00\u4e2a event \u4e3a RunCompleted\n\u251c\u2500\u2500 test_stream_reasoning_events                  # \u63a8\u7406\u5185\u5bb9\u4ea7\u751f ReasoningStarted/Step/Completed\n\nTestStreamContent\n\u251c\u2500\u2500 test_stream_content_accumulates               # \u591a\u4e2a chunk \u7684 content \u62fc\u63a5\u540e\u7b49\u4e8e\u5b8c\u6574\u54cd\u5e94\n\u251c\u2500\u2500 test_stream_reasoning_content_separate        # reasoning_content \u4e0e content \u5206\u79bb\n\u251c\u2500\u2500 test_stream_empty_content_skipped             # \u7a7a content chunk \u4e0d\u4ea7\u751f\u8f93\u51fa\n\nTestStreamToolCalls\n\u251c\u2500\u2500 test_stream_tool_call_then_text               # \u5de5\u5177\u8c03\u7528\u540e\u7ee7\u7eed\u8f93\u51fa\u6587\u672c\n\u251c\u2500\u2500 test_stream_multiple_tool_calls               # \u591a\u4e2a\u5de5\u5177\u8c03\u7528\u5728\u6d41\u4e2d\u6b63\u786e\u62a5\u544a\n\u251c\u2500\u2500 test_stream_tool_error_reported               # \u5de5\u5177\u5931\u8d25\u5728\u6d41\u4e2d\u62a5\u544a\n\nTestStreamSync\n\u251c\u2500\u2500 test_stream_sync_matches_async                # run_stream_sync \u8f93\u51fa\u4e0e run_stream \u4e00\u81f4\n\u251c\u2500\u2500 test_stream_sync_queue_backpressure           # \u540e\u53f0\u7ebf\u7a0b\u4ea7\u751f\u901f\u5ea6 &gt; \u6d88\u8d39\u901f\u5ea6\u65f6\u4e0d\u4e22\u6570\u636e\n</code></pre>"},{"location":"tests/#33-test_agent_tools_integrationpy-p0","title":"3.3 test_agent_tools_integration.py \u2014 \u5de5\u5177\u8c03\u7528\u56de\u8def\uff08P0\uff09","text":"<p>\u8986\u76d6 Agent + Model + Tool \u7684\u5b8c\u6574\u8c03\u7528\u94fe\uff08mock LLM\uff0c\u771f\u5b9e\u5de5\u5177\u6267\u884c\uff09\u3002</p> <pre><code>TestSingleToolCall\n\u251c\u2500\u2500 test_sync_tool_called_and_result_returned     # \u540c\u6b65\u5de5\u5177\u6b63\u786e\u6267\u884c\uff0c\u7ed3\u679c\u9001\u56de model\n\u251c\u2500\u2500 test_async_tool_called_and_result_returned    # \u5f02\u6b65\u5de5\u5177\u6b63\u786e\u6267\u884c\n\u251c\u2500\u2500 test_tool_result_in_final_response            # \u6700\u7ec8 RunResponse \u5305\u542b\u5de5\u5177\u8c03\u7528\u4fe1\u606f\n\u251c\u2500\u2500 test_tool_call_metrics_recorded               # \u5de5\u5177\u6267\u884c\u65f6\u95f4\u88ab\u8bb0\u5f55\n\nTestMultipleToolCalls\n\u251c\u2500\u2500 test_parallel_tools_executed_concurrently     # \u591a\u5de5\u5177\u5e76\u884c\u6267\u884c\uff08\u9a8c\u8bc1\u65f6\u95f4 &lt; \u4e32\u884c\u65f6\u95f4\uff09\n\u251c\u2500\u2500 test_parallel_tools_results_ordered           # \u5e76\u884c\u6267\u884c\u7ed3\u679c\u6309\u539f\u59cb\u987a\u5e8f\u8fd4\u56de\n\u251c\u2500\u2500 test_parallel_mixed_sync_async_tools          # \u6df7\u5408 sync/async \u5de5\u5177\u5e76\u884c\u6267\u884c\n\u251c\u2500\u2500 test_tool_call_limit_respected                # tool_call_limit \u9650\u5236\u751f\u6548\n\nTestToolErrors\n\u251c\u2500\u2500 test_tool_exception_sets_error_field          # \u5de5\u5177\u629b\u5f02\u5e38\u65f6 FunctionCall.error \u88ab\u8bbe\u7f6e\n\u251c\u2500\u2500 test_tool_exception_does_not_crash_agent      # \u5de5\u5177\u5f02\u5e38\u4e0d\u5bfc\u81f4 Agent \u5d29\u6e83\n\u251c\u2500\u2500 test_stop_agent_run_stops_execution           # StopAgentRun \u7ec8\u6b62\u6267\u884c\n\u251c\u2500\u2500 test_retry_agent_run_triggers_retry           # RetryAgentRun \u89e6\u53d1\u91cd\u8bd5\n\u251c\u2500\u2500 test_partial_tool_failure_others_succeed      # \u90e8\u5206\u5de5\u5177\u5931\u8d25\u4e0d\u5f71\u54cd\u5176\u4ed6\u5de5\u5177\n\nTestToolHooks\n\u251c\u2500\u2500 test_pre_hook_called_before_execution         # pre_hook \u5728\u5de5\u5177\u6267\u884c\u524d\u8c03\u7528\n\u251c\u2500\u2500 test_post_hook_called_after_execution         # post_hook \u5728\u5de5\u5177\u6267\u884c\u540e\u8c03\u7528\n\u251c\u2500\u2500 test_async_pre_hook_with_sync_tool            # async pre_hook + sync \u5de5\u5177\n\u251c\u2500\u2500 test_sync_pre_hook_with_async_tool            # [\u73b0\u6709] sync pre_hook + async \u5de5\u5177\n\nTestToolCallRoundTrip\n\u251c\u2500\u2500 test_model_returns_tool_call_agent_executes   # model \u8fd4\u56de tool_calls \u2192 agent \u6267\u884c \u2192 \u7ed3\u679c\u9001\u56de\n\u251c\u2500\u2500 test_multi_round_tool_calls                   # \u591a\u8f6e\u5de5\u5177\u8c03\u7528\uff08model \u8fde\u7eed\u8bf7\u6c42\u5de5\u5177\uff09\n\u251c\u2500\u2500 test_tool_call_with_streaming                 # \u6d41\u5f0f\u6a21\u5f0f\u4e0b\u7684\u5de5\u5177\u8c03\u7528\n</code></pre>"},{"location":"tests/#34-test_model_basepy-model-p0","title":"3.4 test_model_base.py \u2014 Model \u57fa\u7c7b + \u5e76\u884c\u5de5\u5177\u6267\u884c\uff08P0\uff09","text":"<p>\u8986\u76d6 asyncio.gather \u5e76\u884c\u6267\u884c \u8fd9\u4e00\u6838\u5fc3\u67b6\u6784\u4f18\u52bf\u3002</p> <pre><code>TestModelInterface\n\u251c\u2500\u2500 test_invoke_is_async                          # invoke() \u662f coroutine\n\u251c\u2500\u2500 test_invoke_stream_is_async                   # invoke_stream() \u662f coroutine\n\u251c\u2500\u2500 test_response_is_async                        # response() \u662f coroutine\n\u251c\u2500\u2500 test_response_stream_is_async                 # response_stream() \u662f coroutine\n\u251c\u2500\u2500 test_no_sync_response_method                  # \u4e0d\u5b58\u5728\u540c\u6b65\u7684 response \u65b9\u6cd5\n\u251c\u2500\u2500 test_no_a_prefix_methods                      # \u4e0d\u5b58\u5728 arun/aresponse/ainvoke \u7b49\u65e7\u65b9\u6cd5\n\nTestModelAddTool\n\u251c\u2500\u2500 test_add_callable_tool                        # add_tool(callable) \u6b63\u786e\u6ce8\u518c\n\u251c\u2500\u2500 test_add_tool_class                           # add_tool(Tool) \u6b63\u786e\u6ce8\u518c\n\u251c\u2500\u2500 test_add_function_object                      # add_tool(Function) \u6b63\u786e\u6ce8\u518c\n\u251c\u2500\u2500 test_add_dict_tool                            # add_tool(dict) \u4f5c\u4e3a raw schema\n\u251c\u2500\u2500 test_duplicate_tool_deduplicated              # \u540c\u540d\u5de5\u5177\u4e0d\u91cd\u590d\u6ce8\u518c\n\u251c\u2500\u2500 test_get_tools_for_api_format                 # get_tools_for_api() \u8fd4\u56de OpenAI \u683c\u5f0f\n\nTestRunFunctionCalls\n\u251c\u2500\u2500 test_single_tool_execution                    # \u5355\u4e2a\u5de5\u5177\u6b63\u786e\u6267\u884c\n\u251c\u2500\u2500 test_parallel_execution_faster_than_serial    # N \u4e2a sleep(0.1) \u5de5\u5177\u5e76\u884c &lt; N*0.1s\n\u251c\u2500\u2500 test_parallel_execution_preserves_order       # \u7ed3\u679c\u987a\u5e8f\u4e0e\u8f93\u5165\u987a\u5e8f\u4e00\u81f4\n\u251c\u2500\u2500 test_tool_started_events_emitted_first        # \u5148\u53d1\u51fa\u6240\u6709 started \u4e8b\u4ef6\uff0c\u518d\u6267\u884c\n\u251c\u2500\u2500 test_tool_completed_events_in_order           # completed \u4e8b\u4ef6\u6309\u987a\u5e8f\u53d1\u51fa\n\u251c\u2500\u2500 test_tool_exception_isolated                  # \u5355\u4e2a\u5de5\u5177\u5f02\u5e38\u4e0d\u53d6\u6d88\u5176\u4ed6\u5de5\u5177\n\u251c\u2500\u2500 test_tool_call_exception_propagated           # ToolCallException \u5411\u4e0a\u4f20\u64ad\n\u251c\u2500\u2500 test_function_call_stack_tracked              # function_call_stack \u6b63\u786e\u8bb0\u5f55\n\nTestSanitizeMessages\n\u251c\u2500\u2500 [\u73b0\u6709 test_sanitize_messages.py \u7684\u5168\u90e8\u7528\u4f8b\u4fdd\u7559]\n</code></pre>"},{"location":"tests/#35-test_agent_multimodalpy-p1","title":"3.5 test_agent_multimodal.py \u2014 \u591a\u6a21\u6001\u8f93\u5165\uff08P1\uff09","text":"<p>\u8986\u76d6 images / audio / videos \u53c2\u6570\u5728\u6574\u4e2a\u94fe\u8def\u4e2d\u7684\u4f20\u9012\u3002</p> <pre><code>TestImageInput\n\u251c\u2500\u2500 test_run_with_single_image_url                # \u5355\u4e2a URL \u56fe\u7247\n\u251c\u2500\u2500 test_run_with_base64_image                    # base64 \u7f16\u7801\u56fe\u7247\n\u251c\u2500\u2500 test_run_with_multiple_images                 # \u591a\u5f20\u56fe\u7247\n\u251c\u2500\u2500 test_image_added_to_user_message_content      # \u56fe\u7247\u88ab\u6dfb\u52a0\u5230 user message \u7684 content \u5217\u8868\n\u251c\u2500\u2500 test_image_history_cleanup                    # [\u6574\u5408\u73b0\u6709] \u5386\u53f2\u4e2d base64 \u88ab\u6e05\u7406\n\nTestAudioInput\n\u251c\u2500\u2500 test_run_with_audio_parameter                 # \u97f3\u9891\u53c2\u6570\u4f20\u9012\n\u251c\u2500\u2500 test_audio_message_format                     # \u97f3\u9891\u6d88\u606f\u683c\u5f0f\u6b63\u786e\n\u251c\u2500\u2500 test_audio_history_cleanup                    # \u5386\u53f2\u4e2d\u97f3\u9891\u6570\u636e\u88ab\u6e05\u7406\n\nTestVideoInput\n\u251c\u2500\u2500 test_run_with_video_parameter                 # \u89c6\u9891\u53c2\u6570\u4f20\u9012\n\u251c\u2500\u2500 test_video_message_format                     # \u89c6\u9891\u6d88\u606f\u683c\u5f0f\u6b63\u786e\n\nTestMultimodalCombined\n\u251c\u2500\u2500 test_text_and_image_combined                  # \u6587\u672c + \u56fe\u7247\u7ec4\u5408\n\u251c\u2500\u2500 test_text_image_audio_combined                # \u6587\u672c + \u56fe\u7247 + \u97f3\u9891\u7ec4\u5408\n\u251c\u2500\u2500 test_multimodal_in_stream_mode                # \u6d41\u5f0f\u6a21\u5f0f\u4e0b\u7684\u591a\u6a21\u6001\n\u251c\u2500\u2500 test_multimodal_history_multi_turn            # \u591a\u8f6e\u5bf9\u8bdd\u4e2d\u7684\u591a\u6a21\u6001\u5386\u53f2\n</code></pre>"},{"location":"tests/#36-test_model_providerspy-provider-p1","title":"3.6 test_model_providers.py \u2014 Provider \u63a5\u53e3\u4e00\u81f4\u6027\uff08P1\uff09","text":"<p>\u9a8c\u8bc1\u5404 Provider \u90fd\u5b9e\u73b0\u4e86\u76f8\u540c\u7684 async-only \u63a5\u53e3\u3002</p> <pre><code>TestProviderInterface\n\u251c\u2500\u2500 test_openai_chat_has_async_response           # OpenAIChat.response \u662f async\n\u251c\u2500\u2500 test_openai_chat_has_async_response_stream    # OpenAIChat.response_stream \u662f async\n\u251c\u2500\u2500 test_openai_chat_has_async_invoke             # OpenAIChat.invoke \u662f async\n\u251c\u2500\u2500 test_openai_like_inherits_interface           # OpenAILike \u7ee7\u627f OpenAIChat \u63a5\u53e3\n\u251c\u2500\u2500 test_claude_has_async_response                # Claude.response \u662f async\n\u251c\u2500\u2500 test_gemini_has_async_response                # Gemini.response \u662f async\n\u251c\u2500\u2500 test_ollama_has_async_response                # OllamaChat.response \u662f async\n\u251c\u2500\u2500 test_groq_has_async_response                  # GroqChat.response \u662f async\n\u251c\u2500\u2500 test_all_providers_no_sync_response           # \u6240\u6709 provider \u65e0\u540c\u6b65 response \u65b9\u6cd5\n\u251c\u2500\u2500 test_all_providers_use_override_decorator     # \u6240\u6709 provider \u65b9\u6cd5\u4f7f\u7528 @override\n</code></pre>"},{"location":"tests/#37-test_promptspy-promptbuilder-p1","title":"3.7 test_prompts.py \u2014 PromptBuilder + \u6a21\u5757\uff08P1\uff09","text":"<pre><code>TestPromptBuilder\n\u251c\u2500\u2500 test_builder_default_modules                  # \u9ed8\u8ba4\u52a0\u8f7d\u6240\u6709\u57fa\u7840\u6a21\u5757\n\u251c\u2500\u2500 test_builder_custom_modules                   # \u81ea\u5b9a\u4e49\u6a21\u5757\u5217\u8868\n\u251c\u2500\u2500 test_builder_build_produces_string            # build() \u8fd4\u56de\u975e\u7a7a\u5b57\u7b26\u4e32\n\u251c\u2500\u2500 test_builder_includes_soul                    # \u5305\u542b soul \u6a21\u5757\u5185\u5bb9\n\u251c\u2500\u2500 test_builder_includes_tools_when_present      # \u6709\u5de5\u5177\u65f6\u5305\u542b tools \u6a21\u5757\n\u251c\u2500\u2500 test_builder_includes_heartbeat               # \u5305\u542b heartbeat \u6a21\u5757\n\nTestPromptModules\n\u251c\u2500\u2500 test_load_prompt_reads_md_file                # load_prompt() \u6b63\u786e\u52a0\u8f7d .md \u6587\u4ef6\n\u251c\u2500\u2500 test_soul_module_content                      # soul \u6a21\u5757\u8fd4\u56de\u6709\u6548\u5185\u5bb9\n\u251c\u2500\u2500 test_tools_module_content                     # tools \u6a21\u5757\u8fd4\u56de\u6709\u6548\u5185\u5bb9\n\u251c\u2500\u2500 test_task_management_module_content            # task_management \u6a21\u5757\u8fd4\u56de\u6709\u6548\u5185\u5bb9\n\u251c\u2500\u2500 test_self_verification_module_content          # self_verification \u6a21\u5757\u8fd4\u56de\u6709\u6548\u5185\u5bb9\n\nTestGetSystemMessage\n\u251c\u2500\u2500 test_system_message_includes_instructions     # instructions \u88ab\u5305\u542b\u5728\u7cfb\u7edf\u6d88\u606f\u4e2d\n\u251c\u2500\u2500 test_system_message_includes_datetime         # add_datetime_to_instructions \u751f\u6548\n\u251c\u2500\u2500 test_system_message_includes_workspace        # workspace context \u88ab\u5305\u542b\n\u251c\u2500\u2500 test_system_message_callable_prompt           # callable system_prompt \u88ab\u8c03\u7528\n</code></pre>"},{"location":"tests/#38-test_sessionpy-sessionmixin-async-p1","title":"3.8 test_session.py \u2014 SessionMixin async \u6301\u4e45\u5316\uff08P1\uff09","text":"<pre><code>TestSessionPersistence\n\u251c\u2500\u2500 test_read_from_storage_no_db_noop             # \u65e0 db \u65f6 read_from_storage \u4e0d\u62a5\u9519\n\u251c\u2500\u2500 test_write_to_storage_no_db_noop              # \u65e0 db \u65f6 write_to_storage \u4e0d\u62a5\u9519\n\u251c\u2500\u2500 test_read_from_storage_async                  # read_from_storage \u662f async\n\u251c\u2500\u2500 test_write_to_storage_async                   # write_to_storage \u662f async\n\u251c\u2500\u2500 test_load_session_creates_new_if_not_exist    # load_session \u521b\u5efa\u65b0\u4f1a\u8bdd\n\u251c\u2500\u2500 test_session_state_persisted_across_runs      # session_state \u8de8 run \u6301\u4e45\u5316\n\u251c\u2500\u2500 test_generate_session_name_async              # generate_session_name \u662f async\n</code></pre>"},{"location":"tests/#39-test_run_responsepy-runresponseruneventp1","title":"3.9 test_run_response.py \u2014 RunResponse/RunEvent\uff08P1\uff09","text":"<pre><code>TestRunResponse\n\u251c\u2500\u2500 test_run_response_creation                    # \u57fa\u672c\u521b\u5efa\n\u251c\u2500\u2500 test_run_response_default_event               # \u9ed8\u8ba4 event \u4e3a RunResponse\n\u251c\u2500\u2500 test_run_response_to_json                     # to_json \u5e8f\u5217\u5316\n\u251c\u2500\u2500 test_run_response_to_dict                     # to_dict \u5e8f\u5217\u5316\n\u251c\u2500\u2500 test_run_response_with_tools                  # \u5305\u542b tools \u5217\u8868\n\u251c\u2500\u2500 test_run_response_with_images                 # \u5305\u542b images\n\u251c\u2500\u2500 test_run_response_with_reasoning_content      # \u5305\u542b reasoning_content\n\u251c\u2500\u2500 test_run_response_extra_data                  # extra_data \u5b57\u6bb5\n\nTestRunEvent\n\u251c\u2500\u2500 test_all_events_defined                       # \u6240\u6709\u9884\u671f\u4e8b\u4ef6\u90fd\u5df2\u5b9a\u4e49\n\u251c\u2500\u2500 test_event_values_are_strings                 # \u4e8b\u4ef6\u503c\u4e3a\u5b57\u7b26\u4e32\n\u251c\u2500\u2500 test_event_names_unique                       # \u4e8b\u4ef6\u540d\u4e0d\u91cd\u590d\n\u251c\u2500\u2500 test_tool_call_events_present                 # \u5de5\u5177\u8c03\u7528\u76f8\u5173\u4e8b\u4ef6\u5b58\u5728\n\u251c\u2500\u2500 test_reasoning_events_present                 # \u63a8\u7406\u76f8\u5173\u4e8b\u4ef6\u5b58\u5728\n\u251c\u2500\u2500 test_workflow_events_present                  # \u5de5\u4f5c\u6d41\u76f8\u5173\u4e8b\u4ef6\u5b58\u5728\n</code></pre>"},{"location":"tests/#310-test_workflow_advancedpy-workflow-p2","title":"3.10 test_workflow_advanced.py \u2014 Workflow \u591a\u6b65\u7f16\u6392\uff08P2\uff09","text":"<pre><code>TestWorkflowMultiStep\n\u251c\u2500\u2500 test_sequential_agents_workflow               # \u591a Agent \u987a\u5e8f\u6267\u884c\n\u251c\u2500\u2500 test_workflow_passes_state_between_steps      # \u6b65\u9aa4\u95f4\u72b6\u6001\u4f20\u9012\n\u251c\u2500\u2500 test_workflow_run_is_async                    # run() \u662f async\n\u251c\u2500\u2500 test_workflow_run_sync_adapter                # run_sync() \u6b63\u786e\u5305\u88c5\n\u251c\u2500\u2500 test_workflow_with_conditional_branching      # \u6761\u4ef6\u5206\u652f\u6267\u884c\n\u251c\u2500\u2500 test_workflow_error_in_step_propagates        # \u6b65\u9aa4\u5f02\u5e38\u5411\u4e0a\u4f20\u64ad\n\u251c\u2500\u2500 test_workflow_session_state_across_runs       # session_state \u8de8\u8fd0\u884c\u4fdd\u6301\n\nTestWorkflowMemory\n\u251c\u2500\u2500 test_workflow_memory_records_runs             # memory.runs \u8bb0\u5f55\u6bcf\u6b21\u8fd0\u884c\n\u251c\u2500\u2500 test_workflow_memory_custom                   # \u81ea\u5b9a\u4e49 WorkflowMemory\n</code></pre>"},{"location":"tests/#311-test_error_handlingpy-p2","title":"3.11 test_error_handling.py \u2014 \u5f02\u5e38\u548c\u6062\u590d\u8def\u5f84\uff08P2\uff09","text":"<pre><code>TestModelErrors\n\u251c\u2500\u2500 test_model_response_exception_handled         # model.response() \u629b\u5f02\u5e38\u88ab Agent \u6355\u83b7\n\u251c\u2500\u2500 test_model_stream_exception_handled           # model.response_stream() \u5f02\u5e38\u88ab\u6355\u83b7\n\u251c\u2500\u2500 test_model_timeout_handled                    # model \u8d85\u65f6\u8fd4\u56de\u8d85\u65f6\u54cd\u5e94\n\nTestToolErrors\n\u251c\u2500\u2500 test_tool_value_error_captured                # ValueError \u88ab\u6355\u83b7\u4e3a FunctionCall.error\n\u251c\u2500\u2500 test_tool_runtime_error_captured              # RuntimeError \u88ab\u6355\u83b7\n\u251c\u2500\u2500 test_stop_agent_run_with_user_message         # StopAgentRun \u643a\u5e26 user_message\n\u251c\u2500\u2500 test_retry_agent_run_messages_injected        # RetryAgentRun \u7684 messages \u88ab\u6ce8\u5165\n\nTestCancellation\n\u251c\u2500\u2500 test_agent_cancel_during_run                  # \u8fd0\u884c\u4e2d\u53d6\u6d88\n\u251c\u2500\u2500 test_agent_cancel_during_stream               # \u6d41\u5f0f\u4e2d\u53d6\u6d88\n</code></pre>"},{"location":"tests/#312-test_lazy_loadingpy-__init__py-p2","title":"3.12 test_lazy_loading.py \u2014 <code>__init__.py</code> \u61d2\u52a0\u8f7d\uff08P2\uff09","text":"<pre><code>TestLazyLoading\n\u251c\u2500\u2500 test_core_modules_imported_eagerly            # Agent, Model, Tool \u7b49\u76f4\u63a5\u53ef\u7528\n\u251c\u2500\u2500 test_optional_module_lazy_loaded              # \u6570\u636e\u5e93\u540e\u7aef\u7b49\u6309\u9700\u52a0\u8f7d\n\u251c\u2500\u2500 test_missing_optional_module_graceful_error   # \u7f3a\u5c11\u53ef\u9009\u4f9d\u8d56\u65f6\u53cb\u597d\u62a5\u9519\n\u251c\u2500\u2500 test_lazy_loading_thread_safe                 # \u5e76\u53d1 import \u4e0d\u51fa\u9519\n\u251c\u2500\u2500 test_all_public_names_accessible              # __all__ \u4e2d\u7684\u540d\u79f0\u90fd\u53ef\u8bbf\u95ee\n</code></pre>"},{"location":"tests/#_4","title":"\u56db\u3001\u6838\u5fc3\u67b6\u6784\u4f18\u52bf\u8986\u76d6\u77e9\u9635","text":"<p>\u5c06\u6d4b\u8bd5\u4e0e async-first \u67b6\u6784\u7684\u6838\u5fc3\u4f18\u52bf\u5bf9\u5e94\uff1a</p> \u67b6\u6784\u4f18\u52bf \u6d4b\u8bd5\u8986\u76d6\u6587\u4ef6 \u5173\u952e\u6d4b\u8bd5\u7528\u4f8b Async-Native \u56db\u4ef6\u5957 <code>test_agent_core.py</code> <code>run</code>/<code>run_stream</code>/<code>run_sync</code>/<code>run_stream_sync</code> \u552f\u4e00\u6267\u884c\u5f15\u64ce <code>_run_impl</code> <code>test_agent_core.py</code> \u6240\u6709 run \u53d8\u4f53\u5171\u4eab\u76f8\u540c\u884c\u4e3a \u5e76\u884c\u5de5\u5177\u6267\u884c asyncio.gather <code>test_model_base.py</code>, <code>test_agent_tools_integration.py</code> <code>test_parallel_execution_faster_than_serial</code> \u6d41\u5f0f\u539f\u8bed AsyncIterator <code>test_agent_stream.py</code> RunEvent \u72b6\u6001\u673a\u6d4b\u8bd5 \u540c\u6b65\u9002\u914d\u5668\u8584\u5305\u88c5 <code>test_agent_core.py</code> <code>test_run_sync_bridges_to_async_run</code> sync \u5de5\u5177 run_in_executor <code>test_async_tool.py</code>, <code>test_agent_tools_integration.py</code> \u6df7\u5408 sync/async \u5de5\u5177\u6d4b\u8bd5 weakref \u65e0\u5185\u5b58\u6cc4\u6f0f <code>test_memory_leak.py</code> [\u73b0\u6709] \u5df2\u8986\u76d6 Mixin \u67b6\u6784 <code>test_prompts.py</code>, <code>test_session.py</code> \u5404 Mixin \u72ec\u7acb\u6d4b\u8bd5 \u591a\u6a21\u6001\u652f\u6301 <code>test_agent_multimodal.py</code>, <code>test_vision_history.py</code> images/audio/videos \u5168\u94fe\u8def Guardrails \u5b88\u536b <code>test_guardrails.py</code> [\u73b0\u6709] \u5df2\u8986\u76d6 Workflow async \u7f16\u6392 <code>test_workflow_advanced.py</code> \u591a\u6b65\u7f16\u6392 + \u72b6\u6001\u4f20\u9012 Provider \u4e00\u81f4\u6027 <code>test_model_providers.py</code> \u6240\u6709 Provider async-only \u63a5\u53e3 \u61d2\u52a0\u8f7d\u7ebf\u7a0b\u5b89\u5168 <code>test_lazy_loading.py</code> \u5e76\u53d1 import \u6d4b\u8bd5 Token \u611f\u77e5\u622a\u65ad <code>test_memory.py</code> [\u73b0\u6709] max_tokens \u6d4b\u8bd5 \u5de5\u5177\u5f02\u5e38\u63a7\u5236\u6d41 <code>test_error_handling.py</code> StopAgentRun/RetryAgentRun ACP \u534f\u8bae <code>test_acp.py</code> [\u73b0\u6709] \u5df2\u8986\u76d6"},{"location":"tests/#_5","title":"\u4e94\u3001\u6267\u884c\u7b56\u7565","text":""},{"location":"tests/#51","title":"5.1 \u4f18\u5148\u7ea7\u6392\u5e8f","text":"<pre><code>P0\uff08\u5fc5\u987b\uff09: \u8986\u76d6\u6846\u67b6\u6838\u5fc3\u5dee\u5f02\u5316\u80fd\u529b\n  \u251c\u2500\u2500 conftest.py                        \u2014 \u5171\u4eab fixtures\n  \u251c\u2500\u2500 test_agent_core.py                 \u2014 \u56db\u4ef6\u5957\u6838\u5fc3\u8def\u5f84\n  \u251c\u2500\u2500 test_agent_stream.py               \u2014 \u6d41\u5f0f\u8f93\u51fa\n  \u251c\u2500\u2500 test_agent_tools_integration.py    \u2014 \u5de5\u5177\u8c03\u7528\u56de\u8def\n  \u2514\u2500\u2500 test_model_base.py                 \u2014 Model \u57fa\u7c7b + \u5e76\u884c\u6267\u884c\n\nP1\uff08\u91cd\u8981\uff09: \u8986\u76d6\u4e8c\u7ea7\u6838\u5fc3\u80fd\u529b\n  \u251c\u2500\u2500 test_agent_multimodal.py           \u2014 \u591a\u6a21\u6001\n  \u251c\u2500\u2500 test_model_providers.py            \u2014 Provider \u4e00\u81f4\u6027\n  \u251c\u2500\u2500 test_prompts.py                    \u2014 Prompt \u6784\u5efa\n  \u251c\u2500\u2500 test_session.py                    \u2014 \u4f1a\u8bdd\u6301\u4e45\u5316\n  \u2514\u2500\u2500 test_run_response.py              \u2014 \u54cd\u5e94\u6a21\u578b\n\nP2\uff08\u589e\u5f3a\uff09: \u8fb9\u7f18\u573a\u666f\u548c\u5065\u58ee\u6027\n  \u251c\u2500\u2500 test_workflow_advanced.py          \u2014 Workflow \u589e\u5f3a\n  \u251c\u2500\u2500 test_error_handling.py             \u2014 \u9519\u8bef\u6062\u590d\n  \u2514\u2500\u2500 test_lazy_loading.py              \u2014 \u61d2\u52a0\u8f7d\n</code></pre>"},{"location":"tests/#52","title":"5.2 \u73b0\u6709\u6d4b\u8bd5\u5904\u7406","text":"\u6587\u4ef6 \u5904\u7406\u65b9\u5f0f \u8bf4\u660e <code>test_agent.py</code> \u4fdd\u7559 \u521d\u59cb\u5316\u548c\u5c5e\u6027\u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_async_tool.py</code> \u4fdd\u7559 FunctionCall \u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_agent_as_tool.py</code> \u4fdd\u7559 as_tool \u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_memory.py</code> \u4fdd\u7559 Memory \u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_memory_leak.py</code> \u4fdd\u7559 weakref \u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_workspace.py</code> \u4fdd\u7559 Workspace \u6d4b\u8bd5\u4f9d\u7136\u6709\u6548 <code>test_sanitize_messages.py</code> \u4fdd\u7559\uff0c\u6574\u5408\u5230 test_model_base.py \u53ef\u4f5c\u4e3a Model \u6d4b\u8bd5\u7684\u4e00\u90e8\u5206 <code>test_vision_history.py</code> \u4fdd\u7559 \u591a\u6a21\u6001\u5386\u53f2\u6d4b\u8bd5\u72ec\u7acb <code>test_guardrails.py</code> \u4fdd\u7559 \u5b88\u536b\u6d4b\u8bd5\u72ec\u7acb <code>test_patch_tool.py</code> \u4fdd\u7559 \u5de5\u5177\u6d4b\u8bd5\u72ec\u7acb <code>test_acp.py</code> \u4fdd\u7559 ACP \u6d4b\u8bd5\u72ec\u7acb <code>test_cli.py</code> \u4fdd\u7559 CLI \u914d\u7f6e\u6d4b\u8bd5\u72ec\u7acb <code>test_deep_agent.py</code> \u4fdd\u7559 DeepAgent \u6d4b\u8bd5\u72ec\u7acb <code>test_react_agent.py</code> \u5408\u5e76\u5230 test_agent_core.py \u529f\u80fd\u91cd\u53e0 <code>test_llm.py</code> \u5408\u5e76\u5230 test_model_base.py \u529f\u80fd\u91cd\u53e0 <code>test_edit_tool.py</code> \u5220\u9664 \u5f15\u7528\u5df2\u91cd\u547d\u540d\u6a21\u5757\uff08\u5df2\u5728 gitignore\uff09"},{"location":"tests/#53-mock","title":"5.3 Mock \u7b56\u7565\u603b\u7ed3","text":"\u5c42\u7ea7 Mock \u65b9\u5f0f \u539f\u56e0 Model.response() <code>AsyncMock</code> \u907f\u514d\u771f\u5b9e API \u8c03\u7528 Model.response_stream() <code>AsyncMock</code> \u8fd4\u56de async generator \u63a7\u5236\u6d41\u5f0f\u8f93\u51fa chunk FunctionCall.execute() \u771f\u5b9e\u6267\u884c\uff08\u7b80\u5355\u5de5\u5177\u51fd\u6570\uff09 \u9a8c\u8bc1\u5b9e\u9645 async \u884c\u4e3a DB/Storage <code>AsyncMock</code> \u6216 <code>tempfile</code> \u907f\u514d\u5916\u90e8\u4f9d\u8d56 Workspace <code>tempfile</code> + \u771f\u5b9e\u6587\u4ef6\u64cd\u4f5c \u9a8c\u8bc1\u6587\u4ef6 I/O"},{"location":"tests/#54","title":"5.4 \u8fd0\u884c\u547d\u4ee4","text":"<pre><code># \u8fd0\u884c\u5168\u90e8\u6d4b\u8bd5\npython -m pytest tests/ -v --tb=short --ignore=tests/test_edit_tool.py\n\n# \u8fd0\u884c\u65b0\u589e\u6d4b\u8bd5\npython -m pytest tests/test_agent_core.py tests/test_agent_stream.py tests/test_agent_tools_integration.py tests/test_model_base.py -v\n\n# \u8fd0\u884c P0 \u6d4b\u8bd5\npython -m pytest tests/test_agent_core.py tests/test_agent_stream.py tests/test_agent_tools_integration.py tests/test_model_base.py -v --tb=short\n\n# \u8fd0\u884c\u5e76\u53d1\u6d4b\u8bd5\uff08\u9a8c\u8bc1\u5e76\u884c\u5de5\u5177\u6267\u884c\u6027\u80fd\uff09\npython -m pytest tests/test_model_base.py::TestRunFunctionCalls::test_parallel_execution_faster_than_serial -v -s\n</code></pre>"},{"location":"tests/#_6","title":"\u516d\u3001\u5b9e\u9645\u7ed3\u679c","text":"\u6307\u6807 \u91cd\u6784\u524d \u91cd\u6784\u540e \u6d4b\u8bd5\u6587\u4ef6\u6570 23 35 \u6d4b\u8bd5\u7528\u4f8b\u6570 ~316 500 \u4ee3\u7801\u884c\u6570 ~4849 ~7157 Agent \u6838\u5fc3\u8def\u5f84\u8986\u76d6 \u4f4e \u5b8c\u6574\uff08\u56db\u4ef6\u5957 + \u6d41\u5f0f + \u5de5\u5177\u8c03\u7528\uff09 \u5e76\u884c\u6267\u884c\u8986\u76d6 \u65e0 \u6709\uff08\u6027\u80fd\u65ad\u8a00 &lt; 0.25s\uff09 \u591a\u6a21\u6001\u8986\u76d6 \u4ec5\u89c6\u89c9\u5386\u53f2 images/audio/videos \u5168\u94fe\u8def Provider \u4e00\u81f4\u6027\u8986\u76d6 \u65e0 \u6709\uff086 provider async \u68c0\u67e5\uff09 \u9519\u8bef\u5904\u7406\u8986\u76d6 \u90e8\u5206 \u5b8c\u6574\uff08\u5f02\u5e38/\u8d85\u65f6/\u53d6\u6d88\uff09 \u8fd0\u884c\u65f6\u95f4 ~3s ~5s \u5168\u90e8\u901a\u8fc7 \u2713 \u2713\uff08500 passed\uff09"},{"location":"api/agent/","title":"Agent API \u53c2\u8003","text":"<p>\u57fa\u4e8e\u6e90\u7801\u7684\u5b8c\u6574 API \u6587\u6863\u3002\u540e\u7eed\u5c06\u901a\u8fc7 docstring \u81ea\u52a8\u751f\u6210\u3002</p>"},{"location":"api/agent/#agent","title":"Agent","text":"<pre><code>from agentica import Agent\n</code></pre> <p>\u6838\u5fc3 Agent \u7c7b\uff0c\u5c06\u6a21\u578b\u3001\u5de5\u5177\u548c\u8bb0\u5fc6\u8fde\u63a5\u5728\u4e00\u8d77\u3002\u4f7f\u7528 <code>@dataclass(init=False)</code> + mixin \u591a\u7ee7\u627f\u67b6\u6784\u3002</p>"},{"location":"api/agent/#_1","title":"\u6784\u9020\u53c2\u6570","text":""},{"location":"api/agent/#_2","title":"\u7b2c\u4e00\u5c42\uff1a\u6838\u5fc3\u5b9a\u4e49","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>model</code> <code>Model</code> <code>None</code> LLM \u6a21\u578b\u5b9e\u4f8b\u3002\u672a\u6307\u5b9a\u65f6\u4f7f\u7528\u9ed8\u8ba4 OpenAI \u6a21\u578b <code>name</code> <code>str</code> <code>None</code> Agent \u540d\u79f0\uff0c\u7528\u4e8e\u65e5\u5fd7\u548c\u56e2\u961f\u6807\u8bc6 <code>agent_id</code> <code>str</code> \u81ea\u52a8 UUID Agent \u552f\u4e00\u6807\u8bc6 <code>description</code> <code>str</code> <code>None</code> Agent \u63cf\u8ff0\uff0c\u5728 Team \u6a21\u5f0f\u4e0b\u5e2e\u52a9\u534f\u8c03\u8005\u7406\u89e3\u6210\u5458\u80fd\u529b <code>instructions</code> <code>str \\| List[str] \\| Callable</code> <code>None</code> \u884c\u4e3a\u6307\u4ee4\uff0c\u6ce8\u5165\u5230 system prompt <code>tools</code> <code>List[Tool \\| Callable]</code> <code>None</code> \u5de5\u5177\u5217\u8868 <code>knowledge</code> <code>Knowledge</code> <code>None</code> \u77e5\u8bc6\u5e93\u5b9e\u4f8b (RAG) <code>team</code> <code>List[Agent]</code> <code>None</code> \u56e2\u961f\u6210\u5458\u5217\u8868 <code>workspace</code> <code>Workspace \\| str</code> <code>None</code> \u5de5\u4f5c\u7a7a\u95f4\uff08\u4f20 str \u4f1a\u81ea\u52a8\u521b\u5efa Workspace\uff09 <code>response_model</code> <code>Type[BaseModel]</code> <code>None</code> Pydantic \u6a21\u578b\uff0c\u542f\u7528\u7ed3\u6784\u5316\u8f93\u51fa"},{"location":"api/agent/#_3","title":"\u7b2c\u4e8c\u5c42\uff1a\u901a\u7528\u914d\u7f6e","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>add_history_to_messages</code> <code>bool</code> <code>False</code> \u5c06\u5386\u53f2\u6d88\u606f\u52a0\u5165\u4e0a\u4e0b\u6587 <code>history_window</code> <code>int</code> <code>3</code> \u4fdd\u7559\u7684\u5386\u53f2\u8f6e\u6570 <code>structured_outputs</code> <code>bool</code> <code>False</code> \u4f7f\u7528 OpenAI \u4e25\u683c\u7ed3\u6784\u5316\u8f93\u51fa\u6a21\u5f0f <code>debug</code> <code>bool</code> <code>False</code> \u8c03\u8bd5\u6a21\u5f0f\uff08\u8be6\u7ec6\u65e5\u5fd7\uff09 <code>tracing</code> <code>bool</code> <code>False</code> \u542f\u7528 Langfuse \u8ffd\u8e2a"},{"location":"api/agent/#_4","title":"\u7b2c\u4e09\u5c42\uff1a\u6253\u5305\u914d\u7f6e","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>prompt_config</code> <code>PromptConfig</code> <code>PromptConfig()</code> \u63d0\u793a\u8bcd\u6784\u5efa\u914d\u7f6e <code>tool_config</code> <code>ToolConfig</code> <code>ToolConfig()</code> \u5de5\u5177\u8c03\u7528\u914d\u7f6e <code>long_term_memory_config</code> <code>WorkspaceMemoryConfig</code> <code>WorkspaceMemoryConfig()</code> \u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6\u914d\u7f6e <code>team_config</code> <code>TeamConfig</code> <code>TeamConfig()</code> \u56e2\u961f\u914d\u7f6e"},{"location":"api/agent/#_5","title":"\u8fd0\u884c\u65f6","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>working_memory</code> <code>WorkingMemory</code> <code>WorkingMemory()</code> \u5de5\u4f5c\u8bb0\u5fc6\uff08\u4f1a\u8bdd\u6d88\u606f\u5386\u53f2\uff09 <code>context</code> <code>Dict[str, Any]</code> <code>None</code> \u8fd0\u884c\u65f6\u4e0a\u4e0b\u6587\uff0c\u4f20\u9012\u7ed9\u5de5\u5177\u548c\u52a8\u6001\u6307\u4ee4"},{"location":"api/agent/#_6","title":"\u65b9\u6cd5","text":""},{"location":"api/agent/#async-runmessage-kwargs-runresponse","title":"<code>async run(message, **kwargs) -&gt; RunResponse</code>","text":"<p>\u5f02\u6b65\u975e\u6d41\u5f0f\u8fd0\u884c\u3002</p> <pre><code>result = await agent.run(\"\u4f60\u597d\")\nprint(result.content)\n</code></pre> <p>\u53c2\u6570\uff1a</p> \u53c2\u6570 \u7c7b\u578b \u8bf4\u660e <code>message</code> <code>str \\| List \\| Dict \\| Message</code> \u8f93\u5165\u6d88\u606f <code>stream</code> <code>bool</code> \u662f\u5426\u6d41\u5f0f\uff08\u5185\u90e8\u4f7f\u7528\uff09 <code>stream_intermediate_steps</code> <code>bool</code> \u6d41\u5f0f\u4e2d\u95f4\u6b65\u9aa4 <code>session_id</code> <code>str</code> \u4f1a\u8bdd ID <code>user_id</code> <code>str</code> \u7528\u6237 ID <code>save_response_to_file</code> <code>str</code> \u4fdd\u5b58\u54cd\u5e94\u5230\u6587\u4ef6 <code>**kwargs</code> \u4f20\u9012\u7ed9\u6a21\u578b\u7684\u989d\u5916\u53c2\u6570 <p>\u8fd4\u56de\uff1a <code>RunResponse</code></p>"},{"location":"api/agent/#async-run_streammessage-kwargs-asynciteratorrunresponse","title":"<code>async run_stream(message, **kwargs) -&gt; AsyncIterator[RunResponse]</code>","text":"<p>\u5f02\u6b65\u6d41\u5f0f\u8fd0\u884c\u3002\u8fd4\u56de\u5f02\u6b65\u751f\u6210\u5668\u3002</p> <pre><code>async for chunk in agent.run_stream(\"\u4f60\u597d\"):\n    if chunk.content:\n        print(chunk.content, end=\"\")\n</code></pre> <p>\u53c2\u6570\u4e0e <code>run()</code> \u76f8\u540c\u3002</p>"},{"location":"api/agent/#run_syncmessage-kwargs-runresponse","title":"<code>run_sync(message, **kwargs) -&gt; RunResponse</code>","text":"<p>\u540c\u6b65\u975e\u6d41\u5f0f\u8fd0\u884c\u3002\u5185\u90e8\u901a\u8fc7 <code>asyncio</code> \u9002\u914d\u5668\u8c03\u7528 <code>run()</code>\u3002</p> <pre><code>result = agent.run_sync(\"\u4f60\u597d\")\nprint(result.content)\n</code></pre>"},{"location":"api/agent/#run_stream_syncmessage-kwargs-iteratorrunresponse","title":"<code>run_stream_sync(message, **kwargs) -&gt; Iterator[RunResponse]</code>","text":"<p>\u540c\u6b65\u6d41\u5f0f\u8fd0\u884c\u3002\u901a\u8fc7\u540e\u53f0\u7ebf\u7a0b\u9a71\u52a8\u5f02\u6b65\u8fed\u4ee3\u5668\u3002</p> <pre><code>for chunk in agent.run_stream_sync(\"\u4f60\u597d\"):\n    if chunk.content:\n        print(chunk.content, end=\"\")\n</code></pre>"},{"location":"api/agent/#async-print_responsemessage-kwargs","title":"<code>async print_response(message, **kwargs)</code>","text":"<p>\u5f02\u6b65\u975e\u6d41\u5f0f\u6253\u5370\u683c\u5f0f\u5316\u54cd\u5e94\u3002</p> <pre><code>await agent.print_response(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"api/agent/#async-print_response_streammessage-kwargs","title":"<code>async print_response_stream(message, **kwargs)</code>","text":"<p>\u5f02\u6b65\u6d41\u5f0f\u6253\u5370\u683c\u5f0f\u5316\u54cd\u5e94\u3002</p> <pre><code>await agent.print_response_stream(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"api/agent/#print_response_syncmessage-kwargs","title":"<code>print_response_sync(message, **kwargs)</code>","text":"<p>\u540c\u6b65\u975e\u6d41\u5f0f\u6253\u5370\u3002</p> <pre><code>agent.print_response_sync(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"api/agent/#print_response_stream_syncmessage-kwargs","title":"<code>print_response_stream_sync(message, **kwargs)</code>","text":"<p>\u540c\u6b65\u6d41\u5f0f\u6253\u5370\u3002</p> <pre><code>agent.print_response_stream_sync(\"\u89e3\u91ca\u91cf\u5b50\u8ba1\u7b97\")\n</code></pre>"},{"location":"api/agent/#as_tooltool_namenone-tool_descriptionnone-function","title":"<code>as_tool(tool_name=None, tool_description=None) -&gt; Function</code>","text":"<p>\u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\uff0c\u4f9b\u5176\u4ed6 Agent \u4f7f\u7528\u3002</p> <pre><code>tool = agent.as_tool(\n    tool_name=\"research\",\n    tool_description=\"\u6df1\u5ea6\u7814\u7a76\u6307\u5b9a\u4e3b\u9898\",\n)\n</code></pre>"},{"location":"api/agent/#cancel","title":"<code>cancel()</code>","text":"<p>\u53d6\u6d88\u5f53\u524d\u8fd0\u884c\u3002\u901a\u8fc7\u534f\u4f5c\u5f0f\u53d6\u6d88\u901a\u77e5 Agent \u5728\u4e0b\u4e00\u4e2a\u68c0\u67e5\u70b9\u505c\u6b62\u3002</p> <pre><code>agent.cancel()\n</code></pre>"},{"location":"api/agent/#get_chat_history-listmessage","title":"<code>get_chat_history() -&gt; List[Message]</code>","text":"<p>\u83b7\u53d6\u804a\u5929\u5386\u53f2\u3002</p>"},{"location":"api/agent/#search_knowledge_basequery-num_documentsnone-str","title":"<code>search_knowledge_base(query, num_documents=None) -&gt; str</code>","text":"<p>\u641c\u7d22\u77e5\u8bc6\u5e93\u3002</p>"},{"location":"api/agent/#promptconfig","title":"PromptConfig","text":"<pre><code>from agentica.agent.config import PromptConfig\n</code></pre> <p>\u63d0\u793a\u8bcd\u6784\u5efa\u7684\u9ad8\u7ea7\u914d\u7f6e\u3002\u5927\u591a\u6570\u573a\u666f\u53ea\u9700 <code>Agent.instructions</code>\u3002</p> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>system_prompt</code> <code>str \\| Callable</code> <code>None</code> \u81ea\u5b9a\u4e49 system prompt\uff08\u8986\u76d6\u9ed8\u8ba4\u6784\u5efa\uff09 <code>task</code> <code>str</code> <code>None</code> \u4efb\u52a1\u63cf\u8ff0 <code>role</code> <code>str</code> <code>None</code> \u89d2\u8272\u63cf\u8ff0 <code>guidelines</code> <code>List[str]</code> <code>None</code> \u884c\u4e3a\u51c6\u5219 <code>expected_output</code> <code>str</code> <code>None</code> \u671f\u671b\u8f93\u51fa\u683c\u5f0f <code>additional_context</code> <code>str</code> <code>None</code> \u989d\u5916\u4e0a\u4e0b\u6587 <code>add_datetime_to_instructions</code> <code>bool</code> <code>True</code> \u6ce8\u5165\u5f53\u524d\u65f6\u95f4 <code>prevent_hallucinations</code> <code>bool</code> <code>False</code> \u6dfb\u52a0\u9632\u5e7b\u89c9\u6307\u4ee4 <code>prevent_prompt_leakage</code> <code>bool</code> <code>False</code> \u9632\u6b62 prompt \u6cc4\u9732 <code>enable_agentic_prompt</code> <code>bool</code> <code>False</code> \u542f\u7528\u589e\u5f3a prompt\uff08\u9002\u5408 DeepAgent\uff09 <code>output_language</code> <code>str</code> <code>None</code> \u6307\u5b9a\u8f93\u51fa\u8bed\u8a00 <code>markdown</code> <code>bool</code> <code>False</code> Markdown \u683c\u5f0f\u8f93\u51fa"},{"location":"api/agent/#toolconfig","title":"ToolConfig","text":"<pre><code>from agentica.agent.config import ToolConfig\n</code></pre> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>support_tool_calls</code> <code>bool</code> <code>True</code> \u662f\u5426\u652f\u6301\u5de5\u5177\u8c03\u7528 <code>tool_call_limit</code> <code>int</code> <code>None</code> \u5de5\u5177\u8c03\u7528\u6b21\u6570\u9650\u5236 <code>tool_choice</code> <code>str \\| Dict</code> <code>None</code> \u5de5\u5177\u9009\u62e9\u7b56\u7565 <code>search_knowledge</code> <code>bool</code> <code>True</code> \u5141\u8bb8 Agent \u4e3b\u52a8\u641c\u7d22\u77e5\u8bc6\u5e93 <code>add_references</code> <code>bool</code> <code>False</code> \u6dfb\u52a0\u77e5\u8bc6\u5e93\u5f15\u7528 <code>compress_tool_results</code> <code>bool</code> <code>False</code> \u538b\u7f29\u5de5\u5177\u7ed3\u679c <code>compression_manager</code> <code>CompressionManager</code> <code>None</code> \u538b\u7f29\u7ba1\u7406\u5668\u5b9e\u4f8b"},{"location":"api/agent/#workspacememoryconfig","title":"WorkspaceMemoryConfig","text":"<pre><code>from agentica.agent.config import WorkspaceMemoryConfig\n</code></pre> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>load_workspace_context</code> <code>bool</code> <code>True</code> \u52a0\u8f7d workspace \u4e0a\u4e0b\u6587 <code>load_workspace_memory</code> <code>bool</code> <code>True</code> \u52a0\u8f7d workspace \u8bb0\u5fc6 <code>memory_days</code> <code>int</code> <code>2</code> \u8bb0\u5fc6\u56de\u6eaf\u5929\u6570"},{"location":"api/agent/#teamconfig","title":"TeamConfig","text":"<pre><code>from agentica.agent.config import TeamConfig\n</code></pre> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>respond_directly</code> <code>bool</code> <code>False</code> \u56e2\u961f\u6210\u5458\u76f4\u63a5\u56de\u590d\uff08\u4e0d\u7ecf\u534f\u8c03\u8005\uff09 <code>add_transfer_instructions</code> <code>bool</code> <code>True</code> \u81ea\u52a8\u6dfb\u52a0\u59d4\u6d3e\u6307\u4ee4 <code>team_response_separator</code> <code>str</code> <code>\"\\n\"</code> \u56e2\u961f\u54cd\u5e94\u5206\u9694\u7b26"},{"location":"api/agent/#deepagent","title":"DeepAgent","text":"<pre><code>from agentica import DeepAgent\n</code></pre> <p>\u9884\u914d\u7f6e\u7684 Agent\uff0c\u7ee7\u627f\u81ea <code>Agent</code>\uff0c\u5185\u7f6e\u6587\u4ef6\u64cd\u4f5c\u3001\u547d\u4ee4\u6267\u884c\u3001\u7f51\u9875\u641c\u7d22\u7b49\u5de5\u5177\u3002</p>"},{"location":"api/agent/#_7","title":"\u6784\u9020\u53c2\u6570","text":"<p>\u7ee7\u627f Agent \u6240\u6709\u53c2\u6570\uff0c\u989d\u5916\u63d0\u4f9b\uff1a</p> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>enable_file_tools</code> <code>bool</code> <code>True</code> \u542f\u7528\u6587\u4ef6\u64cd\u4f5c\u5de5\u5177 <code>enable_execute_tools</code> <code>bool</code> <code>True</code> \u542f\u7528\u547d\u4ee4\u6267\u884c\u5de5\u5177 <code>enable_web_tools</code> <code>bool</code> <code>True</code> \u542f\u7528\u7f51\u9875\u641c\u7d22\u5de5\u5177 <code>enable_todo_tools</code> <code>bool</code> <code>True</code> \u542f\u7528 TODO \u7ba1\u7406 <code>enable_task_tools</code> <code>bool</code> <code>True</code> \u542f\u7528\u5b50\u4efb\u52a1\u59d4\u6d3e"},{"location":"api/agent/#_8","title":"\u5185\u7f6e\u5de5\u5177","text":"\u5de5\u5177 \u51fd\u6570 \u8bf4\u660e \u6587\u4ef6 <code>ls</code>, <code>glob</code>, <code>grep</code>, <code>read_file</code>, <code>write_file</code>, <code>edit_file</code> \u6587\u4ef6\u7cfb\u7edf\u64cd\u4f5c \u6267\u884c <code>execute</code> \u8fd0\u884c Shell \u547d\u4ee4 \u641c\u7d22 <code>web_search</code>, <code>fetch_url</code> \u7f51\u9875\u641c\u7d22\u548c\u6293\u53d6 \u4efb\u52a1 <code>task</code> \u59d4\u6d3e\u5b50\u4efb\u52a1\u7ed9\u5b50 Agent TODO <code>read_todos</code>, <code>write_todos</code> \u4efb\u52a1\u5217\u8868\u7ba1\u7406"},{"location":"api/agent/#runresponse","title":"RunResponse","text":"<pre><code>from agentica import RunResponse\n</code></pre> <p>Agent \u8fd0\u884c\u7684\u8fd4\u56de\u503c\u3002</p>"},{"location":"api/agent/#_9","title":"\u5c5e\u6027","text":"\u5c5e\u6027 \u7c7b\u578b \u8bf4\u660e <code>content</code> <code>Any</code> \u54cd\u5e94\u5185\u5bb9\uff08str \u6216 BaseModel\uff09 <code>event</code> <code>RunEvent</code> \u4e8b\u4ef6\u7c7b\u578b <code>model</code> <code>str</code> \u6a21\u578b\u540d\u79f0 <code>run_id</code> <code>str</code> \u8fd0\u884c ID <code>session_id</code> <code>str</code> \u4f1a\u8bdd ID <code>messages</code> <code>List[Message]</code> \u6d88\u606f\u5217\u8868 <code>metrics</code> <code>Dict</code> \u6307\u6807\uff08token \u7528\u91cf\u3001\u8017\u65f6\uff09 <code>tool_calls</code> <code>List[ToolCallInfo]</code> \u5de5\u5177\u8c03\u7528\u8be6\u60c5 <code>tool_call_times</code> <code>Dict[str, float]</code> \u5404\u5de5\u5177\u8017\u65f6 <code>reasoning_content</code> <code>str</code> \u63a8\u7406\u5185\u5bb9\uff08\u601d\u8003\u8fc7\u7a0b\uff09 <code>images</code> <code>List[Image]</code> \u751f\u6210\u7684\u56fe\u7247"},{"location":"api/agent/#_10","title":"\u65b9\u6cd5","text":"\u65b9\u6cd5 \u8fd4\u56de \u8bf4\u660e <code>to_json()</code> <code>str</code> \u8f6c\u4e3a JSON \u5b57\u7b26\u4e32 <code>to_dict()</code> <code>Dict</code> \u8f6c\u4e3a\u5b57\u5178"},{"location":"api/agent/#runevent","title":"RunEvent","text":"<pre><code>from agentica import RunEvent\n</code></pre> <p>\u8fd0\u884c\u4e8b\u4ef6\u679a\u4e3e\uff1a</p> \u4e8b\u4ef6 \u8bf4\u660e <code>run_started</code> \u8fd0\u884c\u5f00\u59cb <code>run_response</code> \u6b63\u5e38\u54cd\u5e94\u5185\u5bb9 <code>run_completed</code> \u8fd0\u884c\u5b8c\u6210 <code>tool_call_started</code> \u5de5\u5177\u8c03\u7528\u5f00\u59cb <code>tool_call_completed</code> \u5de5\u5177\u8c03\u7528\u5b8c\u6210 <code>multi_round_turn</code> \u591a\u8f6e\u5bf9\u8bdd\u8f6e\u6b21 <code>multi_round_completed</code> \u591a\u8f6e\u5bf9\u8bdd\u5b8c\u6210"},{"location":"api/agent/#toolcallinfo","title":"ToolCallInfo","text":"<pre><code>from agentica import ToolCallInfo\n</code></pre> <p>\u5de5\u5177\u8c03\u7528\u4fe1\u606f\u7684\u6241\u5e73\u5316\u8bbf\u95ee\uff1a</p> \u5c5e\u6027 \u7c7b\u578b \u8bf4\u660e <code>tool_name</code> <code>str</code> \u5de5\u5177\u540d\u79f0 <code>tool_args</code> <code>Dict</code> \u8c03\u7528\u53c2\u6570 <code>tool_result</code> <code>str</code> \u8fd4\u56de\u7ed3\u679c <code>call_id</code> <code>str</code> \u8c03\u7528 ID"},{"location":"api/agent/#workflow","title":"Workflow","text":"<pre><code>from agentica import Workflow\n</code></pre> <p>\u786e\u5b9a\u6027\u5de5\u4f5c\u6d41\u5f15\u64ce\u3002\u5b50\u7c7b\u5b9e\u73b0 <code>run()</code> \u65b9\u6cd5\u7f16\u6392\u6b65\u9aa4\u3002</p>"},{"location":"api/agent/#_11","title":"\u65b9\u6cd5","text":"\u65b9\u6cd5 \u7c7b\u578b \u8bf4\u660e <code>run()</code> async \u5b50\u7c7b\u5b9e\u73b0\u7684\u8fd0\u884c\u903b\u8f91 <code>run_sync()</code> sync \u540c\u6b65\u9002\u914d\u5668"},{"location":"api/agent/#model","title":"Model","text":"<pre><code>from agentica import Model\n</code></pre> <p>\u6240\u6709\u6a21\u578b\u7684\u62bd\u8c61\u57fa\u7c7b\uff0c\u5b9a\u4e49\u56db\u4e2a async \u62bd\u8c61\u65b9\u6cd5\uff1a</p> \u65b9\u6cd5 \u8bf4\u660e <code>invoke()</code> \u5355\u6b21\u8c03\u7528\uff08\u4e0d\u5904\u7406\u5de5\u5177\uff09 <code>invoke_stream()</code> \u6d41\u5f0f\u8c03\u7528 <code>response()</code> \u5b8c\u6574\u54cd\u5e94\uff08\u542b\u5de5\u5177\u5faa\u73af\uff09 <code>response_stream()</code> \u6d41\u5f0f\u54cd\u5e94\uff08\u542b\u5de5\u5177\u5faa\u73af\uff09"},{"location":"api/agent/#_12","title":"\u901a\u7528\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u8bf4\u660e <code>id</code> <code>str</code> \u6a21\u578b ID <code>api_key</code> <code>str</code> API \u5bc6\u94a5 <code>base_url</code> <code>str</code> API \u5730\u5740 <code>temperature</code> <code>float</code> \u6e29\u5ea6 <code>max_tokens</code> <code>int</code> \u6700\u5927\u8f93\u51fa token <code>timeout</code> <code>int</code> \u8d85\u65f6\u79d2\u6570"},{"location":"api/agent/#_13","title":"\u5185\u7f6e\u6a21\u578b","text":"\u7c7b \u63d0\u4f9b\u5546 \u9ed8\u8ba4\u6a21\u578b <code>OpenAIChat</code> OpenAI gpt-4o-mini <code>AzureOpenAIChat</code> Azure OpenAI \u2014 <code>DeepSeek</code> DeepSeek deepseek-chat <code>Claude</code> Anthropic claude-3.5-sonnet <code>ZhipuAI</code> \u667a\u8c31 AI glm-4.7-flash <code>Qwen</code> \u901a\u4e49\u5343\u95ee qwen-plus <code>Moonshot</code> \u6708\u4e4b\u6697\u9762 moonshot-v1-128k <code>Doubao</code> \u8c46\u5305 doubao-pro-32k <code>Yi</code> \u96f6\u4e00\u4e07\u7269 yi-large <code>Grok</code> xAI grok-beta <code>Ollama</code> \u672c\u5730 llama3 <code>Together</code> Together AI \u2014 <code>OpenAILike</code> \u901a\u7528\u9002\u914d \u2014"},{"location":"api/agent/#workingmemory","title":"WorkingMemory","text":"<pre><code>from agentica.memory import WorkingMemory\n</code></pre> <p>\u8fd0\u884c\u65f6\u5de5\u4f5c\u8bb0\u5fc6\uff0c\u7ef4\u62a4\u4f1a\u8bdd\u6d88\u606f\u5386\u53f2\u3002</p>"},{"location":"api/agent/#_14","title":"\u6784\u9020\u53c2\u6570","text":"\u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>db</code> <code>BaseDb</code> <code>None</code> \u6301\u4e45\u5316\u6570\u636e\u5e93"},{"location":"api/agent/#tool-function-functioncall","title":"Tool / Function / FunctionCall","text":"<pre><code>from agentica import Tool, Function, FunctionCall\n</code></pre> <p>\u4e09\u5c42\u5de5\u5177\u67b6\u6784\uff1a</p> \u7c7b \u8bf4\u660e <code>Tool</code> \u5de5\u5177\u5bb9\u5668\uff0c\u6ce8\u518c\u591a\u4e2a Function <code>Function</code> \u51fd\u6570\u5b9a\u4e49\uff08schema + \u5165\u53e3\u70b9\uff09 <code>FunctionCall</code> \u5355\u6b21\u51fd\u6570\u8c03\u7528\u5b9e\u4f8b"},{"location":"api/agent/#functionfrom_callable","title":"Function.from_callable","text":"<pre><code>func = Function.from_callable(my_function, strict=True)\n</code></pre> <p>\u4ece Python \u51fd\u6570\u81ea\u52a8\u751f\u6210\u5de5\u5177\u5b9a\u4e49\u3002</p>"},{"location":"api/agent/#_15","title":"\u6570\u636e\u5e93","text":"<pre><code>from agentica import SqliteDb, PostgresDb, InMemoryDb, JsonDb\n</code></pre> \u7c7b \u8bf4\u660e <code>SqliteDb</code> SQLite \u6301\u4e45\u5316 <code>PostgresDb</code> PostgreSQL <code>InMemoryDb</code> \u5185\u5b58\uff08\u6d4b\u8bd5\u7528\uff09 <code>JsonDb</code> JSON \u6587\u4ef6 <pre><code>db = SqliteDb(table_name=\"sessions\", db_file=\"agent.db\")\n</code></pre>"},{"location":"api/agent/#_16","title":"\u5b9e\u7528\u5de5\u5177","text":""},{"location":"api/agent/#token","title":"Token \u8ba1\u6570","text":"<pre><code>from agentica import count_tokens, count_text_tokens\n\ntokens = count_text_tokens(\"Hello, world!\", model_id=\"gpt-4o\")\ntokens = count_tokens(messages, tools=tools, model_id=\"gpt-4o\")\n</code></pre>"},{"location":"api/agent/#_17","title":"\u65e5\u5fd7","text":"<pre><code>from agentica import set_log_level_to_debug, set_log_level_to_info, logger\n</code></pre>"},{"location":"api/agent/#_18","title":"\u683c\u5f0f\u5316\u6253\u5370","text":"<pre><code>from agentica import pprint_run_response\n\npprint_run_response(response, markdown=True)\n</code></pre>"},{"location":"concepts/agent/","title":"Agent","text":"<p>Agent \u662f Agentica \u7684\u6838\u5fc3\u7ec4\u4ef6\u2014\u2014\u5b83\u5c06\u6a21\u578b\u3001\u5de5\u5177\u548c\u8bb0\u5fc6\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u80fd\u591f\u601d\u8003\u3001\u51b3\u7b56\u548c\u6267\u884c\u52a8\u4f5c\u3002</p>"},{"location":"concepts/agent/#_1","title":"\u57fa\u672c\u7ed3\u6784","text":"<pre><code>Agent\n\u251c\u2500\u2500 Model          # \u5927\u8111\uff1aLLM \u63d0\u4f9b\u63a8\u7406\u80fd\u529b\n\u251c\u2500\u2500 Tools          # \u53cc\u624b\uff1a\u4e0e\u5916\u90e8\u4e16\u754c\u4ea4\u4e92\u7684\u80fd\u529b\n\u251c\u2500\u2500 Memory         # \u8bb0\u5fc6\uff1a\u4f1a\u8bdd\u5386\u53f2\u4e0e\u957f\u671f\u8bb0\u5fc6\n\u251c\u2500\u2500 Knowledge      # \u77e5\u8bc6\uff1a\u5916\u90e8\u6587\u6863\u68c0\u7d22 (RAG)\n\u2514\u2500\u2500 Instructions   # \u6307\u4ee4\uff1a\u5b9a\u4e49 Agent \u7684\u884c\u4e3a\n</code></pre>"},{"location":"concepts/agent/#agent_1","title":"\u521b\u5efa Agent","text":""},{"location":"concepts/agent/#_2","title":"\u6700\u5c0f\u793a\u4f8b","text":"<pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\n</code></pre>"},{"location":"concepts/agent/#_3","title":"\u5b8c\u6574\u914d\u7f6e","text":"<pre><code>from agentica import Agent, OpenAIChat, BaiduSearchTool\n\nagent = Agent(\n    name=\"Research Assistant\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=[\n        \"\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u7814\u7a76\u52a9\u624b\",\n        \"\u641c\u7d22\u5e76\u6574\u7406\u6700\u65b0\u4fe1\u606f\",\n        \"\u7528\u4e2d\u6587\u56de\u7b54\uff0c\u6761\u7406\u6e05\u6670\",\n    ],\n    tools=[BaiduSearchTool()],\n    add_history_to_messages=True,\n    num_history_responses=5,\n    markdown=True,\n)\n</code></pre>"},{"location":"concepts/agent/#_4","title":"\u53c2\u6570\u5206\u5c42","text":"<p>Agent \u7684\u53c2\u6570\u7ec4\u7ec7\u4e3a\u4e09\u5c42\uff1a</p> <p>\u7b2c\u4e00\u5c42\uff1a\u6838\u5fc3\u5b9a\u4e49</p> \u53c2\u6570 \u7c7b\u578b \u8bf4\u660e <code>model</code> <code>Model</code> LLM \u6a21\u578b\u5b9e\u4f8b <code>name</code> <code>str</code> Agent \u540d\u79f0 <code>instructions</code> <code>str \\| List[str] \\| Callable</code> \u884c\u4e3a\u6307\u4ee4 <code>tools</code> <code>List[Tool \\| Callable]</code> \u5de5\u5177\u5217\u8868 <code>knowledge</code> <code>Knowledge</code> \u77e5\u8bc6\u5e93 <code>team</code> <code>List[Agent]</code> \u56e2\u961f\u6210\u5458 <code>workspace</code> <code>Workspace</code> \u5de5\u4f5c\u7a7a\u95f4 <code>response_model</code> <code>Type[BaseModel]</code> \u7ed3\u6784\u5316\u8f93\u51fa\u6a21\u578b <p>\u7b2c\u4e8c\u5c42\uff1a\u901a\u7528\u914d\u7f6e</p> \u53c2\u6570 \u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e <code>add_history_to_messages</code> <code>bool</code> <code>False</code> \u5c06\u5386\u53f2\u6d88\u606f\u52a0\u5165\u4e0a\u4e0b\u6587 <code>history_window</code> <code>int</code> <code>3</code> \u5386\u53f2\u8f6e\u6570 <code>structured_outputs</code> <code>bool</code> <code>False</code> \u4e25\u683c\u7ed3\u6784\u5316\u8f93\u51fa <code>debug</code> <code>bool</code> <code>False</code> \u8c03\u8bd5\u6a21\u5f0f <p>\u7b2c\u4e09\u5c42\uff1a\u6253\u5305\u914d\u7f6e</p> \u53c2\u6570 \u7c7b\u578b \u8bf4\u660e <code>prompt_config</code> <code>PromptConfig</code> \u63d0\u793a\u8bcd\u914d\u7f6e\uff08system_prompt, markdown, output_language \u7b49\uff09 <code>tool_config</code> <code>ToolConfig</code> \u5de5\u5177\u914d\u7f6e\uff08search_knowledge, tool_call_limit, \u538b\u7f29\u7b49\uff09 <code>long_term_memory_config</code> <code>WorkspaceMemoryConfig</code> \u5de5\u4f5c\u7a7a\u95f4\u8bb0\u5fc6\u914d\u7f6e <code>team_config</code> <code>TeamConfig</code> \u56e2\u961f\u914d\u7f6e\uff08\u59d4\u6d3e\u7b56\u7565\u7b49\uff09"},{"location":"concepts/agent/#_5","title":"\u8fd0\u884c\u65b9\u5f0f","text":"<p>Agentica \u91c7\u7528 async-first \u67b6\u6784\uff0c\u6240\u6709\u6838\u5fc3\u65b9\u6cd5\u539f\u751f async\uff1a</p> <pre><code>import asyncio\nfrom agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\n\n# 1. \u5f02\u6b65\u975e\u6d41\u5f0f\uff08\u63a8\u8350\uff09\nasync def example_async():\n    result = await agent.run(\"\u4f60\u597d\")\n    print(result.content)\n\n# 2. \u5f02\u6b65\u6d41\u5f0f\nasync def example_stream():\n    async for chunk in agent.run_stream(\"\u4f60\u597d\"):\n        if chunk.content:\n            print(chunk.content, end=\"\")\n\n# 3. \u540c\u6b65\u975e\u6d41\u5f0f\nresult = agent.run_sync(\"\u4f60\u597d\")\nprint(result.content)\n\n# 4. \u540c\u6b65\u6d41\u5f0f\nfor chunk in agent.run_stream_sync(\"\u4f60\u597d\"):\n    if chunk.content:\n        print(chunk.content, end=\"\")\n</code></pre>"},{"location":"concepts/agent/#_6","title":"\u65b9\u6cd5\u5bf9\u7167","text":"\u65b9\u6cd5 \u7c7b\u578b \u7528\u9014 <code>run()</code> async \u975e\u6d41\u5f0f\u8fd0\u884c <code>run_stream()</code> async generator \u6d41\u5f0f\u8fd0\u884c <code>run_sync()</code> sync \u540c\u6b65\u9002\u914d\u5668 <code>run_stream_sync()</code> sync iterator \u540c\u6b65\u6d41\u5f0f\u9002\u914d\u5668 <code>print_response()</code> async \u683c\u5f0f\u5316\u6253\u5370\u54cd\u5e94 <code>print_response_stream()</code> async \u683c\u5f0f\u5316\u6d41\u5f0f\u6253\u5370 <code>print_response_sync()</code> sync \u540c\u6b65\u6253\u5370 <code>print_response_stream_sync()</code> sync \u540c\u6b65\u6d41\u5f0f\u6253\u5370"},{"location":"concepts/agent/#model","title":"Model\uff08\u6a21\u578b\uff09","text":"<p>Model \u662f Agent \u7684\"\u5927\u8111\"\uff0c\u63d0\u4f9b\u63a8\u7406\u548c\u751f\u6210\u80fd\u529b\u3002</p>"},{"location":"concepts/agent/#_7","title":"\u652f\u6301\u7684\u6a21\u578b","text":"<pre><code>from agentica import (\n    # OpenAI \u7cfb\u5217\n    OpenAIChat,         # gpt-4o, gpt-4o-mini\n    AzureOpenAIChat,    # Azure \u90e8\u7f72\u7684 OpenAI \u6a21\u578b\n\n    # \u56fd\u5185\u6a21\u578b\n    ZhipuAI,            # glm-4.7-flash\uff08\u514d\u8d39\uff09, glm-4-plus\n    DeepSeek,           # deepseek-chat, deepseek-reasoner\n    Qwen,               # qwen-plus, qwen-turbo\n    Moonshot,           # moonshot-v1-128k\n    Doubao,             # doubao-pro-32k\n    Yi,                 # yi-large\n\n    # \u6d77\u5916\u6a21\u578b\n    Claude,             # claude-3.5-sonnet\n    Grok,               # grok-beta\n    Together,           # \u591a\u79cd\u5f00\u6e90\u6a21\u578b\n\n    # \u672c\u5730\u6a21\u578b\n    Ollama,             # llama3, mistral, qwen2 \u7b49\n\n    # \u901a\u7528\u9002\u914d\n    OpenAILike,         # \u517c\u5bb9 OpenAI API \u7684\u4efb\u610f\u6a21\u578b\n)\n</code></pre>"},{"location":"concepts/agent/#_8","title":"\u901a\u7528\u53c2\u6570","text":"<pre><code>model = OpenAIChat(\n    id=\"gpt-4o\",              # \u6a21\u578b ID\n    api_key=\"sk-xxx\",         # API \u5bc6\u94a5\uff08\u6216\u901a\u8fc7\u73af\u5883\u53d8\u91cf\uff09\n    base_url=\"https://...\",   # API \u5730\u5740\n    temperature=0.7,          # \u6e29\u5ea6\n    max_tokens=4096,          # \u6700\u5927\u8f93\u51fa token\n    timeout=60,               # \u8d85\u65f6\u79d2\u6570\n)\n</code></pre>"},{"location":"concepts/agent/#memory","title":"Memory\uff08\u8bb0\u5fc6\uff09","text":"<p>Agentica \u63d0\u4f9b\u4e24\u5c42\u8bb0\u5fc6\u7cfb\u7edf\uff1a</p>"},{"location":"concepts/agent/#workingmemory","title":"\u8fd0\u884c\u65f6\u8bb0\u5fc6\uff1aWorkingMemory","text":"<p>\u7ba1\u7406\u5f53\u524d\u4f1a\u8bdd\u7684\u6d88\u606f\u5386\u53f2\uff0c\u652f\u6301 token \u611f\u77e5\u7684\u622a\u65ad\u3002</p> <pre><code>from agentica import Agent\n\nagent = Agent(\n    add_history_to_messages=True,   # \u5c06\u5386\u53f2\u52a0\u5165\u4e0a\u4e0b\u6587\n    history_window=5,               # \u4fdd\u7559\u6700\u8fd1 5 \u8f6e\n)\n</code></pre>"},{"location":"concepts/agent/#workspace","title":"\u6301\u4e45\u5316\u8bb0\u5fc6\uff1aWorkspace","text":"<p>\u57fa\u4e8e\u6587\u4ef6\u7684\u6301\u4e45\u5316\u5b58\u50a8\uff0c\u4f7f\u7528 Markdown \u6587\u4ef6\u7ba1\u7406\u4e0a\u4e0b\u6587\u548c\u8bb0\u5fc6\uff1a</p> <pre><code>workspace/\n\u251c\u2500\u2500 AGENT.md      # Agent \u4e0a\u4e0b\u6587\u4fe1\u606f\n\u251c\u2500\u2500 PERSONA.md    # \u7528\u6237\u753b\u50cf\n\u251c\u2500\u2500 TOOLS.md      # \u5de5\u5177\u4f7f\u7528\u8bb0\u5f55\n\u251c\u2500\u2500 USER.md       # \u7528\u6237\u76f8\u5173\u4fe1\u606f\n\u251c\u2500\u2500 MEMORY.md     # \u957f\u671f\u8bb0\u5fc6\n\u2514\u2500\u2500 users/\n    \u2514\u2500\u2500 {user_id}/  # \u591a\u7528\u6237\u9694\u79bb\n</code></pre> <pre><code>from agentica import Agent, Workspace\n\nagent = Agent(\n    workspace=Workspace(path=\"./my_workspace\", user_id=\"alice\"),\n)\n</code></pre>"},{"location":"concepts/agent/#_9","title":"\u4f1a\u8bdd\u6301\u4e45\u5316","text":"<p>\u901a\u8fc7\u6570\u636e\u5e93\u4fdd\u5b58\u4f1a\u8bdd\u5386\u53f2\uff1a</p> <pre><code>from agentica import Agent, SqliteDb\n\ndb = SqliteDb(table_name=\"sessions\", db_file=\"agent.db\")\nagent = Agent(\n    working_memory=WorkingMemory(db=db),\n)\n</code></pre>"},{"location":"concepts/agent/#tools","title":"Tools\uff08\u5de5\u5177\uff09","text":"<p>\u5de5\u5177\u8d4b\u4e88 Agent \u4e0e\u5916\u90e8\u4e16\u754c\u4ea4\u4e92\u7684\u80fd\u529b\u3002</p>"},{"location":"concepts/agent/#_10","title":"\u51fd\u6570\u5de5\u5177\uff08\u6700\u7b80\u65b9\u5f0f\uff09","text":"<p>\u4efb\u4f55\u5e26\u7c7b\u578b\u6ce8\u89e3\u548c docstring \u7684 Python \u51fd\u6570\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u5de5\u5177\uff1a</p> <pre><code>def get_weather(city: str) -&gt; str:\n    \"\"\"\u83b7\u53d6\u6307\u5b9a\u57ce\u5e02\u7684\u5929\u6c14\u4fe1\u606f\n\n    Args:\n        city: \u57ce\u5e02\u540d\u79f0\uff0c\u5982 \"\u5317\u4eac\"\u3001\"\u4e0a\u6d77\"\n    \"\"\"\n    return f\"{city}\uff1a\u6674\uff0c25\u00b0C\"\n\nagent = Agent(tools=[get_weather])\n</code></pre>"},{"location":"concepts/agent/#_11","title":"\u7c7b\u5de5\u5177","text":"<p>\u7ee7\u627f <code>Tool</code> \u57fa\u7c7b\uff0c\u9002\u5408\u5c01\u88c5\u4e00\u7ec4\u76f8\u5173\u529f\u80fd\uff1a</p> <pre><code>from agentica import Tool\n\nclass MathTool(Tool):\n    def __init__(self):\n        super().__init__(name=\"math\")\n        self.register(self.add)\n        self.register(self.multiply)\n\n    def add(self, a: float, b: float) -&gt; float:\n        \"\"\"\u4e24\u6570\u76f8\u52a0\"\"\"\n        return a + b\n\n    def multiply(self, a: float, b: float) -&gt; float:\n        \"\"\"\u4e24\u6570\u76f8\u4e58\"\"\"\n        return a * b\n\nagent = Agent(tools=[MathTool()])\n</code></pre>"},{"location":"concepts/agent/#_12","title":"\u5185\u7f6e\u5de5\u5177","text":"<p>Agentica \u63d0\u4f9b 40+ \u5f00\u7bb1\u5373\u7528\u7684\u5de5\u5177\uff0c\u8be6\u89c1 \u5de5\u5177\u7cfb\u7edf\u6307\u5357\u3002</p>"},{"location":"concepts/agent/#knowledge","title":"Knowledge\uff08\u77e5\u8bc6\u5e93\uff09","text":"<p>\u901a\u8fc7 RAG \u8ba9 Agent \u57fa\u4e8e\u4f60\u7684\u6587\u6863\u56de\u7b54\u95ee\u9898\uff1a</p> <pre><code>from agentica import Agent, Knowledge\nfrom agentica.vectordb import LanceDb\nfrom agentica.emb import OpenAIEmb\nfrom agentica.agent.config import ToolConfig\n\nknowledge = Knowledge(\n    data_path=\"./documents\",\n    vector_db=LanceDb(table_name=\"docs\", uri=\"./lancedb\"),\n)\nknowledge.load(recreate=True)\n\nagent = Agent(\n    knowledge=knowledge,\n    tool_config=ToolConfig(search_knowledge=True),  # Agent \u53ef\u4e3b\u52a8\u641c\u7d22\u77e5\u8bc6\u5e93\n    instructions=[\"\u57fa\u4e8e\u77e5\u8bc6\u5e93\u56de\u7b54\u95ee\u9898\uff0c\u5982\u65e0\u76f8\u5173\u4fe1\u606f\u5219\u660e\u786e\u544a\u77e5\"],\n)\n</code></pre> <p>\u8be6\u89c1 RAG \u6307\u5357\u3002</p>"},{"location":"concepts/agent/#instructions","title":"Instructions\uff08\u6307\u4ee4\uff09","text":"<p>Instructions \u5b9a\u4e49 Agent \u7684\u884c\u4e3a\u548c\u98ce\u683c\u3002\u652f\u6301\u9759\u6001\u548c\u52a8\u6001\u4e24\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"concepts/agent/#_13","title":"\u9759\u6001\u6307\u4ee4","text":"<pre><code>agent = Agent(\n    instructions=[\n        \"\u4f60\u662f\u4e00\u4e2a Python \u4ee3\u7801\u5ba1\u67e5\u4e13\u5bb6\",\n        \"\u68c0\u67e5\u4ee3\u7801\u7684\u5b89\u5168\u6027\u3001\u6027\u80fd\u548c\u53ef\u8bfb\u6027\",\n        \"\u53d1\u73b0\u95ee\u9898\u65f6\u63d0\u4f9b\u4fee\u590d\u5efa\u8bae\",\n        \"\u4f7f\u7528\u4e2d\u6587\u56de\u590d\",\n    ],\n)\n</code></pre>"},{"location":"concepts/agent/#_14","title":"\u52a8\u6001\u6307\u4ee4","text":"<pre><code>def get_instructions(agent):\n    base = [\"\u4f60\u662f\u4e00\u4e2a\u667a\u80fd\u52a9\u624b\"]\n    if agent.session_state.get(\"expert_mode\"):\n        base.append(\"\u4f7f\u7528\u4e13\u4e1a\u672f\u8bed\u8be6\u7ec6\u56de\u7b54\")\n    else:\n        base.append(\"\u7528\u7b80\u5355\u6613\u61c2\u7684\u8bed\u8a00\u56de\u7b54\")\n    return base\n\nagent = Agent(instructions=get_instructions)\n</code></pre>"},{"location":"concepts/agent/#system-prompt","title":"System Prompt","text":"<p>\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>PromptConfig</code> \u8bbe\u7f6e\u5b8c\u6574\u7684\u7cfb\u7edf\u63d0\u793a\u8bcd\uff1a</p> <pre><code>from agentica.agent.config import PromptConfig\n\nagent = Agent(\n    prompt_config=PromptConfig(\n        system_prompt=\"\u4f60\u662f\u4e00\u4e2a\u53cb\u597d\u7684\u4e2d\u6587\u52a9\u624b\uff0c\u56de\u7b54\u7b80\u6d01\u51c6\u786e\u3002\",\n    ),\n)\n</code></pre>"},{"location":"concepts/agent/#runresponse","title":"RunResponse","text":"<p>Agent \u8fd0\u884c\u540e\u8fd4\u56de <code>RunResponse</code> \u5bf9\u8c61\uff1a</p> <pre><code>result = await agent.run(\"\u4f60\u597d\")\n\nresult.content           # \u54cd\u5e94\u5185\u5bb9\uff08str \u6216 BaseModel\uff09\nresult.event             # \u4e8b\u4ef6\u7c7b\u578b (RunEvent)\nresult.model             # \u4f7f\u7528\u7684\u6a21\u578b\u540d\u79f0\nresult.metrics           # \u6307\u6807\uff08token \u7528\u91cf\u3001\u8017\u65f6\u7b49\uff09\nresult.tool_calls        # \u5de5\u5177\u8c03\u7528\u4fe1\u606f List[ToolCallInfo]\nresult.reasoning_content # \u63a8\u7406\u5185\u5bb9\uff08\u601d\u8003\u8fc7\u7a0b\uff09\n</code></pre>"},{"location":"concepts/agent/#_15","title":"\u6d41\u5f0f\u4e8b\u4ef6","text":"<p>\u6d41\u5f0f\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e2a chunk \u643a\u5e26\u4e0d\u540c\u7684\u4e8b\u4ef6\uff1a</p> <pre><code>from agentica import RunEvent\n\nasync for chunk in agent.run_stream(\"\u4f60\u597d\"):\n    match chunk.event:\n        case RunEvent.run_response:\n            print(chunk.content, end=\"\")  # \u6b63\u5e38\u8f93\u51fa\n        case RunEvent.tool_call_started:\n            print(f\"\u8c03\u7528\u5de5\u5177: {chunk.content}\")\n        case RunEvent.tool_call_completed:\n            print(f\"\u5de5\u5177\u5b8c\u6210\")\n        case RunEvent.run_completed:\n            print(\"\u5b8c\u6210\")\n</code></pre>"},{"location":"concepts/agent/#deepagent","title":"DeepAgent","text":"<p><code>DeepAgent</code> \u662f\u9884\u914d\u7f6e\u7684 Agent\uff0c\u5185\u7f6e\u6587\u4ef6\u64cd\u4f5c\u3001\u547d\u4ee4\u6267\u884c\u3001\u7f51\u9875\u641c\u7d22\u3001\u5b50\u4efb\u52a1\u59d4\u6d3e\u7b49\u5de5\u5177\uff0c\u9002\u5408\u590d\u6742\u7684\u591a\u6b65\u9aa4\u4efb\u52a1\uff1a</p> <pre><code>from agentica import DeepAgent, OpenAIChat\n\nagent = DeepAgent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    name=\"My Assistant\",\n)\nresult = await agent.run(\"\u5206\u6790\u5f53\u524d\u76ee\u5f55\u7684\u4ee3\u7801\u7ed3\u6784\")\n</code></pre> <p>\u5185\u7f6e\u5de5\u5177\u5305\u62ec\uff1a<code>ls</code>, <code>read_file</code>, <code>write_file</code>, <code>edit_file</code>, <code>glob</code>, <code>grep</code>, <code>execute</code>, <code>web_search</code>, <code>fetch_url</code>, <code>task</code>\uff08\u5b50\u4efb\u52a1\u59d4\u6d3e\uff09\u3002</p>"},{"location":"concepts/agent/#_16","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>Team &amp; Workflow \u2014 \u591a\u667a\u80fd\u4f53\u534f\u4f5c\u4e0e\u5de5\u4f5c\u6d41</li> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u6df1\u5165\u4e86\u89e3\u5de5\u5177</li> <li>API \u53c2\u8003 \u2014 \u5b8c\u6574 API</li> </ul>"},{"location":"concepts/team/","title":"Team &amp; Workflow","text":"<p>Agentica \u63d0\u4f9b\u4e24\u79cd\u591a\u667a\u80fd\u4f53\u534f\u4f5c\u6a21\u5f0f\uff1aTeam\uff08\u52a8\u6001\u59d4\u6d3e\uff09\u548c Workflow\uff08\u786e\u5b9a\u6027\u7f16\u6392\uff09\u3002</p>"},{"location":"concepts/team/#team","title":"Team\uff08\u667a\u80fd\u4f53\u56e2\u961f\uff09","text":"<p>Team \u6a21\u5f0f\u4e0b\uff0c\u4e00\u4e2a\u4e3b Agent \u5145\u5f53\u534f\u8c03\u8005\uff0c\u6839\u636e\u4efb\u52a1\u9700\u8981\u52a8\u6001\u59d4\u6d3e\u7ed9\u56e2\u961f\u6210\u5458\u3002</p>"},{"location":"concepts/team/#_1","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>import asyncio\nfrom agentica import Agent, OpenAIChat, BaiduSearchTool\n\n# \u4e13\u4e1a\u7814\u7a76\u5458\nresearcher = Agent(\n    name=\"Researcher\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    tools=[BaiduSearchTool()],\n    description=\"\u8d1f\u8d23\u4fe1\u606f\u641c\u7d22\u548c\u8d44\u6599\u6574\u7406\",\n    instructions=[\"\u641c\u7d22\u76f8\u5173\u4fe1\u606f\u5e76\u6574\u7406\u8981\u70b9\"],\n)\n\n# \u4e13\u4e1a\u5199\u624b\nwriter = Agent(\n    name=\"Writer\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    description=\"\u8d1f\u8d23\u5185\u5bb9\u5199\u4f5c\u548c\u6587\u7ae0\u6da6\u8272\",\n    instructions=[\"\u57fa\u4e8e\u7814\u7a76\u6750\u6599\u64b0\u5199\u9ad8\u8d28\u91cf\u6587\u7ae0\"],\n)\n\n# \u56e2\u961f\u534f\u8c03\u8005\nteam = Agent(\n    name=\"Editor\",\n    team=[researcher, writer],\n    instructions=[\n        \"\u4f60\u662f\u4e00\u4e2a\u7f16\u8f91\uff0c\u534f\u8c03\u7814\u7a76\u5458\u548c\u5199\u624b\u5b8c\u6210\u4efb\u52a1\",\n        \"\u7814\u7a76\u4efb\u52a1\u4ea4\u7ed9 Researcher\",\n        \"\u5199\u4f5c\u4efb\u52a1\u4ea4\u7ed9 Writer\",\n    ],\n)\n\nasync def main():\n    await team.print_response_stream(\"\u5199\u4e00\u7bc7\u5173\u4e8e AI Agent \u6700\u65b0\u53d1\u5c55\u7684\u6587\u7ae0\")\n\nasyncio.run(main())\n</code></pre>"},{"location":"concepts/team/#_2","title":"\u5de5\u4f5c\u539f\u7406","text":"<ol> <li>\u56e2\u961f\u6210\u5458\u901a\u8fc7 <code>as_tool()</code> \u81ea\u52a8\u8f6c\u6362\u4e3a\u5de5\u5177\u6ce8\u518c\u5230\u4e3b Agent</li> <li>\u4e3b Agent \u6839\u636e\u4efb\u52a1\u63cf\u8ff0\u51b3\u5b9a\u8c03\u7528\u54ea\u4e2a\u6210\u5458</li> <li>\u6210\u5458 Agent \u72ec\u7acb\u6267\u884c\u4efb\u52a1\u5e76\u8fd4\u56de\u7ed3\u679c</li> <li>\u4e3b Agent \u6574\u5408\u7ed3\u679c\uff0c\u751f\u6210\u6700\u7ec8\u54cd\u5e94</li> </ol>"},{"location":"concepts/team/#agent","title":"Agent \u4f5c\u4e3a\u5de5\u5177","text":"<p>\u4e5f\u53ef\u4ee5\u624b\u52a8\u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\uff1a</p> <pre><code># \u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\nresearch_tool = researcher.as_tool(\n    tool_name=\"research\",\n    tool_description=\"\u641c\u7d22\u5e76\u6574\u7406\u6307\u5b9a\u4e3b\u9898\u7684\u8d44\u6599\",\n)\n\n# \u5728\u5176\u4ed6 Agent \u4e2d\u4f7f\u7528\nmain_agent = Agent(\n    tools=[research_tool],\n)\n</code></pre>"},{"location":"concepts/team/#_3","title":"\u8bbe\u8ba1\u539f\u5219","text":"\u539f\u5219 \u8bf4\u660e \u5355\u4e00\u804c\u8d23 \u6bcf\u4e2a\u6210\u5458\u4e13\u6ce8\u4e00\u4e2a\u9886\u57df \u6e05\u6670\u63cf\u8ff0 <code>description</code> \u5e2e\u52a9\u534f\u8c03\u8005\u6b63\u786e\u59d4\u6d3e \u9002\u91cf\u6210\u5458 3-5 \u4e2a\u6210\u5458\u6700\u4f73\uff0c\u8fc7\u591a\u4f1a\u964d\u4f4e\u59d4\u6d3e\u51c6\u786e\u6027 \u9002\u91cf\u5de5\u5177 \u6bcf\u4e2a\u6210\u5458 3-7 \u4e2a\u5de5\u5177"},{"location":"concepts/team/#workflow","title":"Workflow\uff08\u5de5\u4f5c\u6d41\uff09","text":"<p>Workflow \u6a21\u5f0f\u4e0b\uff0c\u6b65\u9aa4\u987a\u5e8f\u662f\u786e\u5b9a\u6027\u7684\uff0c\u9002\u5408\u9700\u8981\u4e25\u683c\u63a7\u5236\u6d41\u7a0b\u7684\u573a\u666f\u3002</p>"},{"location":"concepts/team/#workflow_1","title":"\u4f55\u65f6\u9009\u62e9 Workflow","text":"\u573a\u666f Team Workflow \u6b65\u9aa4\u987a\u5e8f\u56fa\u5b9a \u9002\u5408 \u9700\u8981\u975e LLM \u6b65\u9aa4\uff08\u6570\u636e\u9a8c\u8bc1\u3001\u8ba1\u7b97\uff09 \u9002\u5408 \u4e0d\u540c\u6b65\u9aa4\u9700\u8981\u4e0d\u540c\u6a21\u578b \u9002\u5408 \u4efb\u52a1\u5206\u89e3\u4e0d\u786e\u5b9a \u9002\u5408 \u9700\u8981\u52a8\u6001\u5224\u65ad\u4e0b\u4e00\u6b65 \u9002\u5408"},{"location":"concepts/team/#_4","title":"\u57fa\u672c\u7528\u6cd5","text":"<p>\u7ee7\u627f <code>Workflow</code> \u7c7b\uff0c\u5b9e\u73b0 <code>run()</code> \u65b9\u6cd5\uff1a</p> <pre><code>import asyncio\nfrom typing import List\nfrom pydantic import BaseModel, Field\nfrom agentica import Agent, OpenAIChat, Workflow, RunResponse\n\n\nclass AnalysisReport(BaseModel):\n    summary: str\n    key_findings: List[str]\n    recommendations: List[str]\n\n\nclass ResearchWorkflow(Workflow):\n    \"\"\"\u7814\u7a76\u5de5\u4f5c\u6d41\uff1a\u641c\u7d22 -&gt; \u5206\u6790 -&gt; \u62a5\u544a\"\"\"\n\n    description: str = \"\u641c\u7d22\u3001\u5206\u6790\u5e76\u751f\u6210\u7814\u7a76\u62a5\u544a\"\n\n    # \u4e0d\u540c\u6b65\u9aa4\u7528\u4e0d\u540c\u6a21\u578b\u4f18\u5316\u6210\u672c\n    extractor: Agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o-mini\"),  # \u4f4e\u6210\u672c\u6a21\u578b\u505a\u63d0\u53d6\n        name=\"Extractor\",\n        instructions=[\"\u63d0\u53d6\u6587\u672c\u4e2d\u7684\u5173\u952e\u4fe1\u606f\"],\n    )\n\n    analyst: Agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o\"),  # \u9ad8\u8d28\u91cf\u6a21\u578b\u505a\u5206\u6790\n        name=\"Analyst\",\n        instructions=[\"\u6df1\u5165\u5206\u6790\u6570\u636e\uff0c\u7ed9\u51fa\u6d1e\u89c1\u548c\u5efa\u8bae\"],\n        response_model=AnalysisReport,\n    )\n\n    def _validate_data(self, data: str) -&gt; str:\n        \"\"\"\u7eaf Python \u9a8c\u8bc1\u6b65\u9aa4\uff0c\u65e0\u9700 LLM\"\"\"\n        lines = [l.strip() for l in data.split(\"\\n\") if l.strip()]\n        return \"\\n\".join(lines)\n\n    async def run(self, topic: str) -&gt; RunResponse:\n        # Step 1: LLM \u63d0\u53d6\n        extracted = await self.extractor.run(f\"\u63d0\u53d6\u5173\u952e\u4fe1\u606f\uff1a{topic}\")\n\n        # Step 2: Python \u9a8c\u8bc1\uff08\u65e0 LLM \u6210\u672c\uff09\n        cleaned = self._validate_data(extracted.content)\n\n        # Step 3: LLM \u5206\u6790\n        result = await self.analyst.run(f\"\u5206\u6790\u4ee5\u4e0b\u5185\u5bb9\uff1a\\n{cleaned}\")\n\n        return RunResponse(content=result.content)\n\n\nasync def main():\n    wf = ResearchWorkflow()\n    result = await wf.run(\"2024\u5e74\u5168\u7403AI\u82af\u7247\u5e02\u573a\u5206\u6790\")\n    print(result.content)\n\nasyncio.run(main())\n</code></pre>"},{"location":"concepts/team/#workflow_2","title":"Workflow \u7279\u70b9","text":"<ul> <li><code>run()</code> \u65b9\u6cd5\u662f async \u7684\uff0c\u4e5f\u63d0\u4f9b <code>run_sync()</code> \u540c\u6b65\u9002\u914d\u5668</li> <li>\u53ef\u4ee5\u6df7\u5408 LLM \u6b65\u9aa4\u548c\u7eaf Python \u6b65\u9aa4</li> <li>\u4e0d\u540c\u6b65\u9aa4\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u6a21\u578b\uff08\u6210\u672c\u4f18\u5316\uff09</li> <li>\u6b65\u9aa4\u95f4\u53ef\u4ee5\u4f20\u9012\u7ed3\u6784\u5316\u6570\u636e\uff08Pydantic \u6a21\u578b\uff09</li> <li>\u652f\u6301\u4f1a\u8bdd\u6301\u4e45\u5316</li> </ul>"},{"location":"concepts/team/#_5","title":"\u540c\u6b65\u8fd0\u884c","text":"<pre><code>wf = ResearchWorkflow()\nresult = wf.run_sync(\"2024\u5e74\u5168\u7403AI\u82af\u7247\u5e02\u573a\u5206\u6790\")\nprint(result.content)\n</code></pre>"},{"location":"concepts/team/#_6","title":"\u5b9e\u9645\u793a\u4f8b","text":""},{"location":"concepts/team/#_7","title":"\u65b0\u95fb\u62a5\u9053\u6d41\u6c34\u7ebf","text":"<pre><code>class NewsWorkflow(Workflow):\n    researcher: Agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o-mini\"),\n        tools=[BaiduSearchTool()],\n        instructions=[\"\u641c\u7d22\u6700\u65b0\u65b0\u95fb\"],\n    )\n\n    writer: Agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o\"),\n        instructions=[\"\u5199\u4e00\u7bc7\u65b0\u95fb\u62a5\u9053\uff0c\u5305\u542b\u6807\u9898\u3001\u5bfc\u8bed\u3001\u6b63\u6587\"],\n    )\n\n    reviewer: Agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o\"),\n        instructions=[\"\u5ba1\u6838\u6587\u7ae0\u7684\u51c6\u786e\u6027\u548c\u53ef\u8bfb\u6027\uff0c\u63d0\u51fa\u4fee\u6539\u5efa\u8bae\"],\n    )\n\n    async def run(self, topic: str) -&gt; RunResponse:\n        # 1. \u641c\u7d22\n        research = await self.researcher.run(f\"\u641c\u7d22\u6700\u65b0\u65b0\u95fb\uff1a{topic}\")\n\n        # 2. \u64b0\u5199\n        draft = await self.writer.run(\n            f\"\u57fa\u4e8e\u4ee5\u4e0b\u8d44\u6599\u64b0\u5199\u65b0\u95fb\u62a5\u9053\uff1a\\n{research.content}\"\n        )\n\n        # 3. \u5ba1\u6838\n        final = await self.reviewer.run(\n            f\"\u5ba1\u6838\u5e76\u6539\u8fdb\u4ee5\u4e0b\u6587\u7ae0\uff1a\\n{draft.content}\"\n        )\n\n        return RunResponse(content=final.content)\n</code></pre>"},{"location":"concepts/team/#_8","title":"\u8fa9\u8bba\u6a21\u5f0f","text":"<pre><code>import asyncio\nfrom agentica import Agent, OpenAIChat\n\npro = Agent(\n    name=\"Pro\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=[\"\u4f60\u652f\u6301\u8fd9\u4e2a\u89c2\u70b9\uff0c\u7ed9\u51fa\u8bba\u636e\"],\n)\n\ncon = Agent(\n    name=\"Con\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=[\"\u4f60\u53cd\u5bf9\u8fd9\u4e2a\u89c2\u70b9\uff0c\u7ed9\u51fa\u8bba\u636e\"],\n)\n\njudge = Agent(\n    name=\"Judge\",\n    model=OpenAIChat(id=\"gpt-4o\"),\n    instructions=[\"\u603b\u7ed3\u53cc\u65b9\u89c2\u70b9\uff0c\u7ed9\u51fa\u5ba2\u89c2\u8bc4\u4ef7\"],\n)\n\nasync def debate(topic: str, rounds: int = 2):\n    context = f\"\u8fa9\u9898\uff1a{topic}\\n\"\n\n    for i in range(rounds):\n        pro_arg = await pro.run(f\"{context}\\n\u8bf7\u7ed9\u51fa\u7b2c {i+1} \u8f6e\u6b63\u65b9\u8bba\u70b9\")\n        context += f\"\\n\u6b63\u65b9\uff1a{pro_arg.content}\"\n\n        con_arg = await con.run(f\"{context}\\n\u8bf7\u7ed9\u51fa\u7b2c {i+1} \u8f6e\u53cd\u65b9\u8bba\u70b9\")\n        context += f\"\\n\u53cd\u65b9\uff1a{con_arg.content}\"\n\n    verdict = await judge.run(f\"{context}\\n\u8bf7\u603b\u7ed3\u5e76\u8bc4\u5224\")\n    print(verdict.content)\n\nasyncio.run(debate(\"\u8fdc\u7a0b\u529e\u516c\u6bd4\u5230\u529e\u516c\u5ba4\u529e\u516c\u66f4\u9ad8\u6548\"))\n</code></pre>"},{"location":"concepts/team/#_9","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>Agent \u6838\u5fc3\u6982\u5ff5 \u2014 \u56de\u987e Agent \u57fa\u7840</li> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u4e3a Agent \u914d\u5907\u5de5\u5177</li> <li>API \u53c2\u8003 \u2014 \u5b8c\u6574 API</li> </ul>"},{"location":"guides/benchmark/","title":"Benchmark","text":"<p>\u6027\u80fd\u8bc4\u6d4b\u7ed3\u679c\u5c06\u5728\u6b64\u5904\u53d1\u5e03\u3002</p>"},{"location":"guides/benchmark/#_1","title":"\u8ba1\u5212\u4e2d\u7684\u8bc4\u6d4b","text":"<ul> <li>\u5de5\u5177\u8c03\u7528\u51c6\u786e\u7387 \u2014 \u4e0d\u540c\u6a21\u578b\u5728\u5de5\u5177\u9009\u62e9\u548c\u53c2\u6570\u586b\u5145\u4e0a\u7684\u51c6\u786e\u7387</li> <li>RAG \u68c0\u7d22\u8d28\u91cf \u2014 \u4e0d\u540c\u5411\u91cf\u5e93\u548c Embedding \u6a21\u578b\u7684\u68c0\u7d22\u6548\u679c\u5bf9\u6bd4</li> <li>\u591a\u667a\u80fd\u4f53\u534f\u4f5c\u6548\u7387 \u2014 Team \u6a21\u5f0f\u4e0b\u4efb\u52a1\u5b8c\u6210\u8d28\u91cf\u548c token \u6d88\u8017</li> <li>\u5ef6\u8fdf\u4e0e\u541e\u5410 \u2014 \u6d41\u5f0f / \u975e\u6d41\u5f0f\u573a\u666f\u4e0b\u7684\u54cd\u5e94\u5ef6\u8fdf</li> </ul>"},{"location":"guides/benchmark/#_2","title":"\u8bc4\u6d4b\u6846\u67b6","text":"<p>\u8bc4\u6d4b\u4ee3\u7801\u4f4d\u4e8e <code>evaluation/</code> \u76ee\u5f55\uff0c\u4f7f\u7528\u6807\u51c6\u5316\u7684\u6d4b\u8bd5\u96c6\u548c\u8bc4\u5206\u65b9\u6cd5\u3002</p> <pre><code># \u8fd0\u884c\u8bc4\u6d4b\uff08\u5f85\u8865\u5145\uff09\npython -m evaluation.run --suite all\n</code></pre> <p>\u6b64\u9875\u9762\u5c06\u6301\u7eed\u66f4\u65b0\u8bc4\u6d4b\u7ed3\u679c\u3002</p>"},{"location":"guides/best_practices/","title":"Agentica \u6700\u4f73\u5b9e\u8df5","text":"<p>Agent \u5f00\u53d1\u7684\u63a8\u8350\u6a21\u5f0f\u3001\u6280\u5de7\u548c\u5e38\u89c1\u95ee\u9898\u89e3\u51b3\u65b9\u6848</p>"},{"location":"guides/best_practices/#_1","title":"\u76ee\u5f55","text":"<ul> <li>Agent \u8bbe\u8ba1\u539f\u5219</li> <li>\u63d0\u793a\u8bcd\u5de5\u7a0b</li> <li>\u5de5\u5177\u4f7f\u7528</li> <li>\u5185\u5b58\u7ba1\u7406</li> <li>RAG \u6700\u4f73\u5b9e\u8df5</li> <li>\u591a\u8f6e\u5bf9\u8bdd</li> <li>\u56e2\u961f\u534f\u4f5c</li> <li>\u6027\u80fd\u4f18\u5316</li> <li>\u9519\u8bef\u5904\u7406</li> <li>\u751f\u4ea7\u90e8\u7f72</li> </ul>"},{"location":"guides/best_practices/#agent","title":"Agent \u8bbe\u8ba1\u539f\u5219","text":""},{"location":"guides/best_practices/#1","title":"1. \u5355\u4e00\u804c\u8d23","text":"<p>\u6bcf\u4e2a Agent \u5e94\u8be5\u4e13\u6ce8\u4e8e\u4e00\u4e2a\u7279\u5b9a\u4efb\u52a1\u3002</p> <pre><code># \u2705 \u597d\u7684\u8bbe\u8ba1\uff1a\u4e13\u6ce8\u7684 Agent\nresearcher = Agent(\n    name=\"Researcher\",\n    instructions=[\"\u4e13\u6ce8\u4e8e\u4fe1\u606f\u641c\u7d22\u548c\u6574\u7406\"],\n    tools=[DuckDuckGoTool(), ArxivTool()],\n)\n\nwriter = Agent(\n    name=\"Writer\",\n    instructions=[\"\u4e13\u6ce8\u4e8e\u5185\u5bb9\u5199\u4f5c\"],\n)\n\n# \u274c \u907f\u514d\uff1a\u529f\u80fd\u8fc7\u591a\u7684 Agent\ndo_everything_agent = Agent(\n    name=\"DoEverything\",\n    instructions=[\"\u641c\u7d22\u3001\u5199\u4f5c\u3001\u7f16\u7a0b\u3001\u5206\u6790...\"],\n    tools=[...20\u4e2a\u5de5\u5177...],\n)\n</code></pre>"},{"location":"guides/best_practices/#2","title":"2. \u6e05\u6670\u7684\u6307\u4ee4","text":"<p>\u63d0\u4f9b\u660e\u786e\u3001\u5177\u4f53\u7684\u6307\u4ee4\u3002</p> <pre><code># \u2705 \u597d\u7684\u6307\u4ee4\nagent = Agent(\n    instructions=[\n        \"\u4f60\u662f\u4e00\u4e2a Python \u4ee3\u7801\u5ba1\u67e5\u4e13\u5bb6\",\n        \"\u68c0\u67e5\u4ee3\u7801\u65f6\u5173\u6ce8\uff1a\u5b89\u5168\u6027\u3001\u6027\u80fd\u3001\u53ef\u8bfb\u6027\",\n        \"\u4f7f\u7528\u4e2d\u6587\u56de\u590d\",\n        \"\u53d1\u73b0\u95ee\u9898\u65f6\u63d0\u4f9b\u4fee\u590d\u5efa\u8bae\",\n    ],\n)\n\n# \u274c \u6a21\u7cca\u7684\u6307\u4ee4\nagent = Agent(\n    instructions=[\"\u4f60\u662f\u4e00\u4e2a\u52a9\u624b\"],\n)\n</code></pre>"},{"location":"guides/best_practices/#3","title":"3. \u9002\u5f53\u7684\u5de5\u5177\u6570\u91cf","text":"<p>\u5de5\u5177\u8fc7\u591a\u4f1a\u964d\u4f4e\u51c6\u786e\u6027\u3002</p> <pre><code># \u2705 \u63a8\u8350\uff1a3-7 \u4e2a\u76f8\u5173\u5de5\u5177\nagent = Agent(\n    tools=[\n        DuckDuckGoTool(),\n        UrlCrawlerTool(),\n        FileTool(),\n    ],\n)\n\n# \u274c \u907f\u514d\uff1a\u8fc7\u591a\u5de5\u5177\nagent = Agent(\n    tools=[...15\u4e2a\u5de5\u5177...],  # \u6a21\u578b\u53ef\u80fd\u6df7\u6dc6\n)\n</code></pre>"},{"location":"guides/best_practices/#_2","title":"\u63d0\u793a\u8bcd\u5de5\u7a0b","text":""},{"location":"guides/best_practices/#1_1","title":"1. \u7ed3\u6784\u5316\u6307\u4ee4","text":"<pre><code>agent = Agent(\n    instructions=[\n        # \u89d2\u8272\u5b9a\u4e49\n        \"\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u6570\u636e\u5206\u6790\u5e08\",\n\n        # \u80fd\u529b\u63cf\u8ff0\n        \"\u4f60\u53ef\u4ee5\uff1a\u5206\u6790\u6570\u636e\u3001\u751f\u6210\u56fe\u8868\u3001\u64b0\u5199\u62a5\u544a\",\n\n        # \u884c\u4e3a\u7ea6\u675f\n        \"\u5206\u6790\u65f6\u59cb\u7ec8\u9a8c\u8bc1\u6570\u636e\u8d28\u91cf\",\n        \"\u4f7f\u7528 Python \u8fdb\u884c\u6570\u636e\u5904\u7406\",\n\n        # \u8f93\u51fa\u683c\u5f0f\n        \"\u62a5\u544a\u683c\u5f0f\uff1a\u6458\u8981 -&gt; \u8be6\u7ec6\u5206\u6790 -&gt; \u7ed3\u8bba\",\n    ],\n)\n</code></pre>"},{"location":"guides/best_practices/#2_1","title":"2. \u4f7f\u7528\u7cfb\u7edf\u63d0\u793a\u8bcd","text":"<pre><code>from agentica.agent.config import PromptConfig\n\n# \u9759\u6001\u7cfb\u7edf\u63d0\u793a\u8bcd\nagent = Agent(\n    prompt_config=PromptConfig(\n        system_prompt=\"\u4f60\u662f\u4e00\u4e2a\u53cb\u597d\u7684\u52a9\u624b\uff0c\u4f7f\u7528\u7b80\u6d01\u7684\u8bed\u8a00\u56de\u7b54\u95ee\u9898\u3002\",\n    ),\n)\n\n# \u52a8\u6001\u7cfb\u7edf\u63d0\u793a\u8bcd\ndef get_system_prompt(agent):\n    from datetime import datetime\n    return f\"\u5f53\u524d\u65f6\u95f4: {datetime.now()}\\n\u4f60\u662f\u4e00\u4e2a\u667a\u80fd\u52a9\u624b\u3002\"\n\nagent = Agent(\n    prompt_config=PromptConfig(system_prompt=get_system_prompt),\n)\n</code></pre>"},{"location":"guides/best_practices/#3_1","title":"3. \u52a8\u6001\u6307\u4ee4","text":"<pre><code>def get_instructions(agent):\n    base = [\"\u4f60\u662f\u4e00\u4e2a\u52a9\u624b\"]\n\n    # \u6839\u636e\u4e0a\u4e0b\u6587\u6dfb\u52a0\u6307\u4ee4\n    if agent.session_state.get(\"mode\") == \"expert\":\n        base.append(\"\u4f7f\u7528\u4e13\u4e1a\u672f\u8bed\u56de\u7b54\")\n    else:\n        base.append(\"\u4f7f\u7528\u7b80\u5355\u6613\u61c2\u7684\u8bed\u8a00\")\n\n    return base\n\nagent = Agent(instructions=get_instructions)\n</code></pre>"},{"location":"guides/best_practices/#4-few-shot","title":"4. Few-shot \u793a\u4f8b","text":"<pre><code>agent = Agent(\n    instructions=[\n        \"\u5c06\u7528\u6237\u8f93\u5165\u8f6c\u6362\u4e3a SQL \u67e5\u8be2\",\n        \"\",\n        \"\u793a\u4f8b\uff1a\",\n        \"\u8f93\u5165\uff1a\u67e5\u627e\u6240\u6709\u5e74\u9f84\u5927\u4e8e 30 \u7684\u7528\u6237\",\n        \"\u8f93\u51fa\uff1aSELECT * FROM users WHERE age &gt; 30\",\n        \"\",\n        \"\u8f93\u5165\uff1a\u7edf\u8ba1\u6bcf\u4e2a\u57ce\u5e02\u7684\u7528\u6237\u6570\",\n        \"\u8f93\u51fa\uff1aSELECT city, COUNT(*) FROM users GROUP BY city\",\n    ],\n)\n</code></pre>"},{"location":"guides/best_practices/#_3","title":"\u5de5\u5177\u4f7f\u7528","text":""},{"location":"guides/best_practices/#1_2","title":"1. \u5de5\u5177\u63cf\u8ff0\u8981\u6e05\u6670","text":"<pre><code>def search_products(\n    query: str,\n    category: str = None,\n    max_price: float = None,\n) -&gt; str:\n    \"\"\"\u641c\u7d22\u4ea7\u54c1\u76ee\u5f55\n\n    \u5728\u4ea7\u54c1\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u5339\u914d\u7684\u5546\u54c1\u3002\n\n    Args:\n        query: \u641c\u7d22\u5173\u952e\u8bcd\uff0c\u5982 \"iPhone\" \u6216 \"\u7b14\u8bb0\u672c\u7535\u8111\"\n        category: \u4ea7\u54c1\u7c7b\u522b\uff0c\u53ef\u9009\u503c\uff1aelectronics, clothing, books\n        max_price: \u6700\u9ad8\u4ef7\u683c\u9650\u5236\uff08\u4eba\u6c11\u5e01\uff09\n\n    Returns:\n        JSON \u683c\u5f0f\u7684\u4ea7\u54c1\u5217\u8868\uff0c\u5305\u542b\u540d\u79f0\u3001\u4ef7\u683c\u3001\u63cf\u8ff0\n\n    Example:\n        search_products(\"\u624b\u673a\", category=\"electronics\", max_price=5000)\n    \"\"\"\n    ...\n</code></pre>"},{"location":"guides/best_practices/#2_2","title":"2. \u5de5\u5177\u8fd4\u56de\u683c\u5f0f","text":"<pre><code># \u2705 \u7ed3\u6784\u5316\u8fd4\u56de\ndef get_weather(city: str) -&gt; str:\n    data = fetch_weather(city)\n    return json.dumps({\n        \"city\": city,\n        \"temperature\": data[\"temp\"],\n        \"condition\": data[\"condition\"],\n        \"humidity\": data[\"humidity\"],\n    }, ensure_ascii=False)\n\n# \u274c \u907f\u514d\uff1a\u975e\u7ed3\u6784\u5316\u8fd4\u56de\ndef get_weather(city: str) -&gt; str:\n    return f\"\u5929\u6c14\u5f88\u597d\uff0c\u6e29\u5ea625\u5ea6\"  # \u96be\u4ee5\u89e3\u6790\n</code></pre>"},{"location":"guides/best_practices/#3_2","title":"3. \u9519\u8bef\u5904\u7406","text":"<pre><code>def safe_api_call(url: str) -&gt; str:\n    \"\"\"\u5b89\u5168\u7684 API \u8c03\u7528\"\"\"\n    try:\n        response = requests.get(url, timeout=10)\n        response.raise_for_status()\n        return response.text\n    except requests.Timeout:\n        return \"\u9519\u8bef\uff1a\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\"\n    except requests.HTTPError as e:\n        return f\"\u9519\u8bef\uff1aHTTP {e.response.status_code}\"\n    except Exception as e:\n        return f\"\u9519\u8bef\uff1a{str(e)}\"\n</code></pre>"},{"location":"guides/best_practices/#4","title":"4. \u5de5\u5177\u9650\u5236","text":"<pre><code>from agentica.agent.config import ToolConfig\n\nagent = Agent(\n    tools=[...],\n    tool_config=ToolConfig(tool_call_limit=10),  # \u9650\u5236\u5de5\u5177\u8c03\u7528\u6b21\u6570\n)\n</code></pre>"},{"location":"guides/best_practices/#_4","title":"\u5185\u5b58\u7ba1\u7406","text":""},{"location":"guides/best_practices/#1_3","title":"1. \u4f1a\u8bdd\u6301\u4e45\u5316","text":"<pre><code>from agentica import Agent, SqliteDb, AgentMemory\n\n# \u4f7f\u7528\u6570\u636e\u5e93\u6301\u4e45\u5316\u4f1a\u8bdd\ndb = SqliteDb(table_name=\"sessions\", db_file=\"agent.db\")\n\nagent = Agent(\n    session_id=\"user-123-session\",\n    memory=AgentMemory.with_db(db=db),\n)\n\n# \u4f1a\u8bdd\u4f1a\u81ea\u52a8\u4fdd\u5b58\u548c\u6062\u590d\n</code></pre>"},{"location":"guides/best_practices/#2_3","title":"2. \u957f\u671f\u8bb0\u5fc6","text":"<pre><code>agent = Agent(\n    user_id=\"user-123\",\n    memory=AgentMemory.with_db(\n        db=db,\n        create_user_memories=True,  # \u542f\u7528\u957f\u671f\u8bb0\u5fc6\n    ),\n)\n\n# Agent \u4f1a\u81ea\u52a8\u8bb0\u4f4f\u7528\u6237\u504f\u597d\n# \"\u8bb0\u4f4f\u6211\u559c\u6b22 Python\" -&gt; \u4fdd\u5b58\u5230\u957f\u671f\u8bb0\u5fc6\n</code></pre>"},{"location":"guides/best_practices/#3_3","title":"3. \u5386\u53f2\u6d88\u606f\u7ba1\u7406","text":"<pre><code>agent = Agent(\n    add_history_to_messages=True,  # \u6dfb\u52a0\u5386\u53f2\u5230\u4e0a\u4e0b\u6587\n    history_window=5,              # \u6700\u8fd1 5 \u8f6e\u5bf9\u8bdd\n)\n</code></pre>"},{"location":"guides/best_practices/#4_1","title":"4. \u4f1a\u8bdd\u6458\u8981","text":"<pre><code>agent = Agent(\n    memory=AgentMemory(\n        create_session_summary=True,  # \u751f\u6210\u4f1a\u8bdd\u6458\u8981\n    ),\n)\n\n# \u957f\u5bf9\u8bdd\u4f1a\u81ea\u52a8\u751f\u6210\u6458\u8981\uff0c\u51cf\u5c11 token \u4f7f\u7528\n</code></pre>"},{"location":"guides/best_practices/#rag","title":"RAG \u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/best_practices/#1_4","title":"1. \u77e5\u8bc6\u5e93\u914d\u7f6e","text":"<pre><code>from agentica import Knowledge\nfrom agentica.vectordb import LanceDb\nfrom agentica.emb import OpenAIEmbedder\n\nknowledge = Knowledge(\n    data_path=\"./documents\",\n    vector_db=LanceDb(\n        table_name=\"docs\",\n        uri=\"./lancedb\",\n        embedder=OpenAIEmbedder(),\n    ),\n    chunk_size=1000,      # \u9002\u5f53\u7684\u5206\u5757\u5927\u5c0f\n    num_documents=5,      # \u68c0\u7d22\u6587\u6863\u6570\n)\n\n# \u52a0\u8f7d\u77e5\u8bc6\u5e93\nknowledge.load(recreate=False, upsert=True)\n</code></pre>"},{"location":"guides/best_practices/#2_4","title":"2. \u68c0\u7d22\u589e\u5f3a","text":"<pre><code>from agentica.agent.config import ToolConfig\n\nagent = Agent(\n    knowledge=knowledge,\n    tool_config=ToolConfig(add_references=True),  # \u6dfb\u52a0\u5f15\u7528\u5230\u54cd\u5e94\n    instructions=[\n        \"\u57fa\u4e8e\u77e5\u8bc6\u5e93\u56de\u7b54\u95ee\u9898\",\n        \"\u5982\u679c\u77e5\u8bc6\u5e93\u4e2d\u6ca1\u6709\u76f8\u5173\u4fe1\u606f\uff0c\u660e\u786e\u544a\u77e5\u7528\u6237\",\n        \"\u5f15\u7528\u6765\u6e90\u65f6\u6ce8\u660e\u6587\u6863\u540d\u79f0\",\n    ],\n)\n</code></pre>"},{"location":"guides/best_practices/#3-agentic-rag","title":"3. Agentic RAG","text":"<p>\u8ba9 Agent \u4e3b\u52a8\u641c\u7d22\u77e5\u8bc6\u5e93\u3002</p> <pre><code>from agentica.agent.config import ToolConfig\n\nagent = Agent(\n    knowledge=knowledge,\n    tool_config=ToolConfig(search_knowledge=True),  # Agent \u53ef\u4ee5\u4e3b\u52a8\u641c\u7d22\n    instructions=[\n        \"\u9047\u5230\u4e13\u4e1a\u95ee\u9898\u65f6\uff0c\u5148\u641c\u7d22\u77e5\u8bc6\u5e93\",\n        \"\u7efc\u5408\u591a\u4e2a\u6765\u6e90\u7684\u4fe1\u606f\u56de\u7b54\",\n    ],\n)\n</code></pre>"},{"location":"guides/best_practices/#4_2","title":"4. \u6df7\u5408\u68c0\u7d22","text":"<pre><code>from agentica.vectordb import LanceDb\n\ndb = LanceDb(\n    search_type=\"hybrid\",  # \u6df7\u5408\u68c0\u7d22\uff1a\u5411\u91cf + \u5173\u952e\u8bcd\n    reranker=CohereReranker(),  # \u91cd\u6392\u5e8f\n)\n</code></pre>"},{"location":"guides/best_practices/#_5","title":"\u591a\u8f6e\u5bf9\u8bdd","text":""},{"location":"guides/best_practices/#1_5","title":"1. \u542f\u7528\u591a\u8f6e\u7b56\u7565","text":"<pre><code>agent = Agent(\n    enable_multi_round=True,\n    max_rounds=50,        # \u6700\u5927\u8f6e\u6570\n    max_tokens=100000,    # token \u9650\u5236\n)\n</code></pre>"},{"location":"guides/best_practices/#2_5","title":"2. \u76d1\u63a7\u591a\u8f6e\u8fdb\u5ea6","text":"<pre><code>async for response in agent.run_stream(\"\u590d\u6742\u4efb\u52a1\"):\n    if response.event == \"MultiRoundTurn\":\n        print(f\"\u8f6e\u6b21 {response.extra_data.round}\")\n    elif response.event == \"MultiRoundToolCall\":\n        print(f\"\u8c03\u7528\u5de5\u5177: {response.content}\")\n    elif response.event == \"MultiRoundCompleted\":\n        print(\"\u4efb\u52a1\u5b8c\u6210\")\n</code></pre>"},{"location":"guides/best_practices/#3_4","title":"3. \u4e0a\u4e0b\u6587\u538b\u7f29","text":"<pre><code>from agentica import CompressionManager\nfrom agentica.agent.config import ToolConfig\n\nagent = Agent(\n    tool_config=ToolConfig(\n        compress_tool_results=True,\n        compression_manager=CompressionManager(\n            compress_token_limit=50000,\n        ),\n    ),\n)\n</code></pre>"},{"location":"guides/best_practices/#_6","title":"\u56e2\u961f\u534f\u4f5c","text":""},{"location":"guides/best_practices/#1-agent","title":"1. Agent \u56e2\u961f","text":"<pre><code>researcher = Agent(\n    name=\"Researcher\",\n    role=\"\u7814\u7a76\u5458\",\n    instructions=[\"\u8d1f\u8d23\u4fe1\u606f\u641c\u7d22\"],\n    tools=[DuckDuckGoTool()],\n)\n\nwriter = Agent(\n    name=\"Writer\",\n    role=\"\u5199\u624b\",\n    instructions=[\"\u8d1f\u8d23\u5185\u5bb9\u521b\u4f5c\"],\n)\n\n# \u4e3b Agent \u534f\u8c03\u56e2\u961f\nleader = Agent(\n    name=\"Leader\",\n    team=[researcher, writer],\n    instructions=[\n        \"\u534f\u8c03\u56e2\u961f\u5b8c\u6210\u4efb\u52a1\",\n        \"\u7814\u7a76\u4efb\u52a1\u4ea4\u7ed9 Researcher\",\n        \"\u5199\u4f5c\u4efb\u52a1\u4ea4\u7ed9 Writer\",\n    ],\n)\n\nleader.print_response(\"\u5199\u4e00\u7bc7\u5173\u4e8e AI \u7684\u6587\u7ae0\")\n</code></pre>"},{"location":"guides/best_practices/#2-agent","title":"2. Agent \u4f5c\u4e3a\u5de5\u5177","text":"<pre><code># \u5c06 Agent \u8f6c\u6362\u4e3a\u5de5\u5177\nresearch_tool = researcher.as_tool(\n    tool_name=\"research\",\n    tool_description=\"\u8fdb\u884c\u6df1\u5ea6\u7814\u7a76\",\n)\n\nmain_agent = Agent(\n    tools=[research_tool, other_tools...],\n)\n</code></pre>"},{"location":"guides/best_practices/#3-workflow","title":"3. Workflow \u7f16\u6392","text":"<pre><code>from agentica import Workflow, RunResponse\n\nclass ArticleWorkflow(Workflow):\n    researcher: Agent\n    writer: Agent\n    reviewer: Agent\n\n    def run(self, topic: str) -&gt; RunResponse:\n        # 1. \u7814\u7a76\n        research = self.researcher.run(f\"\u7814\u7a76: {topic}\")\n\n        # 2. \u5199\u4f5c\n        draft = self.writer.run(f\"\u57fa\u4e8e\u7814\u7a76\u5199\u6587\u7ae0:\\n{research.content}\")\n\n        # 3. \u5ba1\u6838\n        final = self.reviewer.run(f\"\u5ba1\u6838\u5e76\u6539\u8fdb:\\n{draft.content}\")\n\n        return RunResponse(content=final.content)\n</code></pre>"},{"location":"guides/best_practices/#_7","title":"\u6027\u80fd\u4f18\u5316","text":""},{"location":"guides/best_practices/#1_6","title":"1. \u6d41\u5f0f\u8f93\u51fa","text":"<pre><code># \u540c\u6b65\u6d41\u5f0f\u8f93\u51fa\u63d0\u5347\u7528\u6237\u4f53\u9a8c\nfor chunk in agent.run_stream_sync(\"\u95ee\u9898\"):\n    print(chunk.content, end=\"\", flush=True)\n\n# \u5f02\u6b65\u6d41\u5f0f\u8f93\u51fa\nasync for chunk in agent.run_stream(\"\u95ee\u9898\"):\n    print(chunk.content, end=\"\", flush=True)\n</code></pre>"},{"location":"guides/best_practices/#2_6","title":"2. \u5f02\u6b65\u6267\u884c","text":"<pre><code>import asyncio\n\nasync def process_queries(queries):\n    tasks = [agent.run(q) for q in queries]\n    return await asyncio.gather(*tasks)\n\nresults = asyncio.run(process_queries([\"\u95ee\u98981\", \"\u95ee\u98982\", \"\u95ee\u98983\"]))\n</code></pre>"},{"location":"guides/best_practices/#3_5","title":"3. \u6a21\u578b\u9009\u62e9","text":"<pre><code># \u7b80\u5355\u4efb\u52a1\u7528\u5c0f\u6a21\u578b\nsimple_agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o-mini\"),\n)\n\n# \u590d\u6742\u4efb\u52a1\u7528\u5927\u6a21\u578b\ncomplex_agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n)\n</code></pre>"},{"location":"guides/best_practices/#4_3","title":"4. \u7f13\u5b58","text":"<pre><code>from functools import lru_cache\n\n@lru_cache(maxsize=100)\ndef cached_search(query: str) -&gt; str:\n    \"\"\"\u7f13\u5b58\u641c\u7d22\u7ed3\u679c\"\"\"\n    return do_search(query)\n</code></pre>"},{"location":"guides/best_practices/#5-token","title":"5. Token \u7ba1\u7406","text":"<pre><code>from agentica import count_tokens\n\n# \u68c0\u67e5 token \u4f7f\u7528\ntokens = count_tokens(messages, model_id=\"gpt-4o\")\nif tokens &gt; 100000:\n    # \u538b\u7f29\u6216\u622a\u65ad\n    ...\n</code></pre>"},{"location":"guides/best_practices/#_8","title":"\u9519\u8bef\u5904\u7406","text":""},{"location":"guides/best_practices/#1_7","title":"1. \u91cd\u8bd5\u673a\u5236","text":"<pre><code>from tenacity import retry, stop_after_attempt, wait_exponential\n\n@retry(\n    stop=stop_after_attempt(3),\n    wait=wait_exponential(min=1, max=10),\n)\ndef robust_agent_call(agent, message):\n    return agent.run(message)\n</code></pre>"},{"location":"guides/best_practices/#2_7","title":"2. \u8d85\u65f6\u5904\u7406","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(\n        timeout=60,  # \u8bf7\u6c42\u8d85\u65f6\n        max_retries=3,\n    ),\n)\n</code></pre>"},{"location":"guides/best_practices/#3_6","title":"3. \u4f18\u96c5\u964d\u7ea7","text":"<pre><code>try:\n    response = agent.run(\"\u95ee\u9898\")\nexcept Exception as e:\n    logger.error(f\"Agent \u9519\u8bef: {e}\")\n    response = RunResponse(content=\"\u62b1\u6b49\uff0c\u6211\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u3002\")\n</code></pre>"},{"location":"guides/best_practices/#4_4","title":"4. \u5de5\u5177\u9519\u8bef\u5904\u7406","text":"<pre><code>from agentica.tools import ToolCallException\n\ndef risky_tool(data: str) -&gt; str:\n    try:\n        return process(data)\n    except ValueError as e:\n        raise ToolCallException(\n            user_message=f\"\u5904\u7406\u5931\u8d25: {e}\",\n            stop_execution=False,  # \u7ee7\u7eed\u6267\u884c\n        )\n</code></pre>"},{"location":"guides/best_practices/#_9","title":"\u751f\u4ea7\u90e8\u7f72","text":""},{"location":"guides/best_practices/#1_8","title":"1. \u73af\u5883\u914d\u7f6e","text":"<pre><code>import os\n\n# \u4f7f\u7528\u73af\u5883\u53d8\u91cf\nagent = Agent(\n    model=OpenAIChat(\n        api_key=os.getenv(\"OPENAI_API_KEY\"),\n        base_url=os.getenv(\"OPENAI_BASE_URL\"),\n    ),\n)\n</code></pre>"},{"location":"guides/best_practices/#2_8","title":"2. \u65e5\u5fd7\u8bb0\u5f55","text":"<pre><code>from agentica.utils.log import logger, set_log_level_to_debug\n\n# \u5f00\u53d1\u73af\u5883\nset_log_level_to_debug()\n\n# \u751f\u4ea7\u73af\u5883\nimport logging\nlogger.setLevel(logging.WARNING)\n</code></pre>"},{"location":"guides/best_practices/#3_7","title":"3. \u76d1\u63a7\u6307\u6807","text":"<pre><code># \u54cd\u5e94\u4e2d\u5305\u542b\u6307\u6807\nresponse = agent.run(\"\u95ee\u9898\")\nprint(response.metrics)\n# {\n#     \"input_tokens\": 100,\n#     \"output_tokens\": 200,\n#     \"time_to_first_token\": 0.5,\n#     \"total_time\": 2.3,\n# }\n</code></pre>"},{"location":"guides/best_practices/#4-api","title":"4. API \u670d\u52a1","text":"<pre><code>from fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\nagent = Agent(...)\n\nclass Query(BaseModel):\n    message: str\n    session_id: str = None\n\n@app.post(\"/chat\")\nasync def chat(query: Query):\n    agent.session_id = query.session_id\n    response = await agent.run(query.message)\n    return {\"content\": response.content}\n</code></pre>"},{"location":"guides/best_practices/#5","title":"5. \u5b89\u5168\u8003\u8651","text":"<pre><code># \u9650\u5236\u5de5\u5177\u6743\u9650\nagent = Agent(\n    tools=[\n        ShellTool(allowed_commands=[\"ls\", \"cat\"]),  # \u767d\u540d\u5355\n        FileTool(base_dir=\"./safe_dir\"),  # \u9650\u5236\u76ee\u5f55\n    ],\n)\n\n# \u8f93\u5165\u9a8c\u8bc1\ndef validate_input(message: str) -&gt; str:\n    if len(message) &gt; 10000:\n        raise ValueError(\"\u8f93\u5165\u8fc7\u957f\")\n    # \u5176\u4ed6\u9a8c\u8bc1...\n    return message\n</code></pre>"},{"location":"guides/best_practices/#_10","title":"\u5e38\u89c1\u95ee\u9898","text":""},{"location":"guides/best_practices/#q-agent","title":"Q: Agent \u4e0d\u8c03\u7528\u5de5\u5177\uff1f","text":"<p>A: \u68c0\u67e5\u4ee5\u4e0b\u51e0\u70b9\uff1a 1. \u5de5\u5177\u63cf\u8ff0\u662f\u5426\u6e05\u6670 2. \u6307\u4ee4\u4e2d\u662f\u5426\u63d0\u5230\u4f7f\u7528\u5de5\u5177 3. \u6a21\u578b\u662f\u5426\u652f\u6301\u5de5\u5177\u8c03\u7528</p> <pre><code>agent = Agent(\n    tools=[my_tool],\n    instructions=[\"\u4f7f\u7528 my_tool \u5de5\u5177\u5b8c\u6210\u4efb\u52a1\"],\n)\n</code></pre>"},{"location":"guides/best_practices/#q","title":"Q: \u54cd\u5e94\u592a\u6162\uff1f","text":"<p>A: \u4f18\u5316\u5efa\u8bae\uff1a 1. \u4f7f\u7528\u6d41\u5f0f\u8f93\u51fa 2. \u51cf\u5c11\u5de5\u5177\u6570\u91cf 3. \u4f7f\u7528\u66f4\u5feb\u7684\u6a21\u578b 4. \u542f\u7528\u538b\u7f29</p>"},{"location":"guides/best_practices/#q-token","title":"Q: Token \u8d85\u9650\uff1f","text":"<p>A: \u89e3\u51b3\u65b9\u6848\uff1a 1. \u542f\u7528\u538b\u7f29 2. \u51cf\u5c11\u5386\u53f2\u6d88\u606f 3. \u4f7f\u7528\u4f1a\u8bdd\u6458\u8981 4. \u5206\u5757\u5904\u7406\u957f\u6587\u672c</p>"},{"location":"guides/best_practices/#q_1","title":"Q: \u7ed3\u679c\u4e0d\u51c6\u786e\uff1f","text":"<p>A: \u6539\u8fdb\u65b9\u6cd5\uff1a 1. \u4f18\u5316\u63d0\u793a\u8bcd 2. \u6dfb\u52a0 Few-shot \u793a\u4f8b 3. \u4f7f\u7528\u66f4\u5f3a\u7684\u6a21\u578b 4. \u6dfb\u52a0\u77e5\u8bc6\u5e93</p> <p>\u6587\u6863\u6700\u540e\u66f4\u65b0: 2026-02-16</p>"},{"location":"guides/guardrails/","title":"\u5b89\u5168\u5b88\u536b (Guardrails)","text":"<p>Guardrails \u63d0\u4f9b Agent \u8fd0\u884c\u65f6\u7684\u8f93\u5165\u8f93\u51fa\u9a8c\u8bc1\u673a\u5236\uff0c\u9632\u6b62\u4e0d\u5f53\u5185\u5bb9\u901a\u8fc7\u3002\u652f\u6301 Agent \u7ea7\u548c Tool \u7ea7\u4e24\u5c42\u5b88\u536b\u3002</p>"},{"location":"guides/guardrails/#_1","title":"\u4e24\u5c42\u5b88\u536b","text":"<pre><code>\u7528\u6237\u8f93\u5165 \u2192 [InputGuardrail] \u2192 Agent \u5904\u7406 \u2192 [OutputGuardrail] \u2192 \u8fd4\u56de\u7528\u6237\n                                  \u2193\n                          \u5de5\u5177\u8c03\u7528\u53c2\u6570 \u2192 [ToolInputGuardrail]\n                          \u5de5\u5177\u8fd4\u56de\u503c \u2192 [ToolOutputGuardrail]\n</code></pre>"},{"location":"guides/guardrails/#agent","title":"Agent \u7ea7\u5b88\u536b","text":""},{"location":"guides/guardrails/#_2","title":"\u8f93\u5165\u5b88\u536b","text":"<p>\u5728 Agent \u5904\u7406\u7528\u6237\u6d88\u606f\u4e4b\u524d\u9a8c\u8bc1\uff1a</p> <pre><code>from agentica import Agent, InputGuardrail, GuardrailFunctionOutput\n\n@input_guardrail\nasync def block_sensitive_info(text: str) -&gt; GuardrailFunctionOutput:\n    \"\"\"\u963b\u6b62\u5305\u542b\u654f\u611f\u4fe1\u606f\u7684\u8f93\u5165\"\"\"\n    sensitive_keywords = [\"\u5bc6\u7801\", \"\u8eab\u4efd\u8bc1\", \"\u94f6\u884c\u5361\"]\n    for kw in sensitive_keywords:\n        if kw in text:\n            return GuardrailFunctionOutput(\n                tripwire_triggered=True,\n                output_text=f\"\u68c0\u6d4b\u5230\u654f\u611f\u4fe1\u606f\uff08{kw}\uff09\uff0c\u8bf7\u52ff\u8f93\u5165\u4e2a\u4eba\u9690\u79c1\u6570\u636e\u3002\",\n            )\n    return GuardrailFunctionOutput(tripwire_triggered=False)\n\nagent = Agent(\n    input_guardrails=[\n        InputGuardrail(guardrail_function=block_sensitive_info),\n    ],\n)\n</code></pre>"},{"location":"guides/guardrails/#_3","title":"\u8f93\u51fa\u5b88\u536b","text":"<p>\u5728\u8fd4\u56de\u7528\u6237\u4e4b\u524d\u9a8c\u8bc1 Agent \u7684\u8f93\u51fa\uff1a</p> <pre><code>from agentica import OutputGuardrail, GuardrailFunctionOutput\n\n@output_guardrail\nasync def check_output_quality(text: str) -&gt; GuardrailFunctionOutput:\n    \"\"\"\u68c0\u67e5\u8f93\u51fa\u8d28\u91cf\"\"\"\n    if len(text) &lt; 10:\n        return GuardrailFunctionOutput(\n            tripwire_triggered=True,\n            output_text=\"\u8f93\u51fa\u5185\u5bb9\u8fc7\u77ed\uff0c\u8bf7\u63d0\u4f9b\u66f4\u8be6\u7ec6\u7684\u56de\u7b54\u3002\",\n        )\n    return GuardrailFunctionOutput(tripwire_triggered=False)\n\nagent = Agent(\n    output_guardrails=[\n        OutputGuardrail(guardrail_function=check_output_quality),\n    ],\n)\n</code></pre>"},{"location":"guides/guardrails/#tool","title":"Tool \u7ea7\u5b88\u536b","text":""},{"location":"guides/guardrails/#_4","title":"\u5de5\u5177\u8f93\u5165\u5b88\u536b","text":"<p>\u5728\u5de5\u5177\u6267\u884c\u524d\u9a8c\u8bc1\u53c2\u6570\uff1a</p> <pre><code>from agentica import ToolInputGuardrail, ToolGuardrailFunctionOutput\n\n@tool_input_guardrail\nasync def validate_shell_command(\n    tool_name: str, arguments: dict\n) -&gt; ToolGuardrailFunctionOutput:\n    \"\"\"\u963b\u6b62\u5371\u9669\u7684 Shell \u547d\u4ee4\"\"\"\n    if tool_name == \"execute\":\n        cmd = arguments.get(\"command\", \"\")\n        dangerous = [\"rm -rf\", \"sudo\", \"chmod 777\", \"mkfs\"]\n        for d in dangerous:\n            if d in cmd:\n                return ToolGuardrailFunctionOutput(\n                    tripwire_triggered=True,\n                    output_text=f\"\u963b\u6b62\u6267\u884c\u5371\u9669\u547d\u4ee4\uff1a{d}\",\n                )\n    return ToolGuardrailFunctionOutput(tripwire_triggered=False)\n\nagent = Agent(\n    tool_input_guardrails=[\n        ToolInputGuardrail(guardrail_function=validate_shell_command),\n    ],\n)\n</code></pre>"},{"location":"guides/guardrails/#_5","title":"\u5de5\u5177\u8f93\u51fa\u5b88\u536b","text":"<p>\u5728\u5de5\u5177\u8fd4\u56de\u7ed3\u679c\u540e\u8fc7\u6ee4\uff1a</p> <pre><code>@tool_output_guardrail\nasync def filter_sensitive_output(\n    tool_name: str, result: str\n) -&gt; ToolGuardrailFunctionOutput:\n    \"\"\"\u8fc7\u6ee4\u5de5\u5177\u8f93\u51fa\u4e2d\u7684\u654f\u611f\u4fe1\u606f\"\"\"\n    import re\n    # \u8131\u654f\uff1a\u9690\u85cf API Key \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\n    cleaned = re.sub(r'sk-[a-zA-Z0-9]{32,}', 'sk-***REDACTED***', result)\n    return ToolGuardrailFunctionOutput(\n        tripwire_triggered=False,\n        output_text=cleaned,\n    )\n</code></pre>"},{"location":"guides/guardrails/#_6","title":"\u884c\u4e3a\u6a21\u5f0f","text":"<p>\u5b88\u536b\u89e6\u53d1\u65f6\u6709\u4e09\u79cd\u884c\u4e3a\uff1a</p> \u6a21\u5f0f <code>tripwire_triggered</code> \u6548\u679c \u5141\u8bb8 <code>False</code> \u6b63\u5e38\u7ee7\u7eed \u62d2\u7edd\u5e76\u66ff\u6362 <code>True</code> + <code>output_text</code> \u7528\u66ff\u6362\u6587\u672c\u4f5c\u4e3a\u54cd\u5e94 \u629b\u51fa\u5f02\u5e38 raise <code>GuardrailTripwireTriggered</code> \u4e2d\u6b62\u6267\u884c <pre><code>from agentica import InputGuardrailTripwireTriggered\n\n@input_guardrail\nasync def strict_guardrail(text: str) -&gt; GuardrailFunctionOutput:\n    if \"forbidden\" in text:\n        raise InputGuardrailTripwireTriggered(\"\u4e25\u683c\u7981\u6b62\u7684\u5185\u5bb9\")\n    return GuardrailFunctionOutput(tripwire_triggered=False)\n</code></pre>"},{"location":"guides/guardrails/#_7","title":"\u7ec4\u5408\u4f7f\u7528","text":"<pre><code>agent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    tools=[ShellTool()],\n    input_guardrails=[\n        InputGuardrail(guardrail_function=block_sensitive_info),\n        InputGuardrail(guardrail_function=check_input_length),\n    ],\n    output_guardrails=[\n        OutputGuardrail(guardrail_function=check_output_quality),\n    ],\n    tool_input_guardrails=[\n        ToolInputGuardrail(guardrail_function=validate_shell_command),\n    ],\n    tool_output_guardrails=[\n        ToolOutputGuardrail(guardrail_function=filter_sensitive_output),\n    ],\n)\n</code></pre>"},{"location":"guides/guardrails/#_8","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u5de5\u5177\u7ea7\u5b88\u536b\u7684\u66f4\u591a\u7ec6\u8282</li> <li>Agent \u6982\u5ff5 \u2014 Agent \u6574\u4f53\u67b6\u6784</li> <li>API \u53c2\u8003 \u2014 Guardrail API</li> </ul>"},{"location":"guides/mcp/","title":"Model Context Protocol (MCP) Tools","text":"<p>This module provides a client implementation for the Model Context Protocol (MCP), allowing you to easily integrate MCP servers with your Agentica agents.</p>"},{"location":"guides/mcp/#features","title":"Features","text":"<ul> <li>Support for both stdio and SSE transport modes</li> <li>Explicit parameter names for each transport type</li> <li>Async context manager-based API for easy resource management</li> <li>Tool caching for improved performance</li> <li>Automatic tool registration with your agents</li> </ul>"},{"location":"guides/mcp/#installation","title":"Installation","text":"<p>Make sure you have the <code>mcp</code> package installed:</p> <pre><code>pip install mcp\n</code></pre>"},{"location":"guides/mcp/#basic-usage","title":"Basic Usage","text":""},{"location":"guides/mcp/#using-the-mcptool-class","title":"Using the McpTool Class","text":"<p>The <code>McpTool</code> class is the primary way to integrate MCP services with your Agentica agents:</p> <pre><code>from agentica import Agent, OpenAIChat\nfrom agentica.tools.mcp_tool import McpTool\nfrom agentica import ShellTool\n\n# For SSE transport (direct connection to running server)\nmcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    sse_timeout=5.0,\n    sse_read_timeout=300.0\n)\n\n# For stdio transport (launches a subprocess)\nmcp_tool = McpTool(\n    command=\"python path/to/your/mcp_server.py\"\n)\n\n# Use with an agent\nasync with mcp_tool:\n    agent = Agent(\n        model=OpenAIChat(model=\"gpt-4o-mini\"),\n        tools=[ShellTool(), mcp_tool]\n    )\n\n    await agent.print_response(\"Use the weather tool to check the forecast for Beijing\")\n</code></pre>"},{"location":"guides/mcp/#using-low-level-mcpclient-and-server-classes","title":"Using Low-Level MCPClient and Server Classes","text":"<p>For more control, you can directly use the <code>MCPClient</code> and server classes:</p> <pre><code>import asyncio\nfrom agentica.mcp.client import MCPClient\nfrom agentica.mcp.server import MCPServerStdio, MCPServerSse\n\nasync def stdio_example():\n    \"\"\"Example using stdio transport\"\"\"\n    server = MCPServerStdio(\n        name=\"MathTools\",\n        params={\n            \"command\": \"python\",\n            \"args\": [\"path/to/your/mcp_server.py\"],\n            \"env\": {\"VAR\": \"value\"}\n        }\n    )\n\n    async with MCPClient(server=server) as client:\n        # List available tools\n        tools = await client.list_tools()\n        print(f\"Available tools: {[tool.name for tool in tools]}\")\n\n        # Call a tool\n        result = await client.call_tool(\"add\", {\"a\": 5, \"b\": 7})\n        text_result = client.extract_result_text(result)\n        print(f\"5 + 7 = {text_result}\")\n\nasync def sse_example():\n    \"\"\"Example using SSE transport\"\"\"\n    server = MCPServerSse(\n        name=\"WeatherService\",\n        params={\n            \"url\": \"http://localhost:8081/sse\",\n            \"headers\": {\"Authorization\": \"Bearer your-token\"},  # Optional\n            \"timeout\": 5.0,  # HTTP request timeout\n            \"sse_read_timeout\": 300.0  # SSE connection timeout\n        }\n    )\n\n    async with MCPClient(server=server) as client:\n        # Use client as in stdio example\n        tools = await client.list_tools()\n        result = await client.call_tool(\"get_weather\", {\"city\": \"Beijing\"})\n        print(client.extract_result_text(result))\n\nif __name__ == \"__main__\":\n    asyncio.run(stdio_example())\n    asyncio.run(sse_example())\n</code></pre>"},{"location":"guides/mcp/#mcptool-configuration-options","title":"McpTool Configuration Options","text":"<p>The <code>McpTool</code> class supports several configuration options:</p>"},{"location":"guides/mcp/#transport-options","title":"Transport Options","text":"<p>You must provide one of these to specify the transport method:</p> <ul> <li><code>stdio_command</code>: Command string to run the MCP server via stdio transport</li> <li><code>sse_server_url</code>: URL of the SSE endpoint for SSE transport</li> <li><code>server_params</code>: Directly provide <code>StdioServerParameters</code> for stdio transport</li> <li><code>session</code>: Directly provide an initialized <code>ClientSession</code></li> </ul>"},{"location":"guides/mcp/#sse-configuration","title":"SSE Configuration","text":"<p>For SSE transport, you can configure:</p> <ul> <li><code>sse_headers</code>: HTTP headers for the SSE connection</li> <li><code>sse_timeout</code>: HTTP request timeout in seconds (default: 5.0)</li> <li><code>sse_read_timeout</code>: SSE connection timeout in seconds (default: 300.0)</li> </ul>"},{"location":"guides/mcp/#tool-filtering","title":"Tool Filtering","text":"<p>You can filter which tools are exposed to your agent:</p> <ul> <li><code>include_tools</code>: List of tool names to include (if None, includes all)</li> <li><code>exclude_tools</code>: List of tool names to exclude</li> </ul>"},{"location":"guides/mcp/#other-options","title":"Other Options","text":"<ul> <li><code>env</code>: Environment variables to pass to the server process (for stdio transport)</li> </ul>"},{"location":"guides/mcp/#example","title":"Example","text":"<pre><code># Create an McpTool with SSE transport\nfrom agentica.tools.mcp_tool import McpTool\n\nmcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    sse_headers={\"Authorization\": \"Bearer token123\"},\n    include_tools=[\"get_weather\", \"get_forecast\"],\n    exclude_tools=[\"admin_tool\"]\n)\n\n# Create an McpTool with stdio transport\nmcp_tool = McpTool(\n    command=\"python weather_server.py --port 8081\",\n    env={\"API_KEY\": \"your_api_key\"},\n    include_tools=[\"get_weather\"]\n)\n</code></pre>"},{"location":"guides/mcp/#backward-compatibility","title":"Backward Compatibility","text":"<p>The <code>McpTool</code> class still supports environment variables for backward compatibility:</p> <pre><code>from agentica.tools.mcp_tool import McpTool\n# Using environment variables for SSE configuration\nenv = {\n    \"MCP_SERVER_URL\": \"http://localhost:8081/sse\",\n    \"MCP_SERVER_HEADERS\": '{\"Authorization\": \"Bearer token123\"}',\n    \"MCP_SERVER_TIMEOUT\": \"5\",\n    \"MCP_SERVER_READ_TIMEOUT\": \"300\"\n}\n\nmcp_tool = McpTool(env=env)\n</code></pre> <p>However, using the direct parameters is recommended for clarity and type safety.</p>"},{"location":"guides/mcp/#mcp-server-implementation","title":"MCP Server Implementation","text":"<p>If you're implementing your own MCP server, you can use the <code>FastMCP</code> class from the <code>mcp</code> package:</p> <pre><code>from mcp.server.fastmcp import FastMCP\nfrom fastapi import FastAPI\n\n# Create server\nmcp = FastMCP(\"My MCP Server\", host=\"0.0.0.0\", port=8081)\n\n# Define a tool\n@mcp.tool()\ndef get_weather(city: str) -&gt; str:\n    \"\"\"Get weather for a city\"\"\"\n    # Implementation here\n    return f\"Weather for {city}: Sunny, 25\u00b0C\"\n\n# Run the server\nif __name__ == \"__main__\":\n    # Use 'stdio' or 'sse' transport\n    mcp.run(transport=\"sse\")\n</code></pre>"},{"location":"guides/mcp/#examples","title":"Examples","text":"<p>Check out the examples directory for more complete examples:</p> <ul> <li><code>examples/41_mcp_stdio_demo.py</code>: Demonstrates how to use MCP with stdio transport</li> <li><code>examples/42_mcp_sse_server.py</code>: A simple MCP server with SSE transport</li> <li><code>examples/42_mcp_sse_client.py</code>: Demonstrates how to connect to an MCP SSE server</li> </ul>"},{"location":"guides/models/","title":"\u6a21\u578b\u63d0\u4f9b\u5546","text":"<p>Agentica \u652f\u6301 20+ \u6a21\u578b\u63d0\u4f9b\u5546\uff0c\u6240\u6709\u6a21\u578b\u7c7b\u9075\u5faa\u7edf\u4e00\u63a5\u53e3\uff0c\u53ef\u5373\u63d2\u5373\u7528\u3002</p>"},{"location":"guides/models/#_2","title":"\u652f\u6301\u7684\u6a21\u578b","text":"\u7c7b\u540d \u63d0\u4f9b\u5546 \u9ed8\u8ba4\u6a21\u578b \u73af\u5883\u53d8\u91cf <code>OpenAIChat</code> OpenAI gpt-4o-mini <code>OPENAI_API_KEY</code> <code>DeepSeek</code> DeepSeek deepseek-chat <code>DEEPSEEK_API_KEY</code> <code>ZhipuAI</code> \u667a\u8c31 AI glm-4.7-flash <code>ZHIPUAI_API_KEY</code> <code>Claude</code> Anthropic claude-sonnet-4-20250514 <code>ANTHROPIC_API_KEY</code> <code>Qwen</code> \u963f\u91cc\u901a\u4e49 qwen-plus <code>DASHSCOPE_API_KEY</code> <code>Moonshot</code> Moonshot moonshot-v1-128k <code>MOONSHOT_API_KEY</code> <code>Doubao</code> \u5b57\u8282\u8c46\u5305 doubao-pro-32k <code>DOUBAO_API_KEY</code> <code>KimiChat</code> Kimi Coding k2p5 <code>KIMI_API_KEY</code> <code>Yi</code> \u96f6\u4e00\u4e07\u7269 yi-lightning <code>YI_API_KEY</code> <code>XAI</code> xAI grok-3 <code>XAI_API_KEY</code> <code>Ollama</code> Ollama (\u672c\u5730) llama3.1 \u2014 <code>Together</code> Together AI \u2014 <code>TOGETHER_API_KEY</code> <code>LitellmChat</code> LiteLLM \u2014 \u6309\u6a21\u578b\u800c\u5b9a"},{"location":"guides/models/#_3","title":"\u57fa\u672c\u7528\u6cd5","text":""},{"location":"guides/models/#api-key","title":"\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u914d\u7f6e API Key\uff08\u63a8\u8350\uff09","text":"<pre><code>export OPENAI_API_KEY=\"sk-xxx\"\nexport ZHIPUAI_API_KEY=\"your-key\"\n</code></pre> <pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o-mini\"))\n</code></pre>"},{"location":"guides/models/#api-key_1","title":"\u76f4\u63a5\u4f20\u5165 API Key","text":"<pre><code>from agentica import Agent, DeepSeek\n\nagent = Agent(model=DeepSeek(id=\"deepseek-chat\", api_key=\"your-key\"))\n</code></pre>"},{"location":"guides/models/#_4","title":"\u6a21\u578b\u793a\u4f8b","text":""},{"location":"guides/models/#openai","title":"OpenAI","text":"<pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(model=OpenAIChat(id=\"gpt-4o\"))\nresult = agent.run_sync(\"Hello!\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#deepseek","title":"DeepSeek","text":"<pre><code>from agentica import Agent, DeepSeek\n\nagent = Agent(model=DeepSeek(id=\"deepseek-chat\"))\nresult = agent.run_sync(\"\u5199\u4e00\u4e2a\u5feb\u901f\u6392\u5e8f\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#ai","title":"\u667a\u8c31 AI\uff08\u514d\u8d39\u6a21\u578b\uff09","text":"<pre><code>from agentica import Agent, ZhipuAI\n\n# glm-4.7-flash \u514d\u8d39\uff0c\u652f\u6301\u5de5\u5177\u8c03\u7528\uff0c128k \u4e0a\u4e0b\u6587\nagent = Agent(model=ZhipuAI(id=\"glm-4.7-flash\"))\nresult = agent.run_sync(\"\u4e00\u53e5\u8bdd\u4ecb\u7ecd\u5317\u4eac\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#claude-anthropic","title":"Claude (Anthropic)","text":"<pre><code>from agentica import Agent, Claude\n\nagent = Agent(model=Claude(id=\"claude-sonnet-4-20250514\"))\nresult = agent.run_sync(\"Explain quantum computing\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#kimi-coding","title":"Kimi Coding","text":"<pre><code>from agentica import Agent, KimiChat\n\nagent = Agent(model=KimiChat(id=\"k2p5\"))\nresult = agent.run_sync(\"\u5199\u4e00\u4e2a\u4e8c\u5206\u67e5\u627e\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#ollama","title":"Ollama\uff08\u672c\u5730\u6a21\u578b\uff09","text":"<pre><code>from agentica import Agent, Ollama\n\nagent = Agent(model=Ollama(id=\"llama3.1\"))\nresult = agent.run_sync(\"What is Python?\")\nprint(result.content)\n</code></pre>"},{"location":"guides/models/#litellm","title":"LiteLLM\uff08\u7edf\u4e00\u63a5\u53e3\uff09","text":"<p>\u901a\u8fc7 LiteLLM \u53ef\u4ee5\u7528\u7edf\u4e00\u63a5\u53e3\u8c03\u7528 100+ \u6a21\u578b\uff1a</p> <pre><code>from agentica import Agent, LitellmChat\n\n# \u4f7f\u7528 Bedrock\nagent = Agent(model=LitellmChat(id=\"bedrock/anthropic.claude-v2\"))\n\n# \u4f7f\u7528 Azure OpenAI\nagent = Agent(model=LitellmChat(id=\"azure/gpt-4\"))\n</code></pre>"},{"location":"guides/models/#_5","title":"\u5207\u6362\u6a21\u578b","text":"<p>\u6240\u6709\u6a21\u578b\u7c7b\u9075\u5faa\u7edf\u4e00\u63a5\u53e3\uff0c\u5207\u6362\u6a21\u578b\u53ea\u9700\u66f4\u6539\u4e00\u884c\uff1a</p> <pre><code>from agentica import Agent, OpenAIChat, DeepSeek, ZhipuAI\n\n# \u5f00\u53d1\u9636\u6bb5\u7528\u514d\u8d39\u6a21\u578b\nagent = Agent(model=ZhipuAI())\n\n# \u751f\u4ea7\u73af\u5883\u5207\u6362\u4e3a\u66f4\u5f3a\u6a21\u578b\nagent = Agent(model=OpenAIChat(id=\"gpt-4o\"))\n\n# \u6216\u4f7f\u7528 DeepSeek\nagent = Agent(model=DeepSeek())\n</code></pre>"},{"location":"guides/rag/","title":"RAG \u6307\u5357","text":"<p>RAG (Retrieval-Augmented Generation) \u8ba9 Agent \u57fa\u4e8e\u4f60\u7684\u79c1\u6709\u6587\u6863\u56de\u7b54\u95ee\u9898\uff0c\u800c\u975e\u4ec5\u4f9d\u8d56\u6a21\u578b\u7684\u8bad\u7ec3\u77e5\u8bc6\u3002</p>"},{"location":"guides/rag/#_1","title":"\u57fa\u672c\u6d41\u7a0b","text":"<pre><code>\u7528\u6237\u63d0\u95ee \u2192 \u5411\u91cf\u68c0\u7d22 \u2192 \u63d0\u53d6\u76f8\u5173\u6587\u6863 \u2192 \u6ce8\u5165\u4e0a\u4e0b\u6587 \u2192 LLM \u751f\u6210\u56de\u7b54\n</code></pre>"},{"location":"guides/rag/#_2","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"guides/rag/#1","title":"1. \u521b\u5efa\u77e5\u8bc6\u5e93","text":"<pre><code>from agentica import Knowledge\nfrom agentica.vectordb import LanceDb\nfrom agentica.emb import OpenAIEmb\n\nknowledge = Knowledge(\n    data_path=\"./documents\",          # \u6587\u6863\u76ee\u5f55\u6216\u6587\u4ef6\n    vector_db=LanceDb(\n        table_name=\"my_docs\",\n        uri=\"./lancedb\",\n    ),\n    chunk_size=1000,                  # \u5206\u5757\u5927\u5c0f\n    num_documents=5,                  # \u68c0\u7d22\u8fd4\u56de\u6587\u6863\u6570\n)\n\n# \u52a0\u8f7d\u6587\u6863\u5230\u5411\u91cf\u5e93\nknowledge.load(recreate=True)\n</code></pre>"},{"location":"guides/rag/#2-agent","title":"2. \u914d\u7f6e Agent","text":"<pre><code>from agentica import Agent, OpenAIChat\n\nagent = Agent(\n    model=OpenAIChat(id=\"gpt-4o\"),\n    knowledge=knowledge,\n    search_knowledge=True,          # Agent \u53ef\u4e3b\u52a8\u641c\u7d22\u77e5\u8bc6\u5e93\n    add_references=True,            # \u54cd\u5e94\u4e2d\u9644\u52a0\u5f15\u7528\u6765\u6e90\n    instructions=[\n        \"\u57fa\u4e8e\u77e5\u8bc6\u5e93\u5185\u5bb9\u56de\u7b54\u95ee\u9898\",\n        \"\u5982\u679c\u77e5\u8bc6\u5e93\u4e2d\u6ca1\u6709\u76f8\u5173\u4fe1\u606f\uff0c\u660e\u786e\u544a\u77e5\u7528\u6237\",\n        \"\u5f15\u7528\u65f6\u6ce8\u660e\u6587\u6863\u6765\u6e90\",\n    ],\n)\n\nresult = await agent.run(\"\u9879\u76ee\u7684\u90e8\u7f72\u6d41\u7a0b\u662f\u4ec0\u4e48\uff1f\")\nprint(result.content)\n</code></pre>"},{"location":"guides/rag/#_3","title":"\u652f\u6301\u7684\u6587\u6863\u683c\u5f0f","text":"<ul> <li>\u6587\u672c\u6587\u4ef6: <code>.txt</code>, <code>.md</code></li> <li>PDF: <code>.pdf</code>\uff08\u9700\u8981 <code>PyPDF2</code> \u6216 <code>pdfplumber</code>\uff09</li> <li>CSV: <code>.csv</code></li> </ul>"},{"location":"guides/rag/#_4","title":"\u5411\u91cf\u6570\u636e\u5e93","text":""},{"location":"guides/rag/#lancedb","title":"LanceDB\uff08\u63a8\u8350\uff0c\u96f6\u4f9d\u8d56\uff09","text":"<pre><code>from agentica.vectordb import LanceDb\n\ndb = LanceDb(\n    table_name=\"documents\",\n    uri=\"./lancedb\",\n)\n</code></pre>"},{"location":"guides/rag/#chromadb","title":"ChromaDB","text":"<pre><code>from agentica.vectordb import ChromaDb\n\ndb = ChromaDb(\n    collection=\"documents\",\n    path=\"./chromadb\",\n)\n</code></pre>"},{"location":"guides/rag/#_5","title":"\u5176\u4ed6\u9009\u9879","text":"<pre><code>from agentica.vectordb import (\n    InMemoryVectorDb,   # \u5185\u5b58\uff08\u6d4b\u8bd5\u7528\uff09\n    PgVectorDb,         # PostgreSQL + pgvector\n    PineconeDb,         # Pinecone\uff08\u4e91\u670d\u52a1\uff09\n    QdrantDb,           # Qdrant\n)\n</code></pre>"},{"location":"guides/rag/#embedding","title":"Embedding \u6a21\u578b","text":"<pre><code>from agentica.emb import (\n    OpenAIEmb,         # OpenAI text-embedding-3-small\n    ZhipuAIEmb,        # \u667a\u8c31 AI embedding\n    JinaEmb,           # Jina Embeddings\n    OllamaEmb,         # \u672c\u5730 Ollama\n    HuggingfaceEmb,    # HuggingFace \u6a21\u578b\n)\n\n# \u793a\u4f8b\uff1a\u4f7f\u7528\u667a\u8c31 AI\nknowledge = Knowledge(\n    data_path=\"./docs\",\n    vector_db=LanceDb(\n        table_name=\"docs\",\n        uri=\"./lancedb\",\n        embedder=ZhipuAIEmb(),\n    ),\n)\n</code></pre>"},{"location":"guides/rag/#agentic-rag","title":"Agentic RAG","text":"<p>\u9664\u4e86\u81ea\u52a8\u68c0\u7d22\uff0cAgent \u8fd8\u53ef\u4ee5\u4e3b\u52a8\u51b3\u5b9a\u4f55\u65f6\u641c\u7d22\u77e5\u8bc6\u5e93\uff1a</p> <pre><code>agent = Agent(\n    knowledge=knowledge,\n    search_knowledge=True,   # Agent \u81ea\u4e3b\u5224\u65ad\u662f\u5426\u9700\u8981\u641c\u7d22\n    instructions=[\n        \"\u9047\u5230\u4e13\u4e1a\u95ee\u9898\u65f6\uff0c\u5148\u641c\u7d22\u77e5\u8bc6\u5e93\",\n        \"\u7efc\u5408\u591a\u4e2a\u6765\u6e90\u7684\u4fe1\u606f\u56de\u7b54\",\n    ],\n)\n</code></pre> <p>\u6a21\u578b\u4f1a\u5c06 <code>search_knowledge_base</code> \u4f5c\u4e3a\u5de5\u5177\u8c03\u7528\uff0c\u81ea\u4e3b\u51b3\u5b9a\u641c\u7d22\u65f6\u673a\u548c\u67e5\u8be2\u8bcd\u3002</p>"},{"location":"guides/rag/#_6","title":"\u6df7\u5408\u68c0\u7d22\u4e0e\u91cd\u6392\u5e8f","text":""},{"location":"guides/rag/#_7","title":"\u6df7\u5408\u68c0\u7d22","text":"<p>\u7ed3\u5408\u5411\u91cf\u68c0\u7d22\u548c\u5173\u952e\u8bcd\u68c0\u7d22\uff1a</p> <pre><code>from agentica.vectordb import LanceDb\n\ndb = LanceDb(\n    table_name=\"docs\",\n    uri=\"./lancedb\",\n    search_type=\"hybrid\",    # \u5411\u91cf + \u5173\u952e\u8bcd\n)\n</code></pre>"},{"location":"guides/rag/#_8","title":"\u91cd\u6392\u5e8f","text":"<p>\u4f7f\u7528\u91cd\u6392\u5e8f\u6a21\u578b\u4f18\u5316\u68c0\u7d22\u7ed3\u679c\uff1a</p> <pre><code>from agentica.rerank import CohereReranker, JinaReranker, ZhipuAIReranker\n\ndb = LanceDb(\n    table_name=\"docs\",\n    uri=\"./lancedb\",\n    reranker=CohereReranker(),\n)\n</code></pre>"},{"location":"guides/rag/#_9","title":"\u7b2c\u4e09\u65b9\u96c6\u6210","text":""},{"location":"guides/rag/#langchain","title":"LangChain","text":"<pre><code>from agentica import LangChainKnowledge\n\nknowledge = LangChainKnowledge(\n    retriever=my_langchain_retriever,\n)\n</code></pre>"},{"location":"guides/rag/#llamaindex","title":"LlamaIndex","text":"<pre><code>from agentica import LlamaIndexKnowledge\n\nknowledge = LlamaIndexKnowledge(\n    retriever=my_llamaindex_retriever,\n)\n</code></pre>"},{"location":"guides/rag/#_10","title":"\u6700\u4f73\u5b9e\u8df5","text":"\u5b9e\u8df5 \u8bf4\u660e \u9002\u5f53\u7684\u5206\u5757\u5927\u5c0f 1000-2000 \u5b57\u7b26\u901a\u5e38\u6548\u679c\u6700\u4f73 \u68c0\u7d22\u6570\u91cf 3-5 \u4e2a\u6587\u6863\uff0c\u8fc7\u591a\u4f1a\u7a00\u91ca\u76f8\u5173\u6027 \u6e05\u6670\u7684\u6307\u4ee4 \u544a\u8bc9 Agent \u4f55\u65f6\u548c\u5982\u4f55\u4f7f\u7528\u77e5\u8bc6\u5e93 \u5b9a\u671f\u66f4\u65b0 \u6587\u6863\u53d8\u66f4\u540e\u91cd\u65b0\u52a0\u8f7d\uff08<code>upsert=True</code>\uff09 \u6df7\u5408\u68c0\u7d22 \u5173\u952e\u8bcd + \u5411\u91cf\u68c0\u7d22\u4e92\u8865\u6548\u679c\u597d \u91cd\u6392\u5e8f \u68c0\u7d22\u540e\u91cd\u6392\u5e8f\u663e\u8457\u63d0\u5347\u51c6\u786e\u7387"},{"location":"guides/rag/#_11","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>Agent \u6982\u5ff5 \u2014 Agent \u5982\u4f55\u96c6\u6210\u77e5\u8bc6\u5e93</li> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u81ea\u5b9a\u4e49\u68c0\u7d22\u5de5\u5177</li> <li>API \u53c2\u8003 \u2014 Knowledge API</li> </ul>"},{"location":"guides/terminal/","title":"CLI \u7ec8\u7aef\u6307\u5357","text":"<p>Agentica \u63d0\u4f9b\u529f\u80fd\u4e30\u5bcc\u7684\u547d\u4ee4\u884c\u754c\u9762\uff0c\u652f\u6301\u4ea4\u4e92\u5f0f\u5bf9\u8bdd\u3001\u5de5\u5177\u8c03\u7528\u3001\u6587\u4ef6\u5f15\u7528\u7b49\u529f\u80fd\u3002</p> <p></p>"},{"location":"guides/terminal/#_1","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code># \u4ea4\u4e92\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09\nagentica\n\n# \u5355\u6b21\u67e5\u8be2\nagentica --query \"\u89e3\u91ca\u4ec0\u4e48\u662f RAG\"\n\n# \u6307\u5b9a\u6a21\u578b\nagentica --model_provider zhipuai --model_name glm-4.7-flash\n\n# \u4f7f\u7528 OpenAI \u6a21\u578b\nagentica --model_provider openai --model_name gpt-4o\n\n# \u4f7f\u7528 DeepSeek\nagentica --model_provider deepseek --model_name deepseek-chat\n</code></pre>"},{"location":"guides/terminal/#_2","title":"\u547d\u4ee4\u884c\u53c2\u6570","text":"\u53c2\u6570 \u8bf4\u660e \u9ed8\u8ba4\u503c <code>--query</code>, <code>-q</code> \u5355\u6b21\u67e5\u8be2\u5185\u5bb9 \u2014 <code>--model_provider</code> \u6a21\u578b\u63d0\u4f9b\u5546 <code>openai</code> <code>--model_name</code> \u6a21\u578b\u540d\u79f0 <code>gpt-4o-mini</code> <code>--tools</code> \u542f\u7528\u7684\u5de5\u5177\u5217\u8868 \u2014 <code>--debug</code> \u8c03\u8bd5\u6a21\u5f0f <code>False</code>"},{"location":"guides/terminal/#_3","title":"\u542f\u7528\u5de5\u5177","text":"<pre><code># \u542f\u7528\u641c\u7d22\u548c Shell \u5de5\u5177\nagentica --tools baidu_search shell\n\n# \u542f\u7528\u591a\u4e2a\u5de5\u5177\nagentica --tools baidu_search shell wikipedia weather\n</code></pre>"},{"location":"guides/terminal/#_4","title":"\u4ea4\u4e92\u6a21\u5f0f\u529f\u80fd","text":""},{"location":"guides/terminal/#_5","title":"\u6587\u4ef6\u5f15\u7528","text":"<p>\u4f7f\u7528 <code>@filename</code> \u5728\u5bf9\u8bdd\u4e2d\u5f15\u7528\u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code>&gt; @main.py \u8fd9\u6bb5\u4ee3\u7801\u6709\u4ec0\u4e48\u95ee\u9898\uff1f\n&gt; @README.md \u5e2e\u6211\u4f18\u5316\u8fd9\u4e2a\u6587\u6863\n</code></pre>"},{"location":"guides/terminal/#_6","title":"\u5185\u7f6e\u547d\u4ee4","text":"\u547d\u4ee4 \u8bf4\u660e <code>/help</code> \u663e\u793a\u5e2e\u52a9\u4fe1\u606f <code>/clear</code> \u6e05\u9664\u5bf9\u8bdd\u5386\u53f2 <code>/exit</code> \u9000\u51fa"},{"location":"guides/terminal/#_7","title":"\u5feb\u6377\u952e","text":"\u5feb\u6377\u952e \u529f\u80fd <code>Ctrl+C</code> \u4e2d\u6b62\u5f53\u524d\u54cd\u5e94\uff08\u4f1a\u8c03\u7528 <code>agent.cancel()</code>\uff09 <code>Ctrl+D</code> \u9000\u51fa"},{"location":"guides/terminal/#acp","title":"ACP \u6a21\u5f0f","text":"<p>\u542f\u52a8 ACP (Agent Client Protocol) \u670d\u52a1\u5668\uff0c\u4e0e IDE \u96c6\u6210\uff1a</p> <pre><code>agentica acp\n</code></pre>"},{"location":"guides/terminal/#ide","title":"IDE \u914d\u7f6e","text":"<p>Zed \u2014 \u7f16\u8f91 <code>~/.config/zed/settings.json</code>\uff1a</p> <pre><code>{\n  \"agent_servers\": {\n    \"Agentica\": {\n      \"type\": \"custom\",\n      \"command\": \"agentica\",\n      \"args\": [\"acp\"],\n      \"env\": {\n        \"OPENAI_API_KEY\": \"your-api-key\"\n      }\n    }\n  }\n}\n</code></pre> <p>JetBrains \u2014 \u7f16\u8f91 <code>~/.jetbrains/acp.json</code>\uff1a</p> <pre><code>{\n  \"agent_servers\": {\n    \"Agentica\": {\n      \"command\": \"agentica\",\n      \"args\": [\"acp\"],\n      \"env\": {\n        \"OPENAI_API_KEY\": \"your-api-key\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"guides/terminal/#_8","title":"\u6d41\u5f0f\u8f93\u51fa","text":"<p>CLI \u9ed8\u8ba4\u4f7f\u7528\u6d41\u5f0f\u8f93\u51fa\uff0c\u652f\u6301\uff1a</p> <ul> <li>\u5185\u5bb9\u6d41\u5f0f\u8f93\u51fa \u2014 \u6253\u5b57\u673a\u6548\u679c\u5b9e\u65f6\u663e\u793a</li> <li>\u601d\u8003\u8fc7\u7a0b \u2014 \u63a8\u7406\u6a21\u578b\u7684\u601d\u8003\u6b65\u9aa4</li> <li>\u5de5\u5177\u8c03\u7528\u5c55\u793a \u2014 \u663e\u793a\u5de5\u5177\u8c03\u7528\u540d\u79f0\u548c\u53c2\u6570</li> <li>\u5de5\u5177\u7ed3\u679c\u9884\u89c8 \u2014 Claude Code \u98ce\u683c\u7684\u7ed3\u679c\u6458\u8981\u663e\u793a</li> <li>\u5b50\u4efb\u52a1\u8fdb\u5ea6 \u2014 \u5b50 Agent \u6267\u884c\u65f6\u7684\u8fdb\u5ea6\u6c47\u62a5</li> </ul>"},{"location":"guides/terminal/#_9","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u5feb\u901f\u5165\u95e8 \u2014 \u5b89\u88c5\u548c\u57fa\u7840\u7528\u6cd5</li> <li>\u5de5\u5177\u7cfb\u7edf \u2014 \u4e86\u89e3\u53ef\u7528\u5de5\u5177</li> <li>Agent \u6982\u5ff5 \u2014 Agent \u6838\u5fc3\u6982\u5ff5</li> </ul>"},{"location":"guides/tools/","title":"\u5de5\u5177\u7cfb\u7edf","text":"<p>\u5de5\u5177\u8d4b\u4e88 Agent \u4e0e\u5916\u90e8\u4e16\u754c\u4ea4\u4e92\u7684\u80fd\u529b\u3002Agentica \u63d0\u4f9b 40+ \u5185\u7f6e\u5de5\u5177\uff0c\u5e76\u652f\u6301\u81ea\u5b9a\u4e49\u5de5\u5177\u548c MCP \u534f\u8bae\u96c6\u6210\u3002</p>"},{"location":"guides/tools/#_2","title":"\u521b\u5efa\u81ea\u5b9a\u4e49\u5de5\u5177","text":""},{"location":"guides/tools/#_3","title":"\u51fd\u6570\u5de5\u5177\uff08\u63a8\u8350\uff09","text":"<p>\u4efb\u4f55\u5e26\u7c7b\u578b\u6ce8\u89e3\u548c docstring \u7684 Python \u51fd\u6570\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u5de5\u5177\uff1a</p> <pre><code>def get_weather(city: str) -&gt; str:\n    \"\"\"\u83b7\u53d6\u6307\u5b9a\u57ce\u5e02\u7684\u5929\u6c14\u4fe1\u606f\n\n    Args:\n        city: \u57ce\u5e02\u540d\u79f0\uff0c\u5982 \"\u5317\u4eac\"\u3001\"\u4e0a\u6d77\"\n    \"\"\"\n    # \u5b9e\u9645\u5b9e\u73b0...\n    return f\"{city}\uff1a\u6674\uff0c25\u00b0C\"\n\nagent = Agent(tools=[get_weather])\n</code></pre> <p>\u8981\u70b9\uff1a</p> <ul> <li>\u51fd\u6570\u540d\u5373\u5de5\u5177\u540d</li> <li>docstring \u7b2c\u4e00\u884c\u662f\u5de5\u5177\u63cf\u8ff0</li> <li><code>Args</code> \u90e8\u5206\u63cf\u8ff0\u5404\u53c2\u6570\u542b\u4e49</li> <li>\u53c2\u6570\u7c7b\u578b\u6ce8\u89e3\u7528\u4e8e\u751f\u6210 JSON Schema</li> <li>\u8fd4\u56de\u503c\u5efa\u8bae\u7528 <code>str</code>\uff08JSON \u683c\u5f0f\u66f4\u4f73\uff09</li> </ul>"},{"location":"guides/tools/#_4","title":"\u5f02\u6b65\u51fd\u6570\u5de5\u5177","text":"<p>I/O \u5bc6\u96c6\u578b\u5de5\u5177\u5efa\u8bae\u4f7f\u7528 async\uff1a</p> <pre><code>import aiohttp\n\nasync def fetch_url(url: str) -&gt; str:\n    \"\"\"\u6293\u53d6\u6307\u5b9a URL \u7684\u7f51\u9875\u5185\u5bb9\n\n    Args:\n        url: \u8981\u6293\u53d6\u7684\u7f51\u9875 URL\n    \"\"\"\n    async with aiohttp.ClientSession() as session:\n        async with session.get(url) as resp:\n            return await resp.text()\n\nagent = Agent(tools=[fetch_url])\n</code></pre> <p>Agentica \u4f1a\u81ea\u52a8\u68c0\u6d4b sync/async\uff0csync \u51fd\u6570\u5728 async \u4e0a\u4e0b\u6587\u4e2d\u901a\u8fc7 <code>run_in_executor</code> \u6267\u884c\u3002</p>"},{"location":"guides/tools/#_5","title":"\u7c7b\u5de5\u5177","text":"<p>\u9002\u5408\u5c01\u88c5\u4e00\u7ec4\u76f8\u5173\u529f\u80fd\uff1a</p> <pre><code>from agentica import Tool\n\nclass DatabaseTool(Tool):\n    def __init__(self, connection_string: str):\n        super().__init__(name=\"database\")\n        self.conn_str = connection_string\n        self.register(self.query)\n        self.register(self.list_tables)\n\n    def query(self, sql: str) -&gt; str:\n        \"\"\"\u6267\u884c SQL \u67e5\u8be2\n\n        Args:\n            sql: SQL \u67e5\u8be2\u8bed\u53e5\n        \"\"\"\n        # \u5b9e\u9645\u5b9e\u73b0...\n        return \"query results\"\n\n    def list_tables(self) -&gt; str:\n        \"\"\"\u5217\u51fa\u6240\u6709\u6570\u636e\u5e93\u8868\"\"\"\n        return \"users, orders, products\"\n\nagent = Agent(tools=[DatabaseTool(\"sqlite:///app.db\")])\n</code></pre>"},{"location":"guides/tools/#_6","title":"\u5de5\u5177\u8fd4\u56de\u503c\u5efa\u8bae","text":"<pre><code>import json\n\n# \u63a8\u8350\uff1a\u7ed3\u6784\u5316 JSON \u8fd4\u56de\ndef search_products(query: str, max_price: float = None) -&gt; str:\n    \"\"\"\u641c\u7d22\u4ea7\u54c1\n\n    Args:\n        query: \u641c\u7d22\u5173\u952e\u8bcd\n        max_price: \u6700\u9ad8\u4ef7\u683c\u9650\u5236\n    \"\"\"\n    results = [\n        {\"name\": \"iPhone 16\", \"price\": 7999},\n        {\"name\": \"Pixel 9\", \"price\": 5499},\n    ]\n    return json.dumps(results, ensure_ascii=False)\n</code></pre>"},{"location":"guides/tools/#_7","title":"\u5185\u7f6e\u5de5\u5177","text":""},{"location":"guides/tools/#_8","title":"\u641c\u7d22\u7c7b","text":"\u5de5\u5177 \u8bf4\u660e \u4f9d\u8d56 <code>BaiduSearchTool</code> \u767e\u5ea6\u641c\u7d22 \u2014 <code>DuckDuckGoTool</code> DuckDuckGo \u641c\u7d22 <code>duckduckgo-search</code> <code>SearchSerperTool</code> Serper \u641c\u7d22 API <code>SERPER_API_KEY</code> <code>ExaTool</code> Exa \u8bed\u4e49\u641c\u7d22 <code>exa-py</code> <code>SearchBochaTool</code> \u535a\u67e5\u641c\u7d22 \u2014 <pre><code>from agentica import Agent, BaiduSearchTool\n\nagent = Agent(tools=[BaiduSearchTool()])\n</code></pre>"},{"location":"guides/tools/#shell","title":"\u4ee3\u7801\u4e0eShell","text":"\u5de5\u5177 \u8bf4\u660e <code>ShellTool</code> \u6267\u884c Shell \u547d\u4ee4 <code>CodeTool</code> Python \u4ee3\u7801\u6267\u884c <code>PatchTool</code> \u6587\u4ef6\u8865\u4e01\u64cd\u4f5c <pre><code>from agentica import Agent, ShellTool\n\nagent = Agent(tools=[ShellTool()])\n</code></pre>"},{"location":"guides/tools/#_9","title":"\u7f51\u9875\u4e0e\u6587\u4ef6","text":"\u5de5\u5177 \u8bf4\u660e <code>UrlCrawlerTool</code> \u7f51\u9875\u5185\u5bb9\u6293\u53d6 <code>JinaTool</code> Jina Reader API <code>BrowserTool</code> \u6d4f\u89c8\u5668\u81ea\u52a8\u5316 <code>FileTool</code> \u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c"},{"location":"guides/tools/#_10","title":"\u77e5\u8bc6\u4e0e\u6570\u636e","text":"\u5de5\u5177 \u8bf4\u660e <code>ArxivTool</code> Arxiv \u8bba\u6587\u641c\u7d22 <code>WikipediaTool</code> Wikipedia \u641c\u7d22 <code>YFinanceTool</code> \u91d1\u878d\u6570\u636e\u67e5\u8be2 <code>WeatherTool</code> \u5929\u6c14\u67e5\u8be2 <code>SqlTool</code> SQL \u6570\u636e\u5e93\u67e5\u8be2 <code>HackerNewsTool</code> Hacker News"},{"location":"guides/tools/#_11","title":"\u591a\u5a92\u4f53","text":"\u5de5\u5177 \u8bf4\u660e <code>DalleTool</code> DALL-E \u56fe\u50cf\u751f\u6210 <code>CogViewTool</code> \u667a\u8c31 CogView \u56fe\u50cf\u751f\u6210 <code>CogVideoTool</code> \u667a\u8c31 CogVideo \u89c6\u9891\u751f\u6210 <code>ImageAnalysisTool</code> \u56fe\u50cf\u5206\u6790 <code>OcrTool</code> \u6587\u5b57\u8bc6\u522b (OCR)"},{"location":"guides/tools/#_12","title":"\u7279\u6b8a\u5de5\u5177","text":"\u5de5\u5177 \u8bf4\u660e <code>UserInputTool</code> \u8fd0\u884c\u65f6\u5411\u7528\u6237\u63d0\u95ee (Human-in-the-loop) <code>SkillTool</code> Agent Skill \u7cfb\u7edf <code>McpTool</code> MCP \u534f\u8bae\u96c6\u6210"},{"location":"guides/tools/#mcp","title":"MCP \u96c6\u6210","text":"<p>Model Context Protocol (MCP) \u662f\u4e00\u4e2a\u6807\u51c6\u5316\u7684\u5de5\u5177\u96c6\u6210\u534f\u8bae\u3002</p>"},{"location":"guides/tools/#stdio","title":"stdio \u4f20\u8f93","text":"<pre><code>from agentica import Agent, OpenAIChat\nfrom agentica.tools.mcp_tool import McpTool\n\nmcp_tool = McpTool(\n    command=\"python path/to/mcp_server.py\"\n)\n\nasync with mcp_tool:\n    agent = Agent(\n        model=OpenAIChat(id=\"gpt-4o\"),\n        tools=[mcp_tool],\n    )\n    await agent.print_response(\"\u4f7f\u7528\u5de5\u5177\u67e5\u8be2\u5929\u6c14\")\n</code></pre>"},{"location":"guides/tools/#sse","title":"SSE \u4f20\u8f93","text":"<pre><code>mcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    sse_timeout=5.0,\n    sse_read_timeout=300.0,\n)\n\nasync with mcp_tool:\n    agent = Agent(tools=[mcp_tool])\n    await agent.print_response(\"\u67e5\u8be2\u5317\u4eac\u5929\u6c14\")\n</code></pre>"},{"location":"guides/tools/#json","title":"JSON \u914d\u7f6e","text":"<pre><code>from agentica import MCPConfig\n\nconfig = MCPConfig(\n    servers=[\n        {\n            \"name\": \"filesystem\",\n            \"command\": \"npx\",\n            \"args\": [\"-y\", \"@anthropic/mcp-filesystem\", \"/path/to/dir\"],\n        }\n    ]\n)\n\nagent = Agent(mcp_config=config)\n</code></pre>"},{"location":"guides/tools/#_13","title":"\u5de5\u5177\u8fc7\u6ee4","text":"<pre><code>mcp_tool = McpTool(\n    url=\"http://localhost:8081/sse\",\n    include_tools=[\"get_weather\", \"get_forecast\"],\n    exclude_tools=[\"admin_tool\"],\n)\n</code></pre>"},{"location":"guides/tools/#_14","title":"\u5de5\u5177\u4f7f\u7528\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"guides/tools/#1","title":"1. \u6e05\u6670\u7684\u5de5\u5177\u63cf\u8ff0","text":"<p>\u6a21\u578b\u901a\u8fc7\u5de5\u5177\u63cf\u8ff0\u51b3\u5b9a\u4f55\u65f6\u8c03\u7528\u3002\u63cf\u8ff0\u8d8a\u6e05\u6670\uff0c\u8c03\u7528\u8d8a\u51c6\u786e\uff1a</p> <pre><code># \u597d\u7684\u63cf\u8ff0\ndef search_database(query: str, table: str = \"users\") -&gt; str:\n    \"\"\"\u5728\u6570\u636e\u5e93\u4e2d\u641c\u7d22\u8bb0\u5f55\n\n    \u6839\u636e\u5173\u952e\u8bcd\u5728\u6307\u5b9a\u8868\u4e2d\u641c\u7d22\u5339\u914d\u7684\u8bb0\u5f55\u3002\n    \u8fd4\u56de JSON \u683c\u5f0f\u7684\u7ed3\u679c\u5217\u8868\u3002\n\n    Args:\n        query: \u641c\u7d22\u5173\u952e\u8bcd\n        table: \u76ee\u6807\u8868\u540d\uff0c\u53ef\u9009\u503c\uff1ausers, orders, products\n    \"\"\"\n</code></pre>"},{"location":"guides/tools/#2","title":"2. \u63a7\u5236\u5de5\u5177\u6570\u91cf","text":"<p>\u5de5\u5177\u8fc7\u591a\u4f1a\u964d\u4f4e\u6a21\u578b\u7684\u9009\u62e9\u51c6\u786e\u6027\uff1a</p> <pre><code># \u63a8\u8350\uff1a3-7 \u4e2a\u76f8\u5173\u5de5\u5177\nagent = Agent(tools=[search, crawl, analyze])\n\n# \u907f\u514d\uff1a\u8fc7\u591a\u5de5\u5177\nagent = Agent(tools=[...15\u4e2a\u5de5\u5177...])\n</code></pre>"},{"location":"guides/tools/#3","title":"3. \u9519\u8bef\u5904\u7406","text":"<p>\u5de5\u5177\u5e94\u8fd4\u56de\u6709\u610f\u4e49\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u800c\u975e\u629b\u51fa\u5f02\u5e38\uff1a</p> <pre><code>def call_api(endpoint: str) -&gt; str:\n    \"\"\"\u8c03\u7528\u5916\u90e8 API\"\"\"\n    try:\n        response = requests.get(endpoint, timeout=10)\n        response.raise_for_status()\n        return response.text\n    except requests.Timeout:\n        return \"\u9519\u8bef\uff1a\u8bf7\u6c42\u8d85\u65f6\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\"\n    except requests.HTTPError as e:\n        return f\"\u9519\u8bef\uff1aHTTP {e.response.status_code}\"\n</code></pre>"},{"location":"guides/tools/#_15","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>Agent \u6982\u5ff5 \u2014 Agent \u5982\u4f55\u4f7f\u7528\u5de5\u5177</li> <li>RAG \u6307\u5357 \u2014 \u77e5\u8bc6\u5e93\u68c0\u7d22</li> <li>\u5b89\u5168\u5b88\u536b \u2014 \u5de5\u5177\u7ea7\u5b89\u5168\u9a8c\u8bc1</li> <li>API \u53c2\u8003 \u2014 \u5b8c\u6574 API</li> </ul>"}]}